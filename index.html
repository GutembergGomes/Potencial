<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potencial Colheita e Transporte</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <style>
        /* Modern Color Scheme */
        :root {
            /* Primary brand colors */
            --primary-color: #3949ab;
            --primary-light: #6f74dd;
            --primary-dark: #00227b;
            --primary-color-rgb: 57, 73, 171;
            --primary-gradient: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            
            /* Accent colors */
            --accent-color: #5c6bc0;
            --accent-light: #8e99f3;
            --accent-hover: #3f51b5;
            --accent-color-rgb: 92, 107, 192;
            --accent-gradient: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            
            /* Secondary accent colors */
            --secondary-color: #26a69a;
            --secondary-light: #64d8cb;
            --secondary-dark: #00766c;
            --secondary-color-rgb: 38, 166, 154;
            --secondary-gradient: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            
            /* Interface colors */
            --text-color: #263238;
            --text-secondary: #455a64;
            --text-tertiary: #607d8b;
            --bg-color: #fff;
            --bg-secondary: #f5f7fa;
            --bg-tertiary: #e9eef2;
            --border-color: #d0d9e2;
            --card-bg: #fff;
            
            /* Header colors */
            --header-bg: linear-gradient(135deg, #303f9f, #3949ab);
            --header-text: #fff;
            --overlay-bg: rgba(255, 255, 255, 0.95);
            
            /* Effect colors */
            --shadow: 0 8px 25px rgba(0,0,0,0.08);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-hover: 0 10px 30px rgba(57, 73, 171, 0.15);
            
            /* Form elements */
            --input-bg: #fff;
            --input-border: #d0d9e2;
            --input-focus-border: #3949ab;
            --input-disabled: #f9f9fb;
            --input-shadow: 0 0 0 3px rgba(57, 73, 171, 0.1);
            
            /* Status colors */
            --success-color: #00c853;
            --success-light: #e8f5e9;
            --success-rgb: 0, 200, 83;
            --warning-color: #ffab00;
            --warning-light: #fff8e1;
            --warning-rgb: 255, 171, 0;
            --danger-color: #f44336;
            --danger-light: #ffebee;
            --danger-rgb: 244, 67, 54;
            --info-color: #0091ea;
            --info-light: #e1f5fe;
            --info-rgb: 0, 145, 234;
            
            /* Animation */
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* Fonts */
            --font-family: 'Poppins', 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        /* Dark theme */
        .dark {
            /* Primary brand colors in dark theme */
            --primary-color: #5c6bc0;
            --primary-light: #8e99f3;
            --primary-dark: #26418f;
            --primary-color-rgb: 92, 107, 192;
            --primary-gradient: linear-gradient(135deg, #303f9f, #1a237e);
            
            /* Accent colors */
            --accent-color: #7986cb;
            --accent-light: #9fa8da;
            --accent-hover: #5c6bc0;
            --accent-color-rgb: 121, 134, 203;
            --accent-gradient: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            
            /* Secondary accent colors in dark theme */
            --secondary-color: #26a69a;
            --secondary-light: #64d8cb;
            --secondary-dark: #00766c;
            --secondary-color-rgb: 38, 166, 154;
            --secondary-gradient: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            
            /* Interface colors */
            --text-color: #e0e0e0;
            --text-secondary: #b0bec5;
            --text-tertiary: #78909c;
            --bg-color: #121212;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #252538;
            --border-color: #303040;
            --card-bg: #1e1e2f;
            
            /* Header colors */
            --header-bg: linear-gradient(135deg, #1a237e, #283593);
            --header-text: #e0e0e0;
            --overlay-bg: rgba(18, 18, 34, 0.96);
            
            /* Effect colors */
            --shadow: 0 8px 25px rgba(0,0,0,0.25);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.22);
            --shadow-hover: 0 10px 30px rgba(77, 93, 221, 0.2);
            
            /* Form elements */
            --input-bg: #252538;
            --input-border: #303040;
            --input-focus-border: #5c6bc0;
            --input-disabled: #20202a;
            --input-shadow: 0 0 0 3px rgba(92, 107, 192, 0.2);
            
            /* Status colors */
            --success-color: #00e676;
            --success-light: rgba(0, 230, 118, 0.15);
            --success-rgb: 0, 230, 118;
            --warning-color: #ffca28;
            --warning-light: rgba(255, 202, 40, 0.15);
            --warning-rgb: 255, 202, 40;
            --danger-color: #ff5252;
            --danger-light: rgba(255, 82, 82, 0.15);
            --danger-rgb: 255, 82, 82;
            --info-color: #29b6f6;
            --info-light: rgba(41, 182, 246, 0.15);
            --info-rgb: 41, 182, 246;
        }

        * {
            box-sizing: border-box;
            transition: var(--transition);
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-image: url('https://images.unsplash.com/photo-1601584115197-04ecc0da31d7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
            position: relative;
            line-height: 1.6;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-bg);
            z-index: -1;
        }

        header {
            background: var(--header-bg);
            color: var(--header-text);
            padding: 1.25rem 1rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.25rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .logo {
            height: 50px;
            filter: brightness(0) invert(1);
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        h1 {
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin: 0;
            font-weight: 600;
        }

        .subtitle {
            margin: 0.25rem 0 0;
            font-style: italic;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .header-controls {
            position: absolute;
            top: 1.25rem;
            right: 1.25rem;
            display: flex;
            gap: 0.75rem;
        }

        .theme-toggle, .settings-toggle, .help-toggle {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: var(--header-text);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.6rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(4px);
            z-index: 10;
        }

        .theme-toggle:hover, .theme-toggle:focus,
        .settings-toggle:hover, .settings-toggle:focus,
        .help-toggle:hover, .help-toggle:focus {
            background-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            outline: none;
        }

        .theme-toggle:focus-visible,
        .settings-toggle:focus-visible,
        .help-toggle:focus-visible {
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }

        nav {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .tab-button {
            padding: 0.625rem 1.25rem;
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-button:hover, .tab-button:focus {
            background-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            outline: none;
        }

        .tab-button:focus-visible {
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }

        .tab-button.active {
            background-color: var(--accent-color);
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
            background-color: var(--card-bg);
            border-radius: 12px;
            margin: 1.25rem;
            box-shadow: var(--shadow);
            padding: 1.75rem;
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .dark h2, .dark h3, .dark h4 {
            color: var(--accent-color);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .data-table th, .data-table td {
            border: 1px solid var(--border-color);
            padding: 0.85rem 0.6rem;
            text-align: center;
            background-color: var(--card-bg);
        }

        .data-table th {
            background: var(--primary-gradient);
            color: white;
            position: sticky;
            top: 0;
            font-weight: 500;
        }

        /* Responsive tables */
        .table-container {
            overflow-x: auto;
            position: relative;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }

        .table-container::after {
            content: "← Deslize →";
            position: absolute;
            bottom: -24px;
            right: 0;
            font-size: 0.75rem;
            color: var(--text-color);
            opacity: 0.7;
            pointer-events: none;
        }

        @media (min-width: 1200px) {
            .table-container::after {
                display: none;
            }
        }

        /* DataTables styling */
        table.dataTable {
            border-collapse: collapse !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        table.dataTable thead th, table.dataTable thead td {
            border-bottom: 1px solid var(--border-color) !important;
        }

        table.dataTable.no-footer {
            border-bottom: none !important;
        }

        .dataTables_wrapper .dataTables_length, 
        .dataTables_wrapper .dataTables_filter, 
        .dataTables_wrapper .dataTables_info, 
        .dataTables_wrapper .dataTables_processing, 
        .dataTables_wrapper .dataTables_paginate {
            color: var(--text-color) !important;
            margin-bottom: 10px;
        }

        .dataTables_wrapper .dataTables_filter input {
            border: 1px solid var(--input-border) !important;
            background-color: var(--input-bg) !important;
            color: var(--text-color) !important;
            border-radius: 6px !important;
            padding: 6px 10px !important;
            margin-left: 10px !important;
            font-size: 16px !important;
        }

        .dataTables_wrapper .dataTables_length select {
            border: 1px solid var(--input-border) !important;
            background-color: var(--input-bg) !important;
            color: var(--text-color) !important;
            border-radius: 6px !important;
            padding: 4px 8px !important;
            font-size: 16px !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            background-color: var(--bg-tertiary) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 4px !important;
            padding: 6px 12px !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: var(--primary-color) !important;
            color: white !important;
            border: 1px solid var(--primary-dark) !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: var(--accent-color) !important;
            color: white !important;
            border: 1px solid var(--accent-hover) !important;
        }

        input, select, button, textarea {
            font-family: var(--font-family);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.15);
        }

        input[readonly] {
            background-color: var(--input-disabled);
            cursor: not-allowed;
            opacity: 0.8;
        }

        .controls {
            margin-bottom: 1.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1.25rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            font-size: 16px;
        }

        .btn:hover, .btn:focus {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            outline: none;
        }

        .btn:focus-visible {
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: rgba(93, 92, 222, 0.15);
            color: var(--primary-color);
        }

        .btn-secondary:hover, .btn-secondary:focus {
            background-color: rgba(93, 92, 222, 0.25);
        }

        .dark .btn-secondary {
            color: var(--accent-color);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover, .btn-success:focus {
            background-color: var(--success-color);
            filter: brightness(1.1);
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn-warning:hover, .btn-warning:focus {
            background-color: var(--warning-color);
            filter: brightness(1.1);
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover, .btn-danger:focus {
            background-color: var(--danger-color);
            filter: brightness(1.1);
        }

        .btn-outlined {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outlined:hover, .btn-outlined:focus {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-sm {
            padding: 0.35rem 0.75rem;
            font-size: 0.85rem;
        }

        .btn-lg {
            padding: 0.9rem 1.75rem;
            font-size: 1.1rem;
        }

        .section {
            margin-top: 2.5rem;
            padding: 1.75rem;
            background-color: var(--bg-tertiary);
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }

        .transport-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .transport-col {
            padding: 1.75rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .transport-col::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
            opacity: 0.8;
        }

        .transport-col:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .transport-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.85rem;
            align-items: center;
        }

        .transport-row label {
            font-weight: 500;
            margin-right: 0.85rem;
            flex: 1;
        }

        .transport-row input, 
        .transport-row select {
            flex: 1;
        }

        .results {
            margin-top: 1.75rem;
            background-color: var(--card-bg);
            padding: 1.75rem;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.85rem;
            align-items: center;
        }

        .result-row label {
            font-weight: 600;
            margin-right: 0.85rem;
            flex: 2;
        }

        .result-row input {
            flex: 1;
            font-weight: 600;
            color: var(--accent-color);
            text-align: center;
        }

        .equipamentos-tabs {
            display: flex;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .equip-tab-button {
            padding: 0.625rem 1.25rem;
            background-color: rgba(93, 92, 222, 0.15);
            color: var(--primary-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .equip-tab-button:hover, .equip-tab-button:focus {
            background-color: rgba(93, 92, 222, 0.25);
            transform: translateY(-2px);
            outline: none;
        }

        .equip-tab-button:focus-visible {
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.4);
        }

        .equip-tab-button.active {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(0);
        }

        .equip-frente {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }

        .equip-frente.active {
            display: block;
        }

        .equip-results {
            margin-top: 1.75rem;
            background-color: var(--bg-tertiary);
            padding: 1.75rem;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
        }

        .equip-result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.85rem;
            align-items: center;
        }

        .equip-result-row label {
            font-weight: 500;
            margin-right: 0.85rem;
            flex: 2;
        }

        .equip-result-row input {
            flex: 1;
        }

        .hours-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.25rem;
        }

        .hours-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
            padding: 1.25rem;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .hours-row:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .hours-row label {
            font-weight: 500;
            margin-right: 0.85rem;
            flex: 2;
        }

        .hours-row input {
            flex: 1;
        }

        .form-cadastro {
            max-width: 650px;
            margin: 1.5rem auto;
            padding: 1.75rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .form-row {
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
        }

        .form-row label {
            width: 160px;
            font-weight: 500;
            margin-right: 1.25rem;
        }

        .form-row input,
        .form-row select,
        .form-row textarea {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 16px; /* Increased font size for mobile input fields */
        }

        footer {
            background: var(--header-bg);
            color: white;
            text-align: center;
            padding: 1.25rem;
            margin-top: 2.5rem;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-container {
            width: 100%;
            max-width: 850px;
            height: 400px;
            margin: 2.5rem auto;
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            position: relative;
            border: 1px solid rgba(var(--primary-color-rgb), 0.1);
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .multi-chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 1.5rem;
            margin: 2.5rem auto;
        }

        .small-chart-container {
            height: 300px;
            width: 100%;
            background-color: var(--card-bg);
            padding: 1rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            position: relative;
            border: 1px solid rgba(var(--primary-color-rgb), 0.1);
        }

        .small-chart-container:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }

        .spinner {
            width: 64px;
            height: 64px;
            border: 6px solid transparent;
            border-radius: 50%;
            border-top-color: var(--primary-color);
            border-bottom-color: var(--accent-color);
            animation: spinner 1.2s ease infinite;
            margin-bottom: 1.25rem;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(720deg); }
        }

        .grid-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
            margin: 1.5rem 0;
        }

        .dashboard-card {
            background-color: var(--card-bg);
            background-image: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 100%);
            border-radius: 16px;
            padding: 1.8rem;
            box-shadow: var(--shadow-sm);
            text-align: center;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(var(--primary-color-rgb), 0.1);
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            opacity: 0.8;
            transition: height 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
        }

        .dashboard-card:hover::before {
            height: 6px;
        }

        .dashboard-card h3 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            position: relative;
            display: inline-block;
        }

        .dashboard-card h3::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }

        .dashboard-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-color);
            margin: 1.5rem 0 1rem;
            text-shadow: 0 2px 10px rgba(var(--primary-color-rgb), 0.2);
            transition: color 0.3s ease, text-shadow 0.3s ease;
            position: relative;
        }

        .dashboard-card:hover .value {
            text-shadow: 0 4px 12px rgba(var(--primary-color-rgb), 0.3);
        }

        .dashboard-card .label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 0.3px;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            background-color: rgba(var(--primary-color-rgb), 0.08);
            display: inline-block;
        }

        .dashboard-card .trend {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.25rem;
            padding: 0.25rem;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trend-up {
            color: var(--success-color);
            background-color: var(--success-light);
        }

        .trend-down {
            color: var(--danger-color);
            background-color: var(--danger-light);
        }

        .trend-neutral {
            color: var(--info-color);
            background-color: var(--info-light);
        }

        .dashboard-card-lg {
            grid-column: span 2;
        }

        .timestamp {
            text-align: right;
            font-size: 0.85rem;
            margin-top: -0.5rem;
            margin-bottom: 1.25rem;
            font-style: italic;
            color: var(--text-color);
            opacity: 0.7;
        }

        .toast {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background-color: var(--success-color);
            color: white;
            padding: 1.25rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            opacity: 0;
            transform: translateY(100px);
            transition: opacity 0.4s, transform 0.4s;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        .toast::before {
            content: '✓';
            font-weight: bold;
            font-size: 1.1rem;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background-color: var(--danger-color);
        }

        .toast.error::before {
            content: '✕';
        }

        .toast.warning {
            background-color: var(--warning-color);
        }

        .toast.warning::before {
            content: '!';
        }

        .backup-restore {
            margin-top: 1.25rem;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        .storage-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1.25rem;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .storage-status .indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .storage-status .success {
            background-color: var(--success-color);
        }

        .storage-status .error {
            background-color: var(--danger-color);
        }

        .storage-status .warning {
            background-color: var(--warning-color);
        }

        .storage-status-label {
            display: flex;
            align-items: center;
        }

        .auto-backup-toggle {
            white-space: nowrap;
            margin-left: 10px;
            cursor: pointer;
        }

        .auto-backup-toggle input {
            margin-right: 5px;
            width: auto;
        }

        /* Table summary row styling */
        .summary-row {
            background-color: var(--bg-tertiary);
            font-weight: 600;
        }

        .summary-row td {
            border-top: 2px solid var(--border-color);
        }

        /* Accessibility focus styles */
        a:focus, button:focus, input:focus, select:focus, textarea:focus {
            outline: none;
        }

        a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* Empty state styling */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* Progress bar styles */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: var(--bg-tertiary);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 10px;
            background: var(--primary-gradient);
            width: 0;
            transition: width 0.5s ease;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Report generation styles */
        .report-config {
            background-color: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .report-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .report-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .report-preview {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 2rem;
            box-shadow: var(--shadow-sm);
        }

        /* Settings modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalIn 0.3s ease;
            box-shadow: var(--shadow);
        }

        @keyframes modalIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-body {
            padding: 1.25rem;
        }

        .modal-footer {
            padding: 1.25rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-group h4 {
            margin-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding: 0.5rem 0;
        }

        .settings-row label {
            font-weight: 500;
        }

        .settings-row input[type="checkbox"] {
            width: auto;
            height: 16px;
            width: 16px;
        }

        /* Color swatch */
        .color-options {
            display: flex;
            gap: 10px;
            margin-top: 0.5rem;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .color-swatch.active {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        /* History log styles */
        .history-container {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-entry {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .history-entry:last-child {
            border-bottom: none;
        }

        .history-icon {
            font-size: 1.25rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .history-icon.add {
            background-color: var(--success-light);
            color: var(--success-color);
        }

        .history-icon.edit {
            background-color: var(--info-light);
            color: var(--info-color);
        }

        .history-icon.delete {
            background-color: var(--danger-light);
            color: var(--danger-color);
        }

        .history-icon.system {
            background-color: var(--warning-light);
            color: var(--warning-color);
        }

        .history-content {
            flex: 1;
        }

        .history-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .history-time {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        /* Filter controls */
        .filter-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        /* Badge styles */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .badge-primary {
            background-color: var(--primary-light);
            color: white;
        }

        .badge-success {
            background-color: var(--success-color);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .badge-info {
            background-color: var(--info-color);
            color: white;
        }

        /* Notification badges */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Help panel */
        .help-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 350px;
            max-width: 90vw;
            height: 100vh;
            background-color: var(--card-bg);
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .help-panel.active {
            right: 0;
        }

        .help-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-body {
            flex: 1;
            overflow-y: auto;
            padding: 1.25rem;
        }

        .help-footer {
            padding: 1.25rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
        }

        .help-topic {
            margin-bottom: 1.5rem;
        }

        .help-topic h4 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .help-topic p {
            margin-bottom: 0.5rem;
        }

        /* Confirm dialog */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 10000;
            width: 90%;
            max-width: 400px;
            padding: 1.5rem;
            display: none;
        }

        .confirm-dialog.show {
            display: block;
            animation: bounceIn 0.4s;
        }

        @keyframes bounceIn {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .confirm-dialog h3 {
            margin-top: 0;
        }

        .confirm-dialog p {
            margin-bottom: 1.5rem;
        }

        .confirm-dialog-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Data visualization enhancements */
        .data-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .insight-card {
            background-color: var(--bg-tertiary);
            border-radius: 10px;
            padding: 1.25rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 1.25rem;
            transition: transform 0.3s ease;
        }

        .insight-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .insight-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .insight-content {
            flex: 1;
        }

        .insight-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--primary-color);
        }

        /* Enhanced accordion */
        .accordion {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .accordion-header {
            padding: 1rem;
            background-color: var(--bg-secondary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .accordion-header:hover {
            background-color: var(--bg-tertiary);
        }

        .accordion-header h4 {
            margin: 0;
            font-size: 1rem;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background-color: var(--card-bg);
        }

        .accordion-content-inner {
            padding: 1rem;
        }

        .accordion.active .accordion-content {
            max-height: 500px;
        }
        
        /* File upload drop zone */
        .file-drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
            cursor: pointer;
        }
        
        .file-drop-zone:hover, .file-drop-zone.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(var(--primary-color-rgb), 0.05);
        }
        
        .file-drop-zone i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: block;
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--card-bg);
            color: var(--text-color);
            text-align: center;
            border-radius: 6px;
            padding: 0.75rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: var(--shadow);
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
        }
        
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--border-color) transparent transparent transparent;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Tags input */
        .tags-input-container {
            padding: 0.5rem;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 45px;
        }
        
        .tag {
            background-color: var(--primary-light);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tag-close {
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .tags-input {
            flex: 1;
            min-width: 100px;
            border: none;
            outline: none;
            background: transparent;
            color: var(--text-color);
            padding: 0.25rem;
        }

        /* Comparison slider */
        .comparison-slider-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            border-radius: 10px;
            margin: 2rem 0;
        }
        
        .comparison-slider {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: white;
            left: 50%;
            transform: translateX(-50%);
            cursor: ew-resize;
            z-index: 10;
        }
        
        .comparison-slider::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .comparison-slider::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100vw;
            left: -50vw;
            opacity: 0;
            cursor: ew-resize;
        }
        
        .comparison-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--card-bg);
        }
        
        .comparison-item-before {
            z-index: 1;
            width: 50%;
        }
        
        .comparison-item-after {
            z-index: 2;
        }
        
        .comparison-label {
            position: absolute;
            bottom: 10px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .comparison-label-before {
            left: 10px;
        }
        
        .comparison-label-after {
            right: 10px;
        }

        /* Print styles */
        @media print {
            body {
                background: none;
                color: #000;
            }
            
            body::before {
                display: none;
            }
            
            header, footer, .controls, .theme-toggle, .settings-toggle, .help-toggle, .tab-button:not(.active) {
                display: none;
            }
            
            .tab-content {
                display: block !important;
                break-inside: avoid;
                page-break-inside: avoid;
                margin: 0;
                padding: 0.5cm;
                box-shadow: none;
            }
            
            .chart-container {
                break-inside: avoid;
                page-break-inside: avoid;
                width: 100%;
            }
            
            input, select {
                border: 1px solid #ddd;
            }
            
            input[readonly] {
                border: none;
            }
            
            /* Print specific styles */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 1cm;
            }
            
            .print-header h1 {
                font-size: 18pt;
                margin-bottom: 0.5cm;
            }
            
            .print-footer {
                display: block !important;
                text-align: center;
                margin-top: 1cm;
                font-size: 8pt;
                color: #666;
                border-top: 1px solid #ddd;
                padding-top: 0.5cm;
            }
            
            .print-page-break {
                page-break-before: always;
            }
            
            .no-print {
                display: none !important;
            }
        }

        /* Enhanced responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            
            .logo {
                margin-bottom: 0.75rem;
            }
            
            .transport-grid,
            .hours-grid,
            .grid-dashboard,
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-row label {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .form-row input,
            .form-row select,
            .form-row textarea {
                width: 100%;
            }

            .header-controls {
                position: static;
                justify-content: center;
                margin-top: 1rem;
            }

            .tab-content,
            .section {
                margin: 1rem 0.75rem;
                padding: 1.25rem;
            }
            
            .storage-status {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .auto-backup-toggle {
                margin-left: 0;
                margin-top: 0.5rem;
            }
            
            .chart-container {
                padding: 1rem;
            }

            .dashboard-card-lg {
                grid-column: span 1;
            }

            .multi-chart-container {
                grid-template-columns: 1fr;
            }
            
            .help-panel {
                width: 100%;
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            nav {
                flex-direction: column;
                align-items: center;
            }
            
            .tab-button {
                margin: 0.25rem 0;
                width: 100%;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .controls button {
                width: 100%;
            }

            .transport-row,
            .result-row,
            .equip-result-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .transport-row label,
            .result-row label,
            .equip-result-row label {
                margin-bottom: 0.5rem;
                width: 100%;
            }

            .transport-row input,
            .result-row input,
            .equip-result-row input,
            .transport-row select {
                width: 100%;
            }
            
            .dashboard-card .value {
                font-size: 1.8rem;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .insight-card {
                flex-direction: column;
                text-align: center;
            }
            
            .insight-icon {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading" style="display: none;" aria-live="polite" role="status">
        <div class="spinner" aria-hidden="true"></div>
        <div id="loading-message">Carregando...</div>
    </div>
    
    <div id="toast" class="toast" role="alert" aria-live="assertive">
        Dados salvos com sucesso!
    </div>
    
    <div id="confirm-dialog" class="confirm-dialog" role="alertdialog" aria-labelledby="confirm-title" aria-describedby="confirm-message">
        <h3 id="confirm-title">Confirmação</h3>
        <p id="confirm-message">Tem certeza que deseja realizar esta ação?</p>
        <div class="confirm-dialog-actions">
            <button id="confirm-cancel" class="btn btn-secondary">Cancelar</button>
            <button id="confirm-ok" class="btn btn-danger">Confirmar</button>
        </div>
    </div>

    <header>
        <div class="header-controls">
            <button id="theme-toggle" class="theme-toggle" aria-label="Alternar tema claro/escuro">
                <i class="fas fa-moon" aria-hidden="true"></i>
            </button>
            <button id="settings-toggle" class="settings-toggle" aria-label="Configurações do sistema">
                <i class="fas fa-cog" aria-hidden="true"></i>
            </button>
            <button id="help-toggle" class="help-toggle" aria-label="Ajuda e dicas">
                <i class="fas fa-question" aria-hidden="true"></i>
                <span class="notification-badge">1</span>
            </button>
        </div>
        <div class="header-content">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDY0IDI1NkEyMDggMjA4IDAgMSAxIDQ4IDI1NmEyMDggMjA4IDAgMSAxIDQxNiAwek0wIDI1NmEyNTYgMjU2IDAgMSAwIDUxMiAwQTI1NiAyNTYgMCAxIDAgMCAyNTZ6TTIzMiAzMzZoNDhjOC44IDAgMTYtNy4yIDE2LTE2VjE5MmMwLTguOC03LjItMTYtMTYtMTZIMjMyYy04LjggMC0xNiA3LjItMTYgMTZ2MTI4YzAgOC44IDcuMiAxNiAxNiAxNHoiIGZpbGw9IndoaXRlIi8+PC9zdmc+" alt="Usina Icone" class="logo">
            <div>
                <h1>Potencial Colheita e Transporte Safra 2025</h1>
                <p class="subtitle">Usina Cambuí Açúcar & Álcool</p>
            </div>
        </div>
        <nav>
            <button class="tab-button active" data-tab="dashboard" aria-selected="true">
                <i class="fas fa-chart-line" aria-hidden="true"></i> Dashboard
            </button>
            <button class="tab-button" data-tab="potencial" aria-selected="false">
                <i class="fas fa-calculator" aria-hidden="true"></i> Potencial
            </button>
            <button class="tab-button" data-tab="frentes" aria-selected="false">
                <i class="fas fa-truck-moving" aria-hidden="true"></i> Dados Frentes
            </button>
            <button class="tab-button" data-tab="equipamentos" aria-selected="false">
                <i class="fas fa-tractor" aria-hidden="true"></i> Dados Equipamentos
            </button>
            <button class="tab-button" data-tab="cadastrar" aria-selected="false">
                <i class="fas fa-plus-circle" aria-hidden="true"></i> Cadastrar Frente
            </button>
            <button class="tab-button" data-tab="relatorios" aria-selected="false">
                <i class="fas fa-file-alt" aria-hidden="true"></i> Relatórios
            </button>
            <button class="tab-button" data-tab="historico" aria-selected="false">
                <i class="fas fa-history" aria-hidden="true"></i> Histórico
            </button>
        </nav>
    </header>

    <main>
        <!-- Tab Dashboard -->
        <div id="dashboard" class="tab-content active" role="tabpanel" aria-labelledby="tab-dashboard">
            <h2>Dashboard Colheita e Transporte</h2>
            <div id="lastUpdated" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="storage-status">
                <div class="storage-status-label">
                    <span class="indicator" id="storage-indicator"></span>
                    <span id="storage-status-text">Verificando armazenamento...</span>
                </div>
                <div class="auto-backup-toggle">
                    <label for="auto-backup-toggle">
                        <input type="checkbox" id="auto-backup-toggle" checked>
                        Backup automático
                    </label>
                </div>
            </div>
            
            <div class="grid-dashboard">
                <div class="dashboard-card animate__animated animate__fadeInUp">
                    <div class="trend trend-up"><i class="fas fa-arrow-up"></i></div>
                    <h3>Cota Total</h3>
                    <div id="dashboard-cota" class="value">0</div>
                    <div class="label">Toneladas</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="cota-progress" style="width: 45%"></div>
                    </div>
                    <div class="progress-label">
                        <span>45% da meta</span>
                        <span>Meta: 15.000</span>
                    </div>
                </div>
                <div class="dashboard-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
                    <div class="trend trend-up"><i class="fas fa-arrow-up"></i></div>
                    <h3>Potencial Colheita</h3>
                    <div id="dashboard-colheita" class="value">0</div>
                    <div class="label">Toneladas/Hora</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="colheita-progress" style="width: 60%"></div>
                    </div>
                    <div class="progress-label">
                        <span>60% do projetado</span>
                        <span>Meta: 600</span>
                    </div>
                </div>
                <div class="dashboard-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
                    <div class="trend trend-down"><i class="fas fa-arrow-down"></i></div>
                    <h3>Potencial Transporte</h3>
                    <div id="dashboard-transporte" class="value">0</div>
                    <div class="label">Toneladas/Hora</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="transporte-progress" style="width: 40%"></div>
                    </div>
                    <div class="progress-label">
                        <span>40% do projetado</span>
                        <span>Meta: 550</span>
                    </div>
                </div>
                <div class="dashboard-card animate__animated animate__fadeInUp" style="animation-delay: 0.3s">
                    <div class="trend trend-neutral"><i class="fas fa-minus"></i></div>
                    <h3>Caminhões Disponíveis</h3>
                    <div id="dashboard-caminhoes" class="value">0</div>
                    <div class="label">Total</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="caminhoes-progress" style="width: 75%"></div>
                    </div>
                    <div class="progress-label">
                        <span>75% da frota</span>
                        <span>Total: 60</span>
                    </div>
                </div>
            </div>
            
            <div class="data-grid">
                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">Fator Limitante</div>
                        <p id="insight-limitante">O sistema está limitado pelo transporte. Considere aumentar a disponibilidade de caminhões.</p>
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="insight-content">
                        <div class="insight-title">Maior Eficiência</div>
                        <p id="insight-eficiencia">A Frente 4001 está operando com a maior eficiência, atingindo 92% da capacidade projetada.</p>
                    </div>
                </div>
            </div>

            <div class="multi-chart-container">
                <div class="small-chart-container">
                    <canvas id="colheitaComparativoChart"></canvas>
                </div>
                <div class="small-chart-container">
                    <canvas id="colheitaHistoricoChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="potencialChart"></canvas>
            </div>
            
            <div class="multi-chart-container">
                <div class="small-chart-container">
                    <canvas id="transporteChart"></canvas>
                </div>
                <div class="small-chart-container">
                    <canvas id="eficienciaChart"></canvas>
                </div>
            </div>

            <div class="section">
                <h3>Resumo de Frentes</h3>
                <div class="table-container">
                    <table id="resumo-frentes-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Frente</th>
                                <th>Cota (t)</th>
                                <th>Produção Atual (t/h)</th>
                                <th>Capacidade (%)</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h3>Backup e Restauração</h3>
                <p>Faça o backup completo de todos os dados do sistema ou restaure a partir de um arquivo de backup.</p>
                
                <div class="file-drop-zone" id="backup-drop-zone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Arraste e solte um arquivo de backup aqui ou clique para selecionar</p>
                    <p class="text-sm text-muted">Formatos suportados: .json</p>
                </div>
                
                <div class="backup-restore">
                    <button id="backup-all" class="btn">
                        <i class="fas fa-download" aria-hidden="true"></i> Exportar Backup Completo
                    </button>
                    <button id="restore-all" class="btn">
                        <i class="fas fa-upload" aria-hidden="true"></i> Restaurar Backup
                    </button>
                    <input type="file" id="file-restore-all" accept=".json" style="display: none;">
                </div>
            </div>
        </div>

        <!-- Tab Potencial -->
        <div id="potencial" class="tab-content" role="tabpanel" aria-labelledby="tab-potencial">
            <h2>Potencial de Colheita e Transporte</h2>
            <div id="lastUpdatedPotencial" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="calc-potencial" class="btn">
                    <i class="fas fa-calculator" aria-hidden="true"></i> Calcular
                </button>
                <button id="save-all-potencial" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="export-potencial" class="btn btn-secondary">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar
                </button>
                <button id="import-potencial" class="btn btn-secondary">
                    <i class="fas fa-file-import" aria-hidden="true"></i> Importar
                </button>
                <input type="file" id="file-import-potencial" accept=".csv,.json,.xlsx" style="display: none;">
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="potencial-filter-frente">Filtrar por Frente:</label>
                    <select id="potencial-filter-frente">
                        <option value="">Todas as Frentes</option>
                        <!-- Opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="potencial-filter-transporte">Filtrar por Transporte:</label>
                    <select id="potencial-filter-transporte">
                        <option value="">Todos os Tipos</option>
                        <option value="P">Próprio</option>
                        <option value="T">Terceiro</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="potencial-sort">Ordenar por:</label>
                    <select id="potencial-sort">
                        <option value="frente">Frente</option>
                        <option value="cota">Cota</option>
                        <option value="limitante">Potencial Limitante</option>
                        <option value="frota">Frota</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table id="potencial-table" class="data-table">
                    <thead>
                        <tr>
                            <th rowspan="2">FRENTE</th>
                            <th rowspan="2">COTA (t/h)</th>
                            <th colspan="3">POTENCIAL DE COLHEITA (t/h)</th>
                            <th rowspan="2">ESTRATÉGIA CONTROLE</th>
                            <th rowspan="2">TEMPO CICLO</th>
                            <th rowspan="2">CAM/H</th>
                            <th rowspan="2">FROTA</th>
                            <th rowspan="2">INT ALOC (min)</th>
                            <th rowspan="2">STATUS</th>
                        </tr>
                        <tr>
                            <th>Máquinas</th>
                            <th>Tratores</th>
                            <th>Limitante</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                    <tfoot>
                        <tr class="summary-row">
                            <td>TOTAL</td>
                            <td><input type="text" id="potencial-total-cota" readonly></td>
                            <td><input type="text" id="potencial-total-maquinas" readonly></td>
                            <td><input type="text" id="potencial-total-tratores" readonly></td>
                            <td><input type="text" id="potencial-total-limitante" readonly></td>
                            <td><input type="text" id="potencial-total-estrategia" readonly></td>
                            <td><input type="text" id="potencial-total-tempo" readonly></td>
                            <td><input type="text" id="potencial-total-camh" readonly></td>
                            <td><input type="text" id="potencial-total-frota" readonly></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="section">
                <h3>Frota de Transporte</h3>
                <div class="transport-grid">
                    <div class="transport-col">
                        <h4>CAMINHÕES PRÓPRIOS</h4>
                        <div class="transport-row">
                            <label for="proprios-total">Total:</label>
                            <input type="number" id="proprios-total" value="20" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="proprios-parados">Parados:</label>
                            <input type="number" id="proprios-parados" value="5" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="proprios-disponiveis">Disponíveis:</label>
                            <input type="text" id="proprios-disponiveis" readonly>
                        </div>
                        <div class="transport-row">
                            <label for="proprios-necessarios">Necessários:</label>
                            <input type="text" id="proprios-necessarios" readonly>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="proprios-progress" style="width: 0%"></div>
                        </div>
                        <div class="progress-label">
                            <span id="proprios-progress-label">0% disponível</span>
                        </div>
                    </div>

                    <div class="transport-col">
                        <h4>CAMINHÕES TERCEIROS</h4>
                        <div class="transport-row">
                            <label for="terceiros-total">Total:</label>
                            <input type="number" id="terceiros-total" value="25" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="terceiros-parados">Parados:</label>
                            <input type="number" id="terceiros-parados" value="5" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="terceiros-disponiveis">Disponíveis:</label>
                            <input type="text" id="terceiros-disponiveis" readonly>
                        </div>
                        <div class="transport-row">
                            <label for="terceiros-necessarios">Necessários:</label>
                            <input type="text" id="terceiros-necessarios" readonly>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="terceiros-progress" style="width: 0%"></div>
                        </div>
                        <div class="progress-label">
                            <span id="terceiros-progress-label">0% disponível</span>
                        </div>
                    </div>

                    <div class="transport-col">
                        <h4>CONJUNTOS DE BV</h4>
                        <div class="transport-row">
                            <label for="bv-total">Total:</label>
                            <input type="number" id="bv-total" value="43" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="bv-parados">Parados:</label>
                            <input type="number" id="bv-parados" value="15" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="bv-disponiveis">Disponíveis:</label>
                            <input type="text" id="bv-disponiveis" readonly>
                        </div>
                        <div class="transport-row">
                            <label for="bv-necessarios">Necessários:</label>
                            <input type="text" id="bv-necessarios" readonly>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="bv-progress" style="width: 0%"></div>
                        </div>
                        <div class="progress-label">
                            <span id="bv-progress-label">0% disponível</span>
                        </div>
                    </div>
                </div>

                <div class="results">
                    <div class="result-row">
                        <label for="potencial-colheita">POTENCIAL DE COLHEITA:</label>
                        <input type="text" id="potencial-colheita" readonly>
                    </div>
                    <div class="result-row">
                        <label for="potencial-transporte">POTENCIAL DE TRANSPORTE:</label>
                        <input type="text" id="potencial-transporte" readonly>
                    </div>
                    <div class="result-row">
                        <label for="limitante-sistema">FATOR LIMITANTE DO SISTEMA:</label>
                        <input type="text" id="limitante-sistema" readonly>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>Análise Comparativa</h3>
                <div class="comparison-slider-container">
                    <div class="comparison-slider"></div>
                    <div class="comparison-item comparison-item-before">
                        <canvas id="potencial-before-chart"></canvas>
                        <div class="comparison-label comparison-label-before">Atual</div>
                    </div>
                    <div class="comparison-item comparison-item-after">
                        <canvas id="potencial-after-chart"></canvas>
                        <div class="comparison-label comparison-label-after">Projetado</div>
                    </div>
                </div>
                <p class="text-center">Arraste o slider para comparar o potencial atual com o projetado</p>
            </div>
        </div>

        <!-- Tab Frentes -->
        <div id="frentes" class="tab-content" role="tabpanel" aria-labelledby="tab-frentes">
            <h2>Dados das Frentes</h2>
            <div id="lastUpdatedFrentes" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="save-all-frentes" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="export-frentes" class="btn btn-secondary">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar
                </button>
                <button id="import-frentes" class="btn btn-secondary">
                    <i class="fas fa-file-import" aria-hidden="true"></i> Importar
                </button>
                <button id="compare-frentes" class="btn btn-secondary">
                    <i class="fas fa-balance-scale" aria-hidden="true"></i> Comparar Frentes
                </button>
                <input type="file" id="file-import-frentes" accept=".csv,.json,.xlsx" style="display: none;">
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="frentes-filter-id">Filtrar por ID:</label>
                    <input type="text" id="frentes-filter-id" placeholder="Ex: 4001">
                </div>
                <div class="filter-group">
                    <label for="frentes-filter-transporte">Filtrar por Transporte:</label>
                    <select id="frentes-filter-transporte">
                        <option value="">Todos os Tipos</option>
                        <option value="P">Próprio</option>
                        <option value="T">Terceiro</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="frentes-sort">Ordenar por:</label>
                    <select id="frentes-sort">
                        <option value="frente">Frente</option>
                        <option value="cota">Cota</option>
                        <option value="dist">Distância</option>
                        <option value="tempo">Tempo Total</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table id="frentes-table" class="data-table">
                    <thead>
                        <tr>
                            <th rowspan="2">FRENTE</th>
                            <th rowspan="2">COTA</th>
                            <th rowspan="2">DIST (KM)</th>
                            <th colspan="4">TEMPO CICLO CAMINHÃO (min)</th>
                            <th rowspan="2">TOTAL</th>
                            <th rowspan="2">HORAS</th>
                            <th rowspan="2">CICLO</th>
                            <th rowspan="2">CONJ BV</th>
                            <th rowspan="2">PESO (t)</th>
                            <th rowspan="2">TRANSPORTE</th>
                            <th rowspan="2">AÇÕES</th>
                        </tr>
                        <tr>
                            <th>IDA</th>
                            <th>CAMPO</th>
                            <th>VOLTA</th>
                            <th>USINA</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                    <tfoot>
                        <tr class="summary-row">
                            <td>TOTAL=</td>
                            <td><input type="text" id="frentes-total-cota" readonly></td>
                            <td><input type="text" id="frentes-media-dist" readonly></td>
                            <td><input type="text" id="frentes-media-ida" readonly></td>
                            <td><input type="text" id="frentes-media-campo" readonly></td>
                            <td><input type="text" id="frentes-media-volta" readonly></td>
                            <td><input type="text" id="frentes-media-usina" readonly></td>
                            <td><input type="text" id="frentes-media-total" readonly></td>
                            <td>CICLO</td>
                            <td><input type="text" id="frentes-media-ciclo" readonly></td>
                            <td></td>
                            <td>DENS</td>
                            <td><input type="text" id="frentes-media-dens" readonly></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="section">
                <h3>Horas Trabalhadas</h3>
                <div class="hours-grid">
                    <div class="hours-row">
                        <label for="horas-prop-4001">HORAS TRABALHADAS PROP 4001:</label>
                        <input type="number" id="horas-prop-4001" value="21" min="0">
                    </div>
                    <div class="hours-row">
                        <label for="horas-prop-4002">HORAS TRABALHADAS PROP 4002:</label>
                        <input type="number" id="horas-prop-4002" value="21" min="0">
                    </div>
                    <div class="hours-row">
                        <label for="horas-terc">HORAS TRABALHADAS TERC:</label>
                        <input type="number" id="horas-terc" value="22" min="0">
                    </div>
                </div>
                <p>(descontando as trocas de turno)</p>
            </div>

            <div class="section">
                <h3>Análise de Tempos</h3>
                <div class="chart-container">
                    <canvas id="tempoCicloChart"></canvas>
                </div>
            </div>
            
            <div class="section">
                <h3>Mapa de Frentes</h3>
                <div id="mapa-frentes" style="height: 400px; border-radius: 10px;">
                    <!-- Mapa será carregado aqui -->
                    <div style="height: 100%; display: flex; align-items: center; justify-content: center; background-color: var(--bg-tertiary); border-radius: 10px;">
                        <div style="text-align: center;">
                            <i class="fas fa-map-marked-alt" style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary-color);"></i>
                            <p>Mapa de localização das frentes de colheita</p>
                            <button id="load-map" class="btn btn-sm" style="margin-top: 1rem;">
                                <i class="fas fa-map" aria-hidden="true"></i> Carregar Mapa
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Equipamentos -->
        <div id="equipamentos" class="tab-content" role="tabpanel" aria-labelledby="tab-equipamentos">
            <h2>Dados de Equipamentos</h2>
            <div id="lastUpdatedEquipamentos" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="save-all-equipamentos" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="export-equipamentos" class="btn btn-secondary">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar
                </button>
                <button id="import-equipamentos" class="btn btn-secondary">
                    <i class="fas fa-file-import" aria-hidden="true"></i> Importar
                </button>
                <button id="add-equipamento" class="btn btn-secondary">
                    <i class="fas fa-plus" aria-hidden="true"></i> Adicionar Equipamento
                </button>
                <input type="file" id="file-import-equipamentos" accept=".csv,.json,.xlsx" style="display: none;">
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="equipamentos-filter-frente">Filtrar por Frente:</label>
                    <select id="equipamentos-filter-frente">
                        <option value="">Todas as Frentes</option>
                        <!-- Opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="equipamentos-filter-disponivel">Filtrar por Disponibilidade:</label>
                    <select id="equipamentos-filter-disponivel">
                        <option value="">Todos</option>
                        <option value="1">Disponíveis</option>
                        <option value="0">Indisponíveis</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="equipamentos-sort">Ordenar por:</label>
                    <select id="equipamentos-sort">
                        <option value="frente">Frente</option>
                        <option value="equipo">Equipamento</option>
                        <option value="producao">Produção</option>
                    </select>
                </div>
            </div>
            
            <div class="equipamentos-tabs" role="tablist">
                <!-- Tabs serão preenchidas dinamicamente -->
            </div>

            <div id="equipamentos-content" class="equipamentos-content">
                <!-- Conteúdo será preenchido dinamicamente -->
            </div>

            <div class="section">
                <h3>Análise de Produtividade</h3>
                <div class="chart-container">
                    <canvas id="produtividadeChart"></canvas>
                </div>
            </div>
            
            <div class="section">
                <h3>Manutenções Programadas</h3>
                <div class="table-container">
                    <table id="manutencoes-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Equipamento</th>
                                <th>Frente</th>
                                <th>Tipo</th>
                                <th>Data Programada</th>
                                <th>Duração Prevista</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>COLHEDORA 2</td>
                                <td>4001</td>
                                <td>Preventiva</td>
                                <td>12/07/2025</td>
                                <td>8 horas</td>
                                <td><span class="badge badge-warning">Pendente</span></td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>TRATOR 3</td>
                                <td>4002</td>
                                <td>Corretiva</td>
                                <td>08/07/2025</td>
                                <td>4 horas</td>
                                <td><span class="badge badge-info">Em andamento</span></td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 1rem;">
                    <button id="add-manutencao" class="btn btn-sm">
                        <i class="fas fa-plus" aria-hidden="true"></i> Adicionar Manutenção
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Cadastrar -->
        <div id="cadastrar" class="tab-content" role="tabpanel" aria-labelledby="tab-cadastrar">
            <h2>Cadastrar Nova Frente</h2>
            <div id="lastUpdatedCadastrar" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="add-frente" class="btn">
                    <i class="fas fa-plus-circle" aria-hidden="true"></i> Adicionar Frente
                </button>
                <button id="save-all-cadastrar" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="reset-form-cadastrar" class="btn btn-secondary">
                    <i class="fas fa-undo" aria-hidden="true"></i> Limpar Formulário
                </button>
                <button id="duplicate-frente" class="btn btn-secondary">
                    <i class="fas fa-copy" aria-hidden="true"></i> Duplicar Frente
                </button>
            </div>
            
            <div class="form-cadastro">
                <div class="form-row">
                    <label for="nova-frente-id">ID da Frente:</label>
                    <input type="text" id="nova-frente-id" placeholder="Ex: 4010" required>
                </div>
                <div class="form-row">
                    <label for="nova-frente-cota">Cota (t):</label>
                    <input type="number" id="nova-frente-cota" min="0" value="0" required>
                </div>
                <div class="form-row">
                    <label for="nova-frente-dist">Distância (km):</label>
                    <input type="number" id="nova-frente-dist" min="0" step="0.1" value="0" required>
                </div>
                <div class="form-row">
                    <label for="nova-frente-transporte">Tipo de Transporte:</label>
                    <select id="nova-frente-transporte" required>
                        <option value="P">Próprio</option>
                        <option value="T">Terceiro</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="nova-frente-peso">Peso (t):</label>
                    <input type="number" id="nova-frente-peso" min="0" value="60" required>
                </div>
                <div class="form-row">
                    <label for="nova-frente-localizacao">Localização:</label>
                    <div style="display: flex; gap: 0.5rem; flex: 1;">
                        <input type="text" id="nova-frente-lat" placeholder="Latitude" style="flex: 1;">
                        <input type="text" id="nova-frente-lng" placeholder="Longitude" style="flex: 1;">
                    </div>
                </div>
                <div class="form-row">
                    <label for="nova-frente-tags">Tags:</label>
                    <div class="tags-input-container">
                        <input type="text" class="tags-input" id="nova-frente-tags" placeholder="Digite tags e pressione Enter">
                    </div>
                </div>
                <div class="form-row">
                    <label for="nova-frente-obs">Observações:</label>
                    <textarea id="nova-frente-obs" rows="3" placeholder="Informações adicionais sobre a frente..."></textarea>
                </div>
            </div>

            <div class="section">
                <h3>Frentes Recentemente Cadastradas</h3>
                <div class="table-container">
                    <table id="recentes-frentes-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Frente</th>
                                <th>Cota (t)</th>
                                <th>Distância (km)</th>
                                <th>Transporte</th>
                                <th>Data Cadastro</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Relatórios -->
        <div id="relatorios" class="tab-content" role="tabpanel" aria-labelledby="tab-relatorios">
            <h2>Relatórios</h2>
            <div id="lastUpdatedRelatorios" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="report-config">
                <h3>Configurar Relatório</h3>
                <div class="report-form">
                    <div class="form-group">
                        <label for="report-type">Tipo de Relatório:</label>
                        <select id="report-type">
                            <option value="potencial">Potencial de Colheita</option>
                            <option value="frentes">Dados das Frentes</option>
                            <option value="equipamentos">Dados dos Equipamentos</option>
                            <option value="transporte">Análise de Transporte</option>
                            <option value="completo">Relatório Completo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-frente">Filtrar por Frente:</label>
                        <select id="report-frente">
                            <option value="">Todas as Frentes</option>
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-format">Formato de Saída:</label>
                        <select id="report-format">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="html">HTML</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-date-range">Período:</label>
                        <select id="report-date-range">
                            <option value="today">Hoje</option>
                            <option value="week">Última Semana</option>
                            <option value="month">Último Mês</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                </div>
                <div class="report-options">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="report-include-charts" checked>
                            Incluir Gráficos
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="report-include-summary" checked>
                            Incluir Resumo Executivo
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="report-include-comparison">
                            Incluir Comparação com Período Anterior
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="report-include-insights">
                            Incluir Análise de Insights
                        </label>
                    </div>
                </div>
                <div class="controls">
                    <button id="generate-report" class="btn">
                        <i class="fas fa-file-alt" aria-hidden="true"></i> Gerar Relatório
                    </button>
                    <button id="print-report" class="btn btn-secondary">
                        <i class="fas fa-print" aria-hidden="true"></i> Imprimir
                    </button>
                    <button id="save-report-config" class="btn btn-secondary">
                        <i class="fas fa-save" aria-hidden="true"></i> Salvar Configuração
                    </button>
                    <div class="tooltip" style="display: inline-block;">
                        <button id="schedule-report" class="btn btn-secondary">
                            <i class="fas fa-clock" aria-hidden="true"></i> Agendar
                        </button>
                        <span class="tooltip-text">Agende a geração automática deste relatório em intervalos regulares</span>
                    </div>
                </div>
            </div>
            
            <div class="report-preview" id="report-preview">
                <h3>Prévia do Relatório</h3>
                <p>Configure e gere um relatório para visualizar a prévia aqui.</p>
            </div>
            
            <div class="section">
                <h3>Relatórios Salvos</h3>
                <div class="table-container">
                    <table id="saved-reports-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Data Geração</th>
                                <th>Gerado Por</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Relatório Mensal - Junho/2025</td>
                                <td>Completo</td>
                                <td>05/07/2025</td>
                                <td>Administrador</td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-download"></i></button>
                                    <button class="btn btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>Frente 4001 - Análise</td>
                                <td>Potencial de Colheita</td>
                                <td>01/07/2025</td>
                                <td>Administrador</td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-download"></i></button>
                                    <button class="btn btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>Análise de Equipamentos - Semana 26</td>
                                <td>Dados dos Equipamentos</td>
                                <td>28/06/2025</td>
                                <td>Administrador</td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-download"></i></button>
                                    <button class="btn btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <h3>Relatórios Agendados</h3>
                <div class="table-container">
                    <table id="scheduled-reports-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Frequência</th>
                                <th>Próxima Execução</th>
                                <th>Destinatários</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Relatório Semanal de Produção</td>
                                <td>Completo</td>
                                <td>Semanal (Segunda-feira)</td>
                                <td>10/07/2025</td>
                                <td>admin@usina.com, gerente@usina.com</td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Histórico -->
        <div id="historico" class="tab-content" role="tabpanel" aria-labelledby="tab-historico">
            <h2>Histórico de Alterações</h2>
            <div id="lastUpdatedHistorico" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="history-filter-type">Filtrar por Tipo:</label>
                    <select id="history-filter-type">
                        <option value="">Todos os Tipos</option>
                        <option value="add">Inclusão</option>
                        <option value="edit">Alteração</option>
                        <option value="delete">Exclusão</option>
                        <option value="system">Sistema</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="history-filter-entity">Filtrar por Entidade:</label>
                    <select id="history-filter-entity">
                        <option value="">Todas as Entidades</option>
                        <option value="frente">Frente</option>
                        <option value="equipamento">Equipamento</option>
                        <option value="transporte">Transporte</option>
                        <option value="dados">Dados</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="history-filter-date">Período:</label>
                    <select id="history-filter-date">
                        <option value="today">Hoje</option>
                        <option value="yesterday">Ontem</option>
                        <option value="week">Última Semana</option>
                        <option value="month">Último Mês</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
            </div>
            
            <div id="history-custom-date" style="display: none; margin-bottom: 1.5rem;">
                <div style="display: flex; gap: 1rem;">
                    <div class="filter-group" style="flex: 1;">
                        <label for="history-date-start">Data Inicial:</label>
                        <input type="date" id="history-date-start">
                    </div>
                    <div class="filter-group" style="flex: 1;">
                        <label for="history-date-end">Data Final:</label>
                        <input type="date" id="history-date-end">
                    </div>
                    <div style="align-self: flex-end;">
                        <button id="history-apply-date" class="btn btn-sm">Aplicar</button>
                    </div>
                </div>
            </div>
            
            <div class="history-container" id="history-container">
                <!-- Entradas serão preenchidas dinamicamente -->
            </div>
            
            <div class="section">
                <h3>Estatísticas de Alterações</h3>
                <div class="chart-container">
                    <canvas id="historyChart"></canvas>
                </div>
            </div>
            
            <div class="section">
                <h3>Linha do Tempo</h3>
                <div style="position: relative; padding: 30px 0; margin-top: 30px;">
                    <div style="position: absolute; top: 0; bottom: 0; left: 50%; width: 4px; background-color: var(--primary-color); transform: translateX(-50%);"></div>
                    
                    <!-- Item da linha do tempo -->
                    <div class="timeline-item" style="position: relative; margin-bottom: 50px;">
                        <div style="position: absolute; left: 50%; width: 20px; height: 20px; background-color: var(--primary-color); border-radius: 50%; transform: translateX(-50%); z-index: 1;"></div>
                        <div style="width: 45%; background-color: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); margin-left: auto; margin-right: 60px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">Cadastro Inicial</div>
                            <div>Sistema inicializado com as frentes 4001, 4002, 4007 e 4009</div>
                            <div style="font-size: 0.8rem; color: var(--text-tertiary); margin-top: 10px;">15/06/2025 10:30</div>
                        </div>
                    </div>
                    
                    <!-- Item da linha do tempo -->
                    <div class="timeline-item" style="position: relative; margin-bottom: 50px;">
                        <div style="position: absolute; left: 50%; width: 20px; height: 20px; background-color: var(--info-color); border-radius: 50%; transform: translateX(-50%); z-index: 1;"></div>
                        <div style="width: 45%; background-color: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); margin-right: auto; margin-left: 60px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">Alteração de Equipamento</div>
                            <div>COLHEDORA 3 marcada como indisponível na frente 4001</div>
                            <div style="font-size: 0.8rem; color: var(--text-tertiary); margin-top: 10px;">16/06/2025 14:15</div>
                        </div>
                    </div>
                    
                    <!-- Item da linha do tempo -->
                    <div class="timeline-item" style="position: relative;">
                        <div style="position: absolute; left: 50%; width: 20px; height: 20px; background-color: var(--danger-color); border-radius: 50%; transform: translateX(-50%); z-index: 1;"></div>
                        <div style="width: 45%; background-color: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); margin-left: auto; margin-right: 60px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">Remoção de Frente</div>
                            <div>Frente 4005 removida do sistema</div>
                            <div style="font-size: 0.8rem; color: var(--text-tertiary); margin-top: 10px;">18/06/2025 11:45</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Help Panel -->
    <div id="help-panel" class="help-panel">
        <div class="help-header">
            <h3>Ajuda e Dicas</h3>
            <button id="help-close" class="modal-close">&times;</button>
        </div>
        <div class="help-body">
            <div class="help-topic">
                <h4>Dashboard</h4>
                <p>O Dashboard apresenta uma visão geral dos indicadores de colheita e transporte, permitindo monitorar o desempenho geral do sistema.</p>
                <p>Os cards principais mostram os valores atuais e o progresso em relação às metas definidas.</p>
            </div>
            <div class="help-topic">
                <h4>Cálculo de Potencial</h4>
                <p>Para calcular o potencial de colheita e transporte:</p>
                <ol>
                    <li>Preencha os dados de frente, incluindo tempos de ciclo e distâncias</li>
                    <li>Configure os equipamentos disponíveis para cada frente</li>
                    <li>Acesse a aba Potencial e clique em "Calcular"</li>
                </ol>
                <p>O sistema irá determinar automaticamente o fator limitante entre colheita e transporte.</p>
            </div>
            <div class="help-topic">
                <h4>Backup e Restauração</h4>
                <p>É recomendado fazer backups regulares dos seus dados:</p>
                <ol>
                    <li>Acesse a seção de Backup no Dashboard</li>
                    <li>Clique em "Exportar Backup Completo"</li>
                    <li>Salve o arquivo em local seguro</li>
                </ol>
                <p>Para restaurar, use o botão "Restaurar Backup" e selecione o arquivo salvo anteriormente.</p>
            </div>
            <div class="help-topic">
                <h4>Novidades na versão 2.0</h4>
                <p><i class="fas fa-star" style="color: #FFD700;"></i> <strong>Novo:</strong> Análise comparativa de potencial atual vs. projetado</p>
                <p><i class="fas fa-star" style="color: #FFD700;"></i> <strong>Novo:</strong> Sistema de agendamento de relatórios</p>
                <p><i class="fas fa-star" style="color: #FFD700;"></i> <strong>Novo:</strong> Mapa de visualização de frentes</p>
                <p><i class="fas fa-star" style="color: #FFD700;"></i> <strong>Novo:</strong> Controle de manutenções programadas</p>
            </div>
        </div>
        <div class="help-footer">
            <button id="help-dismiss" class="btn btn-sm">Entendi, não mostrar novamente</button>
        </div>
    </div>
    
    <!-- Settings modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configurações do Sistema</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <h4>Aparência</h4>
                    <div class="settings-row">
                        <label for="settings-theme">Tema</label>
                        <select id="settings-theme">
                            <option value="auto">Automático (Sistema)</option>
                            <option value="light">Claro</option>
                            <option value="dark">Escuro</option>
                        </select>
                    </div>
                    <div class="settings-row">
                        <label>Cor principal</label>
                        <div class="color-options">
                            <div class="color-swatch active" style="background-color: #3949ab;" data-color="blue"></div>
                            <div class="color-swatch" style="background-color: #26a69a;" data-color="teal"></div>
                            <div class="color-swatch" style="background-color: #5d4037;" data-color="brown"></div>
                            <div class="color-swatch" style="background-color: #7b1fa2;" data-color="purple"></div>
                            <div class="color-swatch" style="background-color: #00897b;" data-color="green"></div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Tabelas</h4>
                    <div class="settings-row">
                        <label for="settings-rows-per-page">Linhas por página</label>
                        <select id="settings-rows-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <div class="settings-row">
                        <label for="settings-enable-filters">Habilitar filtros avançados</label>
                        <input type="checkbox" id="settings-enable-filters" checked>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Armazenamento</h4>
                    <div class="settings-row">
                        <label for="settings-auto-save">Auto-salvar alterações</label>
                        <input type="checkbox" id="settings-auto-save" checked>
                    </div>
                    <div class="settings-row">
                        <label for="settings-backup-interval">Intervalo de backup automático</label>
                        <select id="settings-backup-interval">
                            <option value="5">5 minutos</option>
                            <option value="10">10 minutos</option>
                            <option value="15">15 minutos</option>
                            <option value="30">30 minutos</option>
                            <option value="60">1 hora</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Gráficos</h4>
                    <div class="settings-row">
                        <label for="settings-chart-animations">Animações</label>
                        <input type="checkbox" id="settings-chart-animations" checked>
                    </div>
                    <div class="settings-row">
                        <label for="settings-chart-labels">Exibir rótulos nos gráficos</label>
                        <input type="checkbox" id="settings-chart-labels" checked>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Notificações</h4>
                    <div class="settings-row">
                        <label for="settings-notifications">Habilitar notificações</label>
                        <input type="checkbox" id="settings-notifications" checked>
                    </div>
                    <div class="settings-row">
                        <label for="settings-notification-sound">Som de notificação</label>
                        <input type="checkbox" id="settings-notification-sound" checked>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Exportação</h4>
                    <div class="settings-row">
                        <label for="settings-export-format">Formato padrão de exportação</label>
                        <select id="settings-export-format">
                            <option value="csv">CSV</option>
                            <option value="json">JSON</option>
                            <option value="xlsx">Excel (XLSX)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="settings-reset" class="btn btn-secondary">Restaurar Padrões</button>
                <button id="settings-save" class="btn">Salvar Configurações</button>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Sistema de Gestão de Colheita - Usina Cambuí Açúcar & Álcool (Ass: Gutemberg Gomes) © 2025 | <span id="app-version">Versão 2.0.1</span></p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if required libraries are available
            const checkLibrary = (name, obj) => {
                const loaded = typeof obj !== 'undefined';
                if (!loaded) console.warn(`Library ${name} is not loaded`);
                return loaded;
            };
            
            const jQueryLoaded = checkLibrary('jQuery', window.jQuery);
            const ChartLoaded = checkLibrary('Chart.js', window.Chart);
            const dataTablesLoaded = jQueryLoaded && checkLibrary('DataTables', $.fn.DataTable);
            
            // If jQuery is not loaded, load it and then initialize app
            if (!jQueryLoaded) {
                const script = document.createElement('script');
                script.src = 'https://code.jquery.com/jquery-3.6.0.min.js';
                script.onload = initializeApplication;
                document.head.appendChild(script);
                return;
            }
            
            // Otherwise, initialize right away
            initializeApplication();
            
            // Main initialization function
            function initializeApplication() {
                // Check for dark mode preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                }
                
                // Listen for changes in color scheme
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    if (event.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                });
                
                // App namespace
                const App = {
                    // Data storage
                    data: {
                        frentes: [
                            { frente: '4001', cota: 3000, dist: 22.5, ida: 30, campo: 30, volta: 30, usina: 30, transporte: 'P', peso: 60, obs: '', createdAt: new Date().toISOString(), location: { lat: -22.456789, lng: -47.123456 }, tags: ['Prioritária', 'Mecanizada'] },
                            { frente: '4002', cota: 2500, dist: 15.3, ida: 25, campo: 22, volta: 25, usina: 28, transporte: 'P', peso: 60, obs: '', createdAt: new Date().toISOString(), location: { lat: -22.487654, lng: -47.154321 }, tags: ['Mecanizada'] },
                            { frente: '4007', cota: 3500, dist: 18.7, ida: 28, campo: 25, volta: 28, usina: 32, transporte: 'T', peso: 60, obs: '', createdAt: new Date().toISOString(), location: { lat: -22.512345, lng: -47.187654 }, tags: ['Mecanizada'] },
                            { frente: '4009', cota: 3500, dist: 30.2, ida: 35, campo: 25, volta: 35, usina: 30, transporte: 'T', peso: 60, obs: '', createdAt: new Date().toISOString(), location: { lat: -22.534567, lng: -47.223456 }, tags: ['Auxiliar'] }
                        ],
                        equipamentos: {
                            '4001': [
                                { equipo: 'COLHEDORA 1', carreg: 5.2, aux: 1.5, disponivel: 1, producao: 138.5 },
                                { equipo: 'COLHEDORA 2', carreg: 4.8, aux: 1.2, disponivel: 1, producao: 150.0 },
                                { equipo: 'COLHEDORA 3', carreg: 5.5, aux: 1.8, disponivel: 1, producao: 130.9 },
                                { equipo: 'COLHEDORA 4', carreg: 5.0, aux: 1.3, disponivel: 1, producao: 144.0 },
                                { equipo: 'COLHEDORA 5', carreg: 4.9, aux: 1.4, disponivel: 1, producao: 146.9 }
                            ],
                            '4002': [
                                { equipo: 'COLHEDORA 1', carreg: 5.0, aux: 1.5, disponivel: 1, producao: 144.0 },
                                { equipo: 'COLHEDORA 2', carreg: 4.7, aux: 1.2, disponivel: 1, producao: 153.2 },
                                { equipo: 'COLHEDORA 3', carreg: 5.2, aux: 1.4, disponivel: 1, producao: 138.5 },
                                { equipo: 'COLHEDORA 4', carreg: 4.8, aux: 1.3, disponivel: 1, producao: 150.0 },
                                { equipo: 'COLHEDORA 5', carreg: 5.5, aux: 1.6, disponivel: 1, producao: 130.9 }
                            ],
                            '4007': [
                                { equipo: 'COLHEDORA 1', carreg: 5.1, aux: 1.5, disponivel: 1, producao: 141.2 },
                                { equipo: 'COLHEDORA 2', carreg: 4.9, aux: 1.3, disponivel: 1, producao: 146.9 },
                                { equipo: 'COLHEDORA 3', carreg: 5.0, aux: 1.4, disponivel: 1, producao: 144.0 },
                                { equipo: 'COLHEDORA 4', carreg: 4.8, aux: 1.2, disponivel: 1, producao: 150.0 },
                                { equipo: 'COLHEDORA 5', carreg: 5.3, aux: 1.5, disponivel: 1, producao: 135.8 }
                            ],
                            '4009': [
                                { equipo: 'COLHEDORA 1', carreg: 5.2, aux: 1.6, disponivel: 1, producao: 138.5 },
                                { equipo: 'COLHEDORA 2', carreg: 5.0, aux: 1.4, disponivel: 1, producao: 144.0 },
                                { equipo: 'COLHEDORA 3', carreg: 5.5, aux: 1.7, disponivel: 1, producao: 130.9 },
                                { equipo: 'COLHEDORA 4', carreg: 4.8, aux: 1.3, disponivel: 1, producao: 150.0 },
                                { equipo: 'COLHEDORA 5', carreg: 5.3, aux: 1.5, disponivel: 1, producao: 135.8 }
                            ]
                        },
                        potencial: [],
                        transportes: {
                            propriosTotal: 20,
                            propriosParados: 5,
                            terceirosTotal: 25,
                            terceirosParados: 5,
                            bvTotal: 43,
                            bvParados: 15
                        },
                        horasTrabalhadas: {
                            prop4001: 21,
                            prop4002: 21,
                            terc: 22
                        },
                        manutencoes: [
                            { id: 1, equipo: 'COLHEDORA 2', frente: '4001', tipo: 'Preventiva', dataProgramada: '2025-07-12', duracao: '8 horas', status: 'Pendente' },
                            { id: 2, equipo: 'TRATOR 3', frente: '4002', tipo: 'Corretiva', dataProgramada: '2025-07-08', duracao: '4 horas', status: 'Em andamento' }
                        ],
                        historico: [
                            { id: 1, tipo: 'add', entidade: 'frente', titulo: 'Frente 4001 adicionada', descricao: 'Nova frente cadastrada com cota de 3000 toneladas', data: '2025-06-15T10:30:00', usuario: 'Administrador' },
                            { id: 2, tipo: 'edit', entidade: 'equipamento', titulo: 'Equipamento COLHEDORA 3 alterado', descricao: 'Disponibilidade alterada para Indisponível', data: '2025-06-16T14:15:00', usuario: 'Administrador' },
                            { id: 3, tipo: 'system', entidade: 'dados', titulo: 'Backup automático', descricao: 'Backup completo realizado automaticamente', data: '2025-06-17T09:00:00', usuario: 'Sistema' },
                            { id: 4, tipo: 'delete', entidade: 'frente', titulo: 'Frente 4005 removida', descricao: 'Frente removida do sistema', data: '2025-06-18T11:45:00', usuario: 'Administrador' }
                        ],
                        historicalData: {
                            colheita: [
                                { data: '2025-01-01', valor: 280 },
                                { data: '2025-02-01', valor: 310 },
                                { data: '2025-03-01', valor: 340 },
                                { data: '2025-04-01', valor: 375 },
                                { data: '2025-05-01', valor: 410 },
                                { data: '2025-06-01', valor: 450 }
                            ],
                            transporte: [
                                { data: '2025-01-01', valor: 260 },
                                { data: '2025-02-01', valor: 285 },
                                { data: '2025-03-01', valor: 305 },
                                { data: '2025-04-01', valor: 335 },
                                { data: '2025-05-01', valor: 360 },
                                { data: '2025-06-01', valor: 395 }
                            ]
                        },
                        lastUpdated: new Date().toISOString()
                    },
                    
                    // Configuration
                    config: {
                        storage: {
                            useLocalStorage: true,
                            autoBackup: true,
                            backupInterval: 300000, // 5 minutes
                            lastBackupTime: null,
                            storageAvailable: false,
                            storageKey: 'safraTransportesData'
                        },
                        ui: {
                            theme: 'auto',
                            colorScheme: 'blue',
                            rowsPerPage: 10,
                            enableFilters: true,
                            chartAnimations: true,
                            chartLabels: true
                        },
                        notifications: {
                            enabled: true,
                            sound: true
                        },
                        export: {
                            defaultFormat: 'json'
                        }
                    },
                    
                    // Charts
                    charts: {},
                    
                    // App state
                    state: {
                        currentTab: 'dashboard',
                        dataTables: {},
                        selectedTags: [],
                        helpDismissed: false,
                        mapLoaded: false
                    },
                    
                    // Initialize app
                    init: function() {
                        this.setupEventListeners();
                        this.checkStorage();
                        this.loadSavedData();
                        this.setupHelp();
                        DataHandler.calculatePotencial();
                        UI.updateDashboard();
                        UI.updateAllCharts();
                    },
                    
                    // Setup event listeners
                    setupEventListeners: function() {
                        // Tab switching
                        document.querySelectorAll('.tab-button').forEach(button => {
                            button.addEventListener('click', () => {
                                const tabId = button.getAttribute('data-tab');
                                
                                // Remove active class from all tabs and buttons
                                document.querySelectorAll('.tab-content').forEach(tab => {
                                    tab.classList.remove('active');
                                });
                                
                                document.querySelectorAll('.tab-button').forEach(btn => {
                                    btn.classList.remove('active');
                                    btn.setAttribute('aria-selected', 'false');
                                });
                                
                                // Add active class to current tab and button
                                document.getElementById(tabId).classList.add('active');
                                button.classList.add('active');
                                button.setAttribute('aria-selected', 'true');
                                
                                // Update state
                                this.state.currentTab = tabId;
                                
                                // Special actions for specific tabs
                                if (tabId === 'potencial' || tabId === 'dashboard') {
                                    UI.updateCharts();
                                }
                            });
                        });
                        
                        // Theme toggle
                        document.getElementById('theme-toggle').addEventListener('click', () => {
                            document.documentElement.classList.toggle('dark');
                            
                            const themeToggleIcon = document.getElementById('theme-toggle').querySelector('i');
                            if (document.documentElement.classList.contains('dark')) {
                                themeToggleIcon.className = 'fas fa-sun';
                            } else {
                                themeToggleIcon.className = 'fas fa-moon';
                            }
                            
                            // Update charts for new theme
                            UI.updateAllCharts();
                        });
                        
                        // Settings toggle
                        document.getElementById('settings-toggle').addEventListener('click', () => {
                            document.getElementById('settings-modal').style.display = 'flex';
                        });
                        
                        // Help toggle
                        document.getElementById('help-toggle').addEventListener('click', () => {
                            document.getElementById('help-panel').classList.add('active');
                        });
                        
                        // Close help panel
                        document.getElementById('help-close').addEventListener('click', () => {
                            document.getElementById('help-panel').classList.remove('active');
                        });
                        
                        // Dismiss help
                        document.getElementById('help-dismiss').addEventListener('click', () => {
                            document.getElementById('help-panel').classList.remove('active');
                            this.state.helpDismissed = true;
                            localStorage.setItem('helpDismissed', 'true');
                            // Hide notification badge
                            const badge = document.querySelector('.help-toggle .notification-badge');
                            if (badge) {
                                badge.style.display = 'none';
                            }
                        });
                        
                        // Close settings modal
                        document.querySelectorAll('.modal-close').forEach(button => {
                            button.addEventListener('click', function() {
                                const modal = this.closest('.modal');
                                if (modal) modal.style.display = 'none';
                            });
                        });
                        
                        // Calculate potential
                        document.getElementById('calc-potencial').addEventListener('click', () => {
                            UI.showLoading('Calculando potencial...');
                            setTimeout(() => {
                                DataHandler.calculatePotencial();
                                DataHandler.updateTransportes();
                                UI.updateDashboard();
                                UI.updateAllCharts();
                                UI.hideLoading();
                                UI.showToast('Potencial calculado com sucesso!');
                            }, 500);
                        });
                        
                        // Save data buttons
                        document.querySelectorAll('[id^="save-all-"]').forEach(button => {
                            button.addEventListener('click', () => {
                                UI.showLoading('Salvando dados...');
                                setTimeout(() => {
                                    this.saveAllData();
                                    UI.hideLoading();
                                    UI.showToast('Dados salvos com sucesso!');
                                }, 500);
                            });
                        });
                        
                        // Add new front
                        document.getElementById('add-frente').addEventListener('click', () => {
                            DataHandler.addNewFrente();
                        });
                        
                        // Reset form button
                        document.getElementById('reset-form-cadastrar').addEventListener('click', () => {
                            document.getElementById('nova-frente-id').value = '';
                            document.getElementById('nova-frente-cota').value = '0';
                            document.getElementById('nova-frente-dist').value = '0';
                            document.getElementById('nova-frente-peso').value = '60';
                            document.getElementById('nova-frente-lat').value = '';
                            document.getElementById('nova-frente-lng').value = '';
                            document.getElementById('nova-frente-obs').value = '';
                            this.clearTags();
                        });
                        
                        // Duplicate front
                        document.getElementById('duplicate-frente').addEventListener('click', () => {
                            UI.showFrenteDuplicateForm();
                        });
                        
                        // Tags input
                        const tagsInput = document.getElementById('nova-frente-tags');
                        if (tagsInput) {
                            tagsInput.addEventListener('keydown', (e) => {
                                if (e.key === 'Enter' && tagsInput.value.trim() !== '') {
                                    e.preventDefault();
                                    this.addTag(tagsInput.value.trim());
                                    tagsInput.value = '';
                                }
                            });
                        }
                        
                        // Transport field updates
                        document.querySelectorAll('#proprios-total, #proprios-parados, #terceiros-total, #terceiros-parados, #bv-total, #bv-parados').forEach(input => {
                            input.addEventListener('change', () => {
                                DataHandler.updateTransportesFromUI();
                            });
                        });
                        
                        // Load map
                        document.getElementById('load-map').addEventListener('click', () => {
                            UI.loadMap();
                        });
                        
                        // Export/import handlers
                        document.getElementById('export-potencial').addEventListener('click', () => {
                            FileHandler.exportData('potencial');
                        });
                        
                        document.getElementById('export-frentes').addEventListener('click', () => {
                            FileHandler.exportData('frentes');
                        });
                        
                        document.getElementById('export-equipamentos').addEventListener('click', () => {
                            FileHandler.exportData('equipamentos');
                        });
                        
                        // Backup/restore
                        document.getElementById('backup-all').addEventListener('click', () => {
                            FileHandler.exportBackup();
                        });
                        
                        document.getElementById('restore-all').addEventListener('click', () => {
                            document.getElementById('file-restore-all').click();
                        });
                        
                        document.getElementById('file-restore-all').addEventListener('change', (e) => {
                            if (e.target.files.length > 0) {
                                FileHandler.importBackup(e.target.files[0]);
                            }
                        });
                        
                        // Add equipment
                        document.getElementById('add-equipamento').addEventListener('click', () => {
                            UI.showAddEquipamentoForm();
                        });
                        
                        // Add maintenance
                        document.getElementById('add-manutencao').addEventListener('click', () => {
                            UI.showAddManutencaoForm();
                        });
                        
                        // Generate report
                        document.getElementById('generate-report').addEventListener('click', () => {
                            UI.generateReport();
                        });
                        
                        // Compare fronts
                        document.getElementById('compare-frentes').addEventListener('click', () => {
                            UI.showFrentesComparison();
                        });
                        
                        // Initialize slider comparison
                        this.initSliderComparison();
                        
                        // Auto-backup toggle
                        document.getElementById('auto-backup-toggle').addEventListener('change', function() {
                            App.config.storage.autoBackup = this.checked;
                        });
                        
                        // File input handlers
                        document.getElementById('import-potencial').addEventListener('click', () => {
                            document.getElementById('file-import-potencial').click();
                        });
                        
                        document.getElementById('file-import-potencial').addEventListener('change', (e) => {
                            if (e.target.files.length > 0) {
                                FileHandler.importData('potencial', e.target.files[0]);
                            }
                        });
                        
                        document.getElementById('import-frentes').addEventListener('click', () => {
                            document.getElementById('file-import-frentes').click();
                        });
                        
                        document.getElementById('file-import-frentes').addEventListener('change', (e) => {
                            if (e.target.files.length > 0) {
                                FileHandler.importData('frentes', e.target.files[0]);
                            }
                        });
                        
                        document.getElementById('import-equipamentos').addEventListener('click', () => {
                            document.getElementById('file-import-equipamentos').click();
                        });
                        
                        document.getElementById('file-import-equipamentos').addEventListener('change', (e) => {
                            if (e.target.files.length > 0) {
                                FileHandler.importData('equipamentos', e.target.files[0]);
                            }
                        });
                        
                        // History date filter
                        document.getElementById('history-filter-date').addEventListener('change', function() {
                            if (this.value === 'custom') {
                                document.getElementById('history-custom-date').style.display = 'block';
                            } else {
                                document.getElementById('history-custom-date').style.display = 'none';
                                UI.updateHistoryList();
                            }
                        });
                        
                        document.getElementById('history-apply-date').addEventListener('click', () => {
                            UI.updateHistoryList();
                        });
                        
                        // History filters
                        document.getElementById('history-filter-type').addEventListener('change', () => {
                            UI.updateHistoryList();
                        });
                        
                        document.getElementById('history-filter-entity').addEventListener('change', () => {
                            UI.updateHistoryList();
                        });
                        
                        // Confirmation dialog buttons
                        document.getElementById('confirm-cancel').addEventListener('click', () => {
                            document.getElementById('confirm-dialog').classList.remove('show');
                        });
                        
                        document.getElementById('confirm-ok').addEventListener('click', () => {
                            if (typeof this.state.confirmCallback === 'function') {
                                this.state.confirmCallback();
                                this.state.confirmCallback = null;
                            }
                            document.getElementById('confirm-dialog').classList.remove('show');
                        });
                        
                        // Setup drag and drop for backup
                        this.setupDragDropZone();
                    },
                    
                    // Initialize drag and drop zone
                    setupDragDropZone: function() {
                        const dropZone = document.getElementById('backup-drop-zone');
                        if (!dropZone) return;
                        
                        // Prevent default behavior for drag events
                        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                            dropZone.addEventListener(eventName, (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                            }, false);
                        });
                        
                        // Add/remove highlight class
                        ['dragenter', 'dragover'].forEach(eventName => {
                            dropZone.addEventListener(eventName, () => {
                                dropZone.classList.add('drag-over');
                            }, false);
                        });
                        
                        ['dragleave', 'drop'].forEach(eventName => {
                            dropZone.addEventListener(eventName, () => {
                                dropZone.classList.remove('drag-over');
                            }, false);
                        });
                        
                        // Handle drop event
                        dropZone.addEventListener('drop', (e) => {
                            const files = e.dataTransfer.files;
                            if (files && files.length > 0) {
                                FileHandler.importBackup(files[0]);
                            }
                        }, false);
                        
                        // Click to select file
                        dropZone.addEventListener('click', () => {
                            document.getElementById('file-restore-all').click();
                        });
                    },
                    
                    // Initialize comparison slider
                    initSliderComparison: function() {
                        const slider = document.querySelector('.comparison-slider');
                        if (!slider) return;
                        
                        let isResizing = false;
                        
                        // Mouse events
                        slider.addEventListener('mousedown', function(e) {
                            e.preventDefault();
                            isResizing = true;
                            document.addEventListener('mousemove', onMouseMove);
                            document.addEventListener('mouseup', onMouseUp);
                        });
                        
                        // Touch events
                        slider.addEventListener('touchstart', function(e) {
                            e.preventDefault();
                            isResizing = true;
                            document.addEventListener('touchmove', onTouchMove);
                            document.addEventListener('touchend', onTouchEnd);
                        });
                        
                        function onMouseMove(e) {
                            if (!isResizing) return;
                            const container = document.querySelector('.comparison-slider-container');
                            const rect = container.getBoundingClientRect();
                            let position = ((e.clientX - rect.left) / rect.width) * 100;
                            position = Math.max(0, Math.min(100, position));
                            updateSliderPosition(position);
                        }
                        
                        function onMouseUp() {
                            isResizing = false;
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                        }
                        
                        function onTouchMove(e) {
                            if (!isResizing || !e.touches[0]) return;
                            const container = document.querySelector('.comparison-slider-container');
                            const rect = container.getBoundingClientRect();
                            let position = ((e.touches[0].clientX - rect.left) / rect.width) * 100;
                            position = Math.max(0, Math.min(100, position));
                            updateSliderPosition(position);
                        }
                        
                        function onTouchEnd() {
                            isResizing = false;
                            document.removeEventListener('touchmove', onTouchMove);
                            document.removeEventListener('touchend', onTouchEnd);
                        }
                        
                        function updateSliderPosition(position) {
                            slider.style.left = `${position}%`;
                            document.querySelector('.comparison-item-before').style.width = `${position}%`;
                        }
                    },
                    
                    // Add a tag to the tags input
                    addTag: function(tagText) {
                        // Check if tag already exists
                        if (this.state.selectedTags.includes(tagText)) {
                            UI.showToast('Esta tag já foi adicionada', 'warning');
                            return;
                        }
                        
                        // Check tag limit
                        if (this.state.selectedTags.length >= 10) {
                            UI.showToast('Máximo de 10 tags atingido', 'warning');
                            return;
                        }
                        
                        // Add tag
                        const tagsContainer = document.querySelector('.tags-input-container');
                        const tagsInput = document.getElementById('nova-frente-tags');
                        
                        const tag = document.createElement('div');
                        tag.className = 'tag';
                        tag.innerHTML = `
                            <span>${tagText}</span>
                            <span class="tag-close">&times;</span>
                        `;
                        
                        // Add event to remove tag
                        tag.querySelector('.tag-close').addEventListener('click', () => {
                            tag.remove();
                            this.state.selectedTags = this.state.selectedTags.filter(t => t !== tagText);
                        });
                        
                        // Add tag to container
                        tagsContainer.insertBefore(tag, tagsInput);
                        
                        // Update state
                        this.state.selectedTags.push(tagText);
                    },
                    
                    // Clear all tags
                    clearTags: function() {
                        const tagsContainer = document.querySelector('.tags-input-container');
                        if (!tagsContainer) return;
                        
                        const tagElements = tagsContainer.querySelectorAll('.tag');
                        tagElements.forEach(tag => tag.remove());
                        this.state.selectedTags = [];
                    },
                    
                    // Setup help panel
                    setupHelp: function() {
                        // Check if help has been dismissed before
                        this.state.helpDismissed = localStorage.getItem('helpDismissed') === 'true';
                        
                        // Update notification badge
                        if (this.state.helpDismissed) {
                            const badge = document.querySelector('.help-toggle .notification-badge');
                            if (badge) {
                                badge.style.display = 'none';
                            }
                        } else {
                            // Show help panel after 2 seconds
                            setTimeout(() => {
                                document.getElementById('help-panel').classList.add('active');
                            }, 2000);
                        }
                    },
                    
                    // Show confirmation dialog
                    showConfirmDialog: function(title, message, callback) {
                        document.getElementById('confirm-title').textContent = title;
                        document.getElementById('confirm-message').textContent = message;
                        this.state.confirmCallback = callback;
                        document.getElementById('confirm-dialog').classList.add('show');
                    },
                    
                    // Check if local storage is available
                    checkStorage: function() {
                        try {
                            const testKey = '__storage_test__';
                            localStorage.setItem(testKey, testKey);
                            localStorage.removeItem(testKey);
                            
                            const storageIndicator = document.getElementById('storage-indicator');
                            const storageStatusText = document.getElementById('storage-status-text');
                            
                            storageIndicator.className = 'indicator success';
                            storageStatusText.textContent = 'Armazenamento local disponível';
                            this.config.storage.storageAvailable = true;
                            
                            return true;
                        } catch (e) {
                            const storageIndicator = document.getElementById('storage-indicator');
                            const storageStatusText = document.getElementById('storage-status-text');
                            
                            storageIndicator.className = 'indicator error';
                            storageStatusText.textContent = 'Armazenamento local indisponível - seus dados serão perdidos ao fechar o navegador';
                            this.config.storage.storageAvailable = false;
                            
                            return false;
                        }
                    },
                    
                    // Load saved data from local storage
                    loadSavedData: function() {
                        UI.showLoading('Carregando dados...');
                        
                        setTimeout(() => {
                            if (this.config.storage.storageAvailable) {
                                const savedData = localStorage.getItem(this.config.storage.storageKey);
                                if (savedData) {
                                    try {
                                        const parsedData = JSON.parse(savedData);
                                        
                                        // Update with saved data
                                        for (const key in parsedData) {
                                            if (key in this.data) {
                                                this.data[key] = parsedData[key];
                                            }
                                        }
                                        
                                        // Update timestamps
                                        UI.updateTimestamps();
                                        
                                        // Update UI
                                        UI.initFrentesTable();
                                        UI.initEquipamentosTables();
                                        UI.initPotencialTable();
                                        UI.updateRecentFrentes();
                                    } catch (error) {
                                        console.error('Error parsing saved data:', error);
                                        UI.showToast('Error loading saved data. Using default data.', 'error');
                                    }
                                }
                            }
                            
                            UI.hideLoading();
                        }, 500);
                    },
                    
                    // Save all data
                    saveAllData: function() {
                        try {
                            // Update data from UI
                            DataHandler.updateFrentesDataFromUI();
                            DataHandler.updateAllEquipamentosData();
                            DataHandler.updateTransportesFromUI();
                            DataHandler.updateHorasTrabalhadasFromUI();
                            
                            // Calculate potential
                            DataHandler.calculatePotencial();
                            
                            // Update timestamp
                            this.data.lastUpdated = new Date().toISOString();
                            UI.updateTimestamps();
                            
                            // Save to storage
                            this.saveData();
                            
                            // Add to history
                            this.addHistoryEntry({
                                tipo: 'system',
                                entidade: 'dados',
                                titulo: 'Salvamento manual',
                                descricao: 'Todos os dados foram salvos manualmente',
                                data: new Date().toISOString(),
                                usuario: 'Administrador'
                            });
                            
                            // Update UI
                            UI.updateDashboard();
                            
                            return true;
                        } catch (error) {
                            console.error('Error saving data:', error);
                            UI.showToast('Error saving data: ' + error.message, 'error');
                            return false;
                        }
                    },
                    
                    // Save data to storage
                    saveData: function() {
                        if (this.config.storage.storageAvailable) {
                            try {
                                localStorage.setItem(this.config.storage.storageKey, JSON.stringify(this.data));
                                return true;
                            } catch (error) {
                                console.error('Error saving to localStorage:', error);
                                return false;
                            }
                        }
                        return false;
                    },
                    
                    // Add history entry
                    addHistoryEntry: function(entry) {
                        const id = this.data.historico.length > 0 ? 
                            Math.max(...this.data.historico.map(h => h.id)) + 1 : 1;
                        
                        const newEntry = {
                            id,
                            ...entry
                        };
                        
                        this.data.historico.unshift(newEntry);
                        
                        // Update UI if history tab is active
                        if (this.state.currentTab === 'historico') {
                            UI.updateHistoryList();
                        }
                        
                        return newEntry;
                    }
                };
                
                // DataHandler namespace - for data calculations and processing
                const DataHandler = {
                    // Calculate potential for all fronts
                    calculatePotencial: function() {
                        App.data.potencial = [];
                        
                        App.data.frentes.forEach(frenteData => {
                            // Get front equipment capacities
                            const equipamentos = App.data.equipamentos[frenteData.frente];
                            if (!equipamentos) return;
                            
                            // Filter available equipment
                            const disponiveis = equipamentos.filter(e => e.disponivel === 1);
                            
                            // Separate harvesters
                            const colhedoras = disponiveis.filter(e => e.equipo.toUpperCase().includes('COLHEDORA'));
                            
                            // Get number of active tractors (from UI)
                            const tratoresAtivosElement = document.getElementById(`${frenteData.frente}-tratores`);
                            const tratoresAtivos = tratoresAtivosElement ? parseInt(tratoresAtivosElement.value) || 5 : 5;
                            
                            // Get cargo density
                            const densidadeElement = document.getElementById(`${frenteData.frente}-densidade`);
                            const densidade = densidadeElement ? parseFloat(densidadeElement.value) || 12 : 12;
                            
                            // Calculate averages for equipment
                            const mediaCarreg = disponiveis.length > 0 ? 
                                disponiveis.reduce((sum, e) => sum + (parseFloat(e.carreg) || 0), 0) / disponiveis.length : 0;
                            
                            const mediaAux = disponiveis.length > 0 ? 
                                disponiveis.reduce((sum, e) => sum + (parseFloat(e.aux) || 0), 0) / disponiveis.length : 0;
                            
                            // Update UI with averages
                            const mediaCarregElement = document.getElementById(`${frenteData.frente}-media-carreg`);
                            const mediaAuxElement = document.getElementById(`${frenteData.frente}-media-aux`);
                            const disponiveisElement = document.getElementById(`${frenteData.frente}-disponiveis`);
                            
                            if (mediaCarregElement) mediaCarregElement.value = mediaCarreg.toFixed(2);
                            if (mediaAuxElement) mediaAuxElement.value = mediaAux.toFixed(2);
                            if (disponiveisElement) disponiveisElement.value = disponiveis.length;
                            
                            // Calculate individual equipment production
                            colhedoras.forEach(equip => {
                                equip.producao = equip.carreg > 0 ? (60 / equip.carreg) * densidade : 0;
                            });
                            
                            // Calculate harvesting capacity
                            const capColhedoras = colhedoras.reduce((sum, e) => sum + e.producao, 0);
                            
                            // Calculate tractor capacity
                            const tempoTotalCiclo = mediaCarreg + mediaAux;
                            const capTratores = tempoTotalCiclo > 0 ? 
                                ((60 / tempoTotalCiclo) * densidade * tratoresAtivos) : 0;
                            
                            // Limiting factor is the minimum between harvesters and tractors
                            const capColheadorasFinal = isNaN(capColhedoras) ? 0 : capColhedoras;
                            const capTratoresFinal = isNaN(capTratores) ? 0 : (capTratores === Infinity ? 0 : capTratores);
                            
                            const capFrente = Math.min(capColheadorasFinal, capTratoresFinal);
                            
                            // Update UI
                            const capColhedorasElement = document.getElementById(`${frenteData.frente}-cap-colhedoras`);
                            const capTratoresElement = document.getElementById(`${frenteData.frente}-cap-tratores`);
                            const capFrenteElement = document.getElementById(`${frenteData.frente}-cap-frente`);
                            
                            if (capColhedorasElement) capColhedorasElement.value = capColheadorasFinal.toFixed(2);
                            if (capTratoresElement) capTratoresElement.value = capTratoresFinal.toFixed(2);
                            if (capFrenteElement) capFrenteElement.value = capFrente.toFixed(2);
                            
                            // Calculate working hours for this front
                            const horasTrabalho = frenteData.transporte === 'P' ? 
                                (frenteData.frente === '4001' ? App.data.horasTrabalhadas.prop4001 : App.data.horasTrabalhadas.prop4002) : 
                                App.data.horasTrabalhadas.terc;
                            
                            // Calculate values
                            const cotaTH = frenteData.cota / Math.max(1, horasTrabalho);
                            const tempoTotal = (parseFloat(frenteData.ida) + parseFloat(frenteData.campo) + 
                                        parseFloat(frenteData.volta) + parseFloat(frenteData.usina)) / 1440;
                            
                            // Get strategy from default or existing
                            const existingPotencial = App.data.potencial.find(p => p.frente === frenteData.frente);
                            const estrategia = existingPotencial ? existingPotencial.estrategia : Math.round(frenteData.cota / horasTrabalho);
                            
                            // Calculate per hour values
                            const camH = frenteData.peso > 0 ? estrategia / frenteData.peso : 0;
                            const frota = tempoTotal * 24 * camH;
                            const intAloc = camH > 0 ? 60 / camH : 0;
                            
                            // Calculate status
                            const capacidadePercentual = cotaTH > 0 ? (capFrente / cotaTH) * 100 : 0;
                            const status = capacidadePercentual >= 100 ? 'ÓTIMO' :
                                          capacidadePercentual >= 90 ? 'BOM' :
                                          capacidadePercentual >= 75 ? 'REGULAR' : 'INSUFICIENTE';
                            
                            // Add to potential data
                            App.data.potencial.push({
                                frente: frenteData.frente,
                                cota: cotaTH,
                                capMaquinas: capColheadorasFinal,
                                capTratores: capTratoresFinal,
                                capFrente: capFrente,
                                estrategia: estrategia,
                                tempo: tempoTotal,
                                camh: camH,
                                frota: frota,
                                intaloc: intAloc,
                                status: status
                            });
                        });
                        
                        // Update UI
                        UI.initPotencialTable();
                        this.updateTransportes();
                        UI.updateHistoryList();
                        
                        return App.data.potencial;
                    },
                    
                    // Update transports from UI
                    updateTransportesFromUI: function() {
                        App.data.transportes.propriosTotal = parseInt(document.getElementById('proprios-total').value) || 0;
                        App.data.transportes.propriosParados = parseInt(document.getElementById('proprios-parados').value) || 0;
                        App.data.transportes.terceirosTotal = parseInt(document.getElementById('terceiros-total').value) || 0;
                        App.data.transportes.terceirosParados = parseInt(document.getElementById('terceiros-parados').value) || 0;
                        App.data.transportes.bvTotal = parseInt(document.getElementById('bv-total').value) || 0;
                        App.data.transportes.bvParados = parseInt(document.getElementById('bv-parados').value) || 0;
                        
                        this.updateTransportes();
                    },
                    
                    // Update transport calculations
                    updateTransportes: function() {
                        // Calculate available
                        const propriosDisponiveis = Math.max(0, App.data.transportes.propriosTotal - App.data.transportes.propriosParados);
                        const terceirosDisponiveis = Math.max(0, App.data.transportes.terceirosTotal - App.data.transportes.terceirosParados);
                        const bvDisponiveis = Math.max(0, App.data.transportes.bvTotal - App.data.transportes.bvParados);
                        
                        // Update UI
                        document.getElementById('proprios-disponiveis').value = propriosDisponiveis;
                        document.getElementById('terceiros-disponiveis').value = terceirosDisponiveis;
                        document.getElementById('bv-disponiveis').value = bvDisponiveis;
                        
                        // Update progress bars
                        const propriosProgress = App.data.transportes.propriosTotal > 0 ? 
                            (propriosDisponiveis / App.data.transportes.propriosTotal) * 100 : 0;
                            
                        const terceirosProgress = App.data.transportes.terceirosTotal > 0 ? 
                            (terceirosDisponiveis / App.data.transportes.terceirosTotal) * 100 : 0;
                            
                        const bvProgress = App.data.transportes.bvTotal > 0 ? 
                            (bvDisponiveis / App.data.transportes.bvTotal) * 100 : 0;
                            
                        document.getElementById('proprios-progress').style.width = `${propriosProgress}%`;
                        document.getElementById('terceiros-progress').style.width = `${terceirosProgress}%`;
                        document.getElementById('bv-progress').style.width = `${bvProgress}%`;
                        
                        document.getElementById('proprios-progress-label').textContent = `${Math.round(propriosProgress)}% disponível`;
                        document.getElementById('terceiros-progress-label').textContent = `${Math.round(terceirosProgress)}% disponível`;
                        document.getElementById('bv-progress-label').textContent = `${Math.round(bvProgress)}% disponível`;
                        
                        // Calculate needed
                        let propriosNecessarios = 0;
                        let terceirosNecessarios = 0;
                        
                        if (App.data.potencial.length > 0) {
                            propriosNecessarios = App.data.potencial
                                .filter(p => {
                                    const frente = App.data.frentes.find(f => f.frente === p.frente);
                                    return frente && frente.transporte === 'P';
                                })
                                .reduce((sum, p) => sum + (parseFloat(p.frota) || 0), 0);
                                
                            terceirosNecessarios = App.data.potencial
                                .filter(p => {
                                    const frente = App.data.frentes.find(f => f.frente === p.frente);
                                    return frente && frente.transporte === 'T';
                                })
                                .reduce((sum, p) => sum + (parseFloat(p.frota) || 0), 0);
                        }
                        
                        document.getElementById('proprios-necessarios').value = propriosNecessarios.toFixed(2);
                        document.getElementById('terceiros-necessarios').value = terceirosNecessarios.toFixed(2);
                        
                        // Calculate harvest potential
                        const potencialColheita = App.data.potencial.reduce((sum, p) => sum + p.capFrente, 0);
                        document.getElementById('potencial-colheita').value = potencialColheita.toFixed(2);
                        
                        // Calculate transport potential
                        const totalDisponiveis = propriosDisponiveis + terceirosDisponiveis;
                        const totalNecessarios = propriosNecessarios + terceirosNecessarios;
                        
                        const potencialTransporte = totalNecessarios > 0 ? 
                            (potencialColheita * totalDisponiveis) / totalNecessarios : 0;
                            
                        document.getElementById('potencial-transporte').value = potencialTransporte.toFixed(2);
                        
                        // Determine system limiting factor
                        const limitanteElement = document.getElementById('limitante-sistema');
                        
                        if (potencialTransporte < potencialColheita) {
                            limitanteElement.value = "TRANSPORTE";
                            limitanteElement.style.color = 'var(--danger-color)';
                            
                            // Update insight text
                            document.getElementById('insight-limitante').textContent = 
                                `O sistema está limitado pelo TRANSPORTE. Considere aumentar a disponibilidade de caminhões (faltam ${Math.ceil(totalNecessarios - totalDisponiveis)}).`;
                        } else {
                            limitanteElement.value = "COLHEITA";
                            limitanteElement.style.color = 'var(--success-color)';
                            
                            // Update insight text
                            document.getElementById('insight-limitante').textContent = 
                                `O sistema está limitado pela COLHEITA. O transporte atual é suficiente para a capacidade de colheita.`;
                        }
                        
                        // Update dashboard
                        document.getElementById('dashboard-caminhoes').textContent = totalDisponiveis;
                        document.getElementById('dashboard-transporte').textContent = Math.round(potencialTransporte);
                        
                        const transporteProgress = Math.min(100, (potencialTransporte / 550) * 100);
                        document.getElementById('transporte-progress').style.width = `${transporteProgress}%`;
                        const transporteProgressLabel = document.querySelector('#transporte-progress').parentElement.nextElementSibling.firstElementChild;
                        transporteProgressLabel.textContent = `${Math.round(transporteProgress)}% do projetado`;
                    },
                    
                    // Update working hours from UI
                    updateHorasTrabalhadasFromUI: function() {
                        App.data.horasTrabalhadas.prop4001 = parseInt(document.getElementById('horas-prop-4001').value) || 0;
                        App.data.horasTrabalhadas.prop4002 = parseInt(document.getElementById('horas-prop-4002').value) || 0;
                        App.data.horasTrabalhadas.terc = parseInt(document.getElementById('horas-terc').value) || 0;
                    },
                    
                    // Update fronts data from UI
                    updateFrentesDataFromUI: function() {
                        const rows = document.querySelectorAll('#frentes-table tbody tr');
                        const newFrentes = [];
                        
                        rows.forEach(row => {
                            const frenteId = row.querySelector('.frente-input').value;
                            const existingFrente = App.data.frentes.find(f => f.frente === frenteId);
                            
                            // Create updated front data
                            const frente = {
                                frente: frenteId,
                                cota: parseFloat(row.querySelector('td:nth-child(2) input').value) || 0,
                                dist: parseFloat(row.querySelector('td:nth-child(3) input').value) || 0,
                                ida: parseFloat(row.querySelector('td:nth-child(4) input').value) || 0,
                                campo: parseFloat(row.querySelector('td:nth-child(5) input').value) || 0,
                                volta: parseFloat(row.querySelector('td:nth-child(6) input').value) || 0,
                                usina: parseFloat(row.querySelector('td:nth-child(7) input').value) || 0,
                                peso: parseFloat(row.querySelector('td:nth-child(12) input').value) || 60,
                                transporte: row.querySelector('.transporte-select').value,
                                // Keep additional fields
                                obs: existingFrente?.obs || '',
                                location: existingFrente?.location || null,
                                tags: existingFrente?.tags || [],
                                createdAt: existingFrente?.createdAt || new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            };
                            
                            newFrentes.push(frente);
                        });
                        
                        // Update fronts data
                        App.data.frentes = newFrentes;
                        
                        // Update UI
                        UI.updateFrentesTotais();
                    },
                    
                    // Add new front
                    addNewFrente: function() {
                        const frenteId = document.getElementById('nova-frente-id').value.trim();
                        const cota = parseFloat(document.getElementById('nova-frente-cota').value) || 0;
                        const dist = parseFloat(document.getElementById('nova-frente-dist').value) || 0;
                        const transporte = document.getElementById('nova-frente-transporte').value;
                        const peso = parseFloat(document.getElementById('nova-frente-peso').value) || 60;
                        const lat = document.getElementById('nova-frente-lat').value.trim();
                        const lng = document.getElementById('nova-frente-lng').value.trim();
                        const obs = document.getElementById('nova-frente-obs').value.trim();
                        
                        // Check if in edit mode
                        const isEdit = document.getElementById('add-frente').dataset.mode === 'edit';
                        const originalId = document.getElementById('add-frente').dataset.originalId;
                        
                        // Validate front ID
                        if (!frenteId) {
                            UI.showToast('Por favor, informe o ID da frente', 'warning');
                            return;
                        }
                        
                        // Check if front already exists (only for new fronts)
                        if (!isEdit && App.data.frentes.some(f => f.frente === frenteId)) {
                            UI.showToast('Já existe uma frente com este ID!', 'error');
                            return;
                        }
                        
                        // Prepare location if coordinates provided
                        const location = (lat && lng) ? 
                            { lat: parseFloat(lat), lng: parseFloat(lng) } : null;
                        
                        UI.showLoading(isEdit ? 'Atualizando frente...' : 'Adicionando frente...');
                        
                        setTimeout(() => {
                            try {
                                if (isEdit) {
                                    // Update existing front
                                    const index = App.data.frentes.findIndex(f => f.frente === originalId);
                                    if (index !== -1) {
                                        // If ID changed, update equipment data as well
                                        if (originalId !== frenteId) {
                                            App.data.equipamentos[frenteId] = [...App.data.equipamentos[originalId]];
                                            delete App.data.equipamentos[originalId];
                                        }
                                        
                                        const existingFrente = App.data.frentes[index];
                                        
                                        // Update front
                                        App.data.frentes[index] = {
                                            frente: frenteId,
                                            cota: cota,
                                            dist: dist,
                                            ida: existingFrente.ida || 0,
                                            campo: existingFrente.campo || 0,
                                            volta: existingFrente.volta || 0,
                                            usina: existingFrente.usina || 0,
                                            transporte: transporte,
                                            peso: peso,
                                            obs: obs,
                                            location: location || existingFrente.location,
                                            tags: App.state.selectedTags,
                                            createdAt: existingFrente.createdAt,
                                            updatedAt: new Date().toISOString()
                                        };
                                        
                                        // Reset button to add mode
                                        document.getElementById('add-frente').innerHTML = '<i class="fas fa-plus-circle" aria-hidden="true"></i> Adicionar Frente';
                                        document.getElementById('add-frente').dataset.mode = '';
                                        delete document.getElementById('add-frente').dataset.originalId;
                                        
                                        // Add history entry
                                        App.addHistoryEntry({
                                            tipo: 'edit',
                                            entidade: 'frente',
                                            titulo: `Frente ${frenteId} atualizada`,
                                            descricao: `Frente atualizada com cota de ${cota} toneladas`,
                                            data: new Date().toISOString(),
                                            usuario: 'Administrador'
                                        });
                                        
                                        UI.showToast(`Frente ${frenteId} atualizada com sucesso!`);
                                    }
                                } else {
                                    // Add new front
                                    const newFrente = {
                                        frente: frenteId,
                                        cota: cota,
                                        dist: dist,
                                        ida: 0,
                                        campo: 0,
                                        volta: 0,
                                        usina: 0,
                                        transporte: transporte,
                                        peso: peso,
                                        obs: obs,
                                        location: location,
                                        tags: App.state.selectedTags,
                                        createdAt: new Date().toISOString()
                                    };
                                    
                                    App.data.frentes.push(newFrente);
                                    
                                    // Create default equipment
                                    App.data.equipamentos[frenteId] = [
                                        { equipo: 'COLHEDORA 1', carreg: 5.0, aux: 1.5, disponivel: 1, producao: 144.0 },
                                        { equipo: 'COLHEDORA 2', carreg: 4.8, aux: 1.3, disponivel: 1, producao: 150.0 },
                                        { equipo: 'COLHEDORA 3', carreg: 5.2, aux: 1.4, disponivel: 1, producao: 138.5 },
                                        { equipo: 'COLHEDORA 4', carreg: 4.9, aux: 1.2, disponivel: 1, producao: 146.9 },
                                        { equipo: 'COLHEDORA 5', carreg: 5.5, aux: 1.6, disponivel: 1, producao: 130.9 }
                                    ];
                                    
                                    // Add history entry
                                    App.addHistoryEntry({
                                        tipo: 'add',
                                        entidade: 'frente',
                                        titulo: `Frente ${frenteId} adicionada`,
                                        descricao: `Nova frente cadastrada com cota de ${cota} toneladas`,
                                        data: new Date().toISOString(),
                                        usuario: 'Administrador'
                                    });
                                    
                                    UI.showToast(`Frente ${frenteId} adicionada com sucesso!`);
                                }
                                
                                // Reset form
                                document.getElementById('nova-frente-id').value = '';
                                document.getElementById('nova-frente-cota').value = '0';
                                document.getElementById('nova-frente-dist').value = '0';
                                document.getElementById('nova-frente-peso').value = '60';
                                document.getElementById('nova-frente-lat').value = '';
                                document.getElementById('nova-frente-lng').value = '';
                                document.getElementById('nova-frente-obs').value = '';
                                App.clearTags();
                                
                                // Update UI
                                UI.initFrentesTable();
                                UI.initEquipamentosTables();
                                UI.initPotencialTable();
                                UI.updateRecentFrentes();
                                this.calculatePotencial();
                                
                                // Update timestamp and save
                                App.data.lastUpdated = new Date().toISOString();
                                UI.updateTimestamps();
                                App.saveData();
                                
                                UI.hideLoading();
                            } catch (error) {
                                console.error('Error adding/updating front:', error);
                                UI.hideLoading();
                                UI.showToast('Error processing front: ' + error.message, 'error');
                            }
                        }, 500);
                    },
                    
                    // Update all equipment data
                    updateAllEquipamentosData: function() {
                        for (const frente in App.data.equipamentos) {
                            this.updateEquipamentosDataFromUI(frente);
                        }
                    },
                    
                    // Update equipment data from UI
                    updateEquipamentosDataFromUI: function(frente) {
                        const rows = document.querySelectorAll(`#equip-${frente} .equip-table tbody tr`);
                        if (!rows.length) return;
                        
                        const equipamentos = [];
                        
                        rows.forEach(row => {
                            const equipo = row.querySelector('td:nth-child(1) input').value;
                            const carreg = parseFloat(row.querySelector('td:nth-child(2) input').value) || 0;
                            const aux = parseFloat(row.querySelector('td:nth-child(3) input').value) || 0;
                            const disponivel = parseInt(row.querySelector('.disponivel-select').value) || 0;
                            const producao = parseFloat(row.querySelector('td:nth-child(5) input').value) || 0;
                            
                            equipamentos.push({
                                equipo,
                                carreg,
                                aux,
                                disponivel,
                                producao
                            });
                        });
                        
                        App.data.equipamentos[frente] = equipamentos;
                    }
                };
                
                // UI namespace - for handling UI updates and interactions
                const UI = {
                    // Show loading state
                    showLoading: function(message = 'Carregando...') {
                        const loading = document.getElementById('loading');
                        const loadingMessage = document.getElementById('loading-message');
                        loadingMessage.textContent = message;
                        loading.style.display = 'flex';
                    },
                    
                    // Hide loading state
                    hideLoading: function() {
                        const loading = document.getElementById('loading');
                        loading.style.display = 'none';
                    },
                    
                    // Show toast message
                    showToast: function(message, type = 'success') {
                        const toast = document.getElementById('toast');
                        toast.textContent = message;
                        toast.className = 'toast';
                        if (type) toast.classList.add(type);
                        toast.classList.add('show');
                        
                        setTimeout(() => {
                            toast.classList.remove('show');
                        }, 5000);
                    },
                    
                    // Update timestamps
                    updateTimestamps: function() {
                        const formattedDate = new Date(App.data.lastUpdated).toLocaleString('pt-BR');
                        
                        document.querySelectorAll('[id^="lastUpdated"]').forEach(element => {
                            element.textContent = 'Última atualização: ' + formattedDate;
                        });
                    },
                    
                    // Update fronts table
                    initFrentesTable: function() {
                        const tableBody = document.querySelector('#frentes-table tbody');
                        tableBody.innerHTML = '';
                        
                        App.data.frentes.forEach(frente => {
                            const totalTempo = (parseFloat(frente.ida) || 0) + (parseFloat(frente.campo) || 0) + 
                                              (parseFloat(frente.volta) || 0) + (parseFloat(frente.usina) || 0);
                            const horas = totalTempo / 60;
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td><input type="text" class="frente-input" value="${frente.frente}" readonly></td>
                                <td><input type="number" min="0" step="100" value="${frente.cota}"></td>
                                <td><input type="number" min="0" step="0.1" value="${frente.dist}"></td>
                                <td><input type="number" min="0" class="tempo-input" value="${frente.ida}"></td>
                                <td><input type="number" min="0" class="tempo-input" value="${frente.campo}"></td>
                                <td><input type="number" min="0" class="tempo-input" value="${frente.volta}"></td>
                                <td><input type="number" min="0" class="tempo-input" value="${frente.usina}"></td>
                                <td><input type="text" class="total-tempo" value="${totalTempo.toFixed(2)}" readonly></td>
                                <td><input type="text" value="${horas.toFixed(2)}" readonly></td>
                                <td><input type="text" value="${horas.toFixed(2)}" readonly></td>
                                <td><input type="number" min="0" value="0"></td>
                                <td><input type="number" min="0" step="1" value="${frente.peso}"></td>
                                <td>
                                    <select class="transporte-select">
                                        <option value="P" ${frente.transporte === 'P' ? 'selected' : ''}>Próprio</option>
                                        <option value="T" ${frente.transporte === 'T' ? 'selected' : ''}>Terceiro</option>
                                    </select>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-view-frente" data-frente="${frente.frente}" aria-label="Ver detalhes">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-edit-frente" data-frente="${frente.frente}" aria-label="Editar frente">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-delete-frente" data-frente="${frente.frente}" aria-label="Excluir frente">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            `;
                            
                            // Add event handlers for time inputs
                            row.querySelectorAll('.tempo-input').forEach(input => {
                                input.addEventListener('change', () => {
                                    const ida = parseFloat(row.querySelector('td:nth-child(4) input').value) || 0;
                                    const campo = parseFloat(row.querySelector('td:nth-child(5) input').value) || 0;
                                    const volta = parseFloat(row.querySelector('td:nth-child(6) input').value) || 0;
                                    const usina = parseFloat(row.querySelector('td:nth-child(7) input').value) || 0;
                                    
                                    const total = ida + campo + volta + usina;
                                    row.querySelector('.total-tempo').value = total.toFixed(2);
                                    
                                    // Update hours
                                    const horas = total / 60;
                                    row.querySelector('td:nth-child(9) input').value = horas.toFixed(2);
                                    row.querySelector('td:nth-child(10) input').value = horas.toFixed(2);
                                });
                            });
                            
                            // Add event handlers for buttons
                            row.querySelector('.btn-view-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.showFrenteDetails(App.data.frentes.find(f => f.frente === frente));
                            });
                            
                            row.querySelector('.btn-edit-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.editFrente(frente);
                            });
                            
                            row.querySelector('.btn-delete-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.deleteFrente(frente);
                            });
                            
                            tableBody.appendChild(row);
                        });
                        
                        this.updateFrentesTotais();
                    },
                    
                    // Update front totals
                    updateFrentesTotais: function() {
                        const frentes = App.data.frentes;
                        if (!frentes || frentes.length === 0) return;
                        
                        // Calculate totals and averages
                        const totalCota = frentes.reduce((sum, f) => sum + parseFloat(f.cota), 0);
                        const avgDist = frentes.reduce((sum, f) => sum + parseFloat(f.dist), 0) / frentes.length;
                        const avgIda = frentes.reduce((sum, f) => sum + parseFloat(f.ida), 0) / frentes.length;
                        const avgCampo = frentes.reduce((sum, f) => sum + parseFloat(f.campo), 0) / frentes.length;
                        const avgVolta = frentes.reduce((sum, f) => sum + parseFloat(f.volta), 0) / frentes.length;
                        const avgUsina = frentes.reduce((sum, f) => sum + parseFloat(f.usina), 0) / frentes.length;
                        
                        const avgTotal = avgIda + avgCampo + avgVolta + avgUsina;
                        const avgCiclo = avgTotal / 60;
                        const avgDens = frentes.reduce((sum, f) => sum + parseFloat(f.peso), 0) / frentes.length;
                        
                        // Update UI
                        document.getElementById('frentes-total-cota').value = totalCota.toFixed(2);
                        document.getElementById('frentes-media-dist').value = avgDist.toFixed(2);
                        document.getElementById('frentes-media-ida').value = avgIda.toFixed(2);
                        document.getElementById('frentes-media-campo').value = avgCampo.toFixed(2);
                        document.getElementById('frentes-media-volta').value = avgVolta.toFixed(2);
                        document.getElementById('frentes-media-usina').value = avgUsina.toFixed(2);
                        document.getElementById('frentes-media-total').value = avgTotal.toFixed(2);
                        document.getElementById('frentes-media-ciclo').value = avgCiclo.toFixed(2);
                        document.getElementById('frentes-media-dens').value = avgDens.toFixed(2);
                    },
                    
                    // Initialize potential table
                    initPotencialTable: function() {
                        const tableBody = document.querySelector('#potencial-table tbody');
                        tableBody.innerHTML = '';
                        
                        // Update front filter select
                        const filterSelect = document.getElementById('potencial-filter-frente');
                        if (filterSelect) {
                            const selectedValue = filterSelect.value;
                            filterSelect.innerHTML = '<option value="">Todas as Frentes</option>';
                            
                            App.data.frentes.forEach(frente => {
                                const option = document.createElement('option');
                                option.value = frente.frente;
                                option.textContent = frente.frente;
                                filterSelect.appendChild(option);
                            });
                            
                            if (selectedValue && Array.from(filterSelect.options).some(opt => opt.value === selectedValue)) {
                                filterSelect.value = selectedValue;
                            }
                        }
                        
                        // Update front filter in other places
                        this.updateFrontFilterSelects();
                        
                        App.data.frentes.forEach(frente => {
                            // Find potential data for this front
                            const potencialData = App.data.potencial.find(p => p.frente === frente.frente);
                            
                            // Default strategy value
                            const defaultEstrategia = potencialData ? potencialData.estrategia : Math.round(frente.cota / 21);
                            
                            // Calculate status display
                            const capacidadePercentual = potencialData && potencialData.cota > 0 ? 
                                (potencialData.capFrente / potencialData.cota) * 100 : 0;
                                
                            const status = capacidadePercentual >= 100 ? 'ÓTIMO' :
                                capacidadePercentual >= 90 ? 'BOM' :
                                capacidadePercentual >= 75 ? 'REGULAR' : 'INSUFICIENTE';
                                
                            const statusClass = capacidadePercentual >= 100 ? 'badge-success' :
                                capacidadePercentual >= 90 ? 'badge-info' :
                                capacidadePercentual >= 75 ? 'badge-warning' : 'badge-danger';
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${frente.frente}</td>
                                <td><input type="text" class="potencial-cota" value="${potencialData ? potencialData.cota.toFixed(2) : '0.00'}" readonly></td>
                                <td><input type="text" class="potencial-maquinas" value="${potencialData ? potencialData.capMaquinas.toFixed(2) : '0.00'}" readonly></td>
                                <td><input type="text" class="potencial-tratores" value="${potencialData ? potencialData.capTratores.toFixed(2) : '0.00'}" readonly></td>
                                <td><input type="text" class="potencial-limitante" value="${potencialData ? potencialData.capFrente.toFixed(2) : '0.00'}" readonly></td>
                                <td><input type="number" min="0" class="potencial-estrategia" value="${defaultEstrategia}"></td>
                                <td><input type="text" class="potencial-tempo" value="${potencialData ? potencialData.tempo.toFixed(4) : '0.0000'}" readonly></td>
                                <td><input type="text" class="potencial-camh" value="${potencialData ? potencialData.camh.toFixed(2) : '0.00'}" readonly></td>
                                <td><input type="text" class="potencial-frota" value="${potencialData ? potencialData.frota.toFixed(2) : '0.00'}" readonly></td>
                                <td><input type="text" class="potencial-intaloc" value="${potencialData ? potencialData.intaloc.toFixed(2) : '0.00'}" readonly></td>
                                <td><span class="badge ${statusClass} status-badge">${status}</span></td>
                            `;
                            
                            // Add event listener for strategy input
                            row.querySelector('.potencial-estrategia').addEventListener('change', () => {
                                DataHandler.calculatePotencial();
                                this.updateDashboard();
                            });
                            
                            tableBody.appendChild(row);
                        });
                        
                        // Calculate and update totals
                        this.updatePotencialTotals();
                    },
                    
                    // Update potential totals
                    updatePotencialTotals: function() {
                        if (!App.data.potencial || App.data.potencial.length === 0) return;
                        
                        const totalCota = App.data.potencial.reduce((sum, p) => sum + p.cota, 0);
                        const totalMaquinas = App.data.potencial.reduce((sum, p) => sum + p.capMaquinas, 0);
                        const totalTratores = App.data.potencial.reduce((sum, p) => sum + p.capTratores, 0);
                        const totalLimitante = App.data.potencial.reduce((sum, p) => sum + p.capFrente, 0);
                        const totalEstrategia = App.data.potencial.reduce((sum, p) => sum + p.estrategia, 0);
                        const avgTempo = App.data.potencial.length > 0 ? 
                            App.data.potencial.reduce((sum, p) => sum + p.tempo, 0) / App.data.potencial.length : 0;
                        const totalCamH = App.data.potencial.reduce((sum, p) => sum + p.camh, 0);
                        const totalFrota = App.data.potencial.reduce((sum, p) => sum + p.frota, 0);
                        
                        // Update UI
                        document.getElementById('potencial-total-cota').value = totalCota.toFixed(2);
                        document.getElementById('potencial-total-maquinas').value = totalMaquinas.toFixed(2);
                        document.getElementById('potencial-total-tratores').value = totalTratores.toFixed(2);
                        document.getElementById('potencial-total-limitante').value = totalLimitante.toFixed(2);
                        document.getElementById('potencial-total-estrategia').value = totalEstrategia.toFixed(2);
                        document.getElementById('potencial-total-tempo').value = avgTempo.toFixed(4);
                        document.getElementById('potencial-total-camh').value = totalCamH.toFixed(2);
                        document.getElementById('potencial-total-frota').value = totalFrota.toFixed(2);
                    },
                    
                    // Update front filter selects in various tabs
                    updateFrontFilterSelects: function() {
                        const filterSelects = [
                            document.getElementById('equipamentos-filter-frente'),
                            document.getElementById('report-frente')
                        ];
                        
                        filterSelects.forEach(select => {
                            if (!select) return;
                            
                            const selectedValue = select.value;
                            select.innerHTML = '<option value="">Todas as Frentes</option>';
                            
                            App.data.frentes.forEach(frente => {
                                const option = document.createElement('option');
                                option.value = frente.frente;
                                option.textContent = frente.frente;
                                select.appendChild(option);
                            });
                            
                            if (selectedValue && Array.from(select.options).some(opt => opt.value === selectedValue)) {
                                select.value = selectedValue;
                            }
                        });
                    },
                    
                    // Initialize equipment tabs
                    initEquipamentosTabs: function() {
                        const tabsContainer = document.querySelector('.equipamentos-tabs');
                        tabsContainer.innerHTML = '';
                        
                        App.data.frentes.forEach((frente, index) => {
                            const tab = document.createElement('button');
                            tab.classList.add('equip-tab-button');
                            if (index === 0) tab.classList.add('active');
                            tab.setAttribute('data-frente', frente.frente);
                            tab.setAttribute('aria-selected', index === 0 ? 'true' : 'false');
                            tab.setAttribute('role', 'tab');
                            tab.textContent = `Frente ${frente.frente}`;
                            
                            tab.addEventListener('click', function() {
                                document.querySelectorAll('.equip-tab-button').forEach(t => {
                                    t.classList.remove('active');
                                    t.setAttribute('aria-selected', 'false');
                                });
                                document.querySelectorAll('.equip-frente').forEach(c => c.classList.remove('active'));
                                
                                this.classList.add('active');
                                this.setAttribute('aria-selected', 'true');
                                document.getElementById(`equip-${frente.frente}`).classList.add('active');
                            });
                            
                            tabsContainer.appendChild(tab);
                        });
                    },
                    
                    // Initialize equipment tables
                    initEquipamentosTables: function() {
                        this.initEquipamentosTabs();
                        
                        const contentContainer = document.getElementById('equipamentos-content');
                        contentContainer.innerHTML = '';
                        
                        App.data.frentes.forEach((frente, index) => {
                            const equipamentosFrente = App.data.equipamentos[frente.frente];
                            if (!equipamentosFrente) return;
                            
                            const frenteContainer = document.createElement('div');
                            frenteContainer.id = `equip-${frente.frente}`;
                            frenteContainer.classList.add('equip-frente');
                            if (index === 0) frenteContainer.classList.add('active');
                            
                            let tableHTML = `
                                <div class="data-container">
                                    <div class="table-container">
                                        <table class="data-table equip-table">
                                            <thead>
                                                <tr>
                                                    <th>Equipamento</th>
                                                    <th>Tempo de Carregamento (min)</th>
                                                    <th>Tempo Auxiliar (min)</th>
                                                    <th>Disponível</th>
                                                    <th>Produção (t/h)</th>
                                                    <th>Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                            `;
                            
                            equipamentosFrente.forEach(equip => {
                                tableHTML += `
                                    <tr>
                                        <td><input type="text" value="${equip.equipo}"></td>
                                        <td><input type="number" min="0" step="0.1" value="${equip.carreg}"></td>
                                        <td><input type="number" min="0" step="0.1" value="${equip.aux}"></td>
                                        <td>
                                            <select class="disponivel-select">
                                                <option value="1" ${equip.disponivel === 1 ? 'selected' : ''}>Sim</option>
                                                <option value="0" ${equip.disponivel === 0 ? 'selected' : ''}>Não</option>
                                            </select>
                                        </td>
                                        <td><input type="text" value="${equip.producao.toFixed(2)}" readonly></td>
                                        <td>
                                            <button class="btn btn-sm btn-danger btn-delete-equip" data-frente="${frente.frente}" data-equipo="${equip.equipo}" aria-label="Excluir equipamento">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            });
                            
                            tableHTML += `
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="equip-results">
                                    <div class="form-row">
                                        <label for="${frente.frente}-tratores">Número de Tratores Ativos:</label>
                                        <input type="number" id="${frente.frente}-tratores" min="0" value="5">
                                    </div>
                                    <div class="form-row">
                                        <label for="${frente.frente}-densidade">Densidade de Carga (t):</label>
                                        <input type="number" id="${frente.frente}-densidade" min="0" step="0.1" value="12">
                                    </div>
                                    <hr style="margin: 1.5rem 0;">
                                    <div class="equip-result-row">
                                        <label for="${frente.frente}-disponiveis">Colhedoras Disponíveis:</label>
                                        <input type="text" id="${frente.frente}-disponiveis" value="0" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente.frente}-media-carreg">Tempo Médio de Carregamento (min):</label>
                                        <input type="text" id="${frente.frente}-media-carreg" value="0.00" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente.frente}-media-aux">Tempo Médio Auxiliar (min):</label>
                                        <input type="text" id="${frente.frente}-media-aux" value="0.00" readonly>
                                    </div>
                                    <hr style="margin: 1.5rem 0;">
                                    <div class="equip-result-row">
                                        <label for="${frente.frente}-cap-colhedoras">Capacidade Colhedoras (t/h):</label>
                                        <input type="text" id="${frente.frente}-cap-colhedoras" value="0.00" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente.frente}-cap-tratores">Capacidade Tratores (t/h):</label>
                                        <input type="text" id="${frente.frente}-cap-tratores" value="0.00" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente.frente}-cap-frente">Capacidade da Frente (t/h):</label>
                                        <input type="text" id="${frente.frente}-cap-frente" value="0.00" readonly>
                                    </div>
                                </div>
                            `;
                            
                            frenteContainer.innerHTML = tableHTML;
                            contentContainer.appendChild(frenteContainer);
                            
                            // Add event listeners
                            const tratoresInput = document.getElementById(`${frente.frente}-tratores`);
                            const densidadeInput = document.getElementById(`${frente.frente}-densidade`);
                            
                            if (tratoresInput) {
                                tratoresInput.addEventListener('change', () => {
                                    DataHandler.calculatePotencial();
                                });
                            }
                            
                            if (densidadeInput) {
                                densidadeInput.addEventListener('change', () => {
                                    DataHandler.calculatePotencial();
                                });
                            }
                            
                            // Add event listeners for equipment inputs
                            const equipRows = frenteContainer.querySelectorAll('.equip-table tbody tr');
                            equipRows.forEach(row => {
                                const inputs = row.querySelectorAll('input, select');
                                inputs.forEach(input => {
                                    input.addEventListener('change', () => {
                                        DataHandler.updateEquipamentosDataFromUI(frente.frente);
                                        DataHandler.calculatePotencial();
                                    });
                                });
                                
                                // Add delete button handler
                                const deleteBtn = row.querySelector('.btn-delete-equip');
                                if (deleteBtn) {
                                    deleteBtn.addEventListener('click', function() {
                                        const frente = this.dataset.frente;
                                        const equipo = this.dataset.equipo;
                                        
                                        App.showConfirmDialog(
                                            'Excluir Equipamento',
                                            `Tem certeza que deseja excluir o equipamento ${equipo} da frente ${frente}?`,
                                            () => {
                                                // Remove equipment
                                                App.data.equipamentos[frente] = App.data.equipamentos[frente].filter(e => e.equipo !== equipo);
                                                
                                                // Update UI
                                                UI.initEquipamentosTables();
                                                DataHandler.calculatePotencial();
                                                
                                                // Add to history
                                                App.addHistoryEntry({
                                                    tipo: 'delete',
                                                    entidade: 'equipamento',
                                                    titulo: `Equipamento ${equipo} excluído`,
                                                    descricao: `Equipamento removido da frente ${frente}`,
                                                    data: new Date().toISOString(),
                                                    usuario: 'Administrador'
                                                });
                                                
                                                UI.showToast(`Equipamento ${equipo} excluído com sucesso!`);
                                            }
                                        );
                                    });
                                }
                            });
                        });
                    },
                    
                    // Update recent fronts table
                    updateRecentFrentes: function() {
                        const tableBody = document.querySelector('#recentes-frentes-table tbody');
                        if (!tableBody) return;
                        
                        tableBody.innerHTML = '';
                        
                        // Sort fronts by creation date (most recent first)
                        const frentesOrdenadas = [...App.data.frentes]
                            .filter(f => f.createdAt)
                            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                            .slice(0, 5); // Show only 5 most recent
                        
                        if (frentesOrdenadas.length === 0) {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td colspan="6" class="empty-state">
                                    <i class="fas fa-info-circle"></i>
                                    <p>Nenhuma frente cadastrada recentemente.</p>
                                </td>
                            `;
                            tableBody.appendChild(row);
                            return;
                        }
                        
                        frentesOrdenadas.forEach(frente => {
                            const dataCriacao = new Date(frente.createdAt);
                            const dataFormatada = dataCriacao.toLocaleString('pt-BR');
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${frente.frente}</td>
                                <td>${frente.cota.toLocaleString('pt-BR')}</td>
                                <td>${frente.dist}</td>
                                <td>${frente.transporte === 'P' ? 'Próprio' : 'Terceiro'}</td>
                                <td>${dataFormatada}</td>
                                <td>
                                    <button class="btn btn-sm btn-view-frente" data-frente="${frente.frente}" aria-label="Ver detalhes">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-edit-frente" data-frente="${frente.frente}" aria-label="Editar frente">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-delete-frente" data-frente="${frente.frente}" aria-label="Excluir frente">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            `;
                            
                            // Add event handlers for buttons
                            row.querySelector('.btn-view-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.showFrenteDetails(App.data.frentes.find(f => f.frente === frente));
                            });
                            
                            row.querySelector('.btn-edit-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.editFrente(frente);
                            });
                            
                            row.querySelector('.btn-delete-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.deleteFrente(frente);
                            });
                            
                            tableBody.appendChild(row);
                        });
                    },
                    
                    // Show front details
                    showFrenteDetails: function(frente) {
                        // Create modal with front details
                        const modal = document.createElement('div');
                        modal.className = 'modal';
                        modal.style.display = 'flex';
                        
                        // Get potential data if available
                        const potencialData = App.data.potencial.find(p => p.frente === frente.frente);
                        
                        // Format tags
                        const tags = frente.tags && frente.tags.length > 0 ? 
                            frente.tags.map(tag => `<span class="badge badge-primary">${tag}</span>`).join(' ') : 
                            '<i>Nenhuma tag</i>';
                        
                        // Create modal content
                        modal.innerHTML = `
                            <div class="modal-content" style="max-width: 700px;">
                                <div class="modal-header">
                                    <h3>Detalhes da Frente ${frente.frente}</h3>
                                    <button class="modal-close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                                        <div class="data-card">
                                            <h4>Informações Básicas</h4>
                                            <div class="form-row">
                                                <label>ID:</label>
                                                <strong>${frente.frente}</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Cota:</label>
                                                <strong>${frente.cota.toLocaleString('pt-BR')} toneladas</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Distância:</label>
                                                <strong>${frente.dist} km</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Transporte:</label>
                                                <strong>${frente.transporte === 'P' ? 'Próprio' : 'Terceiro'}</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Peso:</label>
                                                <strong>${frente.peso} t</strong>
                                            </div>
                                        </div>
                                        
                                        <div class="data-card">
                                            <h4>Tempos de Ciclo</h4>
                                            <div class="form-row">
                                                <label>Ida:</label>
                                                <strong>${frente.ida} min</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Campo:</label>
                                                <strong>${frente.campo} min</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Volta:</label>
                                                <strong>${frente.volta} min</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Usina:</label>
                                                <strong>${frente.usina} min</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Total:</label>
                                                <strong>${(parseFloat(frente.ida) + parseFloat(frente.campo) + parseFloat(frente.volta) + parseFloat(frente.usina)).toFixed(2)} min</strong>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="data-card" style="margin-top: 1.5rem;">
                                        <h4>Potencial</h4>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;">
                                            <div class="form-row">
                                                <label>Potencial de Colheita:</label>
                                                <strong>${potencialData ? potencialData.capFrente.toFixed(2) : 'N/A'} t/h</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Estratégia:</label>
                                                <strong>${potencialData ? potencialData.estrategia.toFixed(2) : 'N/A'} t/h</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Frota:</label>
                                                <strong>${potencialData ? potencialData.frota.toFixed(2) : 'N/A'} caminhões</strong>
                                            </div>
                                            <div class="form-row">
                                                <label>Intervalo Alocação:</label>
                                                <strong>${potencialData ? potencialData.intaloc.toFixed(2) : 'N/A'} min</strong>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="data-card" style="margin-top: 1.5rem;">
                                        <h4>Equipamentos Disponíveis</h4>
                                        <div class="table-container">
                                            <table class="data-table">
                                                <thead>
                                                    <tr>
                                                        <th>Equipamento</th>
                                                        <th>T. Carregamento</th>
                                                        <th>T. Auxiliar</th>
                                                        <th>Produção</th>
                                                        <th>Disponível</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${App.data.equipamentos[frente.frente] ?
                                                      App.data.equipamentos[frente.frente].map(equip => `
                                                        <tr>
                                                            <td>${equip.equipo}</td>
                                                            <td>${equip.carreg} min</td>
                                                            <td>${equip.aux} min</td>
                                                            <td>${equip.producao.toFixed(2)} t/h</td>
                                                            <td>${equip.disponivel === 1 ? '<span class="badge badge-success">Sim</span>' : '<span class="badge badge-danger">Não</span>'}</td>
                                                        </tr>
                                                    `).join('') : 
                                                    '<tr><td colspan="5" class="empty-state">Nenhum equipamento cadastrado</td></tr>'}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    
                                    <div class="data-card" style="margin-top: 1.5rem;">
                                        <h4>Informações Adicionais</h4>
                                        <div class="form-row">
                                            <label>Data de Cadastro:</label>
                                            <strong>${frente.createdAt ? new Date(frente.createdAt).toLocaleString('pt-BR') : 'N/A'}</strong>
                                        </div>
                                        <div class="form-row">
                                            <label>Última Atualização:</label>
                                            <strong>${frente.updatedAt ? new Date(frente.updatedAt).toLocaleString('pt-BR') : 'N/A'}</strong>
                                        </div>
                                        <div class="form-row">
                                            <label>Localização:</label>
                                            <strong>${frente.location ? `Lat: ${frente.location.lat}, Lng: ${frente.location.lng}` : 'Não definida'}</strong>
                                        </div>
                                        <div class="form-row">
                                            <label>Tags:</label>
                                            <div>${tags}</div>
                                        </div>
                                        <div class="form-row">
                                            <label>Observações:</label>
                                            <div>${frente.obs || '<i>Nenhuma observação</i>'}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary modal-close-btn">Fechar</button>
                                    <button class="btn edit-frente-btn" data-frente="${frente.frente}">Editar Frente</button>
                                </div>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // Add event listeners
                        modal.querySelector('.modal-close').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.modal-close-btn').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.edit-frente-btn').addEventListener('click', () => {
                            document.body.removeChild(modal);
                            this.editFrente(frente.frente);
                        });
                        
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                document.body.removeChild(modal);
                            }
                        });
                    },
                    
                    // Edit front
                    editFrente: function(frenteId) {
                        const frente = App.data.frentes.find(f => f.frente === frenteId);
                        if (!frente) {
                            this.showToast('Frente não encontrada', 'error');
                            return;
                        }
                        
                        // Switch to the 'cadastrar' tab
                        document.querySelector('[data-tab="cadastrar"]').click();
                        
                        // Fill the form with front data
                        document.getElementById('nova-frente-id').value = frente.frente;
                        document.getElementById('nova-frente-cota').value = frente.cota;
                        document.getElementById('nova-frente-dist').value = frente.dist;
                        document.getElementById('nova-frente-transporte').value = frente.transporte;
                        document.getElementById('nova-frente-peso').value = frente.peso;
                        
                        // Fill location if available
                        if (frente.location) {
                            document.getElementById('nova-frente-lat').value = frente.location.lat;
                            document.getElementById('nova-frente-lng').value = frente.location.lng;
                        } else {
                            document.getElementById('nova-frente-lat').value = '';
                            document.getElementById('nova-frente-lng').value = '';
                        }
                        
                        document.getElementById('nova-frente-obs').value = frente.obs || '';
                        
                        // Clear existing tags
                        App.clearTags();
                        
                        // Add tags
                        if (frente.tags && frente.tags.length > 0) {
                            App.state.selectedTags = [...frente.tags];
                            frente.tags.forEach(tag => {
                                const tagsContainer = document.querySelector('.tags-input-container');
                                const tagsInput = document.getElementById('nova-frente-tags');
                                
                                const tagElement = document.createElement('div');
                                tagElement.className = 'tag';
                                tagElement.innerHTML = `
                                    <span>${tag}</span>
                                    <span class="tag-close">&times;</span>
                                `;
                                
                                // Add event to remove tag
                                tagElement.querySelector('.tag-close').addEventListener('click', () => {
                                    tagElement.remove();
                                    App.state.selectedTags = App.state.selectedTags.filter(t => t !== tag);
                                });
                                
                                // Add tag to container
                                tagsContainer.insertBefore(tagElement, tagsInput);
                            });
                        }
                        
                        // Change button to Update mode
                        document.getElementById('add-frente').innerHTML = '<i class="fas fa-save" aria-hidden="true"></i> Atualizar Frente';
                        document.getElementById('add-frente').dataset.mode = 'edit';
                        document.getElementById('add-frente').dataset.originalId = frente.frente;
                    },
                    
                    // Delete front
                    deleteFrente: function(frenteId) {
                        App.showConfirmDialog(
                            'Confirmar Exclusão',
                            `Tem certeza que deseja excluir a frente ${frenteId}? Esta ação não pode ser desfeita.`,
                            () => {
                                // Remove front from data
                                const index = App.data.frentes.findIndex(f => f.frente === frenteId);
                                if (index !== -1) {
                                    App.data.frentes.splice(index, 1);
                                    
                                    // Remove equipment
                                    delete App.data.equipamentos[frenteId];
                                    
                                    // Remove from potential
                                    const potIndex = App.data.potencial.findIndex(p => p.frente === frenteId);
                                    if (potIndex !== -1) {
                                        App.data.potencial.splice(potIndex, 1);
                                    }
                                    
                                    // Add to history
                                    App.addHistoryEntry({
                                        tipo: 'delete',
                                        entidade: 'frente',
                                        titulo: `Frente ${frenteId} removida`,
                                        descricao: 'Frente removida do sistema',
                                        data: new Date().toISOString(),
                                        usuario: 'Administrador'
                                    });
                                    
                                    // Update UI
                                    this.initFrentesTable();
                                    this.initEquipamentosTables();
                                    this.initPotencialTable();
                                    this.updateRecentFrentes();
                                    
                                    // Save data
                                    App.data.lastUpdated = new Date().toISOString();
                                    App.saveData();
                                    
                                    this.showToast(`Frente ${frenteId} excluída com sucesso!`);
                                }
                            }
                        );
                    },
                    
                    // Show duplicate front form
                    showFrenteDuplicateForm: function() {
                        // Create modal
                        const modal = document.createElement('div');
                        modal.className = 'modal';
                        modal.style.display = 'flex';
                        
                        let frentesOptions = '';
                        App.data.frentes.forEach(frente => {
                            frentesOptions += `<option value="${frente.frente}">${frente.frente}</option>`;
                        });
                        
                        // Create modal content
                        modal.innerHTML = `
                            <div class="modal-content" style="max-width: 500px;">
                                <div class="modal-header">
                                    <h3>Duplicar Frente</h3>
                                    <button class="modal-close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <p>Selecione a frente a ser duplicada e informe o ID da nova frente.</p>
                                    <div class="form-row">
                                        <label for="frente-origem">Frente de Origem:</label>
                                        <select id="frente-origem">
                                            ${frentesOptions}
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="frente-destino">ID da Nova Frente:</label>
                                        <input type="text" id="frente-destino" placeholder="Ex: 4010" required>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary modal-close-btn">Cancelar</button>
                                    <button class="btn duplicate-btn">Duplicar</button>
                                </div>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // Add event listeners
                        modal.querySelector('.modal-close').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.modal-close-btn').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.duplicate-btn').addEventListener('click', () => {
                            const frenteOrigem = modal.querySelector('#frente-origem').value;
                            const frenteDestino = modal.querySelector('#frente-destino').value.trim();
                            
                            if (!frenteDestino) {
                                this.showToast('Por favor, informe o ID da nova frente', 'warning');
                                return;
                            }
                            
                            // Check if front already exists
                            if (App.data.frentes.some(f => f.frente === frenteDestino)) {
                                this.showToast('Já existe uma frente com este ID!', 'error');
                                return;
                            }
                            
                            const frenteOriginal = App.data.frentes.find(f => f.frente === frenteOrigem);
                            if (!frenteOriginal) {
                                this.showToast('Frente de origem não encontrada', 'error');
                                return;
                            }
                            
                            // Create new front based on original
                            const novaFrente = {
                                ...JSON.parse(JSON.stringify(frenteOriginal)),
                                frente: frenteDestino,
                                createdAt: new Date().toISOString()
                            };
                            
                            // Add front
                            App.data.frentes.push(novaFrente);
                            
                            // Duplicate equipment
                            if (App.data.equipamentos[frenteOrigem]) {
                                App.data.equipamentos[frenteDestino] = JSON.parse(JSON.stringify(App.data.equipamentos[frenteOrigem]));
                            }
                            
                            // Add to history
                            App.addHistoryEntry({
                                tipo: 'add',
                                entidade: 'frente',
                                titulo: `Frente ${frenteDestino} duplicada`,
                                descricao: `Nova frente duplicada a partir de ${frenteOrigem}`,
                                data: new Date().toISOString(),
                                usuario: 'Administrador'
                            });
                            
                            // Update UI
                            this.initFrentesTable();
                            this.initEquipamentosTables();
                            this.initPotencialTable();
                            this.updateRecentFrentes();
                            DataHandler.calculatePotencial();
                            
                            // Save data
                            App.data.lastUpdated = new Date().toISOString();
                            UI.updateTimestamps();
                            App.saveData();
                            
                            this.showToast(`Frente ${frenteDestino} duplicada com sucesso!`);
                            
                            document.body.removeChild(modal);
                        });
                        
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                document.body.removeChild(modal);
                            }
                        });
                    },
                    
                    // Show add equipment form
                    showAddEquipamentoForm: function() {
                        // Create modal
                        const modal = document.createElement('div');
                        modal.className = 'modal';
                        modal.style.display = 'flex';
                        
                        let frentesOptions = '';
                        App.data.frentes.forEach(frente => {
                            frentesOptions += `<option value="${frente.frente}">${frente.frente}</option>`;
                        });
                        
                        // Create modal content
                        modal.innerHTML = `
                            <div class="modal-content" style="max-width: 500px;">
                                <div class="modal-header">
                                    <h3>Adicionar Equipamento</h3>
                                    <button class="modal-close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <div class="form-row">
                                        <label for="equip-frente">Frente:</label>
                                        <select id="equip-frente" required>
                                            ${frentesOptions}
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="equip-nome">Nome do Equipamento:</label>
                                        <input type="text" id="equip-nome" placeholder="Ex: COLHEDORA 6" required>
                                    </div>
                                    <div class="form-row">
                                        <label for="equip-carreg">Tempo de Carregamento (min):</label>
                                        <input type="number" id="equip-carreg" min="0" step="0.1" value="5.0">
                                    </div>
                                    <div class="form-row">
                                        <label for="equip-aux">Tempo Auxiliar (min):</label>
                                        <input type="number" id="equip-aux" min="0" step="0.1" value="1.5">
                                    </div>
                                    <div class="form-row">
                                        <label for="equip-disponivel">Disponível:</label>
                                        <select id="equip-disponivel">
                                            <option value="1">Sim</option>
                                            <option value="0">Não</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary modal-close-btn">Cancelar</button>
                                    <button class="btn add-equip-btn">Adicionar</button>
                                </div>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // Add event listeners
                        modal.querySelector('.modal-close').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.modal-close-btn').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.add-equip-btn').addEventListener('click', () => {
                            const frente = modal.querySelector('#equip-frente').value;
                            const nome = modal.querySelector('#equip-nome').value.trim();
                            const carreg = parseFloat(modal.querySelector('#equip-carreg').value) || 0;
                            const aux = parseFloat(modal.querySelector('#equip-aux').value) || 0;
                            const disponivel = parseInt(modal.querySelector('#equip-disponivel').value) || 0;
                            
                            if (!nome) {
                                this.showToast('Por favor, informe o nome do equipamento', 'warning');
                                return;
                            }
                            
                            // Calculate production based on inputs
                            const densidade = document.getElementById(`${frente}-densidade`) ? 
                                parseFloat(document.getElementById(`${frente}-densidade`).value) || 12 : 12;
                                
                            const producao = carreg > 0 ? (60 / carreg) * densidade : 0;
                            
                            // Check if equipment already exists
                            if (!App.data.equipamentos[frente]) {
                                App.data.equipamentos[frente] = [];
                            }
                            
                            if (App.data.equipamentos[frente].some(e => e.equipo === nome)) {
                                this.showToast('Já existe um equipamento com este nome nesta frente!', 'error');
                                return;
                            }
                            
                            // Add equipment
                            App.data.equipamentos[frente].push({
                                equipo: nome,
                                carreg: carreg,
                                aux: aux,
                                disponivel: disponivel,
                                producao: producao
                            });
                            
                            // Add to history
                            App.addHistoryEntry({
                                tipo: 'add',
                                entidade: 'equipamento',
                                titulo: `Equipamento ${nome} adicionado`,
                                descricao: `Novo equipamento adicionado à frente ${frente}`,
                                data: new Date().toISOString(),
                                usuario: 'Administrador'
                            });
                            
                            // Update UI
                            this.initEquipamentosTables();
                            DataHandler.calculatePotencial();
                            
                            // Save data
                            App.data.lastUpdated = new Date().toISOString();
                            UI.updateTimestamps();
                            App.saveData();
                            
                            this.showToast(`Equipamento ${nome} adicionado com sucesso!`);
                            
                            document.body.removeChild(modal);
                        });
                        
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                document.body.removeChild(modal);
                            }
                        });
                    },
                    
                    // Show add maintenance form
                    showAddManutencaoForm: function() {
                        // Create modal
                        const modal = document.createElement('div');
                        modal.className = 'modal';
                        modal.style.display = 'flex';
                        
                        let frentesOptions = '';
                        App.data.frentes.forEach(frente => {
                            frentesOptions += `<option value="${frente.frente}">${frente.frente}</option>`;
                        });
                        
                        // Create modal content
                        modal.innerHTML = `
                            <div class="modal-content" style="max-width: 500px;">
                                <div class="modal-header">
                                    <h3>Adicionar Manutenção</h3>
                                    <button class="modal-close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <div class="form-row">
                                        <label for="manut-frente">Frente:</label>
                                        <select id="manut-frente" required>
                                            ${frentesOptions}
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-equipo">Equipamento:</label>
                                        <select id="manut-equipo" required>
                                            <option value="">Selecione uma frente primeiro</option>
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-tipo">Tipo:</label>
                                        <select id="manut-tipo" required>
                                            <option value="Preventiva">Preventiva</option>
                                            <option value="Corretiva">Corretiva</option>
                                            <option value="Preditiva">Preditiva</option>
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-data">Data Programada:</label>
                                        <input type="date" id="manut-data" required>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-duracao">Duração Prevista:</label>
                                        <input type="text" id="manut-duracao" placeholder="Ex: 4 horas" required>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-status">Status:</label>
                                        <select id="manut-status" required>
                                            <option value="Pendente">Pendente</option>
                                            <option value="Em andamento">Em andamento</option>
                                            <option value="Concluída">Concluída</option>
                                            <option value="Cancelada">Cancelada</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary modal-close-btn">Cancelar</button>
                                    <button class="btn add-manut-btn">Adicionar</button>
                                </div>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // Add event listeners
                        modal.querySelector('.modal-close').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.modal-close-btn').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        // Update equipment select when front changes
                        modal.querySelector('#manut-frente').addEventListener('change', function() {
                            const frente = this.value;
                            const equipoSelect = modal.querySelector('#manut-equipo');
                            equipoSelect.innerHTML = '';
                            
                            if (frente && App.data.equipamentos[frente]) {
                                App.data.equipamentos[frente].forEach(equip => {
                                    const option = document.createElement('option');
                                    option.value = equip.equipo;
                                    option.textContent = equip.equipo;
                                    equipoSelect.appendChild(option);
                                });
                            } else {
                                equipoSelect.innerHTML = '<option value="">Nenhum equipamento disponível</option>';
                            }
                        });
                        
                        // Set default date to today
                        const today = new Date().toISOString().split('T')[0];
                        modal.querySelector('#manut-data').value = today;
                        
                        // Trigger change to populate equipment select
                        if (modal.querySelector('#manut-frente').value) {
                            modal.querySelector('#manut-frente').dispatchEvent(new Event('change'));
                        }
                        
                        modal.querySelector('.add-manut-btn').addEventListener('click', () => {
                            const frente = modal.querySelector('#manut-frente').value;
                            const equipo = modal.querySelector('#manut-equipo').value;
                            const tipo = modal.querySelector('#manut-tipo').value;
                            const data = modal.querySelector('#manut-data').value;
                            const duracao = modal.querySelector('#manut-duracao').value;
                            const status = modal.querySelector('#manut-status').value;
                            
                            if (!frente || !equipo || !tipo || !data || !duracao) {
                                this.showToast('Por favor, preencha todos os campos obrigatórios', 'warning');
                                return;
                            }
                            
                            // Create new maintenance
                            const id = App.data.manutencoes.length > 0 ? 
                                Math.max(...App.data.manutencoes.map(m => m.id)) + 1 : 1;
                            
                            App.data.manutencoes.push({
                                id,
                                frente,
                                equipo,
                                tipo,
                                dataProgramada: data,
                                duracao,
                                status
                            });
                            
                            // Add to history
                            App.addHistoryEntry({
                                tipo: 'add',
                                entidade: 'manutencao',
                                titulo: `Manutenção para ${equipo} adicionada`,
                                descricao: `Nova manutenção ${tipo} programada para ${new Date(data).toLocaleDateString('pt-BR')}`,
                                data: new Date().toISOString(),
                                usuario: 'Administrador'
                            });
                            
                            // Update UI
                            this.updateManutencoesTable();
                            
                            // Save data
                            App.data.lastUpdated = new Date().toISOString();
                            UI.updateTimestamps();
                            App.saveData();
                            
                            this.showToast(`Manutenção para ${equipo} adicionada com sucesso!`);
                            
                            document.body.removeChild(modal);
                        });
                        
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                document.body.removeChild(modal);
                            }
                        });
                    },
                    
                    // Update maintenance table
                    updateManutencoesTable: function() {
                        const table = document.getElementById('manutencoes-table');
                        if (!table) return;
                        
                        const tbody = table.querySelector('tbody');
                        tbody.innerHTML = '';
                        
                        if (App.data.manutencoes.length === 0) {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td colspan="7" class="empty-state">
                                    <i class="fas fa-info-circle"></i>
                                    <p>Nenhuma manutenção programada.</p>
                                </td>
                            `;
                            tbody.appendChild(row);
                            return;
                        }
                        
                        App.data.manutencoes.forEach(manut => {
                            const row = document.createElement('tr');
                            
                            // Determine badge class based on status
                            let badgeClass = '';
                            switch (manut.status) {
                                case 'Pendente':
                                    badgeClass = 'badge-warning';
                                    break;
                                case 'Em andamento':
                                    badgeClass = 'badge-info';
                                    break;
                                case 'Concluída':
                                    badgeClass = 'badge-success';
                                    break;
                                case 'Cancelada':
                                    badgeClass = 'badge-danger';
                                    break;
                                default:
                                    badgeClass = 'badge-primary';
                            }
                            
                            const dataFormatada = new Date(manut.dataProgramada).toLocaleDateString('pt-BR');
                            
                            row.innerHTML = `
                                <td>${manut.equipo}</td>
                                <td>${manut.frente}</td>
                                <td>${manut.tipo}</td>
                                <td>${dataFormatada}</td>
                                <td>${manut.duracao}</td>
                                <td><span class="badge ${badgeClass}">${manut.status}</span></td>
                                <td>
                                    <button class="btn btn-sm btn-edit-manut" data-id="${manut.id}" aria-label="Editar manutenção">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-delete-manut" data-id="${manut.id}" aria-label="Excluir manutenção">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            `;
                            
                            // Add event handlers for buttons
                            row.querySelector('.btn-edit-manut').addEventListener('click', function() {
                                const id = parseInt(this.dataset.id);
                                UI.editManutencao(id);
                            });
                            
                            row.querySelector('.btn-delete-manut').addEventListener('click', function() {
                                const id = parseInt(this.dataset.id);
                                UI.deleteManutencao(id);
                            });
                            
                            tbody.appendChild(row);
                        });
                    },
                    
                    // Edit maintenance
                    editManutencao: function(id) {
                        const manutencao = App.data.manutencoes.find(m => m.id === id);
                        if (!manutencao) {
                            this.showToast('Manutenção não encontrada', 'error');
                            return;
                        }
                        
                        // Create modal
                        const modal = document.createElement('div');
                        modal.className = 'modal';
                        modal.style.display = 'flex';
                        
                        let frentesOptions = '';
                        App.data.frentes.forEach(frente => {
                            frentesOptions += `<option value="${frente.frente}" ${frente.frente === manutencao.frente ? 'selected' : ''}>${frente.frente}</option>`;
                        });
                        
                        // Get equipment options
                        let equipOptions = '';
                        if (App.data.equipamentos[manutencao.frente]) {
                            App.data.equipamentos[manutencao.frente].forEach(equip => {
                                equipOptions += `<option value="${equip.equipo}" ${equip.equipo === manutencao.equipo ? 'selected' : ''}>${equip.equipo}</option>`;
                            });
                        }
                        
                        // Create modal content
                        modal.innerHTML = `
                            <div class="modal-content" style="max-width: 500px;">
                                <div class="modal-header">
                                    <h3>Editar Manutenção</h3>
                                    <button class="modal-close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <div class="form-row">
                                        <label for="manut-frente">Frente:</label>
                                        <select id="manut-frente" required>
                                            ${frentesOptions}
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-equipo">Equipamento:</label>
                                        <select id="manut-equipo" required>
                                            ${equipOptions || '<option value="">Selecione uma frente primeiro</option>'}
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-tipo">Tipo:</label>
                                        <select id="manut-tipo" required>
                                            <option value="Preventiva" ${manutencao.tipo === 'Preventiva' ? 'selected' : ''}>Preventiva</option>
                                            <option value="Corretiva" ${manutencao.tipo === 'Corretiva' ? 'selected' : ''}>Corretiva</option>
                                            <option value="Preditiva" ${manutencao.tipo === 'Preditiva' ? 'selected' : ''}>Preditiva</option>
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-data">Data Programada:</label>
                                        <input type="date" id="manut-data" value="${manutencao.dataProgramada}" required>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-duracao">Duração Prevista:</label>
                                        <input type="text" id="manut-duracao" value="${manutencao.duracao}" required>
                                    </div>
                                    <div class="form-row">
                                        <label for="manut-status">Status:</label>
                                        <select id="manut-status" required>
                                            <option value="Pendente" ${manutencao.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                            <option value="Em andamento" ${manutencao.status === 'Em andamento' ? 'selected' : ''}>Em andamento</option>
                                            <option value="Concluída" ${manutencao.status === 'Concluída' ? 'selected' : ''}>Concluída</option>
                                            <option value="Cancelada" ${manutencao.status === 'Cancelada' ? 'selected' : ''}>Cancelada</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary modal-close-btn">Cancelar</button>
                                    <button class="btn update-manut-btn" data-id="${id}">Atualizar</button>
                                </div>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // Add event listeners
                        modal.querySelector('.modal-close').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.modal-close-btn').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        // Update equipment select when front changes
                        modal.querySelector('#manut-frente').addEventListener('change', function() {
                            const frente = this.value;
                            const equipoSelect = modal.querySelector('#manut-equipo');
                            equipoSelect.innerHTML = '';
                            
                            if (frente && App.data.equipamentos[frente]) {
                                App.data.equipamentos[frente].forEach(equip => {
                                    const option = document.createElement('option');
                                    option.value = equip.equipo;
                                    option.textContent = equip.equipo;
                                    equipoSelect.appendChild(option);
                                });
                            } else {
                                equipoSelect.innerHTML = '<option value="">Nenhum equipamento disponível</option>';
                            }
                        });
                        
                        modal.querySelector('.update-manut-btn').addEventListener('click', () => {
                            const frente = modal.querySelector('#manut-frente').value;
                            const equipo = modal.querySelector('#manut-equipo').value;
                            const tipo = modal.querySelector('#manut-tipo').value;
                            const data = modal.querySelector('#manut-data').value;
                            const duracao = modal.querySelector('#manut-duracao').value;
                            const status = modal.querySelector('#manut-status').value;
                            
                            if (!frente || !equipo || !tipo || !data || !duracao) {
                                this.showToast('Por favor, preencha todos os campos obrigatórios', 'warning');
                                return;
                            }
                            
                            // Update maintenance
                            const index = App.data.manutencoes.findIndex(m => m.id === id);
                            if (index !== -1) {
                                App.data.manutencoes[index] = {
                                    id,
                                    frente,
                                    equipo,
                                    tipo,
                                    dataProgramada: data,
                                    duracao,
                                    status
                                };
                                
                                // Add to history
                                App.addHistoryEntry({
                                    tipo: 'edit',
                                    entidade: 'manutencao',
                                    titulo: `Manutenção para ${equipo} atualizada`,
                                    descricao: `Manutenção ${tipo} atualizada com status: ${status}`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                                
                                // Update UI
                                this.updateManutencoesTable();
                                
                                // Save data
                                App.data.lastUpdated = new Date().toISOString();
                                UI.updateTimestamps();
                                App.saveData();
                                
                                this.showToast(`Manutenção para ${equipo} atualizada com sucesso!`);
                            }
                            
                            document.body.removeChild(modal);
                        });
                        
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                document.body.removeChild(modal);
                            }
                        });
                    },
                    
                    // Delete maintenance
                    deleteManutencao: function(id) {
                        const manutencao = App.data.manutencoes.find(m => m.id === id);
                        if (!manutencao) {
                            this.showToast('Manutenção não encontrada', 'error');
                            return;
                        }
                        
                        App.showConfirmDialog(
                            'Confirmar Exclusão',
                            `Tem certeza que deseja excluir a manutenção para ${manutencao.equipo}?`,
                            () => {
                                // Remove maintenance
                                const index = App.data.manutencoes.findIndex(m => m.id === id);
                                if (index !== -1) {
                                    App.data.manutencoes.splice(index, 1);
                                    
                                    // Add to history
                                    App.addHistoryEntry({
                                        tipo: 'delete',
                                        entidade: 'manutencao',
                                        titulo: `Manutenção para ${manutencao.equipo} excluída`,
                                        descricao: `Manutenção ${manutencao.tipo} excluída do sistema`,
                                        data: new Date().toISOString(),
                                        usuario: 'Administrador'
                                    });
                                    
                                    // Update UI
                                    this.updateManutencoesTable();
                                    
                                    // Save data
                                    App.data.lastUpdated = new Date().toISOString();
                                    UI.updateTimestamps();
                                    App.saveData();
                                    
                                    this.showToast(`Manutenção excluída com sucesso!`);
                                }
                            }
                        );
                    },
                    
                    // Generate report
                    generateReport: function() {
                        const type = document.getElementById('report-type').value;
                        const frente = document.getElementById('report-frente').value;
                        const format = document.getElementById('report-format').value;
                        const includeCharts = document.getElementById('report-include-charts').checked;
                        const includeSummary = document.getElementById('report-include-summary').checked;
                        const includeComparison = document.getElementById('report-include-comparison').checked;
                        const includeInsights = document.getElementById('report-include-insights').checked;
                        
                        UI.showLoading('Gerando relatório...');
                        
                        setTimeout(() => {
                            // Generate report content based on filters
                            let reportHTML = `
                                <div class="print-header">
                                    <h1>Relatório de ${this.getReportTitle(type)}</h1>
                                    <p>Usina Cambuí Açúcar & Álcool</p>
                                    <p>Gerado em: ${new Date().toLocaleString('pt-BR')}</p>
                                </div>
                            `;
                            
                            // Add summary if requested
                            if (includeSummary) {
                                reportHTML += `
                                    <div class="section">
                                        <h3>Resumo Executivo</h3>
                                        <p>Este relatório apresenta uma análise dos dados de ${this.getReportTitle(type).toLowerCase()} para a safra 2025.</p>
                                        ${frente ? `<p>Filtrado por frente: ${frente}</p>` : ''}
                                        <p>Total de frentes: ${App.data.frentes.length}</p>
                                        <p>Cota total: ${App.data.frentes.reduce((sum, f) => sum + f.cota, 0).toLocaleString('pt-BR')} toneladas</p>
                                        <p>Potencial de colheita: ${App.data.potencial.reduce((sum, p) => sum + p.capFrente, 0).toFixed(2)} t/h</p>
                                    </div>
                                `;
                            }
                            
                            // Add main report content based on type
                            reportHTML += this.generateReportContent(type, frente);
                            
                            // Add charts if requested
                            if (includeCharts) {
                                reportHTML += `
                                    <div class="section">
                                        <h3>Gráficos</h3>
                                        <div class="chart-container" style="height: 400px;">
                                            <canvas id="report-chart"></canvas>
                                        </div>
                                    </div>
                                `;
                            }
                            
                            // Add insights if requested
                            if (includeInsights) {
                                reportHTML += `
                                    <div class="section">
                                        <h3>Análise de Insights</h3>
                                        <div class="insight-card">
                                            <div class="insight-icon">
                                                <i class="fas fa-lightbulb"></i>
                                            </div>
                                            <div class="insight-content">
                                                <div class="insight-title">Fator Limitante do Sistema</div>
                                                <p>${document.getElementById('limitante-sistema').value === 'TRANSPORTE' ?
                                                    'O sistema está limitado por transporte. Recomenda-se avaliar a disponibilidade de caminhões e melhorar a logística.' :
                                                    'O sistema está limitado por colheita. Considere ajustar a estratégia de corte ou avaliar a disponibilidade de máquinas.'}</p>
                                            </div>
                                        </div>
                                        <div class="insight-card" style="margin-top: 1rem;">
                                            <div class="insight-icon">
                                                <i class="fas fa-chart-line"></i>
                                            </div>
                                            <div class="insight-content">
                                                <div class="insight-title">Tendência de Produção</div>
                                                <p>Com base nos dados históricos, a produção está com tendência de aumento gradual em relação aos períodos anteriores.</p>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }
                            
                            // Add comparison if requested
                            if (includeComparison) {
                                reportHTML += `
                                    <div class="section">
                                        <h3>Comparação com Período Anterior</h3>
                                        <div class="table-container">
                                            <table class="data-table">
                                                <thead>
                                                    <tr>
                                                        <th>Indicador</th>
                                                        <th>Período Atual</th>
                                                        <th>Período Anterior</th>
                                                        <th>Variação</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Potencial de Colheita (t/h)</td>
                                                        <td>450</td>
                                                        <td>410</td>
                                                        <td><span style="color: var(--success-color);">+9.8%</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Potencial de Transporte (t/h)</td>
                                                        <td>395</td>
                                                        <td>360</td>
                                                        <td><span style="color: var(--success-color);">+9.7%</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Capacidade Utilizada (%)</td>
                                                        <td>87.7%</td>
                                                        <td>86.1%</td>
                                                        <td><span style="color: var(--success-color);">+1.6%</span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                `;
                            }
                            
                            // Add print footer
                            reportHTML += `
                                <div class="print-footer">
                                    <p>Sistema de Gestão de Colheita - Usina Cambuí Açúcar & Álcool © 2025</p>
                                    <p>Relatório gerado em ${new Date().toLocaleString('pt-BR')}</p>
                                </div>
                            `;
                            
                            // Show in preview
                            document.getElementById('report-preview').innerHTML = reportHTML;
                            
                            // Initialize chart if included
                            if (includeCharts) {
                                this.initReportChart(type, frente);
                            }
                            
                            // Hide loading
                            UI.hideLoading();
                            
                            // Show success message
                            this.showToast('Relatório gerado com sucesso!');
                            
                            // If format is not HTML, prompt to download
                            if (format !== 'html') {
                                setTimeout(() => {
                                    this.showToast(`Para exportar para ${format.toUpperCase()}, utilize a funcionalidade de impressão do navegador e selecione o formato desejado.`, 'info');
                                }, 1000);
                            }
                        }, 1000);
                    },
                    
                    // Get report title
                    getReportTitle: function(type) {
                        switch (type) {
                            case 'potencial':
                                return 'Potencial de Colheita';
                            case 'frentes':
                                return 'Dados das Frentes';
                            case 'equipamentos':
                                return 'Dados dos Equipamentos';
                            case 'transporte':
                                return 'Análise de Transporte';
                            case 'completo':
                                return 'Completo';
                            default:
                                return 'Dados';
                        }
                    },
                    
                    // Generate report content
                    generateReportContent: function(type, frente) {
                        let content = '';
                        
                        switch (type) {
                            case 'potencial':
                                content = `
                                    <div class="section">
                                        <h3>Potencial de Colheita</h3>
                                        <div class="table-container">
                                            <table class="data-table">
                                                <thead>
                                                    <tr>
                                                        <th>FRENTE</th>
                                                        <th>COTA (t/h)</th>
                                                        <th>POTENCIAL (t/h)</th>
                                                        <th>ESTRATÉGIA</th>
                                                        <th>FROTA</th>
                                                        <th>STATUS</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${App.data.potencial
                                                        .filter(p => !frente || p.frente === frente)
                                                        .map(p => {
                                                            const capacidadePercentual = p.cota > 0 ? (p.capFrente / p.cota) * 100 : 0;
                                                            const status = capacidadePercentual >= 100 ? 'ÓTIMO' :
                                                                capacidadePercentual >= 90 ? 'BOM' :
                                                                capacidadePercentual >= 75 ? 'REGULAR' : 'INSUFICIENTE';
                                                            const statusClass = capacidadePercentual >= 100 ? 'badge-success' :
                                                                capacidadePercentual >= 90 ? 'badge-info' :
                                                                capacidadePercentual >= 75 ? 'badge-warning' : 'badge-danger';
                                                                
                                                            return `
                                                                <tr>
                                                                    <td>${p.frente}</td>
                                                                    <td>${p.cota.toFixed(2)}</td>
                                                                    <td>${p.capFrente.toFixed(2)}</td>
                                                                    <td>${p.estrategia.toFixed(2)}</td>
                                                                    <td>${p.frota.toFixed(2)}</td>
                                                                    <td><span class="badge ${statusClass}">${status}</span></td>
                                                                </tr>
                                                            `;
                                                        }).join('')
                                                    }
                                                </tbody>
                                                <tfoot>
                                                    <tr class="summary-row">
                                                        <td>TOTAL</td>
                                                        <td>${App.data.potencial
                                                            .filter(p => !frente || p.frente === frente)
                                                            .reduce((sum, p) => sum + p.cota, 0).toFixed(2)}</td>
                                                        <td>${App.data.potencial
                                                            .filter(p => !frente || p.frente === frente)
                                                            .reduce((sum, p) => sum + p.capFrente, 0).toFixed(2)}</td>
                                                        <td>${App.data.potencial
                                                            .filter(p => !frente || p.frente === frente)
                                                            .reduce((sum, p) => sum + p.estrategia, 0).toFixed(2)}</td>
                                                        <td>${App.data.potencial
                                                            .filter(p => !frente || p.frente === frente)
                                                            .reduce((sum, p) => sum + p.frota, 0).toFixed(2)}</td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                `;
                                break;
                                
                            case 'frentes':
                                content = `
                                    <div class="section">
                                        <h3>Dados das Frentes</h3>
                                        <div class="table-container">
                                            <table class="data-table">
                                                <thead>
                                                    <tr>
                                                        <th>FRENTE</th>
                                                        <th>COTA</th>
                                                        <th>DIST (KM)</th>
                                                        <th>TEMPO TOTAL (min)</th>
                                                        <th>PESO (t)</th>
                                                        <th>TRANSPORTE</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${App.data.frentes
                                                        .filter(f => !frente || f.frente === frente)
                                                        .map(f => {
                                                            const totalTempo = (parseFloat(f.ida) || 0) + (parseFloat(f.campo) || 0) + 
                                                                (parseFloat(f.volta) || 0) + (parseFloat(f.usina) || 0);
                                                                
                                                            return `
                                                                <tr>
                                                                    <td>${f.frente}</td>
                                                                    <td>${f.cota.toLocaleString('pt-BR')}</td>
                                                                    <td>${f.dist}</td>
                                                                    <td>${totalTempo.toFixed(2)}</td>
                                                                    <td>${f.peso}</td>
                                                                    <td>${f.transporte === 'P' ? 'Próprio' : 'Terceiro'}</td>
                                                                </tr>
                                                            `;
                                                        }).join('')
                                                    }
                                                </tbody>
                                                <tfoot>
                                                    <tr class="summary-row">
                                                        <td>TOTAL</td>
                                                        <td>${App.data.frentes
                                                            .filter(f => !frente || f.frente === frente)
                                                            .reduce((sum, f) => sum + f.cota, 0).toLocaleString('pt-BR')}</td>
                                                        <td>${(App.data.frentes
                                                            .filter(f => !frente || f.frente === frente)
                                                            .reduce((sum, f) => sum + parseFloat(f.dist), 0) / 
                                                            Math.max(1, App.data.frentes.filter(f => !frente || f.frente === frente).length)).toFixed(2)}</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                `;
                                break;
                                
                            case 'equipamentos':
                                content = `
                                    <div class="section">
                                        <h3>Dados dos Equipamentos</h3>
                                        ${!frente ? App.data.frentes.map(f => {
                                            const equipamentos = App.data.equipamentos[f.frente];
                                            if (!equipamentos || equipamentos.length === 0) return '';
                                            
                                            return `
                                                <div style="margin-top: 1.5rem;">
                                                    <h4>Frente ${f.frente}</h4>
                                                    <div class="table-container">
                                                        <table class="data-table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Equipamento</th>
                                                                    <th>T. Carregamento</th>
                                                                    <th>T. Auxiliar</th>
                                                                    <th>Produção</th>
                                                                    <th>Disponível</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                ${equipamentos.map(e => `
                                                                    <tr>
                                                                        <td>${e.equipo}</td>
                                                                        <td>${e.carreg} min</td>
                                                                        <td>${e.aux} min</td>
                                                                        <td>${e.producao.toFixed(2)} t/h</td>
                                                                        <td>${e.disponivel === 1 ? '<span class="badge badge-success">Sim</span>' : '<span class="badge badge-danger">Não</span>'}</td>
                                                                    </tr>
                                                                `).join('')}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            `;
                                        }).join('') : (() => {
                                            const equipamentos = App.data.equipamentos[frente];
                                            if (!equipamentos || equipamentos.length === 0) return '';
                                            
                                            return `
                                                <div class="table-container">
                                                    <table class="data-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Equipamento</th>
                                                                <th>T. Carregamento</th>
                                                                <th>T. Auxiliar</th>
                                                                <th>Produção</th>
                                                                <th>Disponível</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${equipamentos.map(e => `
                                                                <tr>
                                                                    <td>${e.equipo}</td>
                                                                    <td>${e.carreg} min</td>
                                                                    <td>${e.aux} min</td>
                                                                    <td>${e.producao.toFixed(2)} t/h</td>
                                                                    <td>${e.disponivel === 1 ? '<span class="badge badge-success">Sim</span>' : '<span class="badge badge-danger">Não</span>'}</td>
                                                                </tr>
                                                            `).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            `;
                                        })()}
                                    </div>
                                `;
                                break;
                                
                            case 'transporte':
                                content = `
                                    <div class="section">
                                        <h3>Análise de Transporte</h3>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.25rem; margin-bottom: 1.5rem;">
                                            <div class="data-card">
                                                <h4>CAMINHÕES PRÓPRIOS</h4>
                                                <div class="form-row">
                                                    <label>Total:</label>
                                                    <strong>${App.data.transportes.propriosTotal}</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Parados:</label>
                                                    <strong>${App.data.transportes.propriosParados}</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Disponíveis:</label>
                                                    <strong>${App.data.transportes.propriosTotal - App.data.transportes.propriosParados}</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Necessários:</label>
                                                    <strong>${document.getElementById('proprios-necessarios').value}</strong>
                                                </div>
                                            </div>
                                            
                                            <div class="data-card">
                                                <h4>CAMINHÕES TERCEIROS</h4>
                                                <div class="form-row">
                                                    <label>Total:</label>
                                                    <strong>${App.data.transportes.terceirosTotal}</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Parados:</label>
                                                    <strong>${App.data.transportes.terceirosParados}</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Disponíveis:</label>
                                                    <strong>${App.data.transportes.terceirosTotal - App.data.transportes.terceirosParados}</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Necessários:</label>
                                                    <strong>${document.getElementById('terceiros-necessarios').value}</strong>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="data-card">
                                            <h4>Resultados do Sistema</h4>
                                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                                                <div class="form-row">
                                                    <label>Potencial de Colheita:</label>
                                                    <strong>${document.getElementById('potencial-colheita').value} t/h</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Potencial de Transporte:</label>
                                                    <strong>${document.getElementById('potencial-transporte').value} t/h</strong>
                                                </div>
                                                <div class="form-row">
                                                    <label>Fator Limitante:</label>
                                                    <strong>${document.getElementById('limitante-sistema').value}</strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                break;
                                
                            case 'completo':
                                // Combine all report types
                                content = this.generateReportContent('potencial', frente) +
                                          this.generateReportContent('frentes', frente) + 
                                          this.generateReportContent('equipamentos', frente) +
                                          this.generateReportContent('transporte', frente);
                                break;
                                
                            default:
                                content = '<p>Nenhum conteúdo disponível para este tipo de relatório.</p>';
                        }
                        
                        return content;
                    },
                    
                    // Initialize report chart
                    initReportChart: function(type, frente) {
                        const canvas = document.getElementById('report-chart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.reportChart) {
                            App.charts.reportChart.destroy();
                        }
                        
                        // Prepare chart data based on report type
                        let chartData = {
                            labels: [],
                            datasets: []
                        };
                        
                        let chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Análise de Dados',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'top'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        };
                        
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        chartOptions.scales.y.grid = { color: gridColor };
                        chartOptions.scales.x = { grid: { color: gridColor } };
                        chartOptions.plugins.title.color = textColor;
                        chartOptions.plugins.legend.labels = { color: textColor };
                        
                        switch (type) {
                            case 'potencial':
                                chartData.labels = App.data.frentes
                                    .filter(f => !frente || f.frente === frente)
                                    .map(f => `Frente ${f.frente}`);
                                    
                                chartData.datasets = [
                                    {
                                        label: 'Cota (t/h)',
                                        data: App.data.potencial
                                            .filter(p => !frente || p.frente === frente)
                                            .map(p => p.cota),
                                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                        borderColor: 'rgb(59, 130, 246)',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Potencial (t/h)',
                                        data: App.data.potencial
                                            .filter(p => !frente || p.frente === frente)
                                            .map(p => p.capFrente),
                                        backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                        borderColor: 'rgb(16, 185, 129)',
                                        borderWidth: 1
                                    }
                                ];
                                
                                chartOptions.plugins.title.text = 'Análise de Potencial por Frente';
                                
                                App.charts.reportChart = new Chart(canvas, {
                                    type: 'bar',
                                    data: chartData,
                                    options: chartOptions
                                });
                                break;
                                
                            case 'frentes':
                                chartData.labels = App.data.frentes
                                    .filter(f => !frente || f.frente === frente)
                                    .map(f => `Frente ${f.frente}`);
                                    
                                chartData.datasets = [
                                    {
                                        label: 'Distância (km)',
                                        data: App.data.frentes
                                            .filter(f => !frente || f.frente === frente)
                                            .map(f => f.dist),
                                        backgroundColor: 'rgba(245, 158, 11, 0.5)',
                                        borderColor: 'rgb(245, 158, 11)',
                                        borderWidth: 1,
                                        yAxisID: 'yDistance'
                                    },
                                    {
                                        label: 'Tempo Ciclo (min)',
                                        data: App.data.frentes
                                            .filter(f => !frente || f.frente === frente)
                                            .map(f => {
                                                return (parseFloat(f.ida) || 0) + (parseFloat(f.campo) || 0) + 
                                                       (parseFloat(f.volta) || 0) + (parseFloat(f.usina) || 0);
                                            }),
                                        backgroundColor: 'rgba(139, 92, 246, 0.5)',
                                        borderColor: 'rgb(139, 92, 246)',
                                        borderWidth: 1,
                                        yAxisID: 'yTime'
                                    }
                                ];
                                
                                chartOptions.plugins.title.text = 'Análise de Distância e Tempo por Frente';
                                chartOptions.scales.yDistance = {
                                    type: 'linear',
                                    position: 'left',
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Distância (km)',
                                        color: textColor
                                    },
                                    grid: { color: gridColor }
                                };
                                chartOptions.scales.yTime = {
                                    type: 'linear',
                                    position: 'right',
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Tempo (min)',
                                        color: textColor
                                    },
                                    grid: {
                                        drawOnChartArea: false,
                                        color: gridColor
                                    }
                                };
                                
                                App.charts.reportChart = new Chart(canvas, {
                                    type: 'bar',
                                    data: chartData,
                                    options: chartOptions
                                });
                                break;
                                
                            case 'equipamentos':
                                if (frente) {
                                    // Chart for a specific front
                                    const equipamentos = App.data.equipamentos[frente];
                                    if (equipamentos && equipamentos.length > 0) {
                                        chartData.labels = equipamentos.map(e => e.equipo);
                                        chartData.datasets = [
                                            {
                                                label: 'Produção (t/h)',
                                                data: equipamentos.map(e => e.producao),
                                                backgroundColor: 'rgba(14, 165, 233, 0.5)',
                                                borderColor: 'rgb(14, 165, 233)',
                                                borderWidth: 1
                                            }
                                        ];
                                        
                                        chartOptions.plugins.title.text = `Produção dos Equipamentos da Frente ${frente}`;
                                        
                                        App.charts.reportChart = new Chart(canvas, {
                                            type: 'bar',
                                            data: chartData,
                                            options: chartOptions
                                        });
                                    }
                                } else {
                                    // Chart for all fronts
                                    chartData.labels = App.data.frentes.map(f => `Frente ${f.frente}`);
                                    
                                    const disponiveisPorFrente = App.data.frentes.map(f => {
                                        const equipamentos = App.data.equipamentos[f.frente];
                                        if (!equipamentos) return 0;
                                        return equipamentos.filter(e => e.disponivel === 1).length;
                                    });
                                    
                                    const indisponiveisPorFrente = App.data.frentes.map(f => {
                                        const equipamentos = App.data.equipamentos[f.frente];
                                        if (!equipamentos) return 0;
                                        return equipamentos.filter(e => e.disponivel === 0).length;
                                    });
                                    
                                    chartData.datasets = [
                                        {
                                            label: 'Equipamentos Disponíveis',
                                            data: disponiveisPorFrente,
                                            backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                            borderColor: 'rgb(16, 185, 129)',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'Equipamentos Indisponíveis',
                                            data: indisponiveisPorFrente,
                                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                                            borderColor: 'rgb(239, 68, 68)',
                                            borderWidth: 1
                                        }
                                    ];
                                    
                                    chartOptions.plugins.title.text = 'Disponibilidade de Equipamentos por Frente';
                                    
                                    App.charts.reportChart = new Chart(canvas, {
                                        type: 'bar',
                                        data: chartData,
                                        options: chartOptions
                                    });
                                }
                                break;
                                
                            case 'transporte':
                                // Transport comparison chart
                                chartData.labels = ['Caminhões Próprios', 'Caminhões Terceiros'];
                                chartData.datasets = [
                                    {
                                        label: 'Disponíveis',
                                        data: [
                                            App.data.transportes.propriosTotal - App.data.transportes.propriosParados,
                                            App.data.transportes.terceirosTotal - App.data.transportes.terceirosParados
                                        ],
                                        backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                        borderColor: 'rgb(16, 185, 129)',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Parados',
                                        data: [
                                            App.data.transportes.propriosParados,
                                            App.data.transportes.terceirosParados
                                        ],
                                        backgroundColor: 'rgba(239, 68, 68, 0.5)',
                                        borderColor: 'rgb(239, 68, 68)',
                                        borderWidth: 1
                                    }
                                ];
                                
                                chartOptions.plugins.title.text = 'Disponibilidade de Transporte';
                                
                                App.charts.reportChart = new Chart(canvas, {
                                    type: 'bar',
                                    data: chartData,
                                    options: chartOptions
                                });
                                break;
                                
                            case 'completo':
                                // Radar chart with multiple metrics
                                const frontsData = App.data.frentes
                                    .filter(f => !frente || f.frente === frente);
                                    
                                chartData.labels = frontsData.map(f => `Frente ${f.frente}`);
                                
                                // Get potencial data
                                const potencialData = App.data.potencial
                                    .filter(p => !frente || p.frente === frente);
                                    
                                // Calculate efficiency per front
                                const efficiency = potencialData.map(p => {
                                    return p.cota > 0 ? Math.min(100, (p.capFrente / p.cota) * 100) : 0;
                                });
                                
                                // Distances normalized to 0-100 scale
                                const maxDist = Math.max(...frontsData.map(f => parseFloat(f.dist) || 0));
                                const distances = frontsData.map(f => {
                                    return maxDist > 0 ? ((parseFloat(f.dist) || 0) / maxDist) * 100 : 0;
                                });
                                
                                chartData.datasets = [
                                    {
                                        label: 'Eficiência (%)',
                                        data: efficiency,
                                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                        borderColor: 'rgb(16, 185, 129)',
                                        borderWidth: 2,
                                        pointRadius: 4,
                                        pointBackgroundColor: 'rgb(16, 185, 129)'
                                    },
                                    {
                                        label: 'Distância (normalizada)',
                                        data: distances,
                                        backgroundColor: 'rgba(245, 158, 11, 0.2)',
                                        borderColor: 'rgb(245, 158, 11)',
                                        borderWidth: 2,
                                        pointRadius: 4,
                                        pointBackgroundColor: 'rgb(245, 158, 11)'
                                    }
                                ];
                                
                                chartOptions.plugins.title.text = 'Análise Comparativa de Frentes';
                                chartOptions.scales = {
                                    r: {
                                        angleLines: {
                                            color: gridColor
                                        },
                                        grid: {
                                            color: gridColor
                                        },
                                        pointLabels: {
                                            color: textColor
                                        },
                                        suggestedMin: 0,
                                        suggestedMax: 100
                                    }
                                };
                                
                                App.charts.reportChart = new Chart(canvas, {
                                    type: 'radar',
                                    data: chartData,
                                    options: chartOptions
                                });
                                break;
                                
                            default:
                                // Fallback to a basic chart
                                chartData.labels = ['Colheita', 'Transporte'];
                                chartData.datasets = [{
                                    label: 'Potencial (t/h)',
                                    data: [
                                        parseFloat(document.getElementById('potencial-colheita').value),
                                        parseFloat(document.getElementById('potencial-transporte').value)
                                    ],
                                    backgroundColor: [
                                        'rgba(16, 185, 129, 0.5)',
                                        'rgba(59, 130, 246, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgb(16, 185, 129)',
                                        'rgb(59, 130, 246)'
                                    ],
                                    borderWidth: 1
                                }];
                                
                                chartOptions.plugins.title.text = 'Comparação de Potenciais';
                                
                                App.charts.reportChart = new Chart(canvas, {
                                    type: 'bar',
                                    data: chartData,
                                    options: chartOptions
                                });
                        }
                    },
                    
                    // Show front comparison
                    showFrentesComparison: function() {
                        // Create modal
                        const modal = document.createElement('div');
                        modal.className = 'modal';
                        modal.style.display = 'flex';
                        
                        // Create frentes options
                        let frentesOptions = '';
                        App.data.frentes.forEach(frente => {
                            frentesOptions += `<option value="${frente.frente}">${frente.frente}</option>`;
                        });
                        
                        // Create modal content
                        modal.innerHTML = `
                            <div class="modal-content" style="max-width: 800px;">
                                <div class="modal-header">
                                    <h3>Comparação de Frentes</h3>
                                    <button class="modal-close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                        <div class="form-group" style="flex: 1; min-width: 200px;">
                                            <label for="compare-frente1">Frente 1:</label>
                                            <select id="compare-frente1">
                                                ${frentesOptions}
                                            </select>
                                        </div>
                                        <div class="form-group" style="flex: 1; min-width: 200px;">
                                            <label for="compare-frente2">Frente 2:</label>
                                            <select id="compare-frente2">
                                                ${frentesOptions}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="comparison-chart"></canvas>
                                    </div>
                                    
                                    <div class="data-card" style="margin-top: 1.5rem;">
                                        <h4>Comparação Detalhada</h4>
                                        <div class="table-container">
                                            <table class="data-table" id="comparison-table">
                                                <thead>
                                                    <tr>
                                                        <th>Indicador</th>
                                                        <th id="compare-col1">Frente 1</th>
                                                        <th id="compare-col2">Frente 2</th>
                                                        <th>Diferença</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Dados serão preenchidos dinamicamente -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary modal-close-btn">Fechar</button>
                                    <button class="btn" id="update-comparison-btn">Atualizar Comparação</button>
                                </div>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // Add event listeners
                        modal.querySelector('.modal-close').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.querySelector('.modal-close-btn').addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });
                        
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                document.body.removeChild(modal);
                            }
                        });
                        
                        // Make sure frente2 starts with a different value
                        if (App.data.frentes.length > 1) {
                            document.getElementById('compare-frente2').selectedIndex = 1;
                        }
                        
                        // Update comparison function
                        const updateComparison = () => {
                            const frente1Value = document.getElementById('compare-frente1').value;
                            const frente2Value = document.getElementById('compare-frente2').value;
                            
                            document.getElementById('compare-col1').textContent = `Frente ${frente1Value}`;
                            document.getElementById('compare-col2').textContent = `Frente ${frente2Value}`;
                            
                            const frente1 = App.data.frentes.find(f => f.frente === frente1Value);
                            const frente2 = App.data.frentes.find(f => f.frente === frente2Value);
                            
                            if (!frente1 || !frente2) {
                                UI.showToast('Frente não encontrada', 'error');
                                return;
                            }
                            
                            // Get potencial data
                            const potencial1 = App.data.potencial.find(p => p.frente === frente1Value);
                            const potencial2 = App.data.potencial.find(p => p.frente === frente2Value);
                            
                            // Calculate cycle times
                            const tempo1 = (parseFloat(frente1.ida) || 0) + (parseFloat(frente1.campo) || 0) + 
                                            (parseFloat(frente1.volta) || 0) + (parseFloat(frente1.usina) || 0);
                            const tempo2 = (parseFloat(frente2.ida) || 0) + (parseFloat(frente2.campo) || 0) + 
                                            (parseFloat(frente2.volta) || 0) + (parseFloat(frente2.usina) || 0);
                            
                            // Populate table
                            const tableBody = document.getElementById('comparison-table').querySelector('tbody');
                            tableBody.innerHTML = '';
                            
                            // Helper function to add a row
                            const addRow = (label, value1, value2, unit = '', formatter = (v) => v) => {
                                const diff = value2 - value1;
                                const diffFormatted = formatter(Math.abs(diff));
                                const diffText = diff === 0 ? '—' : 
                                                diff > 0 ? `<span style="color: var(--success-color);">+${diffFormatted}${unit}</span>` : 
                                                `<span style="color: var(--danger-color);">-${diffFormatted}${unit}</span>`;
                                
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${label}</td>
                                    <td>${formatter(value1)}${unit}</td>
                                    <td>${formatter(value2)}${unit}</td>
                                    <td>${diffText}</td>
                                `;
                                tableBody.appendChild(row);
                            };
                            
                            // Add comparison rows
                            addRow('Cota', frente1.cota, frente2.cota, ' t', v => v.toLocaleString('pt-BR'));
                            addRow('Distância', frente1.dist, frente2.dist, ' km', v => parseFloat(v).toFixed(2));
                            addRow('Tempo de Ciclo', tempo1, tempo2, ' min', v => v.toFixed(2));
                            
                            if (potencial1 && potencial2) {
                                addRow('Potencial de Colheita', potencial1.capFrente, potencial2.capFrente, ' t/h', v => v.toFixed(2));
                                addRow('Estratégia', potencial1.estrategia, potencial2.estrategia, ' t/h', v => v.toFixed(2));
                                addRow('Frota Necessária', potencial1.frota, potencial2.frota, '', v => v.toFixed(2));
                                
                                // Calculate efficiency
                                const eficiencia1 = potencial1.cota > 0 ? (potencial1.capFrente / potencial1.cota) * 100 : 0;
                                const eficiencia2 = potencial2.cota > 0 ? (potencial2.capFrente / potencial2.cota) * 100 : 0;
                                addRow('Eficiência', eficiencia1, eficiencia2, '%', v => v.toFixed(2));
                            }
                            
                            // Update chart
                            this.updateComparisonChart(frente1, frente2, potencial1, potencial2);
                        };
                        
                        // Initial update
                        updateComparison();
                        
                        // Add event listener for update button
                        document.getElementById('update-comparison-btn').addEventListener('click', updateComparison);
                    },
                    
                    // Update comparison chart
                    updateComparisonChart: function(frente1, frente2, potencial1, potencial2) {
                        const canvas = document.getElementById('comparison-chart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.comparisonChart) {
                            App.charts.comparisonChart.destroy();
                        }
                        
                        // Calculate cycle times
                        const tempo1 = (parseFloat(frente1.ida) || 0) + (parseFloat(frente1.campo) || 0) + 
                                        (parseFloat(frente1.volta) || 0) + (parseFloat(frente1.usina) || 0);
                        const tempo2 = (parseFloat(frente2.ida) || 0) + (parseFloat(frente2.campo) || 0) + 
                                        (parseFloat(frente2.volta) || 0) + (parseFloat(frente2.usina) || 0);
                        
                        // Prepare chart data
                        const labels = ['Cota (t)', 'Distância (km)', 'Tempo Ciclo (min)'];
                        const data1 = [frente1.cota / 100, frente1.dist, tempo1];
                        const data2 = [frente2.cota / 100, frente2.dist, tempo2];
                        
                        // Add potencial data if available
                        if (potencial1 && potencial2) {
                            labels.push('Potencial (t/h)', 'Frota');
                            data1.push(potencial1.capFrente, potencial1.frota);
                            data2.push(potencial2.capFrente, potencial2.frota);
                        }
                        
                        // Configure chart
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        const chartData = {
                            labels,
                            datasets: [
                                {
                                    label: `Frente ${frente1.frente}`,
                                    data: data1,
                                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                    borderColor: 'rgb(59, 130, 246)',
                                    borderWidth: 1
                                },
                                {
                                    label: `Frente ${frente2.frente}`,
                                    data: data2,
                                    backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                    borderColor: 'rgb(16, 185, 129)',
                                    borderWidth: 1
                                }
                            ]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: `Comparação Frentes ${frente1.frente} vs ${frente2.frente}`,
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: gridColor
                                    }
                                },
                                x: {
                                    grid: {
                                        color: gridColor
                                    }
                                }
                            }
                        };
                        
                        // Create new chart
                        App.charts.comparisonChart = new Chart(canvas, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions
                        });
                    },
                    
                    // Update dashboard
                    updateDashboard: function() {
                        // Calculate totals
                        const totalCota = App.data.frentes.reduce((sum, f) => sum + f.cota, 0);
                        const potencialColheita = App.data.potencial.reduce((sum, p) => sum + p.capFrente, 0);
                        
                        // Update cards
                        document.getElementById('dashboard-cota').textContent = totalCota.toLocaleString('pt-BR');
                        document.getElementById('dashboard-colheita').textContent = Math.round(potencialColheita);
                        
                        // Calculate progress percentages
                        const cotaProgress = Math.min(100, (totalCota / 15000) * 100);
                        const colheitaProgress = Math.min(100, (potencialColheita / 600) * 100);
                        
                        // Update progress bars
                        document.getElementById('cota-progress').style.width = `${cotaProgress}%`;
                        document.getElementById('colheita-progress').style.width = `${colheitaProgress}%`;
                        
                        // Update progress labels
                        const cotaProgressLabel = document.querySelector('#cota-progress').parentElement.nextElementSibling.firstElementChild;
                        cotaProgressLabel.textContent = `${Math.round(cotaProgress)}% da meta`;
                        
                        const colheitaProgressLabel = document.querySelector('#colheita-progress').parentElement.nextElementSibling.firstElementChild;
                        colheitaProgressLabel.textContent = `${Math.round(colheitaProgress)}% do projetado`;
                        
                        // Update efficiency insight
                        const frentes = App.data.frentes;
                        if (frentes.length > 0 && App.data.potencial.length > 0) {
                            // Find front with highest efficiency
                            let bestFronte = frentes[0].frente;
                            let bestEfficiency = 0;
                            
                            App.data.potencial.forEach(p => {
                                const efficiency = p.cota > 0 ? (p.capFrente / p.cota) * 100 : 0;
                                if (efficiency > bestEfficiency) {
                                    bestEfficiency = efficiency;
                                    bestFronte = p.frente;
                                }
                            });
                            
                            document.getElementById('insight-eficiencia').textContent = 
                                `A Frente ${bestFronte} está operando com a maior eficiência, atingindo ${bestEfficiency.toFixed(1)}% da capacidade projetada.`;
                        }
                        
                        // Update front summary table
                        this.updateResumoFrentes();
                    },
                    
                    // Update front summary
                    updateResumoFrentes: function() {
                        const tableBody = document.querySelector('#resumo-frentes-table tbody');
                        if (!tableBody) return;
                        
                        tableBody.innerHTML = '';
                        
                        // Sort by capacity
                        const frentes = [...App.data.frentes].sort((a, b) => {
                            const potA = App.data.potencial.find(p => p.frente === a.frente);
                            const potB = App.data.potencial.find(p => p.frente === b.frente);
                            
                            const capA = potA ? potA.capFrente : 0;
                            const capB = potB ? potB.capFrente : 0;
                            
                            return capB - capA; // Sort by highest capacity
                        });
                        
                        frentes.forEach(frente => {
                            const potencial = App.data.potencial.find(p => p.frente === frente.frente);
                            if (!potencial) return;
                            
                            // Calculate capacity percentage
                            const capacidade = potencial.cota > 0 ? (potencial.capFrente / potencial.cota) * 100 : 0;
                            
                            // Determine status
                            let status, statusClass;
                            if (capacidade >= 100) {
                                status = 'ÓTIMO';
                                statusClass = 'badge-success';
                            } else if (capacidade >= 90) {
                                status = 'BOM';
                                statusClass = 'badge-info';
                            } else if (capacidade >= 75) {
                                status = 'REGULAR';
                                statusClass = 'badge-warning';
                            } else {
                                status = 'INSUFICIENTE';
                                statusClass = 'badge-danger';
                            }
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${frente.frente}</td>
                                <td>${frente.cota.toLocaleString('pt-BR')}</td>
                                <td>${potencial.capFrente.toFixed(2)}</td>
                                <td>${capacidade.toFixed(2)}%</td>
                                <td><span class="badge ${statusClass}">${status}</span></td>
                                <td>
                                    <button class="btn btn-sm btn-view-frente" data-frente="${frente.frente}" aria-label="Ver detalhes">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-edit-frente" data-frente="${frente.frente}" aria-label="Editar frente">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            `;
                            
                            // Add event handlers for buttons
                            row.querySelector('.btn-view-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.showFrenteDetails(App.data.frentes.find(f => f.frente === frente));
                            });
                            
                            row.querySelector('.btn-edit-frente').addEventListener('click', function() {
                                const frente = this.dataset.frente;
                                UI.editFrente(frente);
                            });
                            
                            tableBody.appendChild(row);
                        });
                    },
                    
                    // Update history list
                    updateHistoryList: function() {
                        const container = document.getElementById('history-container');
                        if (!container) return;
                        
                        // Get filter values
                        const tipoFilter = document.getElementById('history-filter-type').value;
                        const entidadeFilter = document.getElementById('history-filter-entity').value;
                        const dateFilter = document.getElementById('history-filter-date').value;
                        
                        // Apply filters
                        let filteredHistory = [...App.data.historico];
                        
                        if (tipoFilter) {
                            filteredHistory = filteredHistory.filter(h => h.tipo === tipoFilter);
                        }
                        
                        if (entidadeFilter) {
                            filteredHistory = filteredHistory.filter(h => h.entidade === entidadeFilter);
                        }
                        
                        // Apply date filter
                        const now = new Date();
                        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
                        const yesterday = new Date(today - 86400000).getTime(); // 24h in ms
                        const weekAgo = new Date(today - 7 * 86400000).getTime();
                        const monthAgo = new Date(today - 30 * 86400000).getTime();
                        
                        if (dateFilter === 'today') {
                            filteredHistory = filteredHistory.filter(h => new Date(h.data).getTime() >= today);
                        } else if (dateFilter === 'yesterday') {
                            filteredHistory = filteredHistory.filter(h => {
                                const date = new Date(h.data).getTime();
                                return date >= yesterday && date < today;
                            });
                        } else if (dateFilter === 'week') {
                            filteredHistory = filteredHistory.filter(h => new Date(h.data).getTime() >= weekAgo);
                        } else if (dateFilter === 'month') {
                            filteredHistory = filteredHistory.filter(h => new Date(h.data).getTime() >= monthAgo);
                        } else if (dateFilter === 'custom') {
                            const startDate = document.getElementById('history-date-start').value;
                            const endDate = document.getElementById('history-date-end').value;
                            
                            if (startDate) {
                                const startTime = new Date(startDate).getTime();
                                filteredHistory = filteredHistory.filter(h => new Date(h.data).getTime() >= startTime);
                            }
                            
                            if (endDate) {
                                // Add 1 day to include the end date
                                const endTime = new Date(endDate);
                                endTime.setDate(endTime.getDate() + 1);
                                filteredHistory = filteredHistory.filter(h => new Date(h.data).getTime() <= endTime.getTime());
                            }
                        }
                        
                        // Sort by date (newest first)
                        filteredHistory.sort((a, b) => new Date(b.data).getTime() - new Date(a.data).getTime());
                        
                        // Clear container
                        container.innerHTML = '';
                        
                        // Show message if no entries
                        if (filteredHistory.length === 0) {
                            container.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-info-circle"></i>
                                    <p>Nenhuma entrada de histórico encontrada.</p>
                                </div>
                            `;
                            return;
                        }
                        
                        // Add entries
                        filteredHistory.forEach(entry => {
                            const date = new Date(entry.data);
                            const formattedDate = date.toLocaleString('pt-BR');
                            
                            // Determine icon class
                            let iconClass = '';
                            switch (entry.tipo) {
                                case 'add':
                                    iconClass = 'add';
                                    break;
                                case 'edit':
                                    iconClass = 'edit';
                                    break;
                                case 'delete':
                                    iconClass = 'delete';
                                    break;
                                case 'system':
                                    iconClass = 'system';
                                    break;
                                default:
                                    iconClass = 'system';
                            }
                            
                            // Determine icon
                            let icon = '';
                            switch (entry.tipo) {
                                case 'add':
                                    icon = 'fa-plus';
                                    break;
                                case 'edit':
                                    icon = 'fa-edit';
                                    break;
                                case 'delete':
                                    icon = 'fa-trash';
                                    break;
                                case 'system':
                                    icon = 'fa-cog';
                                    break;
                                default:
                                    icon = 'fa-info-circle';
                            }
                            
                            const entryElement = document.createElement('div');
                            entryElement.className = 'history-entry';
                            entryElement.innerHTML = `
                                <div class="history-icon ${iconClass}">
                                    <i class="fas ${icon}"></i>
                                </div>
                                <div class="history-content">
                                    <div class="history-title">${entry.titulo}</div>
                                    <div>${entry.descricao}</div>
                                    <div class="history-time">${formattedDate} - ${entry.usuario}</div>
                                </div>
                            `;
                            
                            container.appendChild(entryElement);
                        });
                        
                        // Refresh history chart
                        this.updateHistoryChart(filteredHistory);
                    },
                    
                    // Update history chart
                    updateHistoryChart: function(historyData) {
                        const canvas = document.getElementById('historyChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.historyChart) {
                            App.charts.historyChart.destroy();
                        }
                        
                        // Count action types
                        const actionCounts = {
                            add: 0,
                            edit: 0,
                            delete: 0,
                            system: 0
                        };
                        
                        historyData.forEach(entry => {
                            if (actionCounts.hasOwnProperty(entry.tipo)) {
                                actionCounts[entry.tipo]++;
                            }
                        });
                        
                        // Prepare chart data
                        const data = [
                            actionCounts.add,
                            actionCounts.edit,
                            actionCounts.delete,
                            actionCounts.system
                        ];
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Prepare chart
                        const chartData = {
                            labels: ['Inclusões', 'Alterações', 'Exclusões', 'Sistema'],
                            datasets: [{
                                label: 'Ações',
                                data: data,
                                backgroundColor: [
                                    'rgba(16, 185, 129, 0.5)',
                                    'rgba(59, 130, 246, 0.5)',
                                    'rgba(239, 68, 68, 0.5)',
                                    'rgba(245, 158, 11, 0.5)'
                                ],
                                borderColor: [
                                    'rgb(16, 185, 129)',
                                    'rgb(59, 130, 246)',
                                    'rgb(239, 68, 68)',
                                    'rgb(245, 158, 11)'
                                ],
                                borderWidth: 1
                            }]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Distribuição de Alterações',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'right',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                datalabels: {
                                    color: textColor,
                                    formatter: (value) => {
                                        if (value === 0) return '';
                                        return value;
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.historyChart = new Chart(canvas, {
                            type: 'pie',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Update all charts
                    updateAllCharts: function() {
                        this.updateCharts();
                        this.updateHistoryChart(App.data.historico);
                    },
                    
                    // Update dashboard charts
                    updateCharts: function() {
                        const canvases = {
                            potencialChart: document.getElementById('potencialChart'),
                            transporteChart: document.getElementById('transporteChart'),
                            eficienciaChart: document.getElementById('eficienciaChart'),
                            tempoCicloChart: document.getElementById('tempoCicloChart'),
                            produtividadeChart: document.getElementById('produtividadeChart'),
                            colheitaComparativoChart: document.getElementById('colheitaComparativoChart'),
                            colheitaHistoricoChart: document.getElementById('colheitaHistoricoChart'),
                            potencialBeforeChart: document.getElementById('potencial-before-chart'),
                            potencialAfterChart: document.getElementById('potencial-after-chart')
                        };
                        
                        // Check which canvases exist
                        for (const key in canvases) {
                            if (canvases[key]) {
                                this[`update${key.charAt(0).toUpperCase() + key.slice(1)}`]();
                            }
                        }
                    },
                    
                    // Update potencial chart
                    updatePotencialChart: function() {
                        const canvas = document.getElementById('potencialChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.potencialChart) {
                            App.charts.potencialChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Prepare chart data
                        const labels = App.data.frentes.map(f => `Frente ${f.frente}`);
                        const cotas = App.data.potencial.map(p => p.cota);
                        const potenciais = App.data.potencial.map(p => p.capFrente);
                        
                        const chartData = {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Cota (t/h)',
                                    data: cotas,
                                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                    borderColor: 'rgb(59, 130, 246)',
                                    borderWidth: 1,
                                    type: 'bar'
                                },
                                {
                                    label: 'Potencial (t/h)',
                                    data: potenciais,
                                    backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                    borderColor: 'rgb(16, 185, 129)',
                                    borderWidth: 1,
                                    type: 'bar'
                                }
                            ]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Potencial de Colheita por Frente',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                datalabels: {
                                    anchor: 'end',
                                    align: 'top',
                                    formatter: (value) => value.toFixed(1),
                                    color: textColor,
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Toneladas/Hora',
                                        color: textColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                },
                                x: {
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.potencialChart = new Chart(canvas, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Update transporte chart
                    updateTransporteChart: function() {
                        const canvas = document.getElementById('transporteChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.transporteChart) {
                            App.charts.transporteChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Get data
                        const propriosTotal = App.data.transportes.propriosTotal;
                        const propriosDisponiveis = propriosTotal - App.data.transportes.propriosParados;
                        const terceirosTotal = App.data.transportes.terceirosTotal;
                        const terceirosDisponiveis = terceirosTotal - App.data.transportes.terceirosParados;
                        
                        // Prepare chart
                        const chartData = {
                            labels: ['Próprios', 'Terceiros'],
                            datasets: [
                                {
                                    label: 'Disponíveis',
                                    data: [propriosDisponiveis, terceirosDisponiveis],
                                    backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                    borderColor: 'rgb(16, 185, 129)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Parados',
                                    data: [propriosTotal - propriosDisponiveis, terceirosTotal - terceirosDisponiveis],
                                    backgroundColor: 'rgba(239, 68, 68, 0.5)',
                                    borderColor: 'rgb(239, 68, 68)',
                                    borderWidth: 1
                                }
                            ]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Disponibilidade de Transporte',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                datalabels: {
                                    anchor: 'center',
                                    align: 'center',
                                    formatter: (value) => value,
                                    color: 'white',
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    stacked: true,
                                    title: {
                                        display: true,
                                        text: 'Quantidade',
                                        color: textColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                },
                                x: {
                                    stacked: true,
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.transporteChart = new Chart(canvas, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Update eficiencia chart
                    updateEficienciaChart: function() {
                        const canvas = document.getElementById('eficienciaChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.eficienciaChart) {
                            App.charts.eficienciaChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Calculate efficiency for each front
                        const labels = [];
                        const efficiencies = [];
                        const backgroundColors = [];
                        
                        App.data.frentes.forEach(frente => {
                            const potencial = App.data.potencial.find(p => p.frente === frente.frente);
                            if (!potencial) return;
                            
                            const efficiency = potencial.cota > 0 ? (potencial.capFrente / potencial.cota) * 100 : 0;
                            
                            labels.push(`Frente ${frente.frente}`);
                            efficiencies.push(efficiency);
                            
                            // Determine color based on efficiency
                            let color;
                            if (efficiency >= 100) {
                                color = 'rgba(16, 185, 129, 0.5)'; // Green
                            } else if (efficiency >= 90) {
                                color = 'rgba(14, 165, 233, 0.5)'; // Blue
                            } else if (efficiency >= 75) {
                                color = 'rgba(245, 158, 11, 0.5)'; // Yellow
                            } else {
                                color = 'rgba(239, 68, 68, 0.5)'; // Red
                            }
                            
                            backgroundColors.push(color);
                        });
                        
                        // Prepare chart
                        const chartData = {
                            labels: labels,
                            datasets: [{
                                label: 'Eficiência (%)',
                                data: efficiencies,
                                backgroundColor: backgroundColors,
                                borderWidth: 1
                            }]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Eficiência por Frente',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    display: false
                                },
                                datalabels: {
                                    anchor: 'end',
                                    align: 'top',
                                    formatter: (value) => value.toFixed(1) + '%',
                                    color: textColor,
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 110, // Allow some space above 100%
                                    title: {
                                        display: true,
                                        text: 'Eficiência (%)',
                                        color: textColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                },
                                x: {
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.eficienciaChart = new Chart(canvas, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Update tempoCiclo chart
                    updateTempoCicloChart: function() {
                        const canvas = document.getElementById('tempoCicloChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.tempoCicloChart) {
                            App.charts.tempoCicloChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Prepare data
                        const labels = App.data.frentes.map(f => `Frente ${f.frente}`);
                        const idaTimes = App.data.frentes.map(f => parseFloat(f.ida) || 0);
                        const campoTimes = App.data.frentes.map(f => parseFloat(f.campo) || 0);
                        const voltaTimes = App.data.frentes.map(f => parseFloat(f.volta) || 0);
                        const usinaTimes = App.data.frentes.map(f => parseFloat(f.usina) || 0);
                        
                        // Prepare chart
                        const chartData = {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Ida',
                                    data: idaTimes,
                                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                    borderColor: 'rgb(59, 130, 246)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Campo',
                                    data: campoTimes,
                                    backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                    borderColor: 'rgb(16, 185, 129)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Volta',
                                    data: voltaTimes,
                                    backgroundColor: 'rgba(245, 158, 11, 0.5)',
                                    borderColor: 'rgb(245, 158, 11)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Usina',
                                    data: usinaTimes,
                                    backgroundColor: 'rgba(139, 92, 246, 0.5)',
                                    borderColor: 'rgb(139, 92, 246)',
                                    borderWidth: 1
                                }
                            ]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Análise de Tempo de Ciclo',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    stacked: true,
                                    title: {
                                        display: true,
                                        text: 'Tempo (min)',
                                        color: textColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                },
                                x: {
                                    stacked: true,
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.tempoCicloChart = new Chart(canvas, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions
                        });
                    },
                    
                    // Update produtividade chart
                    updateProdutividadeChart: function() {
                        const canvas = document.getElementById('produtividadeChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.produtividadeChart) {
                            App.charts.produtividadeChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Get filter values
                        const frenteFilter = document.getElementById('equipamentos-filter-frente')?.value || '';
                        
                        // Prepare data
                        const labels = [];
                        const produtividades = [];
                        const backgroundColors = [];
                        
                        // Helper function to get a proper color scale
                        const getColorScale = (value, min, max) => {
                            // Get scale from 0 to 1
                            const normalized = (value - min) / (max - min);
                            
                            // Use hsl for easy gradient
                            const hue = normalized * 120; // 0 = red, 120 = green
                            return `hsla(${hue}, 75%, 50%, 0.5)`;
                        };
                        
                        // Process each front
                        App.data.frentes.forEach(frente => {
                            // Apply front filter if any
                            if (frenteFilter && frente.frente !== frenteFilter) return;
                            
                            const equipamentos = App.data.equipamentos[frente.frente];
                            if (!equipamentos) return;
                            
                            // Get only available equipment
                            const disponiveisEquipamentos = equipamentos.filter(e => e.disponivel === 1);
                            
                            // Add each equipment to the chart
                            disponiveisEquipamentos.forEach(equip => {
                                labels.push(`${equip.equipo} (${frente.frente})`);
                                produtividades.push(equip.producao);
                            });
                        });
                        
                        // Get min and max for color scaling
                        const minVal = Math.min(...produtividades);
                        const maxVal = Math.max(...produtividades);
                        
                        // Generate colors
                        produtividades.forEach(val => {
                            backgroundColors.push(getColorScale(val, minVal, maxVal));
                        });
                        
                        // Prepare chart
                        const chartData = {
                            labels: labels,
                            datasets: [{
                                label: 'Produção (t/h)',
                                data: produtividades,
                                backgroundColor: backgroundColors,
                                borderWidth: 1
                            }]
                        };
                        
                        const chartOptions = {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Produtividade por Equipamento',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    display: false
                                },
                                datalabels: {
                                    anchor: 'end',
                                    align: 'right',
                                    formatter: (value) => value.toFixed(1) + ' t/h',
                                    color: textColor,
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                },
                                x: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Produção (t/h)',
                                        color: textColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.produtividadeChart = new Chart(canvas, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Update colheita comparativo chart
                    updateColheitaComparativoChart: function() {
                        const canvas = document.getElementById('colheitaComparativoChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.colheitaComparativoChart) {
                            App.charts.colheitaComparativoChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Calculate current values
                        const colheitaAtual = parseFloat(document.getElementById('potencial-colheita').value) || 0;
                        const transporteAtual = parseFloat(document.getElementById('potencial-transporte').value) || 0;
                        
                        // Prepare chart
                        const chartData = {
                            labels: ['Colheita', 'Transporte'],
                            datasets: [
                                {
                                    label: 'Atual',
                                    data: [colheitaAtual, transporteAtual],
                                    backgroundColor: [
                                        'rgba(16, 185, 129, 0.5)',
                                        'rgba(59, 130, 246, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgb(16, 185, 129)',
                                        'rgb(59, 130, 246)'
                                    ],
                                    borderWidth: 1
                                },
                                {
                                    label: 'Meta',
                                    data: [600, 550],
                                    backgroundColor: 'rgba(0, 0, 0, 0)',
                                    borderColor: [
                                        'rgb(16, 185, 129)',
                                        'rgb(59, 130, 246)'
                                    ],
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    type: 'line',
                                    pointRadius: 0
                                }
                            ]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Comparativo com Metas',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                datalabels: {
                                    anchor: 'end',
                                    align: 'top',
                                    formatter: (value, ctx) => {
                                        // Only show for the bar dataset
                                        if (ctx.datasetIndex === 0) {
                                            return value.toFixed(0) + ' t/h';
                                        }
                                        return null;
                                    },
                                    color: textColor,
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Toneladas/Hora',
                                        color: textColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                },
                                x: {
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.colheitaComparativoChart = new Chart(canvas, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Update colheita historico chart
                    updateColheitaHistoricoChart: function() {
                        const canvas = document.getElementById('colheitaHistoricoChart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.colheitaHistoricoChart) {
                            App.charts.colheitaHistoricoChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Get historical data
                        const labels = App.data.historicalData.colheita.map(d => {
                            const date = new Date(d.data);
                            return date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
                        });
                        
                        const colheitaValues = App.data.historicalData.colheita.map(d => d.valor);
                        const transporteValues = App.data.historicalData.transporte.map(d => d.valor);
                        
                        // Prepare chart
                        const chartData = {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Colheita',
                                    data: colheitaValues,
                                    borderColor: 'rgb(16, 185, 129)',
                                    backgroundColor: 'rgba(16, 185, 129, 0.5)',
                                    fill: {
                                        target: 'origin',
                                        above: 'rgba(16, 185, 129, 0.2)'
                                    },
                                    tension: 0.3,
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                },
                                {
                                    label: 'Transporte',
                                    data: transporteValues,
                                    borderColor: 'rgb(59, 130, 246)',
                                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                    fill: {
                                        target: 'origin',
                                        above: 'rgba(59, 130, 246, 0.2)'
                                    },
                                    tension: 0.3,
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                }
                            ]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Histórico de Potencial',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Toneladas/Hora',
                                        color: textColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                },
                                x: {
                                    grid: {
                                        color: gridColor
                                    },
                                    ticks: {
                                        color: textColor
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.colheitaHistoricoChart = new Chart(canvas, {
                            type: 'line',
                            data: chartData,
                            options: chartOptions
                        });
                    },
                    
                    // Update potencial before chart (comparison)
                    updatePotencialBeforeChart: function() {
                        const canvas = document.getElementById('potencial-before-chart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.potencialBeforeChart) {
                            App.charts.potencialBeforeChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Prepare data for current state (before chart)
                        const capacidadeColheita = parseFloat(document.getElementById('potencial-colheita').value) || 0;
                        const capacidadeTransporte = parseFloat(document.getElementById('potencial-transporte').value) || 0;
                        const limitanteAtual = document.getElementById('limitante-sistema').value;
                        
                        // Prepare chart
                        const chartData = {
                            labels: ['Colheita', 'Transporte'],
                            datasets: [{
                                data: [capacidadeColheita, capacidadeTransporte],
                                backgroundColor: [
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(59, 130, 246, 0.7)'
                                ],
                                borderColor: [
                                    'rgb(16, 185, 129)',
                                    'rgb(59, 130, 246)'
                                ],
                                borderWidth: 1,
                                hoverOffset: 10
                            }]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Estado Atual do Sistema',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                subtitle: {
                                    display: true,
                                    text: `Limitante: ${limitanteAtual}`,
                                    color: textColor,
                                    font: {
                                        size: 14,
                                        style: 'italic'
                                    },
                                    padding: {
                                        bottom: 10
                                    }
                                },
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                datalabels: {
                                    anchor: 'center',
                                    align: 'center',
                                    formatter: (value) => value.toFixed(0) + ' t/h',
                                    color: 'white',
                                    font: {
                                        weight: 'bold',
                                        size: 14
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.potencialBeforeChart = new Chart(canvas, {
                            type: 'pie',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Update potencial after chart (comparison)
                    updatePotencialAfterChart: function() {
                        const canvas = document.getElementById('potencial-after-chart');
                        if (!canvas) return;
                        
                        // Destroy previous chart if exists
                        if (App.charts.potencialAfterChart) {
                            App.charts.potencialAfterChart.destroy();
                        }
                        
                        // Configure colors based on theme
                        const isDarkMode = document.documentElement.classList.contains('dark');
                        const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Prepare data for projected state (after chart)
                        // This simulates improvements to the system
                        const capacidadeColheita = parseFloat(document.getElementById('potencial-colheita').value) || 0;
                        const capacidadeTransporte = parseFloat(document.getElementById('potencial-transporte').value) || 0;
                        const limitanteAtual = document.getElementById('limitante-sistema').value;
                        
                        // Simulated improvements
                        const colheitaProjetada = capacidadeColheita * 1.15; // +15%
                        const transporteProjetado = limitanteAtual === 'TRANSPORTE' ? 
                            capacidadeTransporte * 1.25 : capacidadeTransporte * 1.1; // +25% if limiting, otherwise +10%
                            
                        // Determine new limiting factor
                        const novoLimitante = colheitaProjetada <= transporteProjetado ? 'COLHEITA' : 'TRANSPORTE';
                        
                        // Prepare chart
                        const chartData = {
                            labels: ['Colheita', 'Transporte'],
                            datasets: [{
                                data: [colheitaProjetada, transporteProjetado],
                                backgroundColor: [
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(59, 130, 246, 0.7)'
                                ],
                                borderColor: [
                                    'rgb(16, 185, 129)',
                                    'rgb(59, 130, 246)'
                                ],
                                borderWidth: 1,
                                hoverOffset: 10
                            }]
                        };
                        
                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Estado Projetado',
                                    color: textColor,
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                subtitle: {
                                    display: true,
                                    text: `Limitante: ${novoLimitante}`,
                                    color: textColor,
                                    font: {
                                        size: 14,
                                        style: 'italic'
                                    },
                                    padding: {
                                        bottom: 10
                                    }
                                },
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: textColor
                                    }
                                },
                                datalabels: {
                                    anchor: 'center',
                                    align: 'center',
                                    formatter: (value) => value.toFixed(0) + ' t/h',
                                    color: 'white',
                                    font: {
                                        weight: 'bold',
                                        size: 14
                                    }
                                }
                            }
                        };
                        
                        // Create chart
                        App.charts.potencialAfterChart = new Chart(canvas, {
                            type: 'pie',
                            data: chartData,
                            options: chartOptions,
                            plugins: [ChartDataLabels]
                        });
                    },
                    
                    // Load map
                    loadMap: function() {
                        const mapContainer = document.getElementById('mapa-frentes');
                        if (!mapContainer) return;
                        
                        // Show loading state
                        mapContainer.innerHTML = `
                            <div style="height: 100%; display: flex; align-items: center; justify-content: center; background-color: var(--bg-tertiary); border-radius: 10px;">
                                <div style="text-align: center;">
                                    <div class="spinner" style="margin: 0 auto 1rem;"></div>
                                    <p>Carregando mapa...</p>
                                </div>
                            </div>
                        `;
                        
                        // Use setTimeout to simulate loading
                        setTimeout(() => {
                            // Generate map visualization
                            const canvas = document.createElement('canvas');
                            canvas.width = mapContainer.clientWidth;
                            canvas.height = mapContainer.clientHeight;
                            canvas.style.width = '100%';
                            canvas.style.height = '100%';
                            canvas.style.borderRadius = '10px';
                            
                            mapContainer.innerHTML = '';
                            mapContainer.appendChild(canvas);
                            
                            const ctx = canvas.getContext('2d');
                            if (!ctx) return;
                            
                            // Determine colors based on theme
                            const isDarkMode = document.documentElement.classList.contains('dark');
                            const bgColor = isDarkMode ? '#1e1e2f' : '#ffffff';
                            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                            const textColor = isDarkMode ? '#e0e0e0' : '#263238';
                            
                            // Draw background
                            ctx.fillStyle = bgColor;
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                            
                            // Draw grid
                            ctx.strokeStyle = gridColor;
                            ctx.lineWidth = 1;
                            
                            // Draw horizontal grid lines
                            for (let y = 50; y < canvas.height; y += 50) {
                                ctx.beginPath();
                                ctx.moveTo(0, y);
                                ctx.lineTo(canvas.width, y);
                                ctx.stroke();
                            }
                            
                            // Draw vertical grid lines
                            for (let x = 50; x < canvas.width; x += 50) {
                                ctx.beginPath();
                                ctx.moveTo(x, 0);
                                ctx.lineTo(x, canvas.height);
                                ctx.stroke();
                            }
                            
                            // Find min/max coordinates for scaling
                            const locations = App.data.frentes
                                .filter(f => f.location && f.location.lat && f.location.lng)
                                .map(f => f.location);
                                
                            if (locations.length === 0) {
                                // No valid locations, draw message
                                ctx.fillStyle = textColor;
                                ctx.font = '16px var(--font-family)';
                                ctx.textAlign = 'center';
                                ctx.fillText('Nenhuma frente com localização definida', canvas.width / 2, canvas.height / 2);
                                return;
                            }
                            
                            const minLat = Math.min(...locations.map(l => l.lat));
                            const maxLat = Math.max(...locations.map(l => l.lat));
                            const minLng = Math.min(...locations.map(l => l.lng));
                            const maxLng = Math.max(...locations.map(l => l.lng));
                            
                            // Add padding
                            const latRange = maxLat - minLat;
                            const lngRange = maxLng - minLng;
                            const paddingFactor = 0.1;
                            
                            const paddedMinLat = minLat - latRange * paddingFactor;
                            const paddedMaxLat = maxLat + latRange * paddingFactor;
                            const paddedMinLng = minLng - lngRange * paddingFactor;
                            const paddedMaxLng = maxLng + lngRange * paddingFactor;
                            
                            // Helper function to convert coordinates to canvas position
                            const coordToCanvas = (lat, lng) => {
                                const x = ((lng - paddedMinLng) / (paddedMaxLng - paddedMinLng)) * canvas.width;
                                // Flip y coordinate since canvas origin is top-left
                                const y = canvas.height - ((lat - paddedMinLat) / (paddedMaxLat - paddedMinLat)) * canvas.height;
                                return { x, y };
                            };
                            
                            // Draw usina at center
                            const usinaPos = coordToCanvas(
                                (paddedMinLat + paddedMaxLat) / 2,
                                (paddedMinLng + paddedMaxLng) / 2
                            );
                            
                            ctx.fillStyle = '#f44336';
                            ctx.beginPath();
                            ctx.arc(usinaPos.x, usinaPos.y, 10, 0, Math.PI * 2);
                            ctx.fill();
                            
                            ctx.fillStyle = textColor;
                            ctx.font = 'bold 14px var(--font-family)';
                            ctx.textAlign = 'center';
                            ctx.fillText('USINA', usinaPos.x, usinaPos.y - 15);
                            
                            // Draw fronts
                            App.data.frentes
                                .filter(f => f.location && f.location.lat && f.location.lng)
                                .forEach(frente => {
                                    const pos = coordToCanvas(frente.location.lat, frente.location.lng);
                                    
                                    // Determine color based on transport type
                                    const color = frente.transporte === 'P' ? '#3949ab' : '#26a69a';
                                    
                                    // Draw front marker
                                    ctx.fillStyle = color;
                                    ctx.beginPath();
                                    ctx.arc(pos.x, pos.y, 8, 0, Math.PI * 2);
                                    ctx.fill();
                                    
                                    // Draw road to usina
                                    ctx.strokeStyle = color;
                                    ctx.lineWidth = 2;
                                    ctx.setLineDash([5, 3]);
                                    ctx.beginPath();
                                    ctx.moveTo(pos.x, pos.y);
                                    ctx.lineTo(usinaPos.x, usinaPos.y);
                                    ctx.stroke();
                                    ctx.setLineDash([]);
                                    
                                    // Draw distance label
                                    const midX = (pos.x + usinaPos.x) / 2;
                                    const midY = (pos.y + usinaPos.y) / 2;
                                    
                                    ctx.fillStyle = textColor;
                                    ctx.font = '12px var(--font-family)';
                                    ctx.fillText(`${frente.dist} km`, midX, midY - 5);
                                    
                                    // Draw front label
                                    ctx.fillStyle = textColor;
                                    ctx.font = 'bold 14px var(--font-family)';
                                    ctx.textAlign = 'center';
                                    ctx.fillText(frente.frente, pos.x, pos.y - 15);
                                });
                                
                            // Draw legend
                            ctx.fillStyle = bgColor;
                            ctx.fillRect(10, 10, 150, 80);
                            ctx.strokeStyle = gridColor;
                            ctx.strokeRect(10, 10, 150, 80);
                            
                            ctx.fillStyle = textColor;
                            ctx.font = 'bold 12px var(--font-family)';
                            ctx.textAlign = 'left';
                            ctx.fillText('Legenda:', 20, 30);
                            
                            // Próprio marker
                            ctx.fillStyle = '#3949ab';
                            ctx.beginPath();
                            ctx.arc(30, 50, 6, 0, Math.PI * 2);
                            ctx.fill();
                            
                            ctx.fillStyle = textColor;
                            ctx.font = '12px var(--font-family)';
                            ctx.fillText('Transporte Próprio', 45, 54);
                            
                            // Terceiro marker
                            ctx.fillStyle = '#26a69a';
                            ctx.beginPath();
                            ctx.arc(30, 75, 6, 0, Math.PI * 2);
                            ctx.fill();
                            
                            ctx.fillStyle = textColor;
                            ctx.font = '12px var(--font-family)';
                            ctx.fillText('Transporte Terceiro', 45, 79);
                            
                            // Update state
                            App.state.mapLoaded = true;
                            
                            // Notify user
                            UI.showToast('Mapa carregado com sucesso!');
                        }, 1000);
                    }
                };
                
                // FileHandler namespace - for import/export operations
                const FileHandler = {
                    // Export data to file
                    exportData: function(type) {
                        let data;
                        let filename;
                        
                        switch (type) {
                            case 'potencial':
                                data = App.data.potencial;
                                filename = 'potencial_colheita.json';
                                break;
                            case 'frentes':
                                data = App.data.frentes;
                                filename = 'dados_frentes.json';
                                break;
                            case 'equipamentos':
                                data = App.data.equipamentos;
                                filename = 'dados_equipamentos.json';
                                break;
                            default:
                                UI.showToast('Tipo de dados inválido', 'error');
                                return;
                        }
                        
                        // Convert to string
                        const jsonData = JSON.stringify(data, null, 2);
                        
                        // Create download link
                        const blob = new Blob([jsonData], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        
                        // Clean up
                        setTimeout(() => {
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        }, 100);
                        
                        UI.showToast(`Dados de ${type} exportados com sucesso!`);
                    },
                    
                    // Import data from file
                    importData: function(type, file) {
                        if (!file) return;
                        
                        UI.showLoading(`Importando dados de ${type}...`);
                        
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            try {
                                const data = JSON.parse(e.target.result);
                                
                                switch (type) {
                                    case 'potencial':
                                        App.data.potencial = data;
                                        UI.initPotencialTable();
                                        break;
                                    case 'frentes':
                                        App.data.frentes = data;
                                        UI.initFrentesTable();
                                        break;
                                    case 'equipamentos':
                                        App.data.equipamentos = data;
                                        UI.initEquipamentosTables();
                                        break;
                                    default:
                                        UI.showToast('Tipo de dados inválido', 'error');
                                        UI.hideLoading();
                                        return;
                                }
                                
                                // Update app state
                                App.data.lastUpdated = new Date().toISOString();
                                UI.updateTimestamps();
                                
                                // Save data
                                App.saveData();
                                
                                // Add to history
                                App.addHistoryEntry({
                                    tipo: 'system',
                                    entidade: type,
                                    titulo: `Importação de dados de ${type}`,
                                    descricao: `Dados de ${type} importados de arquivo`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                                
                                UI.hideLoading();
                                UI.showToast(`Dados de ${type} importados com sucesso!`);
                                
                            } catch (error) {
                                console.error('Error importing data:', error);
                                UI.hideLoading();
                                UI.showToast(`Erro ao importar dados: ${error.message}`, 'error');
                            }
                        };
                        
                        reader.onerror = function() {
                            UI.hideLoading();
                            UI.showToast('Erro ao ler o arquivo', 'error');
                        };
                        
                        reader.readAsText(file);
                    },
                    
                    // Export full backup
                    exportBackup: function() {
                        // Prepare backup data
                        const backup = {
                            data: App.data,
                            version: App.version.current,
                            exportDate: new Date().toISOString()
                        };
                        
                        // Convert to string
                        const jsonData = JSON.stringify(backup, null, 2);
                        
                        // Create download link
                        const blob = new Blob([jsonData], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `backup_safra_2025_${new Date().toISOString().slice(0, 10)}.json`;
                        document.body.appendChild(a);
                        a.click();
                        
                        // Clean up
                        setTimeout(() => {
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        }, 100);
                        
                        // Add to history
                        App.addHistoryEntry({
                            tipo: 'system',
                            entidade: 'dados',
                            titulo: 'Backup manual',
                            descricao: 'Backup completo do sistema exportado manualmente',
                            data: new Date().toISOString(),
                            usuario: 'Administrador'
                        });
                        
                        UI.showToast('Backup exportado com sucesso!');
                    },
                    
                    // Import backup
                    importBackup: function(file) {
                        if (!file) return;
                        
                        UI.showLoading('Restaurando backup...');
                        
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            try {
                                const backup = JSON.parse(e.target.result);
                                
                                // Validate backup data
                                if (!backup.data || !backup.version) {
                                    throw new Error('Formato de backup inválido');
                                }
                                
                                // Confirm before restoring
                                App.showConfirmDialog(
                                    'Confirmar Restauração',
                                    `Tem certeza que deseja restaurar o backup de ${new Date(backup.exportDate).toLocaleString('pt-BR')}? Todos os dados atuais serão substituídos.`,
                                    () => {
                                        // Restore data
                                        App.data = backup.data;
                                        
                                        // Update UI
                                        UI.updateTimestamps();
                                        UI.initFrentesTable();
                                        UI.initEquipamentosTables();
                                        UI.initPotencialTable();
                                        UI.updateRecentFrentes();
                                        UI.updateAllCharts();
                                        UI.updateDashboard();
                                        
                                        // Save data
                                        App.saveData();
                                        
                                        // Add to history
                                        App.addHistoryEntry({
                                            tipo: 'system',
                                            entidade: 'dados',
                                            titulo: 'Restauração de backup',
                                            descricao: `Backup de ${new Date(backup.exportDate).toLocaleString('pt-BR')} restaurado`,
                                            data: new Date().toISOString(),
                                            usuario: 'Administrador'
                                        });
                                        
                                        UI.hideLoading();
                                        UI.showToast('Backup restaurado com sucesso!');
                                    }
                                );
                                
                                UI.hideLoading();
                                
                            } catch (error) {
                                console.error('Error importing backup:', error);
                                UI.hideLoading();
                                UI.showToast(`Erro ao restaurar backup: ${error.message}`, 'error');
                            }
                        };
                        
                        reader.onerror = function() {
                            UI.hideLoading();
                            UI.showToast('Erro ao ler o arquivo de backup', 'error');
                        };
                        
                        reader.readAsText(file);
                    }
                };
                
                // Initialize the application
                App.init();
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potencial Colheita e Transporte</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <style>
        /* Modern Color Scheme */
        :root {
            /* Primary brand colors */
            --primary-color: #3949ab;
            --primary-light: #6f74dd;
            --primary-dark: #00227b;
            --primary-color-rgb: 57, 73, 171;
            --primary-gradient: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            
            /* Accent colors */
            --accent-color: #5c6bc0;
            --accent-light: #8e99f3;
            --accent-hover: #3f51b5;
            --accent-color-rgb: 92, 107, 192;
            --accent-gradient: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            
            /* Secondary accent colors */
            --secondary-color: #26a69a;
            --secondary-light: #64d8cb;
            --secondary-dark: #00766c;
            --secondary-color-rgb: 38, 166, 154;
            --secondary-gradient: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            
            /* Interface colors */
            --text-color: #263238;
            --text-secondary: #455a64;
            --text-tertiary: #607d8b;
            --bg-color: #fff;
            --bg-secondary: #f5f7fa;
            --bg-tertiary: #e9eef2;
            --border-color: #d0d9e2;
            --card-bg: #fff;
            
            /* Header colors */
            --header-bg: linear-gradient(135deg, #303f9f, #3949ab);
            --header-text: #fff;
            --overlay-bg: rgba(255, 255, 255, 0.95);
            
            /* Effect colors */
            --shadow: 0 8px 25px rgba(0,0,0,0.08);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-hover: 0 10px 30px rgba(57, 73, 171, 0.15);
            
            /* Form elements */
            --input-bg: #fff;
            --input-border: #d0d9e2;
            --input-focus-border: #3949ab;
            --input-disabled: #f9f9fb;
            --input-shadow: 0 0 0 3px rgba(57, 73, 171, 0.1);
            
            /* Status colors */
            --success-color: #00c853;
            --success-light: #e8f5e9;
            --success-rgb: 0, 200, 83;
            --warning-color: #ffab00;
            --warning-light: #fff8e1;
            --warning-rgb: 255, 171, 0;
            --danger-color: #f44336;
            --danger-light: #ffebee;
            --danger-rgb: 244, 67, 54;
            --info-color: #0091ea;
            --info-light: #e1f5fe;
            --info-rgb: 0, 145, 234;
            
            /* Animation */
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* Fonts */
            --font-family: 'Poppins', 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        /* Dark theme */
        .dark {
            /* Primary brand colors in dark theme */
            --primary-color: #5c6bc0;
            --primary-light: #8e99f3;
            --primary-dark: #26418f;
            --primary-color-rgb: 92, 107, 192;
            --primary-gradient: linear-gradient(135deg, #303f9f, #1a237e);
            
            /* Accent colors */
            --accent-color: #7986cb;
            --accent-light: #9fa8da;
            --accent-hover: #5c6bc0;
            --accent-color-rgb: 121, 134, 203;
            --accent-gradient: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            
            /* Secondary accent colors in dark theme */
            --secondary-color: #26a69a;
            --secondary-light: #64d8cb;
            --secondary-dark: #00766c;
            --secondary-color-rgb: 38, 166, 154;
            --secondary-gradient: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            
            /* Interface colors */
            --text-color: #e0e0e0;
            --text-secondary: #b0bec5;
            --text-tertiary: #78909c;
            --bg-color: #121212;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #252538;
            --border-color: #303040;
            --card-bg: #1e1e2f;
            
            /* Header colors */
            --header-bg: linear-gradient(135deg, #1a237e, #283593);
            --header-text: #e0e0e0;
            --overlay-bg: rgba(18, 18, 34, 0.96);
            
            /* Effect colors */
            --shadow: 0 8px 25px rgba(0,0,0,0.25);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.22);
            --shadow-hover: 0 10px 30px rgba(77, 93, 221, 0.2);
            
            /* Form elements */
            --input-bg: #252538;
            --input-border: #303040;
            --input-focus-border: #5c6bc0;
            --input-disabled: #20202a;
            --input-shadow: 0 0 0 3px rgba(92, 107, 192, 0.2);
            
            /* Status colors */
            --success-color: #00e676;
            --success-light: rgba(0, 230, 118, 0.15);
            --success-rgb: 0, 230, 118;
            --warning-color: #ffca28;
            --warning-light: rgba(255, 202, 40, 0.15);
            --warning-rgb: 255, 202, 40;
            --danger-color: #ff5252;
            --danger-light: rgba(255, 82, 82, 0.15);
            --danger-rgb: 255, 82, 82;
            --info-color: #29b6f6;
            --info-light: rgba(41, 182, 246, 0.15);
            --info-rgb: 41, 182, 246;
        }

        * {
            box-sizing: border-box;
            transition: var(--transition);
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-image: url('https://images.unsplash.com/photo-1601584115197-04ecc0da31d7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
            position: relative;
            line-height: 1.6;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-bg);
            z-index: -1;
        }

        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 1.25rem 1rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.25rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .logo {
            height: 50px;
            filter: brightness(0) invert(1);
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        h1 {
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin: 0;
            font-weight: 600;
        }

        .subtitle {
            margin: 0.25rem 0 0;
            font-style: italic;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .header-controls {
            position: absolute;
            top: 1.25rem;
            right: 1.25rem;
            display: flex;
            gap: 0.75rem;
        }

        .theme-toggle, .settings-toggle {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: var(--header-text);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.6rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(4px);
            z-index: 10;
        }

        .theme-toggle:hover, .theme-toggle:focus,
        .settings-toggle:hover, .settings-toggle:focus {
            background-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            outline: none;
        }

        .theme-toggle:focus-visible,
        .settings-toggle:focus-visible {
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }

        nav {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .tab-button {
            padding: 0.625rem 1.25rem;
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-button:hover, .tab-button:focus {
            background-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            outline: none;
        }

        .tab-button:focus-visible {
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }

        .tab-button.active {
            background-color: var(--accent-color);
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
            background-color: var(--card-bg);
            border-radius: 12px;
            margin: 1.25rem;
            box-shadow: var(--shadow);
            padding: 1.75rem;
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .dark h2, .dark h3, .dark h4 {
            color: var(--accent-color);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .data-table th, .data-table td {
            border: 1px solid var(--border-color);
            padding: 0.85rem 0.6rem;
            text-align: center;
            background-color: var(--card-bg);
        }

        .data-table th {
            background-color: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
            font-weight: 500;
        }

        /* Responsive tables */
        .table-container {
            overflow-x: auto;
            position: relative;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }

        .table-container::after {
            content: "← Deslize →";
            position: absolute;
            bottom: -24px;
            right: 0;
            font-size: 0.75rem;
            color: var(--text-color);
            opacity: 0.7;
            pointer-events: none;
        }

        @media (min-width: 1200px) {
            .table-container::after {
                display: none;
            }
        }

        /* DataTables styling */
        table.dataTable {
            border-collapse: collapse !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        table.dataTable thead th, table.dataTable thead td {
            border-bottom: 1px solid var(--border-color) !important;
        }

        table.dataTable.no-footer {
            border-bottom: none !important;
        }

        .dataTables_wrapper .dataTables_length, 
        .dataTables_wrapper .dataTables_filter, 
        .dataTables_wrapper .dataTables_info, 
        .dataTables_wrapper .dataTables_processing, 
        .dataTables_wrapper .dataTables_paginate {
            color: var(--text-color) !important;
            margin-bottom: 10px;
        }

        .dataTables_wrapper .dataTables_filter input {
            border: 1px solid var(--input-border) !important;
            background-color: var(--input-bg) !important;
            color: var(--text-color) !important;
            border-radius: 6px !important;
            padding: 6px 10px !important;
            margin-left: 10px !important;
        }

        .dataTables_wrapper .dataTables_length select {
            border: 1px solid var(--input-border) !important;
            background-color: var(--input-bg) !important;
            color: var(--text-color) !important;
            border-radius: 6px !important;
            padding: 4px 8px !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            background-color: var(--bg-tertiary) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 4px !important;
            padding: 6px 12px !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: var(--primary-color) !important;
            color: white !important;
            border: 1px solid var(--primary-dark) !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: var(--accent-color) !important;
            color: white !important;
            border: 1px solid var(--accent-hover) !important;
        }

        input, select, button, textarea {
            font-family: var(--font-family);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 0.95rem;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.15);
        }

        input[readonly] {
            background-color: var(--input-disabled);
            cursor: not-allowed;
            opacity: 0.8;
        }

        .controls {
            margin-bottom: 1.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1.25rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .btn:hover, .btn:focus {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            outline: none;
        }

        .btn:focus-visible {
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: rgba(93, 92, 222, 0.15);
            color: var(--primary-color);
        }

        .btn-secondary:hover, .btn-secondary:focus {
            background-color: rgba(93, 92, 222, 0.25);
        }

        .dark .btn-secondary {
            color: var(--accent-color);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover, .btn-success:focus {
            background-color: var(--success-color);
            filter: brightness(1.1);
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn-warning:hover, .btn-warning:focus {
            background-color: var(--warning-color);
            filter: brightness(1.1);
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover, .btn-danger:focus {
            background-color: var(--danger-color);
            filter: brightness(1.1);
        }

        .btn-outlined {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outlined:hover, .btn-outlined:focus {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-sm {
            padding: 0.35rem 0.75rem;
            font-size: 0.85rem;
        }

        .btn-lg {
            padding: 0.9rem 1.75rem;
            font-size: 1.1rem;
        }

        .section {
            margin-top: 2.5rem;
            padding: 1.75rem;
            background-color: var(--bg-tertiary);
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }

        .transport-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .transport-col {
            padding: 1.75rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .transport-col::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
            opacity: 0.8;
        }

        .transport-col:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .transport-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.85rem;
            align-items: center;
        }

        .transport-row label {
            font-weight: 500;
            margin-right: 0.85rem;
            flex: 1;
        }

        .transport-row input, 
        .transport-row select {
            flex: 1;
        }

        .results {
            margin-top: 1.75rem;
            background-color: var(--card-bg);
            padding: 1.75rem;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.85rem;
            align-items: center;
        }

        .result-row label {
            font-weight: 600;
            margin-right: 0.85rem;
            flex: 2;
        }

        .result-row input {
            flex: 1;
            font-weight: 600;
            color: var(--accent-color);
            text-align: center;
        }

        .equipamentos-tabs {
            display: flex;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .equip-tab-button {
            padding: 0.625rem 1.25rem;
            background-color: rgba(93, 92, 222, 0.15);
            color: var(--primary-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .equip-tab-button:hover, .equip-tab-button:focus {
            background-color: rgba(93, 92, 222, 0.25);
            transform: translateY(-2px);
            outline: none;
        }

        .equip-tab-button:focus-visible {
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.4);
        }

        .equip-tab-button.active {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(0);
        }

        .equip-frente {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }

        .equip-frente.active {
            display: block;
        }

        .equip-results {
            margin-top: 1.75rem;
            background-color: var(--bg-tertiary);
            padding: 1.75rem;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
        }

        .equip-result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.85rem;
            align-items: center;
        }

        .equip-result-row label {
            font-weight: 500;
            margin-right: 0.85rem;
            flex: 2;
        }

        .equip-result-row input {
            flex: 1;
        }

        .hours-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.25rem;
        }

        .hours-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
            padding: 1.25rem;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .hours-row:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .hours-row label {
            font-weight: 500;
            margin-right: 0.85rem;
            flex: 2;
        }

        .hours-row input {
            flex: 1;
        }

        .form-cadastro {
            max-width: 650px;
            margin: 1.5rem auto;
            padding: 1.75rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .form-row {
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
        }

        .form-row label {
            width: 160px;
            font-weight: 500;
            margin-right: 1.25rem;
        }

        .form-row input,
        .form-row select,
        .form-row textarea {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem; /* Increased font size for mobile input fields */
        }

        footer {
            background-color: var(--header-bg);
            color: white;
            text-align: center;
            padding: 1.25rem;
            margin-top: 2.5rem;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-container {
            width: 100%;
            max-width: 850px;
            height: 400px;
            margin: 2.5rem auto;
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            position: relative;
            border: 1px solid rgba(var(--primary-color-rgb), 0.1);
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .multi-chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 1.5rem;
            margin: 2.5rem auto;
        }

        .small-chart-container {
            height: 300px;
            width: 100%;
            background-color: var(--card-bg);
            padding: 1rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            position: relative;
            border: 1px solid rgba(var(--primary-color-rgb), 0.1);
        }

        .small-chart-container:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }

        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid var(--accent-color);
            width: 55px;
            height: 55px;
            animation: spin 1s linear infinite;
            margin-bottom: 1.25rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .grid-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
            margin: 1.5rem 0;
        }

        .dashboard-card {
            background-color: var(--card-bg);
            background-image: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 100%);
            border-radius: 16px;
            padding: 1.8rem;
            box-shadow: var(--shadow-sm);
            text-align: center;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(var(--primary-color-rgb), 0.1);
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            opacity: 0.8;
            transition: height 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
        }

        .dashboard-card:hover::before {
            height: 6px;
        }

        .dashboard-card h3 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            position: relative;
            display: inline-block;
        }

        .dashboard-card h3::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }

        .dashboard-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-color);
            margin: 1.5rem 0 1rem;
            text-shadow: 0 2px 10px rgba(var(--primary-color-rgb), 0.2);
            transition: color 0.3s ease, text-shadow 0.3s ease;
            position: relative;
        }

        .dashboard-card:hover .value {
            text-shadow: 0 4px 12px rgba(var(--primary-color-rgb), 0.3);
        }

        .dashboard-card .label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 0.3px;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            background-color: rgba(var(--primary-color-rgb), 0.08);
            display: inline-block;
        }

        .dashboard-card .trend {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.25rem;
            padding: 0.25rem;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trend-up {
            color: var(--success-color);
            background-color: var(--success-light);
        }

        .trend-down {
            color: var(--danger-color);
            background-color: var(--danger-light);
        }

        .trend-neutral {
            color: var(--info-color);
            background-color: var(--info-light);
        }

        .dashboard-card-lg {
            grid-column: span 2;
        }

        .timestamp {
            text-align: right;
            font-size: 0.85rem;
            margin-top: -0.5rem;
            margin-bottom: 1.25rem;
            font-style: italic;
            color: var(--text-color);
            opacity: 0.7;
        }

        .toast {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background-color: var(--success-color);
            color: white;
            padding: 1.25rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            opacity: 0;
            transform: translateY(100px);
            transition: opacity 0.4s, transform 0.4s;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        .toast::before {
            content: '✓';
            font-weight: bold;
            font-size: 1.1rem;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background-color: var(--danger-color);
        }

        .toast.error::before {
            content: '✕';
        }

        .toast.warning {
            background-color: var(--warning-color);
        }

        .toast.warning::before {
            content: '!';
        }

        .backup-restore {
            margin-top: 1.25rem;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        .storage-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1.25rem;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .storage-status .indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .storage-status .success {
            background-color: var(--success-color);
        }

        .storage-status .error {
            background-color: var(--danger-color);
        }

        .storage-status .warning {
            background-color: var(--warning-color);
        }

        .storage-status-label {
            display: flex;
            align-items: center;
        }

        .auto-backup-toggle {
            white-space: nowrap;
            margin-left: 10px;
            cursor: pointer;
        }

        .auto-backup-toggle input {
            margin-right: 5px;
            width: auto;
        }

        /* Table summary row styling */
        .summary-row {
            background-color: var(--bg-tertiary);
            font-weight: 600;
        }

        .summary-row td {
            border-top: 2px solid var(--border-color);
        }

        /* Accessibility focus styles */
        a:focus, button:focus, input:focus, select:focus, textarea:focus {
            outline: none;
        }

        a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* Empty state styling */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* Progress bar styles */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: var(--bg-tertiary);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 10px;
            background: var(--primary-gradient);
            width: 0;
            transition: width 0.5s ease;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Report generation styles */
        .report-config {
            background-color: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .report-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .report-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .report-preview {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 2rem;
            box-shadow: var(--shadow-sm);
        }

        /* Settings modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalIn 0.3s ease;
            box-shadow: var(--shadow);
        }

        @keyframes modalIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-body {
            padding: 1.25rem;
        }

        .modal-footer {
            padding: 1.25rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-group h4 {
            margin-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding: 0.5rem 0;
        }

        .settings-row label {
            font-weight: 500;
        }

        .settings-row input[type="checkbox"] {
            width: auto;
            height: 16px;
            width: 16px;
        }

        /* Color swatch */
        .color-options {
            display: flex;
            gap: 10px;
            margin-top: 0.5rem;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .color-swatch.active {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        /* History log styles */
        .history-container {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-entry {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .history-entry:last-child {
            border-bottom: none;
        }

        .history-icon {
            font-size: 1.25rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .history-icon.add {
            background-color: var(--success-light);
            color: var(--success-color);
        }

        .history-icon.edit {
            background-color: var(--info-light);
            color: var(--info-color);
        }

        .history-icon.delete {
            background-color: var(--danger-light);
            color: var(--danger-color);
        }

        .history-icon.system {
            background-color: var(--warning-light);
            color: var(--warning-color);
        }

        .history-content {
            flex: 1;
        }

        .history-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .history-time {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        /* Filter controls */
        .filter-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        /* Badge styles */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .badge-primary {
            background-color: var(--primary-light);
            color: white;
        }

        .badge-success {
            background-color: var(--success-color);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .badge-info {
            background-color: var(--info-color);
            color: white;
        }

        /* Print styles */
        @media print {
            body {
                background: none;
                color: #000;
            }
            
            body::before {
                display: none;
            }
            
            header, footer, .controls, .theme-toggle, .tab-button:not(.active) {
                display: none;
            }
            
            .tab-content {
                display: block !important;
                break-inside: avoid;
                page-break-inside: avoid;
                margin: 0;
                padding: 0.5cm;
                box-shadow: none;
            }
            
            .chart-container {
                break-inside: avoid;
                page-break-inside: avoid;
                width: 100%;
            }
            
            input, select {
                border: 1px solid #ddd;
            }
            
            input[readonly] {
                border: none;
            }
        }

        /* Enhanced responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            
            .logo {
                margin-bottom: 0.75rem;
            }
            
            .transport-grid,
            .hours-grid,
            .grid-dashboard {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-row label {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .form-row input,
            .form-row select,
            .form-row textarea {
                width: 100%;
            }

            .header-controls {
                position: static;
                justify-content: center;
                margin-top: 1rem;
            }

            .tab-content,
            .section {
                margin: 1rem 0.75rem;
                padding: 1.25rem;
            }
            
            .storage-status {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .auto-backup-toggle {
                margin-left: 0;
                margin-top: 0.5rem;
            }
            
            .chart-container {
                padding: 1rem;
            }

            .dashboard-card-lg {
                grid-column: span 1;
            }

            .multi-chart-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            nav {
                flex-direction: column;
                align-items: center;
            }
            
            .tab-button {
                margin: 0.25rem 0;
                width: 100%;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .controls button {
                width: 100%;
            }

            .transport-row,
            .result-row,
            .equip-result-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .transport-row label,
            .result-row label,
            .equip-result-row label {
                margin-bottom: 0.5rem;
                width: 100%;
            }

            .transport-row input,
            .result-row input,
            .equip-result-row input,
            .transport-row select {
                width: 100%;
            }
            
            .dashboard-card .value {
                font-size: 1.8rem;
            }
            
            .modal-content {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading" style="display: none;" aria-live="polite" role="status">
        <div class="spinner" aria-hidden="true"></div>
        <div id="loading-message">Carregando...</div>
    </div>
    
    <div id="toast" class="toast" role="alert" aria-live="assertive">
        Dados salvos com sucesso!
    </div>

    <header>
        <div class="header-controls">
            <button id="theme-toggle" class="theme-toggle" aria-label="Alternar tema claro/escuro">
                <i class="fas fa-moon" aria-hidden="true"></i>
            </button>
            <button id="settings-toggle" class="settings-toggle" aria-label="Configurações do sistema">
                <i class="fas fa-cog" aria-hidden="true"></i>
            </button>
        </div>
        <div class="header-content">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDY0IDI1NkEyMDggMjA4IDAgMSAxIDQ4IDI1NmEyMDggMjA4IDAgMSAxIDQxNiAwek0wIDI1NmEyNTYgMjU2IDAgMSAwIDUxMiAwQTI1NiAyNTYgMCAxIDAgMCAyNTZ6TTIzMiAzMzZoNDhjOC44IDAgMTYtNy4yIDE2LTE2VjE5MmMwLTguOC03LjItMTYtMTYtMTZIMjMyYy04LjggMC0xNiA3LjItMTYgMTZ2MTI4YzAgOC44IDcuMiAxNiAxNiAxNHoiIGZpbGw9IndoaXRlIi8+PC9zdmc+" alt="Usina Icone" class="logo">
            <div>
                <h1>Potencial Colheita e Transporte Safra 2025</h1>
                <p class="subtitle">Usina Cambuí Açúcar & Álcool</p>
            </div>
        </div>
        <nav>
            <button class="tab-button active" data-tab="dashboard" aria-selected="true">
                <i class="fas fa-chart-line" aria-hidden="true"></i> Dashboard
            </button>
            <button class="tab-button" data-tab="potencial" aria-selected="false">
                <i class="fas fa-calculator" aria-hidden="true"></i> Potencial
            </button>
            <button class="tab-button" data-tab="frentes" aria-selected="false">
                <i class="fas fa-truck-moving" aria-hidden="true"></i> Dados Frentes
            </button>
            <button class="tab-button" data-tab="equipamentos" aria-selected="false">
                <i class="fas fa-tractor" aria-hidden="true"></i> Dados Equipamentos
            </button>
            <button class="tab-button" data-tab="cadastrar" aria-selected="false">
                <i class="fas fa-plus-circle" aria-hidden="true"></i> Cadastrar Frente
            </button>
            <button class="tab-button" data-tab="relatorios" aria-selected="false">
                <i class="fas fa-file-alt" aria-hidden="true"></i> Relatórios
            </button>
            <button class="tab-button" data-tab="historico" aria-selected="false">
                <i class="fas fa-history" aria-hidden="true"></i> Histórico
            </button>
        </nav>
    </header>

    <main>
        <!-- Tab Dashboard -->
        <div id="dashboard" class="tab-content active" role="tabpanel" aria-labelledby="tab-dashboard">
            <h2>Dashboard Colheita e Transporte</h2>
            <div id="lastUpdated" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="storage-status">
                <div class="storage-status-label">
                    <span class="indicator" id="storage-indicator"></span>
                    <span id="storage-status-text">Verificando armazenamento...</span>
                </div>
                <div class="auto-backup-toggle">
                    <label for="auto-backup-toggle">
                        <input type="checkbox" id="auto-backup-toggle" checked>
                        Backup automático
                    </label>
                </div>
            </div>
            
            <div class="grid-dashboard">
                <div class="dashboard-card">
                    <div class="trend trend-up"><i class="fas fa-arrow-up"></i></div>
                    <h3>Cota Total</h3>
                    <div id="dashboard-cota" class="value">0</div>
                    <div class="label">Toneladas</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="cota-progress" style="width: 45%"></div>
                    </div>
                    <div class="progress-label">
                        <span>45% da meta</span>
                        <span>Meta: 15.000</span>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="trend trend-up"><i class="fas fa-arrow-up"></i></div>
                    <h3>Potencial Colheita</h3>
                    <div id="dashboard-colheita" class="value">0</div>
                    <div class="label">Toneladas/Hora</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="colheita-progress" style="width: 60%"></div>
                    </div>
                    <div class="progress-label">
                        <span>60% do projetado</span>
                        <span>Meta: 600</span>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="trend trend-down"><i class="fas fa-arrow-down"></i></div>
                    <h3>Potencial Transporte</h3>
                    <div id="dashboard-transporte" class="value">0</div>
                    <div class="label">Toneladas/Hora</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="transporte-progress" style="width: 40%"></div>
                    </div>
                    <div class="progress-label">
                        <span>40% do projetado</span>
                        <span>Meta: 550</span>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="trend trend-neutral"><i class="fas fa-minus"></i></div>
                    <h3>Caminhões Disponíveis</h3>
                    <div id="dashboard-caminhoes" class="value">0</div>
                    <div class="label">Total</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="caminhoes-progress" style="width: 75%"></div>
                    </div>
                    <div class="progress-label">
                        <span>75% da frota</span>
                        <span>Total: 60</span>
                    </div>
                </div>
            </div>

            <div class="multi-chart-container">
                <div class="small-chart-container">
                    <canvas id="colheitaComparativoChart"></canvas>
                </div>
                <div class="small-chart-container">
                    <canvas id="colheitaHistoricoChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="potencialChart"></canvas>
            </div>
            
            <div class="multi-chart-container">
                <div class="small-chart-container">
                    <canvas id="transporteChart"></canvas>
                </div>
                <div class="small-chart-container">
                    <canvas id="eficienciaChart"></canvas>
                </div>
            </div>

            <div class="section">
                <h3>Resumo de Frentes</h3>
                <div class="table-container">
                    <table id="resumo-frentes-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Frente</th>
                                <th>Cota (t)</th>
                                <th>Produção Atual (t/h)</th>
                                <th>Capacidade (%)</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h3>Backup e Restauração</h3>
                <p>Faça o backup completo de todos os dados do sistema ou restaure a partir de um arquivo de backup.</p>
                
                <div class="backup-restore">
                    <button id="backup-all" class="btn">
                        <i class="fas fa-download" aria-hidden="true"></i> Exportar Backup Completo
                    </button>
                    <button id="restore-all" class="btn">
                        <i class="fas fa-upload" aria-hidden="true"></i> Restaurar Backup
                    </button>
                    <input type="file" id="file-restore-all" accept=".json" style="display: none;">
                </div>
            </div>
        </div>

        <!-- Tab Potencial -->
        <div id="potencial" class="tab-content" role="tabpanel" aria-labelledby="tab-potencial">
            <h2>Potencial de Colheita e Transporte</h2>
            <div id="lastUpdatedPotencial" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="calc-potencial" class="btn">
                    <i class="fas fa-calculator" aria-hidden="true"></i> Calcular
                </button>
                <button id="save-all-potencial" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="export-potencial" class="btn btn-secondary">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar CSV
                </button>
                <button id="import-potencial" class="btn btn-secondary">
                    <i class="fas fa-file-import" aria-hidden="true"></i> Importar CSV
                </button>
                <input type="file" id="file-import-potencial" accept=".csv" style="display: none;">
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="potencial-filter-frente">Filtrar por Frente:</label>
                    <select id="potencial-filter-frente">
                        <option value="">Todas as Frentes</option>
                        <!-- Opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="potencial-filter-transporte">Filtrar por Transporte:</label>
                    <select id="potencial-filter-transporte">
                        <option value="">Todos os Tipos</option>
                        <option value="P">Próprio</option>
                        <option value="T">Terceiro</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="potencial-sort">Ordenar por:</label>
                    <select id="potencial-sort">
                        <option value="frente">Frente</option>
                        <option value="cota">Cota</option>
                        <option value="limitante">Potencial Limitante</option>
                        <option value="frota">Frota</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table id="potencial-table" class="data-table">
                    <thead>
                        <tr>
                            <th rowspan="2">FRENTE</th>
                            <th rowspan="2">COTA (t/h)</th>
                            <th colspan="3">POTENCIAL DE COLHEITA (t/h)</th>
                            <th rowspan="2">ESTRATÉGIA CONTROLE</th>
                            <th rowspan="2">TEMPO CICLO</th>
                            <th rowspan="2">CAM/H</th>
                            <th rowspan="2">FROTA</th>
                            <th rowspan="2">INT ALOC (min)</th>
                            <th rowspan="2">STATUS</th>
                        </tr>
                        <tr>
                            <th>Máquinas</th>
                            <th>Tratores</th>
                            <th>Limitante</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                    <tfoot>
                        <tr class="summary-row">
                            <td>TOTAL</td>
                            <td><input type="text" id="potencial-total-cota" readonly></td>
                            <td><input type="text" id="potencial-total-maquinas" readonly></td>
                            <td><input type="text" id="potencial-total-tratores" readonly></td>
                            <td><input type="text" id="potencial-total-limitante" readonly></td>
                            <td><input type="text" id="potencial-total-estrategia" readonly></td>
                            <td><input type="text" id="potencial-total-tempo" readonly></td>
                            <td><input type="text" id="potencial-total-camh" readonly></td>
                            <td><input type="text" id="potencial-total-frota" readonly></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="section">
                <h3>Frota de Transporte</h3>
                <div class="transport-grid">
                    <div class="transport-col">
                        <h4>CAMINHÕES PRÓPRIOS</h4>
                        <div class="transport-row">
                            <label for="proprios-total">Total:</label>
                            <input type="number" id="proprios-total" value="20" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="proprios-parados">Parados:</label>
                            <input type="number" id="proprios-parados" value="5" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="proprios-disponiveis">Disponíveis:</label>
                            <input type="text" id="proprios-disponiveis" readonly>
                        </div>
                        <div class="transport-row">
                            <label for="proprios-necessarios">Necessários:</label>
                            <input type="text" id="proprios-necessarios" readonly>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="proprios-progress" style="width: 0%"></div>
                        </div>
                        <div class="progress-label">
                            <span id="proprios-progress-label">0% disponível</span>
                        </div>
                    </div>

                    <div class="transport-col">
                        <h4>CAMINHÕES TERCEIROS</h4>
                        <div class="transport-row">
                            <label for="terceiros-total">Total:</label>
                            <input type="number" id="terceiros-total" value="25" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="terceiros-parados">Parados:</label>
                            <input type="number" id="terceiros-parados" value="5" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="terceiros-disponiveis">Disponíveis:</label>
                            <input type="text" id="terceiros-disponiveis" readonly>
                        </div>
                        <div class="transport-row">
                            <label for="terceiros-necessarios">Necessários:</label>
                            <input type="text" id="terceiros-necessarios" readonly>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="terceiros-progress" style="width: 0%"></div>
                        </div>
                        <div class="progress-label">
                            <span id="terceiros-progress-label">0% disponível</span>
                        </div>
                    </div>

                    <div class="transport-col">
                        <h4>CONJUNTOS DE BV</h4>
                        <div class="transport-row">
                            <label for="bv-total">Total:</label>
                            <input type="number" id="bv-total" value="43" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="bv-parados">Parados:</label>
                            <input type="number" id="bv-parados" value="15" min="0">
                        </div>
                        <div class="transport-row">
                            <label for="bv-disponiveis">Disponíveis:</label>
                            <input type="text" id="bv-disponiveis" readonly>
                        </div>
                        <div class="transport-row">
                            <label for="bv-necessarios">Necessários:</label>
                            <input type="text" id="bv-necessarios" readonly>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="bv-progress" style="width: 0%"></div>
                        </div>
                        <div class="progress-label">
                            <span id="bv-progress-label">0% disponível</span>
                        </div>
                    </div>
                </div>

                <div class="results">
                    <div class="result-row">
                        <label for="potencial-colheita">POTENCIAL DE COLHEITA:</label>
                        <input type="text" id="potencial-colheita" readonly>
                    </div>
                    <div class="result-row">
                        <label for="potencial-transporte">POTENCIAL DE TRANSPORTE:</label>
                        <input type="text" id="potencial-transporte" readonly>
                    </div>
                    <div class="result-row">
                        <label for="limitante-sistema">FATOR LIMITANTE DO SISTEMA:</label>
                        <input type="text" id="limitante-sistema" readonly>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Frentes -->
        <div id="frentes" class="tab-content" role="tabpanel" aria-labelledby="tab-frentes">
            <h2>Dados das Frentes</h2>
            <div id="lastUpdatedFrentes" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="save-all-frentes" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="export-frentes" class="btn btn-secondary">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar CSV
                </button>
                <button id="import-frentes" class="btn btn-secondary">
                    <i class="fas fa-file-import" aria-hidden="true"></i> Importar CSV
                </button>
                <button id="compare-frentes" class="btn btn-secondary">
                    <i class="fas fa-balance-scale" aria-hidden="true"></i> Comparar Frentes
                </button>
                <input type="file" id="file-import-frentes" accept=".csv" style="display: none;">
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="frentes-filter-id">Filtrar por ID:</label>
                    <input type="text" id="frentes-filter-id" placeholder="Ex: 4001">
                </div>
                <div class="filter-group">
                    <label for="frentes-filter-transporte">Filtrar por Transporte:</label>
                    <select id="frentes-filter-transporte">
                        <option value="">Todos os Tipos</option>
                        <option value="P">Próprio</option>
                        <option value="T">Terceiro</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="frentes-sort">Ordenar por:</label>
                    <select id="frentes-sort">
                        <option value="frente">Frente</option>
                        <option value="cota">Cota</option>
                        <option value="dist">Distância</option>
                        <option value="tempo">Tempo Total</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table id="frentes-table" class="data-table">
                    <thead>
                        <tr>
                            <th rowspan="2">FRENTE</th>
                            <th rowspan="2">COTA</th>
                            <th rowspan="2">DIST (KM)</th>
                            <th colspan="4">TEMPO CICLO CAMINHÃO (min)</th>
                            <th rowspan="2">TOTAL</th>
                            <th rowspan="2">HORAS</th>
                            <th rowspan="2">CICLO</th>
                            <th rowspan="2">CONJ BV</th>
                            <th rowspan="2">PESO (t)</th>
                            <th rowspan="2">TRANSPORTE</th>
                            <th rowspan="2">AÇÕES</th>
                        </tr>
                        <tr>
                            <th>IDA</th>
                            <th>CAMPO</th>
                            <th>VOLTA</th>
                            <th>USINA</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Preenchido dinamicamente -->
                    </tbody>
                    <tfoot>
                        <tr class="summary-row">
                            <td>TOTAL=</td>
                            <td><input type="text" id="frentes-total-cota" readonly></td>
                            <td><input type="text" id="frentes-media-dist" readonly></td>
                            <td><input type="text" id="frentes-media-ida" readonly></td>
                            <td><input type="text" id="frentes-media-campo" readonly></td>
                            <td><input type="text" id="frentes-media-volta" readonly></td>
                            <td><input type="text" id="frentes-media-usina" readonly></td>
                            <td><input type="text" id="frentes-media-total" readonly></td>
                            <td>CICLO</td>
                            <td><input type="text" id="frentes-media-ciclo" readonly></td>
                            <td></td>
                            <td>DENS</td>
                            <td><input type="text" id="frentes-media-dens" readonly></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="section">
                <h3>Horas Trabalhadas</h3>
                <div class="hours-grid">
                    <div class="hours-row">
                        <label for="horas-prop-4001">HORAS TRABALHADAS PROP 4001:</label>
                        <input type="number" id="horas-prop-4001" value="21" min="0">
                    </div>
                    <div class="hours-row">
                        <label for="horas-prop-4002">HORAS TRABALHADAS PROP 4002:</label>
                        <input type="number" id="horas-prop-4002" value="21" min="0">
                    </div>
                    <div class="hours-row">
                        <label for="horas-terc">HORAS TRABALHADAS TERC:</label>
                        <input type="number" id="horas-terc" value="22" min="0">
                    </div>
                </div>
                <p>(descontando as trocas de turno)</p>
            </div>

            <div class="section">
                <h3>Análise de Tempos</h3>
                <div class="chart-container">
                    <canvas id="tempoCicloChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab Equipamentos -->
        <div id="equipamentos" class="tab-content" role="tabpanel" aria-labelledby="tab-equipamentos">
            <h2>Dados de Equipamentos</h2>
            <div id="lastUpdatedEquipamentos" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="save-all-equipamentos" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="export-equipamentos" class="btn btn-secondary">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar CSV
                </button>
                <button id="import-equipamentos" class="btn btn-secondary">
                    <i class="fas fa-file-import" aria-hidden="true"></i> Importar CSV
                </button>
                <button id="add-equipamento" class="btn btn-secondary">
                    <i class="fas fa-plus" aria-hidden="true"></i> Adicionar Equipamento
                </button>
                <input type="file" id="file-import-equipamentos" accept=".csv" style="display: none;">
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="equipamentos-filter-frente">Filtrar por Frente:</label>
                    <select id="equipamentos-filter-frente">
                        <option value="">Todas as Frentes</option>
                        <!-- Opções serão preenchidas dinamicamente -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="equipamentos-filter-disponivel">Filtrar por Disponibilidade:</label>
                    <select id="equipamentos-filter-disponivel">
                        <option value="">Todos</option>
                        <option value="1">Disponíveis</option>
                        <option value="0">Indisponíveis</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="equipamentos-sort">Ordenar por:</label>
                    <select id="equipamentos-sort">
                        <option value="frente">Frente</option>
                        <option value="equipo">Equipamento</option>
                        <option value="producao">Produção</option>
                    </select>
                </div>
            </div>
            
            <div class="equipamentos-tabs" role="tablist">
                <!-- Tabs serão preenchidas dinamicamente -->
            </div>

            <div id="equipamentos-content" class="equipamentos-content">
                <!-- Conteúdo será preenchido dinamicamente -->
            </div>

            <div class="section">
                <h3>Análise de Produtividade</h3>
                <div class="chart-container">
                    <canvas id="produtividadeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab Cadastrar -->
        <div id="cadastrar" class="tab-content" role="tabpanel" aria-labelledby="tab-cadastrar">
            <h2>Cadastrar Nova Frente</h2>
            <div id="lastUpdatedCadastrar" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="controls">
                <button id="add-frente" class="btn">
                    <i class="fas fa-plus-circle" aria-hidden="true"></i> Adicionar Frente
                </button>
                <button id="save-all-cadastrar" class="btn">
                    <i class="fas fa-save" aria-hidden="true"></i> Salvar Dados
                </button>
                <button id="reset-form-cadastrar" class="btn btn-secondary">
                    <i class="fas fa-undo" aria-hidden="true"></i> Limpar Formulário
                </button>
            </div>
            
            <div class="form-cadastro">
                <div class="form-row">
                    <label for="nova-frente-id">ID da Frente:</label>
                    <input type="text" id="nova-frente-id" placeholder="Ex: 4010">
                </div>
                <div class="form-row">
                    <label for="nova-frente-cota">Cota (t):</label>
                    <input type="number" id="nova-frente-cota" min="0" value="0">
                </div>
                <div class="form-row">
                    <label for="nova-frente-dist">Distância (km):</label>
                    <input type="number" id="nova-frente-dist" min="0" step="0.1" value="0">
                </div>
                <div class="form-row">
                    <label for="nova-frente-transporte">Tipo de Transporte:</label>
                    <select id="nova-frente-transporte">
                        <option value="P">Próprio</option>
                        <option value="T">Terceiro</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="nova-frente-peso">Peso (t):</label>
                    <input type="number" id="nova-frente-peso" min="0" value="60">
                </div>
                <div class="form-row">
                    <label for="nova-frente-obs">Observações:</label>
                    <textarea id="nova-frente-obs" rows="3" placeholder="Informações adicionais sobre a frente..."></textarea>
                </div>
            </div>

            <div class="section">
                <h3>Frentes Recentemente Cadastradas</h3>
                <div class="table-container">
                    <table id="recentes-frentes-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Frente</th>
                                <th>Cota (t)</th>
                                <th>Distância (km)</th>
                                <th>Transporte</th>
                                <th>Data Cadastro</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Relatórios -->
        <div id="relatorios" class="tab-content" role="tabpanel" aria-labelledby="tab-relatorios">
            <h2>Relatórios</h2>
            <div id="lastUpdatedRelatorios" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="report-config">
                <h3>Configurar Relatório</h3>
                <div class="report-form">
                    <div class="form-group">
                        <label for="report-type">Tipo de Relatório:</label>
                        <select id="report-type">
                            <option value="potencial">Potencial de Colheita</option>
                            <option value="frentes">Dados das Frentes</option>
                            <option value="equipamentos">Dados dos Equipamentos</option>
                            <option value="transporte">Análise de Transporte</option>
                            <option value="completo">Relatório Completo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-frente">Filtrar por Frente:</label>
                        <select id="report-frente">
                            <option value="">Todas as Frentes</option>
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-format">Formato de Saída:</label>
                        <select id="report-format">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="html">HTML</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-date-range">Período:</label>
                        <select id="report-date-range">
                            <option value="today">Hoje</option>
                            <option value="week">Última Semana</option>
                            <option value="month">Último Mês</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                </div>
                <div class="report-options">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="report-include-charts" checked>
                            Incluir Gráficos
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="report-include-summary" checked>
                            Incluir Resumo Executivo
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="report-include-comparison">
                            Incluir Comparação com Período Anterior
                        </label>
                    </div>
                </div>
                <div class="controls">
                    <button id="generate-report" class="btn">
                        <i class="fas fa-file-alt" aria-hidden="true"></i> Gerar Relatório
                    </button>
                    <button id="print-report" class="btn btn-secondary">
                        <i class="fas fa-print" aria-hidden="true"></i> Imprimir
                    </button>
                    <button id="save-report-config" class="btn btn-secondary">
                        <i class="fas fa-save" aria-hidden="true"></i> Salvar Configuração
                    </button>
                </div>
            </div>
            
            <div class="report-preview" id="report-preview">
                <h3>Prévia do Relatório</h3>
                <p>Configure e gere um relatório para visualizar a prévia aqui.</p>
            </div>
            
            <div class="section">
                <h3>Relatórios Salvos</h3>
                <div class="table-container">
                    <table id="saved-reports-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Data Geração</th>
                                <th>Gerado Por</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Relatório Mensal - Junho/2025</td>
                                <td>Completo</td>
                                <td>05/07/2025</td>
                                <td>Administrador</td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-download"></i></button>
                                    <button class="btn btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>Frente 4001 - Análise</td>
                                <td>Potencial de Colheita</td>
                                <td>01/07/2025</td>
                                <td>Administrador</td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-download"></i></button>
                                    <button class="btn btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>Análise de Equipamentos - Semana 26</td>
                                <td>Dados dos Equipamentos</td>
                                <td>28/06/2025</td>
                                <td>Administrador</td>
                                <td>
                                    <button class="btn btn-sm"><i class="fas fa-download"></i></button>
                                    <button class="btn btn-sm"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Histórico -->
        <div id="historico" class="tab-content" role="tabpanel" aria-labelledby="tab-historico">
            <h2>Histórico de Alterações</h2>
            <div id="lastUpdatedHistorico" class="timestamp">Última atualização: --/--/---- --:--:--</div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="history-filter-type">Filtrar por Tipo:</label>
                    <select id="history-filter-type">
                        <option value="">Todos os Tipos</option>
                        <option value="add">Inclusão</option>
                        <option value="edit">Alteração</option>
                        <option value="delete">Exclusão</option>
                        <option value="system">Sistema</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="history-filter-entity">Filtrar por Entidade:</label>
                    <select id="history-filter-entity">
                        <option value="">Todas as Entidades</option>
                        <option value="frente">Frente</option>
                        <option value="equipamento">Equipamento</option>
                        <option value="transporte">Transporte</option>
                        <option value="dados">Dados</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="history-filter-date">Período:</label>
                    <select id="history-filter-date">
                        <option value="today">Hoje</option>
                        <option value="yesterday">Ontem</option>
                        <option value="week">Última Semana</option>
                        <option value="month">Último Mês</option>
                    </select>
                </div>
            </div>
            
            <div class="history-container" id="history-container">
                <!-- Entradas serão preenchidas dinamicamente -->
            </div>
            
            <div class="section">
                <h3>Estatísticas de Alterações</h3>
                <div class="chart-container">
                    <canvas id="historyChart"></canvas>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Modal de Configurações -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configurações do Sistema</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <h4>Aparência</h4>
                    <div class="settings-row">
                        <label for="settings-theme">Tema</label>
                        <select id="settings-theme">
                            <option value="auto">Automático (Sistema)</option>
                            <option value="light">Claro</option>
                            <option value="dark">Escuro</option>
                        </select>
                    </div>
                    <div class="settings-row">
                        <label>Cor principal</label>
                        <div class="color-options">
                            <div class="color-swatch active" style="background-color: #3949ab;" data-color="blue"></div>
                            <div class="color-swatch" style="background-color: #26a69a;" data-color="teal"></div>
                            <div class="color-swatch" style="background-color: #5d4037;" data-color="brown"></div>
                            <div class="color-swatch" style="background-color: #7b1fa2;" data-color="purple"></div>
                            <div class="color-swatch" style="background-color: #00897b;" data-color="green"></div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Tabelas</h4>
                    <div class="settings-row">
                        <label for="settings-rows-per-page">Linhas por página</label>
                        <select id="settings-rows-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <div class="settings-row">
                        <label for="settings-enable-filters">Habilitar filtros avançados</label>
                        <input type="checkbox" id="settings-enable-filters" checked>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Armazenamento</h4>
                    <div class="settings-row">
                        <label for="settings-auto-save">Auto-salvar alterações</label>
                        <input type="checkbox" id="settings-auto-save" checked>
                    </div>
                    <div class="settings-row">
                        <label for="settings-backup-interval">Intervalo de backup automático</label>
                        <select id="settings-backup-interval">
                            <option value="5">5 minutos</option>
                            <option value="10">10 minutos</option>
                            <option value="15">15 minutos</option>
                            <option value="30">30 minutos</option>
                            <option value="60">1 hora</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Gráficos</h4>
                    <div class="settings-row">
                        <label for="settings-chart-animations">Animações</label>
                        <input type="checkbox" id="settings-chart-animations" checked>
                    </div>
                    <div class="settings-row">
                        <label for="settings-chart-labels">Exibir rótulos nos gráficos</label>
                        <input type="checkbox" id="settings-chart-labels" checked>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="settings-reset" class="btn btn-secondary">Restaurar Padrões</button>
                <button id="settings-save" class="btn">Salvar Configurações</button>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Sistema de Gestão de Colheita - Usina Cambuí Açúcar & Álcool (Ass: Gutemberg Gomes) © 2025</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se as bibliotecas necessárias estão disponíveis
            const requiredLibraries = {
                'jQuery': typeof jQuery !== 'undefined',
                'Chart': typeof Chart !== 'undefined',
                'ChartDataLabels': typeof ChartDataLabels !== 'undefined',
                'DataTable': typeof $.fn?.DataTable !== 'undefined'
            };
            
            const missingLibraries = Object.entries(requiredLibraries)
                .filter(([_, loaded]) => !loaded)
                .map(([name]) => name);
                
            if (missingLibraries.length > 0) {
                console.warn(`Algumas bibliotecas não foram carregadas: ${missingLibraries.join(', ')}. Tentando carregar bibliotecas essenciais...`);
                
                // Tentar carregar jQuery se estiver faltando (outros dependem dele)
                if (!requiredLibraries['jQuery']) {
                    const script = document.createElement('script');
                    script.src = 'https://code.jquery.com/jquery-3.6.0.min.js';
                    script.onload = initializeApplication;
                    document.head.appendChild(script);
                    return;
                }
            }
            
            // Se chegou aqui, jQuery está disponível - iniciar a aplicação
            initializeApplication();
            
            // Função principal de inicialização da aplicação
            function initializeApplication() {
                // Namespace para organizar o aplicativo
                const App = {
                    // Armazenamento de dados principal
                    data: {
                        frentes: [
                            { frente: '4001', cota: 3000, dist: 0, ida: 30, campo: 30, volta: 30, usina: 30, transporte: 'P', peso: 60, obs: '', createdAt: new Date().toISOString() },
                            { frente: '4002', cota: 2500, dist: 0, ida: 0, campo: 0, volta: 0, usina: 0, transporte: 'P', peso: 60, obs: '', createdAt: new Date().toISOString() },
                            { frente: '4007', cota: 3500, dist: 0, ida: 0, campo: 0, volta: 0, usina: 0, transporte: 'T', peso: 60, obs: '', createdAt: new Date().toISOString() },
                            { frente: '4009', cota: 3500, dist: 0, ida: 0, campo: 0, volta: 0, usina: 0, transporte: 'T', peso: 60, obs: '', createdAt: new Date().toISOString() }
                        ],
                        equipamentos: {
                            '4001': [
                                { equipo: 'COLHEDORA 1', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 2', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 3', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 4', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 5', carreg: 0, aux: 0, disponivel: 1, producao: 0 }
                            ],
                            '4002': [
                                { equipo: 'COLHEDORA 1', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 2', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 3', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 4', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 5', carreg: 0, aux: 0, disponivel: 1, producao: 0 }
                            ],
                            '4007': [
                                { equipo: 'COLHEDORA 1', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 2', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 3', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 4', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 5', carreg: 0, aux: 0, disponivel: 1, producao: 0 }
                            ],
                            '4009': [
                                { equipo: 'COLHEDORA 1', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 2', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 3', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 4', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                                { equipo: 'COLHEDORA 5', carreg: 0, aux: 0, disponivel: 1, producao: 0 }
                            ]
                        },
                        potencial: [],
                        transportes: {
                            propriosTotal: 20,
                            propriosParados: 5,
                            terceirosTotal: 25,
                            terceirosParados: 5,
                            bvTotal: 43,
                            bvParados: 15
                        },
                        horasTrabalhadas: {
                            prop4001: 21,
                            prop4002: 21,
                            terc: 22
                        },
                        relatorios: [
                            { id: 1, nome: 'Relatório Mensal - Junho/2025', tipo: 'Completo', data: '2025-07-05', usuario: 'Administrador' },
                            { id: 2, nome: 'Frente 4001 - Análise', tipo: 'Potencial de Colheita', data: '2025-07-01', usuario: 'Administrador' },
                            { id: 3, nome: 'Análise de Equipamentos - Semana 26', tipo: 'Dados dos Equipamentos', data: '2025-06-28', usuario: 'Administrador' }
                        ],
                        historico: [
                            { id: 1, tipo: 'add', entidade: 'frente', titulo: 'Frente 4001 adicionada', descricao: 'Nova frente cadastrada com cota de 3000 toneladas', data: '2025-06-15T10:30:00', usuario: 'Administrador' },
                            { id: 2, tipo: 'edit', entidade: 'equipamento', titulo: 'Equipamento COLHEDORA 3 alterado', descricao: 'Disponibilidade alterada para Indisponível', data: '2025-06-16T14:15:00', usuario: 'Administrador' },
                            { id: 3, tipo: 'system', entidade: 'dados', titulo: 'Backup automático', descricao: 'Backup completo realizado automaticamente', data: '2025-06-17T09:00:00', usuario: 'Sistema' },
                            { id: 4, tipo: 'delete', entidade: 'frente', titulo: 'Frente 4005 removida', descricao: 'Frente removida do sistema', data: '2025-06-18T11:45:00', usuario: 'Administrador' }
                        ],
                        historicalData: {
                            colheita: [
                                { data: '2025-01-01', valor: 280 },
                                { data: '2025-02-01', valor: 310 },
                                { data: '2025-03-01', valor: 340 },
                                { data: '2025-04-01', valor: 375 },
                                { data: '2025-05-01', valor: 410 },
                                { data: '2025-06-01', valor: 450 }
                            ],
                            transporte: [
                                { data: '2025-01-01', valor: 260 },
                                { data: '2025-02-01', valor: 285 },
                                { data: '2025-03-01', valor: 305 },
                                { data: '2025-04-01', valor: 335 },
                                { data: '2025-05-01', valor: 360 },
                                { data: '2025-06-01', valor: 395 }
                            ]
                        },
                        lastUpdated: new Date().toISOString()
                    },
                    
                    // Gráficos
                    charts: {
                        potencial: null,
                        transporteChart: null,
                        eficienciaChart: null,
                        tempoCicloChart: null,
                        produtividadeChart: null,
                        historyChart: null,
                        colheitaComparativoChart: null,
                        colheitaHistoricoChart: null
                    },
                    
                    // Configurações
                    config: {
                        storage: {
                            useLocalStorage: true,
                            autoBackup: true,
                            backupInterval: 5 * 60 * 1000, // 5 minutos
                            lastBackupTime: null,
                            storageAvailable: false,
                            storageKey: 'safraTransportesData'
                        },
                        ui: {
                            theme: 'auto',
                            colorScheme: 'blue',
                            rowsPerPage: 10,
                            enableFilters: true,
                            chartAnimations: true,
                            chartLabels: true
                        },
                        debounceTime: 300, // ms para debounce de eventos
                        autoSaveDelay: 2000 // ms para autosave após mudanças
                    },
                    
                    // Estado da aplicação
                    state: {
                        lastSaveTime: null,
                        dataChanged: false,
                        pendingSave: null,
                        currentTab: 'dashboard',
                        dataTables: {}
                    },
                    
                    // Inicialização da aplicação
                    init: function() {
                        this.setupTheme();
                        this.setupTabs();
                        this.setupModals();
                        
                        // Inicializar UI com carregamento assíncrono
                        UI.showLoading('Iniciando sistema...');
                        
                        // Verificar armazenamento e carregar dados
                        setTimeout(() => {
                            this.checkStorage();
                            this.loadSavedData();
                            this.loadSettings();
                            
                            // Inicializar componentes da UI após carregar dados
                            UI.initComponents();
                            this.initEventListeners();
                            
                            // Remover carregamento inicial
                            UI.hideLoading();
                        }, 500);
                    },
                    
                    // Configuração de tema claro/escuro
                    setupTheme: function() {
                        // Verificar preferência de tema do sistema
                        const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                        const setThemeByPreference = (isDark) => {
                            if (isDark) {
                                document.documentElement.classList.add('dark');
                                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun" aria-hidden="true"></i>';
                            } else {
                                document.documentElement.classList.remove('dark');
                                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon" aria-hidden="true"></i>';
                            }
                        };
                        
                        // Aplicar tema inicial
                        setThemeByPreference(darkModeMediaQuery.matches);
                        
                        // Ouvir mudanças no esquema de cores do sistema
                        try {
                            // Usar o evento moderno
                            darkModeMediaQuery.addEventListener('change', (e) => {
                                setThemeByPreference(e.matches);
                                // Atualizar gráficos com cores do tema atual
                                this.updateCharts();
                            });
                        } catch (error) {
                            // Fallback para navegadores mais antigos
                            console.warn("MediaQueryList.addEventListener não suportado, usando .addListener como fallback");
                            darkModeMediaQuery.addListener((e) => {
                                setThemeByPreference(e.matches);
                                // Atualizar gráficos com cores do tema atual
                                this.updateCharts();
                            });
                        }
                        
                        // Alternar tema manualmente
                        document.getElementById('theme-toggle').addEventListener('click', () => {
                            document.documentElement.classList.toggle('dark');
                            
                            if (document.documentElement.classList.contains('dark')) {
                                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun" aria-hidden="true"></i>';
                                this.config.ui.theme = 'dark';
                            } else {
                                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon" aria-hidden="true"></i>';
                                this.config.ui.theme = 'light';
                            }
                            
                            // Atualizar gráficos com cores do tema atual
                            this.updateCharts();
                            this.saveSettings();
                        });
                    },
                    
                    // Configuração das abas
                    setupTabs: function() {
                        const tabButtons = document.querySelectorAll('.tab-button');
                        
                        tabButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const tabId = button.getAttribute('data-tab');
                                
                                // Remover classe active de todas as abas e botões
                                document.querySelectorAll('.tab-content').forEach(tab => {
                                    tab.classList.remove('active');
                                    tab.setAttribute('aria-hidden', 'true');
                                });
                                
                                tabButtons.forEach(btn => {
                                    btn.classList.remove('active');
                                    btn.setAttribute('aria-selected', 'false');
                                });
                                
                                // Adicionar classe active à aba atual e botão
                                document.getElementById(tabId).classList.add('active');
                                document.getElementById(tabId).setAttribute('aria-hidden', 'false');
                                button.classList.add('active');
                                button.setAttribute('aria-selected', 'true');
                                
                                // Atualizar estado
                                this.state.currentTab = tabId;
                                
                                // Atualizar UI para a aba selecionada
                                if (tabId === 'dashboard') {
                                    this.updateCharts();
                                } else if (tabId === 'historico') {
                                    UI.updateHistoryList();
                                } else if (tabId === 'frentes') {
                                    // Reinicializar DataTables se existir
                                    if (this.state.dataTables.frentes) {
                                        this.state.dataTables.frentes.columns.adjust().draw();
                                    }
                                } else if (tabId === 'potencial') {
                                    if (this.state.dataTables.potencial) {
                                        this.state.dataTables.potencial.columns.adjust().draw();
                                    }
                                } else if (tabId === 'relatorios') {
                                    if (this.state.dataTables.relatorios) {
                                        this.state.dataTables.relatorios.columns.adjust().draw();
                                    }
                                }
                            });
                        });
                    },
                    
                    // Configuração de modais
                    setupModals: function() {
                        // Modal de Configurações
                        const settingsModal = document.getElementById('settings-modal');
                        const settingsToggle = document.getElementById('settings-toggle');
                        const modalClose = document.querySelector('.modal-close');
                        const saveSettings = document.getElementById('settings-save');
                        const resetSettings = document.getElementById('settings-reset');
                        
                        // Abrir modal
                        settingsToggle.addEventListener('click', () => {
                            settingsModal.style.display = 'flex';
                            this.loadSettingsIntoForm();
                        });
                        
                        // Fechar modal com X
                        modalClose.addEventListener('click', () => {
                            settingsModal.style.display = 'none';
                        });
                        
                        // Fechar modal ao clicar fora
                        settingsModal.addEventListener('click', (e) => {
                            if (e.target === settingsModal) {
                                settingsModal.style.display = 'none';
                            }
                        });
                        
                        // Salvar configurações
                        saveSettings.addEventListener('click', () => {
                            this.saveSettingsFromForm();
                            settingsModal.style.display = 'none';
                            UI.showToast('Configurações salvas com sucesso!');
                        });
                        
                        // Restaurar configurações padrão
                        resetSettings.addEventListener('click', () => {
                            this.resetSettings();
                            this.loadSettingsIntoForm();
                            UI.showToast('Configurações restauradas para os valores padrão.');
                        });
                        
                        // Color swatches
                        document.querySelectorAll('.color-swatch').forEach(swatch => {
                            swatch.addEventListener('click', () => {
                                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                                swatch.classList.add('active');
                            });
                        });
                    },
                    
                    // Carregar configurações no formulário
                    loadSettingsIntoForm: function() {
                        document.getElementById('settings-theme').value = this.config.ui.theme;
                        document.getElementById('settings-rows-per-page').value = this.config.ui.rowsPerPage;
                        document.getElementById('settings-enable-filters').checked = this.config.ui.enableFilters;
                        document.getElementById('settings-auto-save').checked = this.config.storage.autoBackup;
                        document.getElementById('settings-backup-interval').value = this.config.storage.backupInterval / (60 * 1000);
                        document.getElementById('settings-chart-animations').checked = this.config.ui.chartAnimations;
                        document.getElementById('settings-chart-labels').checked = this.config.ui.chartLabels;
                        
                        // Cor selecionada
                        document.querySelectorAll('.color-swatch').forEach(swatch => {
                            swatch.classList.remove('active');
                            if (swatch.dataset.color === this.config.ui.colorScheme) {
                                swatch.classList.add('active');
                            }
                        });
                    },
                    
                    // Salvar configurações do formulário
                    saveSettingsFromForm: function() {
                        this.config.ui.theme = document.getElementById('settings-theme').value;
                        this.config.ui.rowsPerPage = parseInt(document.getElementById('settings-rows-per-page').value);
                        this.config.ui.enableFilters = document.getElementById('settings-enable-filters').checked;
                        this.config.storage.autoBackup = document.getElementById('settings-auto-save').checked;
                        this.config.storage.backupInterval = parseInt(document.getElementById('settings-backup-interval').value) * 60 * 1000;
                        this.config.ui.chartAnimations = document.getElementById('settings-chart-animations').checked;
                        this.config.ui.chartLabels = document.getElementById('settings-chart-labels').checked;
                        
                        // Cor selecionada
                        const activeColorSwatch = document.querySelector('.color-swatch.active');
                        if (activeColorSwatch) {
                            this.config.ui.colorScheme = activeColorSwatch.dataset.color;
                        }
                        
                        // Atualizar tema
                        if (this.config.ui.theme === 'light') {
                            document.documentElement.classList.remove('dark');
                            document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon" aria-hidden="true"></i>';
                        } else if (this.config.ui.theme === 'dark') {
                            document.documentElement.classList.add('dark');
                            document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun" aria-hidden="true"></i>';
                        } else {
                            // Auto - usar preferência do sistema
                            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                                document.documentElement.classList.add('dark');
                                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun" aria-hidden="true"></i>';
                            } else {
                                document.documentElement.classList.remove('dark');
                                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon" aria-hidden="true"></i>';
                            }
                        }
                        
                        // Atualizar configurações de DataTables
                        for (const key in this.state.dataTables) {
                            if (this.state.dataTables[key]) {
                                this.state.dataTables[key].page.len(this.config.ui.rowsPerPage).draw();
                            }
                        }
                        
                        // Atualizar gráficos com novas configurações
                        this.updateCharts();
                        
                        // Salvar configurações
                        this.saveSettings();
                    },
                    
                    // Resetar configurações para valores padrão
                    resetSettings: function() {
                        this.config.ui = {
                            theme: 'auto',
                            colorScheme: 'blue',
                            rowsPerPage: 10,
                            enableFilters: true,
                            chartAnimations: true,
                            chartLabels: true
                        };
                        
                        this.config.storage = {
                            useLocalStorage: true,
                            autoBackup: true,
                            backupInterval: 5 * 60 * 1000,
                            lastBackupTime: null,
                            storageAvailable: this.config.storage.storageAvailable,
                            storageKey: 'safraTransportesData'
                        };
                        
                        // Atualizar tema
                        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                            document.documentElement.classList.add('dark');
                            document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun" aria-hidden="true"></i>';
                        } else {
                            document.documentElement.classList.remove('dark');
                            document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon" aria-hidden="true"></i>';
                        }
                        
                        // Atualizar configurações
                        this.saveSettings();
                    },
                    
                    // Carregar configurações
                    loadSettings: function() {
                        if (this.config.storage.storageAvailable) {
                            try {
                                const savedSettings = localStorage.getItem(this.config.storage.storageKey + '_settings');
                                if (savedSettings) {
                                    const parsedSettings = JSON.parse(savedSettings);
                                    this.config.ui = { ...this.config.ui, ...parsedSettings.ui };
                                    this.config.storage = { 
                                        ...this.config.storage, 
                                        autoBackup: parsedSettings.storage?.autoBackup ?? this.config.storage.autoBackup,
                                        backupInterval: parsedSettings.storage?.backupInterval ?? this.config.storage.backupInterval
                                    };
                                    
                                    // Aplicar tema
                                    if (this.config.ui.theme === 'light') {
                                        document.documentElement.classList.remove('dark');
                                        document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon" aria-hidden="true"></i>';
                                    } else if (this.config.ui.theme === 'dark') {
                                        document.documentElement.classList.add('dark');
                                        document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun" aria-hidden="true"></i>';
                                    }
                                }
                            } catch (error) {
                                console.error('Erro ao carregar configurações:', error);
                            }
                        }
                    },
                    
                    // Salvar configurações
                    saveSettings: function() {
                        if (this.config.storage.storageAvailable) {
                            try {
                                const settingsToSave = {
                                    ui: this.config.ui,
                                    storage: {
                                        autoBackup: this.config.storage.autoBackup,
                                        backupInterval: this.config.storage.backupInterval
                                    }
                                };
                                localStorage.setItem(this.config.storage.storageKey + '_settings', JSON.stringify(settingsToSave));
                            } catch (error) {
                                console.error('Erro ao salvar configurações:', error);
                            }
                        }
                    },
                    
                    // Verificar disponibilidade de armazenamento local
                    checkStorage: function() {
                        try {
                            const testKey = '__storage_test__';
                            localStorage.setItem(testKey, testKey);
                            localStorage.removeItem(testKey);
                            
                            const storageIndicator = document.getElementById('storage-indicator');
                            const storageStatusText = document.getElementById('storage-status-text');
                            
                            storageIndicator.className = 'indicator success';
                            storageStatusText.textContent = 'Armazenamento local disponível';
                            this.config.storage.storageAvailable = true;
                            
                            return true;
                        } catch (e) {
                            const storageIndicator = document.getElementById('storage-indicator');
                            const storageStatusText = document.getElementById('storage-status-text');
                            
                            storageIndicator.className = 'indicator error';
                            storageStatusText.textContent = 'Armazenamento local indisponível - seus dados serão perdidos ao fechar o navegador';
                            this.config.storage.storageAvailable = false;
                            
                            if (this.config.storage.autoBackup) {
                                this.createAutoBackup();
                            }
                            
                            return false;
                        }
                    },
                    
                    // Criar backup automático
                    createAutoBackup: function() {
                        // Não criar backup se o último foi feito há menos do intervalo definido
                        if (this.config.storage.lastBackupTime && 
                            (new Date() - this.config.storage.lastBackupTime) < this.config.storage.backupInterval) {
                            return;
                        }
                        
                        try {
                            const backupData = JSON.stringify(this.data);
                            const blob = new Blob([backupData], { type: 'application/json' });
                            const url = URL.createObjectURL(blob);
                            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                            
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = `backup_auto_colheita_transporte_${timestamp}.json`;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            this.config.storage.lastBackupTime = new Date();
                            
                            // Adicionar ao histórico
                            this.addHistoryEntry({
                                tipo: 'system',
                                entidade: 'dados',
                                titulo: 'Backup automático',
                                descricao: 'Backup completo realizado automaticamente',
                                data: new Date().toISOString(),
                                usuario: 'Sistema'
                            });
                            
                            console.log('Backup automático criado com sucesso');
                            UI.showToast('Backup automático criado com sucesso', 'success');
                        } catch (error) {
                            console.error('Erro ao criar backup automático:', error);
                            UI.showToast('Erro ao criar backup automático: ' + error.message, 'error');
                        }
                    },
                    
                    // Inicializar event listeners
                    initEventListeners: function() {
                        // Adicionar nova frente
                        document.getElementById('add-frente').addEventListener('click', () => DataHandler.addNewFrente());
                        
                        // Botões Salvar Dados em todas as abas
                        document.querySelectorAll('[id^="save-all-"]').forEach(button => {
                            button.addEventListener('click', () => this.saveAllData());
                        });
                        
                        // Calcular potencial
                        document.getElementById('calc-potencial').addEventListener('click', () => {
                            UI.showLoading('Calculando potencial...');
                            
                            setTimeout(() => {
                                try {
                                    DataHandler.calculatePotencial();
                                    UI.updateDashboard();
                                    UI.hideLoading();
                                    UI.showToast('Potencial calculado com sucesso!');
                                    
                                    // Adicionar ao histórico
                                    this.addHistoryEntry({
                                        tipo: 'system',
                                        entidade: 'dados',
                                        titulo: 'Cálculo de potencial',
                                        descricao: 'Potencial de colheita e transporte recalculado',
                                        data: new Date().toISOString(),
                                        usuario: 'Administrador'
                                    });
                                } catch (error) {
                                    console.error('Erro ao calcular potencial:', error);
                                    UI.hideLoading();
                                    UI.showToast('Erro ao calcular potencial: ' + error.message, 'error');
                                }
                            }, this.config.debounceTime);
                        });
                        
                        // Atualizar transportes quando valores mudam
                        document.getElementById('proprios-total').addEventListener('change', () => DataHandler.updateTransportesFromUI());
                        document.getElementById('proprios-parados').addEventListener('change', () => DataHandler.updateTransportesFromUI());
                        document.getElementById('terceiros-total').addEventListener('change', () => DataHandler.updateTransportesFromUI());
                        document.getElementById('terceiros-parados').addEventListener('change', () => DataHandler.updateTransportesFromUI());
                        document.getElementById('bv-total').addEventListener('change', () => DataHandler.updateTransportesFromUI());
                        document.getElementById('bv-parados').addEventListener('change', () => DataHandler.updateTransportesFromUI());
                        
                        // Atualizar horas trabalhadas
                        document.getElementById('horas-prop-4001').addEventListener('change', () => DataHandler.updateHorasTrabalhadasFromUI());
                        document.getElementById('horas-prop-4002').addEventListener('change', () => DataHandler.updateHorasTrabalhadasFromUI());
                        document.getElementById('horas-terc').addEventListener('change', () => DataHandler.updateHorasTrabalhadasFromUI());
                        
                        // Filtros para potencial
                        document.getElementById('potencial-filter-frente').addEventListener('change', () => UI.filterPotencialTable());
                        document.getElementById('potencial-filter-transporte').addEventListener('change', () => UI.filterPotencialTable());
                        document.getElementById('potencial-sort').addEventListener('change', () => UI.filterPotencialTable());
                        
                        // Filtros para frentes
                        document.getElementById('frentes-filter-id').addEventListener('input', () => UI.filterFrentesTable());
                        document.getElementById('frentes-filter-transporte').addEventListener('change', () => UI.filterFrentesTable());
                        document.getElementById('frentes-sort').addEventListener('change', () => UI.filterFrentesTable());
                        
                        // Filtros para equipamentos
                        document.getElementById('equipamentos-filter-frente').addEventListener('change', () => UI.filterEquipamentosTable());
                        document.getElementById('equipamentos-filter-disponivel').addEventListener('change', () => UI.filterEquipamentosTable());
                        document.getElementById('equipamentos-sort').addEventListener('change', () => UI.filterEquipamentosTable());
                        
                        // Filtros para histórico
                        document.getElementById('history-filter-type').addEventListener('change', () => UI.updateHistoryList());
                        document.getElementById('history-filter-entity').addEventListener('change', () => UI.updateHistoryList());
                        document.getElementById('history-filter-date').addEventListener('change', () => UI.updateHistoryList());
                        
                        // Relatórios
                        document.getElementById('generate-report').addEventListener('click', () => UI.generateReport());
                        document.getElementById('print-report').addEventListener('click', () => {
                            window.print();
                        });
                        
                        // Limpar formulário de cadastro
                        document.getElementById('reset-form-cadastrar').addEventListener('click', () => {
                            document.getElementById('nova-frente-id').value = '';
                            document.getElementById('nova-frente-cota').value = '0';
                            document.getElementById('nova-frente-dist').value = '0';
                            document.getElementById('nova-frente-peso').value = '60';
                            document.getElementById('nova-frente-obs').value = '';
                        });
                        
                        // Event delegation para campos editáveis com debounce
                        document.addEventListener('change', this.debounce((e) => {
                            if (e.target.matches('#frentes-table tbody input, #frentes-table tbody select')) {
                                if (e.target.classList.contains('tempo-input')) {
                                    const row = e.target.closest('tr');
                                    DataHandler.updateTempoTotal(row);
                                }
                                DataHandler.updateFrentesDataFromUI();
                                DataHandler.calculatePotencial();
                                UI.updateDashboard();
                                
                                // Adicionar ao histórico
                                this.addHistoryEntry({
                                    tipo: 'edit',
                                    entidade: 'frente',
                                    titulo: 'Dados de frente alterados',
                                    descricao: 'Alteração nos dados de frente',
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                            }
                            
                            if (e.target.matches('.equip-table tbody input, .equip-table tbody select')) {
                                const frente = e.target.closest('.equip-frente').id.replace('equip-', '');
                                DataHandler.updateEquipamentosDataFromUI(frente);
                                DataHandler.calculatePotencial();
                                UI.updateDashboard();
                                
                                // Adicionar ao histórico
                                this.addHistoryEntry({
                                    tipo: 'edit',
                                    entidade: 'equipamento',
                                    titulo: 'Dados de equipamento alterados',
                                    descricao: `Alteração nos dados de equipamento da frente ${frente}`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                            }
                            
                            if (e.target.matches('[id$="-densidade"], [id$="-tratores"]')) {
                                const frente = e.target.id.split('-')[0];
                                DataHandler.updateEquipamentosFrente(frente);
                                DataHandler.calculatePotencial();
                                UI.updateDashboard();
                            }
                            
                            if (e.target.classList.contains('potencial-estrategia')) {
                                DataHandler.calculatePotencial();
                                UI.updateDashboard();
                            }
                        }, 300));
                        
                        // Configuração do backup automático
                        document.getElementById('auto-backup-toggle').addEventListener('change', function() {
                            App.config.storage.autoBackup = this.checked;
                            
                            if (this.checked && !App.config.storage.storageAvailable) {
                                UI.showToast('Backup automático ativado. Seus dados serão baixados automaticamente quando você fizer alterações.', 'warning');
                            }
                        });
                        
                        // Botões de exportação/importação
                        FileHandler.setupExportImportButtons();
                        
                        // Botões de backup/restore
                        FileHandler.setupBackupRestoreButtons();
                        
                        // Ações de frentes (ver, editar, excluir)
                        document.addEventListener('click', (e) => {
                            // Botões de ação para frentes
                            if (e.target.closest('.btn-view-frente')) {
                                const frente = e.target.closest('.btn-view-frente').dataset.frente;
                                this.viewFrenteDetails(frente);
                            }
                            
                            if (e.target.closest('.btn-edit-frente')) {
                                const frente = e.target.closest('.btn-edit-frente').dataset.frente;
                                this.editFrente(frente);
                            }
                            
                            if (e.target.closest('.btn-delete-frente')) {
                                const frente = e.target.closest('.btn-delete-frente').dataset.frente;
                                this.deleteFrente(frente);
                            }
                        });
                        
                        // Comparar frentes
                        document.getElementById('compare-frentes').addEventListener('click', () => {
                            UI.showFrentesComparison();
                        });
                        
                        // Adicionar equipamento
                        document.getElementById('add-equipamento').addEventListener('click', () => {
                            UI.showAddEquipamentoForm();
                        });
                        
                        // Salvar dados antes de sair
                        window.addEventListener('beforeunload', (e) => {
                            this.saveData();
                            if (!this.config.storage.storageAvailable && this.config.storage.autoBackup) {
                                // Forçar um backup final antes de sair
                                this.createAutoBackup();
                            }
                        });
                    },
                    
                    // Adicionar entrada ao histórico
                    addHistoryEntry: function(entry) {
                        const id = this.data.historico.length > 0 ? 
                            Math.max(...this.data.historico.map(h => h.id)) + 1 : 1;
                            
                        const newEntry = {
                            id,
                            ...entry
                        };
                        
                        this.data.historico.unshift(newEntry);
                        
                        // Atualizar a UI do histórico se estiver visível
                        if (this.state.currentTab === 'historico') {
                            UI.updateHistoryList();
                        }
                        
                        // Salvar dados atualizados
                        this.saveData();
                        
                        return newEntry;
                    },
                    
                    // Visualizar detalhes da frente
                    viewFrenteDetails: function(frenteId) {
                        const frente = this.data.frentes.find(f => f.frente === frenteId);
                        if (!frente) {
                            UI.showToast('Frente não encontrada.', 'error');
                            return;
                        }
                        
                        UI.showFrenteDetails(frente);
                    },
                    
                    // Editar frente
                    editFrente: function(frenteId) {
                        const frente = this.data.frentes.find(f => f.frente === frenteId);
                        if (!frente) {
                            UI.showToast('Frente não encontrada.', 'error');
                            return;
                        }
                        
                        // Redirecionar para a aba de cadastro e preencher o formulário
                        document.querySelector('[data-tab="cadastrar"]').click();
                        
                        // Preencher formulário
                        document.getElementById('nova-frente-id').value = frente.frente;
                        document.getElementById('nova-frente-cota').value = frente.cota;
                        document.getElementById('nova-frente-dist').value = frente.dist;
                        document.getElementById('nova-frente-transporte').value = frente.transporte;
                        document.getElementById('nova-frente-peso').value = frente.peso;
                        document.getElementById('nova-frente-obs').value = frente.obs || '';
                        
                        // Alterar o botão para "Atualizar"
                        document.getElementById('add-frente').innerHTML = '<i class="fas fa-save" aria-hidden="true"></i> Atualizar Frente';
                        document.getElementById('add-frente').dataset.mode = 'edit';
                        document.getElementById('add-frente').dataset.originalId = frente.frente;
                    },
                    
                    // Excluir frente
                    deleteFrente: function(frenteId) {
                        if (confirm(`Tem certeza que deseja excluir a frente ${frenteId}? Esta ação não pode ser desfeita.`)) {
                            // Remover a frente dos dados
                            const index = this.data.frentes.findIndex(f => f.frente === frenteId);
                            if (index !== -1) {
                                this.data.frentes.splice(index, 1);
                                
                                // Remover equipamentos da frente
                                delete this.data.equipamentos[frenteId];
                                
                                // Remover potencial da frente
                                if (this.data.potencial && this.data.potencial.length > 0) {
                                    const potIndex = this.data.potencial.findIndex(p => p.frente === frenteId);
                                    if (potIndex !== -1) {
                                        this.data.potencial.splice(potIndex, 1);
                                    }
                                }
                                
                                // Atualizar UI
                                UI.initFrentesTable();
                                UI.initEquipamentosTables();
                                UI.initPotencialTable();
                                DataHandler.calculatePotencial();
                                UI.updateDashboard();
                                
                                // Adicionar ao histórico
                                this.addHistoryEntry({
                                    tipo: 'delete',
                                    entidade: 'frente',
                                    titulo: `Frente ${frenteId} removida`,
                                    descricao: 'Frente removida do sistema',
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                                
                                // Salvar dados
                                this.saveData();
                                
                                UI.showToast(`Frente ${frenteId} excluída com sucesso!`);
                            } else {
                                UI.showToast('Frente não encontrada.', 'error');
                            }
                        }
                    },
                    
                    // Função debounce para limitar a frequência de chamadas de funções
                    debounce: function(func, delay) {
                        let timeout;
                        return function(...args) {
                            clearTimeout(timeout);
                            timeout = setTimeout(() => func.apply(this, args), delay);
                        };
                    },
                    
                    // Carregar dados salvos do armazenamento local
                    loadSavedData: function() {
                        UI.showLoading('Carregando dados salvos...');
                        
                        setTimeout(() => {
                            try {
                                // Verificar se localStorage está disponível
                                if (this.checkStorage()) {
                                    const savedData = localStorage.getItem(this.config.storage.storageKey);
                                    if (savedData) {
                                        try {
                                            const parsedData = JSON.parse(savedData);
                                            
                                            // Atualizar this.data com os dados salvos
                                            if (parsedData.frentes) this.data.frentes = parsedData.frentes;
                                            if (parsedData.equipamentos) this.data.equipamentos = parsedData.equipamentos;
                                            if (parsedData.transportes) this.data.transportes = parsedData.transportes;
                                            if (parsedData.horasTrabalhadas) this.data.horasTrabalhadas = parsedData.horasTrabalhadas;
                                            if (parsedData.potencial) this.data.potencial = parsedData.potencial;
                                            if (parsedData.lastUpdated) this.data.lastUpdated = parsedData.lastUpdated;
                                            if (parsedData.historico) this.data.historico = parsedData.historico;
                                            if (parsedData.relatorios) this.data.relatorios = parsedData.relatorios;
                                            if (parsedData.historicalData) this.data.historicalData = parsedData.historicalData;
                                            
                                            console.log('Dados carregados do localStorage');
                                            
                                            // Atualizar UI
                                            UI.initFrentesTable();
                                            UI.initEquipamentosTables();
                                            UI.initPotencialTable();
                                            UI.initTransportes();
                                            UI.updateTimestamps();
                                            
                                            // Calcular potencial com os dados carregados
                                            setTimeout(() => {
                                                DataHandler.calculatePotencial();
                                                UI.updateDashboard();
                                                UI.hideLoading();
                                            }, 300);
                                        } catch (parseError) {
                                            console.error('Erro ao analisar dados salvos:', parseError);
                                            UI.showToast('Erro ao carregar dados. Usando dados padrão.', 'error');
                                            this.initWithDefaultData();
                                        }
                                    } else {
                                        console.log('Nenhum dado salvo encontrado. Usando dados padrão.');
                                        this.initWithDefaultData();
                                    }
                                } else {
                                    // Se localStorage não estiver disponível, usar dados padrão
                                    console.log('Armazenamento local indisponível. Usando dados padrão.');
                                    UI.showToast('Armazenamento local indisponível. Seus dados não serão salvos automaticamente.', 'warning');
                                    this.initWithDefaultData();
                                }
                            } catch (error) {
                                console.error('Erro ao carregar dados salvos:', error);
                                UI.showToast('Erro ao carregar dados. Usando dados padrão.', 'error');
                                this.initWithDefaultData();
                            }
                        }, this.config.debounceTime);
                    },
                    
                    // Inicializar com dados padrão
                    initWithDefaultData: function() {
                        DataHandler.calculatePotencial();
                        UI.updateDashboard();
                        UI.hideLoading();
                    },
                    
                    // Salvar todos os dados
                    saveAllData: function() {
                        UI.showLoading('Salvando dados...');

                        setTimeout(() => {
                            try {
                                DataHandler.updateFrentesDataFromUI();
                                DataHandler.updateAllEquipamentosData();
                                DataHandler.updateTransportesFromUI();
                                DataHandler.updateHorasTrabalhadasFromUI();
                                DataHandler.calculatePotencial();
                                
                                // Atualizar timestamp
                                this.data.lastUpdated = new Date().toISOString();
                                UI.updateTimestamps();
                                
                                this.saveData();
                                UI.updateDashboard();
                                UI.hideLoading();
                                UI.showToast('Dados salvos com sucesso!');
                                
                                // Adicionar ao histórico
                                this.addHistoryEntry({
                                    tipo: 'system',
                                    entidade: 'dados',
                                    titulo: 'Salvamento manual',
                                    descricao: 'Todos os dados foram salvos manualmente',
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                            } catch (error) {
                                console.error('Erro ao salvar dados:', error);
                                UI.hideLoading();
                                UI.showToast('Erro ao salvar dados: ' + error.message, 'error');
                                
                                // Se ocorrer erro ao salvar no localStorage, force um backup
                                if (this.config.storage.autoBackup) {
                                    this.createAutoBackup();
                                }
                            }
                        }, this.config.debounceTime);
                    },
                    
                    // Salvar dados no armazenamento local
                    saveData: function() {
                        try {
                            // Verificar se localStorage está disponível
                            if (this.config.storage.storageAvailable) {
                                localStorage.setItem(this.config.storage.storageKey, JSON.stringify(this.data));
                                console.log('Dados salvos com sucesso no localStorage');
                                
                                const storageIndicator = document.getElementById('storage-indicator');
                                const storageStatusText = document.getElementById('storage-status-text');
                                
                                storageIndicator.className = 'indicator success';
                                storageStatusText.textContent = 'Armazenamento local disponível e funcionando';
                                
                                return true;
                            } else {
                                // Se o armazenamento não estiver disponível e o backup automático estiver ativado
                                if (this.config.storage.autoBackup) {
                                    const autoBackupToggle = document.getElementById('auto-backup-toggle');
                                    if (autoBackupToggle && autoBackupToggle.checked) {
                                        this.createAutoBackup();
                                    }
                                }
                                
                                const storageIndicator = document.getElementById('storage-indicator');
                                const storageStatusText = document.getElementById('storage-status-text');
                                
                                storageIndicator.className = 'indicator error';
                                storageStatusText.textContent = 'Armazenamento local indisponível - seus dados serão perdidos ao fechar o navegador';
                                
                                return false;
                            }
                        } catch (error) {
                            console.error('Erro ao salvar dados:', error);
                            UI.showToast('Erro ao salvar dados: ' + error.message, 'error');
                            
                            const storageIndicator = document.getElementById('storage-indicator');
                            const storageStatusText = document.getElementById('storage-status-text');
                            
                            storageIndicator.className = 'indicator error';
                            storageStatusText.textContent = 'Erro ao salvar dados: ' + error.message;
                            
                            // Tentar backup automático se ativado
                            if (this.config.storage.autoBackup) {
                                const autoBackupToggle = document.getElementById('auto-backup-toggle');
                                if (autoBackupToggle && autoBackupToggle.checked) {
                                    this.createAutoBackup();
                                }
                            }
                            
                            return false;
                        }
                    },
                    
                    // Atualizar gráficos com os dados atuais
                    updateCharts: function() {
                        // Verificar se os dados de potencial estão disponíveis
                        if (!this.data.potencial || this.data.potencial.length === 0) {
                            DataHandler.calculatePotencial();
                        }
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Registrar plugin de labels se ativado nas configurações
                        if (this.config.ui.chartLabels && typeof ChartDataLabels !== 'undefined' && 
                            Chart.registry && typeof Chart.registry.plugins !== 'undefined') {
                            try {
                                if (Chart.registry.plugins.id('datalabels') === undefined) {
                                    Chart.register(ChartDataLabels);
                                }
                            } catch (error) {
                                console.warn('Não foi possível registrar o plugin ChartDataLabels:', error);
                            }
                        }
                        
                        // Atualizar todos os gráficos
                        UI.updatePotencialChart();
                        UI.updateTransporteChart();
                        UI.updateEfficiencyChart();
                        UI.updateTempoCicloChart();
                        UI.updateProdutividadeChart();
                        UI.updateHistoryChart();
                        UI.updateColheitaComparativoChart();
                        UI.updateColheitaHistoricoChart();
                    }
                };
                
                // Namespace para manipulação de dados
                const DataHandler = {
                    // Criar equipamentos padrão para uma nova frente
                    createDefaultEquipamentos: function(frenteId) {
                        return [
                            { equipo: 'COLHEDORA 1', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                            { equipo: 'COLHEDORA 2', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                            { equipo: 'COLHEDORA 3', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                            { equipo: 'COLHEDORA 4', carreg: 0, aux: 0, disponivel: 1, producao: 0 },
                            { equipo: 'COLHEDORA 5', carreg: 0, aux: 0, disponivel: 1, producao: 0 }
                        ];
                    },
                    
                    // Atualizar tempo total para uma linha da tabela
                    updateTempoTotal: function(row) {
                        const ida = parseFloat(row.querySelector('td:nth-child(4) input').value) || 0;
                        const campo = parseFloat(row.querySelector('td:nth-child(5) input').value) || 0;
                        const volta = parseFloat(row.querySelector('td:nth-child(6) input').value) || 0;
                        const usina = parseFloat(row.querySelector('td:nth-child(7) input').value) || 0;
                        
                        const total = ida + campo + volta + usina;
                        row.querySelector('.total-tempo').value = total.toFixed(2);
                        
                        // Atualizar horas
                        const horas = total / 60;
                        row.querySelector('td:nth-child(9) input').value = horas.toFixed(2);
                        row.querySelector('td:nth-child(10) input').value = horas.toFixed(2);
                    },
                    
                    // Adicionar nova frente
                    addNewFrente: function() {
                        const frenteId = document.getElementById('nova-frente-id').value.trim();
                        const cota = parseFloat(document.getElementById('nova-frente-cota').value) || 0;
                        const dist = parseFloat(document.getElementById('nova-frente-dist').value) || 0;
                        const transporte = document.getElementById('nova-frente-transporte').value;
                        const peso = parseFloat(document.getElementById('nova-frente-peso').value) || 60;
                        const obs = document.getElementById('nova-frente-obs').value.trim();
                        const mode = document.getElementById('add-frente').dataset.mode || 'add';
                        const originalId = document.getElementById('add-frente').dataset.originalId || '';

                        if (!frenteId) {
                            UI.showToast('Por favor, insira um ID para a frente!', 'warning');
                            return;
                        }

                        // Verificação diferente dependendo se é edição ou adição
                        if (mode === 'add' && App.data.frentes.some(f => f.frente === frenteId)) {
                            UI.showToast('Já existe uma frente com este ID!', 'error');
                            return;
                        }

                        UI.showLoading(mode === 'add' ? 'Adicionando nova frente...' : 'Atualizando frente...');

                        setTimeout(() => {
                            try {
                                if (mode === 'edit') {
                                    // Modo de edição
                                    const index = App.data.frentes.findIndex(f => f.frente === originalId);
                                    if (index !== -1) {
                                        // Se o ID da frente foi alterado, atualizar também equipamentos
                                        if (originalId !== frenteId) {
                                            App.data.equipamentos[frenteId] = [...App.data.equipamentos[originalId]];
                                            delete App.data.equipamentos[originalId];
                                        }
                                        
                                        // Atualizar dados da frente
                                        App.data.frentes[index] = {
                                            frente: frenteId,
                                            cota: cota,
                                            dist: dist,
                                            ida: App.data.frentes[index].ida,
                                            campo: App.data.frentes[index].campo,
                                            volta: App.data.frentes[index].volta,
                                            usina: App.data.frentes[index].usina,
                                            transporte: transporte,
                                            peso: peso,
                                            obs: obs,
                                            createdAt: App.data.frentes[index].createdAt || new Date().toISOString(),
                                            updatedAt: new Date().toISOString()
                                        };
                                        
                                        // Adicionar ao histórico
                                        App.addHistoryEntry({
                                            tipo: 'edit',
                                            entidade: 'frente',
                                            titulo: `Frente ${frenteId} atualizada`,
                                            descricao: `Frente atualizada com cota de ${cota} toneladas`,
                                            data: new Date().toISOString(),
                                            usuario: 'Administrador'
                                        });
                                        
                                        // Resetar modo do botão
                                        document.getElementById('add-frente').innerHTML = '<i class="fas fa-plus-circle" aria-hidden="true"></i> Adicionar Frente';
                                        document.getElementById('add-frente').dataset.mode = 'add';
                                        delete document.getElementById('add-frente').dataset.originalId;
                                        
                                        UI.showToast(`Frente ${frenteId} atualizada com sucesso!`);
                                    } else {
                                        UI.showToast('Frente original não encontrada!', 'error');
                                    }
                                } else {
                                    // Modo de adição
                                    const newFrente = {
                                        frente: frenteId,
                                        cota: cota,
                                        dist: dist,
                                        ida: 0,
                                        campo: 0,
                                        volta: 0,
                                        usina: 0,
                                        transporte: transporte,
                                        peso: peso,
                                        obs: obs,
                                        createdAt: new Date().toISOString()
                                    };
                                    
                                    App.data.frentes.push(newFrente);
                                    App.data.equipamentos[frenteId] = this.createDefaultEquipamentos(frenteId);
                                    
                                    // Adicionar ao histórico
                                    App.addHistoryEntry({
                                        tipo: 'add',
                                        entidade: 'frente',
                                        titulo: `Frente ${frenteId} adicionada`,
                                        descricao: `Nova frente cadastrada com cota de ${cota} toneladas`,
                                        data: new Date().toISOString(),
                                        usuario: 'Administrador'
                                    });
                                    
                                    UI.showToast(`Frente ${frenteId} cadastrada com sucesso!`);
                                }
                                
                                // Limpar formulário
                                document.getElementById('nova-frente-id').value = '';
                                document.getElementById('nova-frente-cota').value = '0';
                                document.getElementById('nova-frente-dist').value = '0';
                                document.getElementById('nova-frente-peso').value = '60';
                                document.getElementById('nova-frente-obs').value = '';
                                
                                UI.initFrentesTable();
                                UI.initEquipamentosTables();
                                UI.initPotencialTable();
                                UI.updateRecentFrentes();
                                
                                // Atualizar timestamp
                                App.data.lastUpdated = new Date().toISOString();
                                UI.updateTimestamps();
                                
                                App.saveData();
                                this.calculatePotencial();
                                UI.updateDashboard();
                                
                                UI.hideLoading();
                            } catch (error) {
                                console.error('Erro ao adicionar/atualizar frente:', error);
                                UI.hideLoading();
                                UI.showToast('Erro ao processar frente: ' + error.message, 'error');
                            }
                        }, App.config.debounceTime);
                    },
                    
                    // Atualizar todos os dados de equipamentos
                    updateAllEquipamentosData: function() {
                        for (const frente in App.data.equipamentos) {
                            this.updateEquipamentosDataFromUI(frente);
                        }
                    },
                    
                    // Atualizar equipamentos de uma frente
                    updateEquipamentosFrente: function(frente) {
                        const equipamentos = App.data.equipamentos[frente];
                        if (!equipamentos) return;
                        
                        // Filtrar equipamentos disponíveis
                        const disponiveis = equipamentos.filter(e => e.disponivel === 1);
                        
                        // Separar colhedoras e tratores
                        const colhedoras = disponiveis.filter(e => e.equipo.toUpperCase().includes('COLHEDORA'));
                        const tratoresAtivos = parseInt(document.getElementById(`${frente}-tratores`).value) || 0;
                        
                        // Obter densidade de carga
                        const densidadeElement = document.getElementById(`${frente}-densidade`);
                        const densidade = densidadeElement ? parseFloat(densidadeElement.value) || 12 : 12;
                        
                        // Calcular médias para tratores (tempos de ciclo para carregamento)
                        // Para o cálculo da capacidade dos tratores, usamos a média real dos tempos
                        const mediaCarreg = disponiveis.length > 0 ? 
                            disponiveis.reduce((sum, e) => sum + (parseFloat(e.carreg) || 0), 0) / disponiveis.length : 0;
                        
                        const mediaAux = disponiveis.length > 0 ? 
                            disponiveis.reduce((sum, e) => sum + (parseFloat(e.aux) || 0), 0) / disponiveis.length : 0;
                        
                        // Atualizar médias na UI
                        const mediaCarregElement = document.getElementById(`${frente}-media-carreg`);
                        const mediaAuxElement = document.getElementById(`${frente}-media-aux`);
                        const disponiveisElement = document.getElementById(`${frente}-disponiveis`);
                        
                        if (mediaCarregElement) mediaCarregElement.value = mediaCarreg.toFixed(2);
                        if (mediaAuxElement) mediaAuxElement.value = mediaAux.toFixed(2);
                        if (disponiveisElement) disponiveisElement.value = disponiveis.length;
                        
                        // Calcular produções para cada equipamento
                        equipamentos.forEach((equip, index) => {
                            // Para colhedoras disponíveis com tempo de carregamento
                            if (equip.disponivel === 1 && equip.equipo.toUpperCase().includes('COLHEDORA') && equip.carreg > 0) {
                                // Fórmula: (minutos por hora / tempo de carregamento) * densidade de carga
                                equip.producao = (60 / equip.carreg) * densidade;
                            } else {
                                equip.producao = 0;
                            }
                            
                            // Atualizar a UI
                            const row = document.querySelector(`#equip-${frente} .equip-table tbody tr:nth-child(${index + 1})`);
                            if (row) {
                                row.querySelector('td:nth-child(5) input').value = equip.producao.toFixed(2);
                            }
                        });
                        
                        // Calcular capacidade total das colhedoras (soma das produções individuais)
                        const capColhedoras = colhedoras.reduce((sum, e) => sum + e.producao, 0);
                        
                        // Calcular capacidade dos tratores ativos
                        // Fórmula: (minutos por hora / (tempo médio carregamento + tempo médio auxiliar)) * densidade * número de tratores ativos
                        const tempoTotalCiclo = mediaCarreg + mediaAux;
                        const capTratores = tempoTotalCiclo > 0 ? 
                            ((60 / tempoTotalCiclo) * densidade * tratoresAtivos) : 0;
                        
                        // Corrigir cálculo para evitar NaN ou Infinity
                        const capColheadorasFinal = isNaN(capColhedoras) ? 0 : capColhedoras;
                        const capTratoresFinal = isNaN(capTratores) ? 0 : (capTratores === Infinity ? 0 : capTratores);
                        
                        // Capacidade da frente é o fator limitante entre colhedoras e tratores
                        const capFrental = Math.min(capColheadorasFinal, capTratoresFinal);
                        
                        // Atualizar valores na UI
                        const capColhedorasElement = document.getElementById(`${frente}-cap-colhedoras`);
                        const capTratoresElement = document.getElementById(`${frente}-cap-tratores`);
                        const capFrenteElement = document.getElementById(`${frente}-cap-frente`);
                        
                        if (capColhedorasElement) capColhedorasElement.value = capColheadorasFinal.toFixed(2);
                        if (capTratoresElement) capTratoresElement.value = capTratoresFinal.toFixed(2);
                        if (capFrenteElement) capFrenteElement.value = capFrental.toFixed(2);
                    },
                    
                    // Atualizar transportes a partir da UI
                    updateTransportesFromUI: function() {
                        App.data.transportes.propriosTotal = parseInt(document.getElementById('proprios-total').value) || 0;
                        App.data.transportes.propriosParados = parseInt(document.getElementById('proprios-parados').value) || 0;
                        App.data.transportes.terceirosTotal = parseInt(document.getElementById('terceiros-total').value) || 0;
                        App.data.transportes.terceirosParados = parseInt(document.getElementById('terceiros-parados').value) || 0;
                        App.data.transportes.bvTotal = parseInt(document.getElementById('bv-total').value) || 0;
                        App.data.transportes.bvParados = parseInt(document.getElementById('bv-parados').value) || 0;
                        
                        this.updateTransportes();
                        
                        // Atualizar timestamp
                        App.data.lastUpdated = new Date().toISOString();
                        UI.updateTimestamps();
                        
                        App.saveData();
                        UI.updateDashboard();
                    },
                    
                    // Atualizar transportes
                    updateTransportes: function() {
                        // Calcular disponíveis
                        const propriosDisponiveis = App.data.transportes.propriosTotal - App.data.transportes.propriosParados;
                        const terceirosDisponiveis = App.data.transportes.terceirosTotal - App.data.transportes.terceirosParados;
                        const bvDisponiveis = App.data.transportes.bvTotal - App.data.transportes.bvParados;
                        
                        document.getElementById('proprios-disponiveis').value = Math.max(0, propriosDisponiveis);
                        document.getElementById('terceiros-disponiveis').value = Math.max(0, terceirosDisponiveis);
                        document.getElementById('bv-disponiveis').value = Math.max(0, bvDisponiveis);
                        
                        // Atualizar barras de progresso
                        const propriosProgress = Math.min(100, Math.max(0, (propriosDisponiveis / App.data.transportes.propriosTotal) * 100));
                        const terceirosProgress = Math.min(100, Math.max(0, (terceirosDisponiveis / App.data.transportes.terceirosTotal) * 100));
                        const bvProgress = Math.min(100, Math.max(0, (bvDisponiveis / App.data.transportes.bvTotal) * 100));
                        
                        document.getElementById('proprios-progress').style.width = `${propriosProgress}%`;
                        document.getElementById('terceiros-progress').style.width = `${terceirosProgress}%`;
                        document.getElementById('bv-progress').style.width = `${bvProgress}%`;
                        
                        document.getElementById('proprios-progress-label').textContent = `${Math.round(propriosProgress)}% disponível`;
                        document.getElementById('terceiros-progress-label').textContent = `${Math.round(terceirosProgress)}% disponível`;
                        document.getElementById('bv-progress-label').textContent = `${Math.round(bvProgress)}% disponível`;
                        
                        // Calcular necessários
                        let propriosNecessarios = 0;
                        let terceirosNecessarios = 0;
                        
                        if (App.data.potencial.length > 0) {
                            propriosNecessarios = App.data.potencial
                                .filter((p, i) => App.data.frentes[i]?.transporte === 'P')
                                .reduce((sum, p) => sum + (parseFloat(p.frota) || 0), 0);
                            
                            terceirosNecessarios = App.data.potencial
                                .filter((p, i) => App.data.frentes[i]?.transporte === 'T')
                                .reduce((sum, p) => sum + (parseFloat(p.frota) || 0), 0);
                        }
                        
                        document.getElementById('proprios-necessarios').value = propriosNecessarios.toFixed(2);
                        document.getElementById('terceiros-necessarios').value = terceirosNecessarios.toFixed(2);
                        
                        // Calcular potencial de transporte
                        const totalDisponiveis = propriosDisponiveis + terceirosDisponiveis;
                        const potencialColheita = parseFloat(document.getElementById('potencial-colheita').value) || 0;
                        
                        // Fórmula para potencial de transporte corrigida
                        const totalNecessarios = propriosNecessarios + terceirosNecessarios;
                        const potencialTransporte = totalNecessarios > 0 ? 
                            (potencialColheita * totalDisponiveis) / totalNecessarios : 0;
                        
                        document.getElementById('potencial-transporte').value = potencialTransporte.toFixed(2);
                        
                        // Determinar o limitante do sistema
                        const limitanteElement = document.getElementById('limitante-sistema');
                        if (limitanteElement) {
                            if (potencialTransporte < potencialColheita) {
                                limitanteElement.value = 'TRANSPORTE';
                                limitanteElement.style.color = 'var(--danger-color)';
                            } else {
                                limitanteElement.value = 'COLHEITA';
                                limitanteElement.style.color = 'var(--success-color)';
                            }
                        }
                    },
                    
                    // Atualizar horas trabalhadas a partir da UI
                    updateHorasTrabalhadasFromUI: function() {
                        App.data.horasTrabalhadas.prop4001 = parseInt(document.getElementById('horas-prop-4001').value) || 0;
                        App.data.horasTrabalhadas.prop4002 = parseInt(document.getElementById('horas-prop-4002').value) || 0;
                        App.data.horasTrabalhadas.terc = parseInt(document.getElementById('horas-terc').value) || 0;
                        
                        // Atualizar timestamp
                        App.data.lastUpdated = new Date().toISOString();
                        UI.updateTimestamps();
                        
                        this.calculatePotencial();
                        UI.updateDashboard();
                    },
                    
                    // Atualizar dados das frentes a partir da UI
                    updateFrentesDataFromUI: function() {
                        const rows = document.querySelectorAll('#frentes-table tbody tr');
                        const newFrentes = [];
                        
                        rows.forEach(row => {
                            const frente = {
                                frente: row.querySelector('.frente-input').value,
                                cota: parseFloat(row.querySelector('td:nth-child(2) input').value) || 0,
                                dist: parseFloat(row.querySelector('td:nth-child(3) input').value) || 0,
                                ida: parseFloat(row.querySelector('td:nth-child(4) input').value) || 0,
                                campo: parseFloat(row.querySelector('td:nth-child(5) input').value) || 0,
                                volta: parseFloat(row.querySelector('td:nth-child(6) input').value) || 0,
                                usina: parseFloat(row.querySelector('td:nth-child(7) input').value) || 0,
                                peso: parseFloat(row.querySelector('td:nth-child(12) input').value) || 60,
                                transporte: row.querySelector('.transporte-select').value,
                                // Preservar ou adicionar campos adicionais
                                obs: App.data.frentes.find(f => f.frente === row.querySelector('.frente-input').value)?.obs || '',
                                createdAt: App.data.frentes.find(f => f.frente === row.querySelector('.frente-input').value)?.createdAt || new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            };
                            
                            newFrentes.push(frente);
                        });
                        
                        // Verificar se há alterações nos IDs de frente
                        const oldFrenteIds = App.data.frentes.map(f => f.frente);
                        const newFrenteIds = newFrentes.map(f => f.frente);
                        
                        // Verificar frentes removidas
                        const removedFrentes = oldFrenteIds.filter(id => !newFrenteIds.includes(id));
                        
                        // Verificar frentes renomeadas
                        for (let i = 0; i < Math.min(oldFrenteIds.length, newFrenteIds.length); i++) {
                            if (oldFrenteIds[i] !== newFrenteIds[i]) {
                                // Frente renomeada - precisamos atualizar equipamentos
                                if (!removedFrentes.includes(oldFrenteIds[i])) {
                                    App.data.equipamentos[newFrenteIds[i]] = [...App.data.equipamentos[oldFrenteIds[i]]];
                                    delete App.data.equipamentos[oldFrenteIds[i]];
                                    
                                    // Adicionar ao histórico
                                    App.addHistoryEntry({
                                        tipo: 'edit',
                                        entidade: 'frente',
                                        titulo: `Frente ${oldFrenteIds[i]} renomeada`,
                                        descricao: `Frente renomeada para ${newFrenteIds[i]}`,
                                        data: new Date().toISOString(),
                                        usuario: 'Administrador'
                                    });
                                }
                            }
                        }
                        
                        // Remover equipamentos de frentes removidas
                        removedFrentes.forEach(id => {
                            delete App.data.equipamentos[id];
                            
                            // Adicionar ao histórico
                            App.addHistoryEntry({
                                tipo: 'delete',
                                entidade: 'frente',
                                titulo: `Frente ${id} removida`,
                                descricao: 'Frente removida na tabela de dados',
                                data: new Date().toISOString(),
                                usuario: 'Administrador'
                            });
                        });
                        
                        // Adicionar equipamentos para novas frentes
                        newFrenteIds.forEach(id => {
                            if (!oldFrenteIds.includes(id) && !App.data.equipamentos[id]) {
                                App.data.equipamentos[id] = this.createDefaultEquipamentos(id);
                                
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'add',
                                    entidade: 'frente',
                                    titulo: `Frente ${id} adicionada`,
                                    descricao: 'Nova frente adicionada na tabela de dados',
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                            }
                        });
                        
                        App.data.frentes = newFrentes;
                        
                        UI.updateFrentesTotais();
                        
                        // Atualizar timestamp
                        App.data.lastUpdated = new Date().toISOString();
                        UI.updateTimestamps();
                        
                        App.saveData();
                    },
                    
                    // Atualizar dados de equipamentos a partir da UI
                    updateEquipamentosDataFromUI: function(frente) {
                        const rows = document.querySelectorAll(`#equip-${frente} .equip-table tbody tr`);
                        if (!rows.length) return;
                        
                        const oldEquipamentos = App.data.equipamentos[frente] ? [...App.data.equipamentos[frente]] : [];
                        App.data.equipamentos[frente] = [];
                        
                        rows.forEach((row, index) => {
                            const equipo = row.querySelector('td:nth-child(1) input').value;
                            const disponivel = parseInt(row.querySelector('.disponivel-select').value) || 0;
                            
                            // Verificar se houve mudança de disponibilidade
                            if (oldEquipamentos[index] && oldEquipamentos[index].disponivel !== disponivel) {
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'edit',
                                    entidade: 'equipamento',
                                    titulo: `Equipamento ${equipo} alterado`,
                                    descricao: `Disponibilidade alterada para ${disponivel === 1 ? 'Disponível' : 'Indisponível'} na frente ${frente}`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                            }
                            
                            const equip = {
                                equipo: equipo,
                                carreg: parseFloat(row.querySelector('td:nth-child(2) input').value) || 0,
                                aux: parseFloat(row.querySelector('td:nth-child(3) input').value) || 0,
                                disponivel: disponivel,
                                producao: parseFloat(row.querySelector('td:nth-child(5) input').value) || 0
                            };
                            
                            App.data.equipamentos[frente].push(equip);
                        });
                        
                        this.updateEquipamentosFrente(frente);
                        
                        // Atualizar timestamp
                        App.data.lastUpdated = new Date().toISOString();
                        UI.updateTimestamps();
                        
                        App.saveData();
                    },
                    
                    // Validar dados antes de cálculos
                    validateData: function() {
                        // Verificar frentes
                        if (!App.data.frentes || App.data.frentes.length === 0) {
                            console.warn('Nenhuma frente cadastrada');
                            return false;
                        }
                        
                        // Verificar equipamentos
                        let hasEquipamentos = false;
                        for (const frente in App.data.equipamentos) {
                            if (App.data.equipamentos[frente] && App.data.equipamentos[frente].length > 0) {
                                hasEquipamentos = true;
                                break;
                            }
                        }
                        
                        if (!hasEquipamentos) {
                            console.warn('Nenhum equipamento cadastrado');
                            return false;
                        }
                        
                        return true;
                    },
                    
                    // Calcular potencial de colheita e transporte
                    calculatePotencial: function() {
                        if (!this.validateData()) {
                            UI.showToast('Dados insuficientes para cálculo. Verifique se todas as frentes e equipamentos estão configurados corretamente.', 'warning');
                            return;
                        }
                        
                        const rows = document.querySelectorAll('#potencial-table tbody tr');
                        App.data.potencial = [];
                        
                        rows.forEach((row, index) => {
                            const frenteData = App.data.frentes[index];
                            if (!frenteData) return;
                            
                            // Obter capacidades da frente
                            let capMaquinas = 0;
                            let capTratores = 0;
                            let capFrente = 0;
                            
                            const capColhedorasElement = document.getElementById(`${frenteData.frente}-cap-colhedoras`);
                            const capTratoresElement = document.getElementById(`${frenteData.frente}-cap-tratores`);
                            const capFrenteElement = document.getElementById(`${frenteData.frente}-cap-frente`);
                            
                            if (capColhedorasElement) capMaquinas = parseFloat(capColhedorasElement.value) || 0;
                            if (capTratoresElement) capTratores = parseFloat(capTratoresElement.value) || 0;
                            if (capFrenteElement) capFrente = parseFloat(capFrenteElement.value) || 0;
                            
                            // Calcular horas trabalhadas para esta frente
                            const horasTrabalho = frenteData.transporte === 'P' ? 
                                (frenteData.frente === '4001' ? App.data.horasTrabalhadas.prop4001 : App.data.horasTrabalhadas.prop4002) : 
                                App.data.horasTrabalhadas.terc;
                                
                            // Calcular valores
                            const cotaTH = frenteData.cota / Math.max(1, horasTrabalho);
                            const tempoTotal = (parseFloat(frenteData.ida) + parseFloat(frenteData.campo) + 
                                           parseFloat(frenteData.volta) + parseFloat(frenteData.usina)) / 1440;
                            
                            // Obter estrategia do input (agora é valor digitado, não calculado)
                            const estrategia = parseFloat(row.querySelector('.potencial-estrategia').value) || 0;
                            
                            const camH = frenteData.peso > 0 ? estrategia / frenteData.peso : 0;
                            const frota = tempoTotal * 24 * camH;
                            const intAloc = camH > 0 ? 60 / camH : 0;
                            
                            // Calcular status do potencial
                            const capacidadePercentual = cotaTH > 0 ? (capFrente / cotaTH) * 100 : 0;
                            const status = capacidadePercentual >= 100 ? 'ÓTIMO' :
                                            capacidadePercentual >= 90 ? 'BOM' :
                                            capacidadePercentual >= 75 ? 'REGULAR' : 'INSUFICIENTE';
                            
                            const statusClass = capacidadePercentual >= 100 ? 'badge-success' :
                                                capacidadePercentual >= 90 ? 'badge-info' :
                                                capacidadePercentual >= 75 ? 'badge-warning' : 'badge-danger';
                            
                            // Atualizar UI
                            row.querySelector('.potencial-cota').value = cotaTH.toFixed(2);
                            row.querySelector('.potencial-maquinas').value = capMaquinas.toFixed(2);
                            row.querySelector('.potencial-tratores').value = capTratores.toFixed(2);
                            row.querySelector('.potencial-limitante').value = capFrente.toFixed(2);
                            // Não atualizamos potencial-estrategia porque agora é um campo digitado pelo usuário
                            row.querySelector('.potencial-tempo').value = tempoTotal.toFixed(4);
                            row.querySelector('.potencial-camh').value = camH.toFixed(2);
                            row.querySelector('.potencial-frota').value = frota.toFixed(2);
                            row.querySelector('.potencial-intaloc').value = intAloc.toFixed(2);
                            
                            // Atualizar status
                            if (row.querySelector('.status-badge')) {
                                row.querySelector('.status-badge').textContent = status;
                                row.querySelector('.status-badge').className = `badge status-badge ${statusClass}`;
                            } else {
                                const statusCell = row.querySelector('td:last-child');
                                statusCell.innerHTML = `<span class="badge status-badge ${statusClass}">${status}</span>`;
                            }
                            
                            // Salvar dados
                            App.data.potencial.push({
                                frente: frenteData.frente,
                                cota: cotaTH,
                                maquinas: capMaquinas,
                                tratores: capTratores,
                                limitante: capFrente,
                                estrategia: estrategia,
                                tempoCiclo: tempoTotal,
                                camH: camH,
                                frota: frota,
                                intAloc: intAloc,
                                status: status,
                                statusClass: statusClass,
                                capacidadePercentual: capacidadePercentual
                            });
                        });
                        
                        UI.updatePotencialTotais();
                        this.updateTransportes();
                        
                        // Atualizar timestamp
                        App.data.lastUpdated = new Date().toISOString();
                        UI.updateTimestamps();
                        
                        App.saveData();
                        UI.updateDashboard();
                    },
                    
                    // Adicionar um novo equipamento a uma frente
                    addEquipamento: function(frenteId, tipoEquipamento, disponivel) {
                        if (!App.data.equipamentos[frenteId]) {
                            App.data.equipamentos[frenteId] = [];
                        }
                        
                        // Determinar o próximo número sequencial para o equipamento
                        const equiposDoTipo = App.data.equipamentos[frenteId].filter(e => 
                            e.equipo.toUpperCase().includes(tipoEquipamento.toUpperCase())
                        );
                        
                        const proximoNumero = equiposDoTipo.length > 0 ? 
                            Math.max(...equiposDoTipo.map(e => {
                                const match = e.equipo.match(/\d+$/);
                                return match ? parseInt(match[0]) : 0;
                            })) + 1 : 1;
                        
                        const novoEquipamento = {
                            equipo: `${tipoEquipamento.toUpperCase()} ${proximoNumero}`,
                            carreg: 0,
                            aux: 0,
                            disponivel: disponivel ? 1 : 0,
                            producao: 0
                        };
                        
                        App.data.equipamentos[frenteId].push(novoEquipamento);
                        
                        // Adicionar ao histórico
                        App.addHistoryEntry({
                            tipo: 'add',
                            entidade: 'equipamento',
                            titulo: `Equipamento ${novoEquipamento.equipo} adicionado`,
                            descricao: `Novo equipamento adicionado à frente ${frenteId}`,
                            data: new Date().toISOString(),
                            usuario: 'Administrador'
                        });
                        
                        // Atualizar UI
                        UI.initEquipamentosTables();
                        
                        // Atualizar timestamp
                        App.data.lastUpdated = new Date().toISOString();
                        UI.updateTimestamps();
                        
                        App.saveData();
                        return novoEquipamento;
                    }
                };
                
                // Namespace para manipulação de arquivos
                const FileHandler = {
                    // Configurar botões de exportação/importação
                    setupExportImportButtons: function() {
                        // Exportar frentes
                        document.getElementById('export-frentes').addEventListener('click', () => {
                            this.exportToCSV('frentes', App.data.frentes);
                        });
                        
                        // Importar frentes
                        document.getElementById('import-frentes').addEventListener('click', () => {
                            document.getElementById('file-import-frentes').click();
                        });
                        
                        document.getElementById('file-import-frentes').addEventListener('change', (e) => {
                            UI.showLoading('Importando frentes...');
                            
                            this.importFromCSV(e, 'frentes').then(data => {
                                App.data.frentes = data;
                                UI.initFrentesTable();
                                UI.initPotencialTable();
                                
                                // Verificar equipamentos para novas frentes
                                data.forEach(frente => {
                                    if (!App.data.equipamentos[frente.frente]) {
                                        App.data.equipamentos[frente.frente] = DataHandler.createDefaultEquipamentos(frente.frente);
                                    }
                                });
                                
                                // Remover equipamentos de frentes que não existem mais
                                const frenteIds = data.map(f => f.frente);
                                Object.keys(App.data.equipamentos).forEach(id => {
                                    if (!frenteIds.includes(id)) {
                                        delete App.data.equipamentos[id];
                                    }
                                });
                                
                                UI.initEquipamentosTables();
                                DataHandler.calculatePotencial();
                                UI.updateDashboard();
                                
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'system',
                                    entidade: 'frente',
                                    titulo: 'Importação de frentes',
                                    descricao: `${data.length} frentes importadas de arquivo CSV`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                                
                                UI.hideLoading();
                                UI.showToast('Frentes importadas com sucesso!');
                            }).catch(error => {
                                UI.hideLoading();
                                UI.showToast('Erro ao importar frentes: ' + error, 'error');
                            });
                        });
                        
                        // Exportar equipamentos
                        document.getElementById('export-equipamentos').addEventListener('click', () => {
                            // Transformar o objeto em um array plano para exportar
                            let equipamentosFlat = [];
                            for (const frente in App.data.equipamentos) {
                                if (App.data.equipamentos[frente]) {
                                    App.data.equipamentos[frente].forEach(equip => {
                                        equipamentosFlat.push({
                                            frente: frente,
                                            equipo: equip.equipo,
                                            carreg: equip.carreg,
                                            aux: equip.aux,
                                            disponivel: equip.disponivel,
                                            producao: equip.producao
                                        });
                                    });
                                }
                            }
                            
                            this.exportToCSV('equipamentos', equipamentosFlat);
                        });
                        
                        // Importar equipamentos
                        document.getElementById('import-equipamentos').addEventListener('click', () => {
                            document.getElementById('file-import-equipamentos').click();
                        });
                        
                        document.getElementById('file-import-equipamentos').addEventListener('change', (e) => {
                            UI.showLoading('Importando equipamentos...');
                            
                            this.importFromCSV(e, 'equipamentos').then(data => {
                                // Reconstruir a estrutura de dados aninhada
                                const equipamentos = {};
                                data.forEach(item => {
                                    if (!equipamentos[item.frente]) {
                                        equipamentos[item.frente] = [];
                                    }
                                    
                                    equipamentos[item.frente].push({
                                        equipo: item.equipo,
                                        carreg: parseFloat(item.carreg) || 0,
                                        aux: parseFloat(item.aux) || 0,
                                        disponivel: parseInt(item.disponivel) || 0,
                                        producao: parseFloat(item.producao) || 0
                                    });
                                });
                                
                                App.data.equipamentos = equipamentos;
                                UI.initEquipamentosTables();
                                DataHandler.calculatePotencial();
                                UI.updateDashboard();
                                
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'system',
                                    entidade: 'equipamento',
                                    titulo: 'Importação de equipamentos',
                                    descricao: `${data.length} equipamentos importados de arquivo CSV`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                                
                                UI.hideLoading();
                                UI.showToast('Equipamentos importados com sucesso!');
                            }).catch(error => {
                                UI.hideLoading();
                                UI.showToast('Erro ao importar equipamentos: ' + error, 'error');
                            });
                        });
                        
                        // Exportar potencial
                        document.getElementById('export-potencial').addEventListener('click', () => {
                            if (!App.data.potencial || App.data.potencial.length === 0) {
                                DataHandler.calculatePotencial();
                            }
                            this.exportToCSV('potencial', App.data.potencial);
                        });
                        
                        // Importar potencial
                        document.getElementById('import-potencial').addEventListener('click', () => {
                            document.getElementById('file-import-potencial').click();
                        });
                        
                        document.getElementById('file-import-potencial').addEventListener('change', (e) => {
                            UI.showLoading('Importando potencial...');
                            
                            this.importFromCSV(e, 'potencial').then(data => {
                                App.data.potencial = data;
                                
                                // Atualizar a tabela de potencial
                                const rows = document.querySelectorAll('#potencial-table tbody tr');
                                rows.forEach((row, index) => {
                                    if (data[index]) {
                                        const p = data[index];
                                        row.querySelector('.potencial-cota').value = p.cota.toFixed(2);
                                        row.querySelector('.potencial-maquinas').value = p.maquinas.toFixed(2);
                                        row.querySelector('.potencial-tratores').value = p.tratores.toFixed(2);
                                        row.querySelector('.potencial-limitante').value = p.limitante.toFixed(2);
                                        row.querySelector('.potencial-estrategia').value = p.estrategia.toFixed(2);
                                        row.querySelector('.potencial-camh').value = p.camH.toFixed(2);
                                        row.querySelector('.potencial-frota').value = p.frota.toFixed(2);
                                        row.querySelector('.potencial-intaloc').value = p.intAloc.toFixed(2);
                                    }
                                });
                                
                                UI.updatePotencialTotais();
                                DataHandler.updateTransportes();
                                UI.updateDashboard();
                                
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'system',
                                    entidade: 'dados',
                                    titulo: 'Importação de potencial',
                                    descricao: `${data.length} registros de potencial importados de arquivo CSV`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                                
                                UI.hideLoading();
                                UI.showToast('Potencial importado com sucesso!');
                            }).catch(error => {
                                UI.hideLoading();
                                UI.showToast('Erro ao importar potencial: ' + error, 'error');
                            });
                        });
                    },
                    
                    // Configurar botões de backup e restauração
                    setupBackupRestoreButtons: function() {
                        // Backup completo
                        document.getElementById('backup-all').addEventListener('click', () => {
                            try {
                                // Atualizar todos os dados antes do backup
                                DataHandler.updateFrentesDataFromUI();
                                DataHandler.updateAllEquipamentosData();
                                DataHandler.updateTransportesFromUI();
                                DataHandler.updateHorasTrabalhadasFromUI();
                                DataHandler.calculatePotencial();
                                
                                // Criar backup
                                const backupData = JSON.stringify(App.data);
                                const blob = new Blob([backupData], { type: 'application/json' });
                                const url = URL.createObjectURL(blob);
                                const timestamp = new Date().toISOString().slice(0, 10);
                                
                                const link = document.createElement('a');
                                link.href = url;
                                link.download = `backup_colheita_transporte_${timestamp}.json`;
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                
                                App.config.storage.lastBackupTime = new Date();
                                
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'system',
                                    entidade: 'dados',
                                    titulo: 'Backup manual',
                                    descricao: 'Backup completo realizado manualmente',
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                                
                                UI.showToast('Backup completo exportado com sucesso!');
                            } catch (error) {
                                console.error('Erro ao criar backup:', error);
                                UI.showToast('Erro ao criar backup: ' + error.message, 'error');
                            }
                        });
                        
                        // Restaurar backup
                        document.getElementById('restore-all').addEventListener('click', () => {
                            document.getElementById('file-restore-all').click();
                        });
                        
                        document.getElementById('file-restore-all').addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (!file) {
                                UI.showToast('Nenhum arquivo selecionado', 'warning');
                                return;
                            }
                            
                            UI.showLoading('Restaurando backup...');
                            
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                try {
                                    const restoredData = JSON.parse(e.target.result);
                                    
                                    // Verificar se os dados são válidos
                                    if (!restoredData.frentes || !restoredData.equipamentos) {
                                        throw new Error('Arquivo de backup inválido ou corrompido');
                                    }
                                    
                                    // Atualizar App.data
                                    App.data = restoredData;
                                    
                                    // Reinicializar UI
                                    UI.initFrentesTable();
                                    UI.initEquipamentosTables();
                                    UI.initPotencialTable();
                                    UI.initTransportes();
                                    
                                    // Calcular potencial e atualizar dashboard
                                    DataHandler.calculatePotencial();
                                    UI.updateDashboard();
                                    UI.updateTimestamps();
                                    
                                    // Atualizar histórico e relatórios
                                    UI.updateHistoryList();
                                    
                                    // Salvar dados restaurados
                                    App.saveData();
                                    
                                    // Adicionar ao histórico
                                    App.addHistoryEntry({
                                        tipo: 'system',
                                        entidade: 'dados',
                                        titulo: 'Restauração de backup',
                                        descricao: 'Dados completos restaurados de arquivo de backup',
                                        data: new Date().toISOString(),
                                        usuario: 'Administrador'
                                    });
                                    
                                    UI.hideLoading();
                                    UI.showToast('Backup restaurado com sucesso!');
                                } catch (error) {
                                    console.error('Erro ao restaurar backup:', error);
                                    UI.hideLoading();
                                    UI.showToast('Erro ao restaurar backup: ' + error.message, 'error');
                                }
                            };
                            
                            reader.onerror = () => {
                                UI.hideLoading();
                                UI.showToast('Erro ao ler arquivo de backup', 'error');
                            };
                            
                            reader.readAsText(file);
                        });
                    },
                    
                    // Exportar para CSV
                    exportToCSV: function(filename, data) {
                        if (!data || data.length === 0) {
                            UI.showToast('Nenhum dado para exportar!', 'warning');
                            return;
                        }
                        
                        try {
                            // Obter cabeçalhos
                            const headers = Object.keys(data[0] || {});
                            
                            // Criar conteúdo CSV
                            let csvContent = headers.map(h => `"${h}"`).join(',') + '\r\n';
                            
                            data.forEach(item => {
                                const row = headers.map(header => {
                                    let value = item[header];
                                    // Converter boolean/number para string
                                    if (value === null || value === undefined) value = '';
                                    if (typeof value === 'boolean') value = value ? '1' : '0';
                                    return `"${value.toString().replace(/"/g, '""')}"`;
                                });
                                csvContent += row.join(',') + '\r\n';
                            });
                            
                            // Criar link de download
                            const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = `${filename}_${new Date().toISOString().slice(0,10)}.csv`;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // Adicionar ao histórico
                            App.addHistoryEntry({
                                tipo: 'system',
                                entidade: 'dados',
                                titulo: `Exportação de ${filename}`,
                                descricao: `Dados de ${filename} exportados para CSV`,
                                data: new Date().toISOString(),
                                usuario: 'Administrador'
                            });
                            
                            UI.showToast(`Arquivo ${filename}.csv exportado com sucesso!`);
                        } catch (error) {
                            console.error('Erro ao exportar CSV:', error);
                            UI.showToast('Erro ao exportar dados: ' + error.message, 'error');
                        }
                    },
                    
                    // Importar de CSV
                    importFromCSV: function(event, type) {
                        return new Promise((resolve, reject) => {
                            const file = event.target.files[0];
                            if (!file) {
                                reject('Nenhum arquivo selecionado');
                                return;
                            }
                            
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                try {
                                    const text = e.target.result;
                                    const lines = text.replace(/\r\n|\r/g, '\n').split('\n');
                                    
                                    if (lines.length < 2) {
                                        reject('Arquivo CSV vazio ou inválido');
                                        return;
                                    }
                                    
                                    // Processar cabeçalhos
                                    const headers = lines[0].split(',').map(h => 
                                        h.trim().replace(/^"|"$/g, '').toLowerCase()
                                    );
                                    
                                    // Processar linhas
                                    const result = [];
                                    for (let i = 1; i < lines.length; i++) {
                                        if (!lines[i].trim()) continue;
                                        
                                        const values = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/)
                                            .map(v => v.trim().replace(/^"|"$/g, ''));
                                        
                                        if (values.length !== headers.length) continue;
                                        
                                        const row = {};
                                        headers.forEach((header, j) => {
                                            let value = values[j] || '';
                                            
                                            // Converter para número se possível
                                            if (!isNaN(value) && value !== '') {
                                                value = value.includes('.') ? parseFloat(value) : parseInt(value);
                                            }
                                            // Converter disponivel para número
                                            if (header === 'disponivel') {
                                                value = value === '1' || value === 'Sim' ? 1 : 0;
                                            }
                                            
                                            row[header] = value;
                                        });
                                        
                                        result.push(row);
                                    }
                                    
                                    resolve(result);
                                } catch (error) {
                                    console.error('Erro ao processar CSV:', error);
                                    reject('Erro ao processar arquivo CSV: ' + error.message);
                                }
                            };
                            
                            reader.onerror = () => reject('Erro ao ler arquivo');
                            reader.readAsText(file);
                        });
                    },
                    
                    // Exportar para PDF
                    exportToPDF: function(filename, htmlContent) {
                        try {
                            // Usando biblioteca jsPDF (carregada externamente)
                            if (typeof jsPDF === 'undefined') {
                                UI.showToast('Biblioteca jsPDF não carregada. Exportando como HTML...', 'warning');
                                this.exportToHTML(filename, htmlContent);
                                return;
                            }
                            
                            const doc = new jsPDF();
                            doc.html(htmlContent, {
                                callback: function (doc) {
                                    doc.save(`${filename}_${new Date().toISOString().slice(0,10)}.pdf`);
                                },
                                x: 10,
                                y: 10
                            });
                            
                            UI.showToast(`Arquivo ${filename}.pdf exportado com sucesso!`);
                        } catch (error) {
                            console.error('Erro ao exportar PDF:', error);
                            UI.showToast('Erro ao exportar para PDF. Tentando HTML...', 'warning');
                            this.exportToHTML(filename, htmlContent);
                        }
                    },
                    
                    // Exportar para HTML
                    exportToHTML: function(filename, htmlContent) {
                        try {
                            const blob = new Blob([htmlContent], { type: 'text/html' });
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = `${filename}_${new Date().toISOString().slice(0,10)}.html`;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            UI.showToast(`Arquivo ${filename}.html exportado com sucesso!`);
                        } catch (error) {
                            console.error('Erro ao exportar HTML:', error);
                            UI.showToast('Erro ao exportar para HTML: ' + error.message, 'error');
                        }
                    }
                };
                
                // Namespace para interface de usuário
                const UI = {
                    // Inicializar componentes da UI
                    initComponents: function() {
                        this.initFrentesTable();
                        this.initEquipamentosTables();
                        this.initPotencialTable();
                        this.initTransportes();
                        this.updateRecentFrentes();
                        this.updateHistoryList();
                        this.updateResumoFrentes();
                        this.initCharts();
                        this.updateTimestamps();
                        
                        // Inicializar filtros
                        this.initFilterOptions();
                    },
                    
                    // Inicializar opções de filtro
                    initFilterOptions: function() {
                        // Preencher filtros de frentes
                        const frenteIds = App.data.frentes.map(f => f.frente);
                        const frenteFilters = document.querySelectorAll('#potencial-filter-frente, #equipamentos-filter-frente, #report-frente');
                        
                        frenteFilters.forEach(select => {
                            if (!select) return;
                            
                            // Limpar opções atuais, preservando a primeira
                            while (select.options.length > 1) {
                                select.remove(1);
                            }
                            
                            // Adicionar opções
                            frenteIds.forEach(id => {
                                const option = document.createElement('option');
                                option.value = id;
                                option.textContent = `Frente ${id}`;
                                select.appendChild(option);
                            });
                        });
                    },
                    
                    // Mostrar carregamento
                    showLoading: function(message = 'Carregando...') {
                        document.getElementById('loading-message').textContent = message;
                        document.getElementById('loading').style.display = 'flex';
                    },
                    
                    // Esconder carregamento
                    hideLoading: function() {
                        document.getElementById('loading').style.display = 'none';
                    },
                    
                    // Mostrar toast
                    showToast: function(message, type = 'success') {
                        const toast = document.getElementById('toast');
                        toast.textContent = message;
                        toast.className = 'toast';
                        
                        if (type === 'error') {
                            toast.classList.add('error');
                        } else if (type === 'warning') {
                            toast.classList.add('warning');
                        }
                        
                        toast.classList.add('show');
                        
                        // Suporte a acessibilidade - remover classe após 3s
                        setTimeout(() => {
                            toast.classList.remove('show');
                        }, 3000);
                    },
                    
                    // Formatar data
                    formatDate: function(dateString) {
                        const date = new Date(dateString);
                        return date.toLocaleString('pt-BR');
                    },
                    
                    // Formatar data curta
                    formatShortDate: function(dateString) {
                        const date = new Date(dateString);
                        return date.toLocaleDateString('pt-BR');
                    },
                    
                    // Atualizar timestamps
                    updateTimestamps: function() {
                        const timestamp = this.formatDate(App.data.lastUpdated);
                        document.querySelectorAll('.timestamp').forEach(el => {
                            el.textContent = `Última atualização: ${timestamp}`;
                        });
                    },
                    
                    // Inicializar a tabela de frentes
                    initFrentesTable: function() {
                        const tbody = document.querySelector('#frentes-table tbody');
                        tbody.innerHTML = '';
                        
                        if (App.data.frentes.length === 0) {
                            const emptyRow = document.createElement('tr');
                            emptyRow.innerHTML = `
                                <td colspan="14" class="empty-state">
                                    <i class="fas fa-truck-moving" aria-hidden="true"></i>
                                    Nenhuma frente cadastrada. Utilize a aba "Cadastrar Frente" para adicionar.
                                </td>
                            `;
                            tbody.appendChild(emptyRow);
                        } else {
                            App.data.frentes.forEach(frente => {
                                const row = document.createElement('tr');
                                
                                // Calcular totais corretamente
                                const totalTempo = (parseFloat(frente.ida) || 0) + 
                                              (parseFloat(frente.campo) || 0) + 
                                              (parseFloat(frente.volta) || 0) + 
                                              (parseFloat(frente.usina) || 0);
                                const horas = totalTempo / 60;
                                
                                row.innerHTML = `
                                    <td><input type="text" value="${frente.frente}" data-field="frente" class="frente-input" aria-label="ID da Frente"></td>
                                    <td><input type="number" value="${frente.cota}" data-field="cota" min="0" aria-label="Cota"></td>
                                    <td><input type="number" value="${frente.dist}" data-field="dist" min="0" step="0.1" aria-label="Distância em KM"></td>
                                    <td><input type="number" value="${frente.ida}" data-field="ida" min="0" class="tempo-input" aria-label="Tempo de Ida"></td>
                                    <td><input type="number" value="${frente.campo}" data-field="campo" min="0" class="tempo-input" aria-label="Tempo de Campo"></td>
                                    <td><input type="number" value="${frente.volta}" data-field="volta" min="0" class="tempo-input" aria-label="Tempo de Volta"></td>
                                    <td><input type="number" value="${frente.usina}" data-field="usina" min="0" class="tempo-input" aria-label="Tempo de Usina"></td>
                                    <td><input type="text" value="${totalTempo.toFixed(2)}" readonly class="total-tempo" aria-label="Tempo Total"></td>
                                    <td><input type="text" value="${horas.toFixed(2)}" readonly aria-label="Horas"></td>
                                    <td><input type="text" value="${horas.toFixed(2)}" readonly aria-label="Ciclo"></td>
                                    <td><input type="text" value="" readonly aria-label="Conjunto BV"></td>
                                    <td><input type="number" value="${frente.peso}" data-field="peso" min="0" aria-label="Peso em Toneladas"></td>
                                    <td>
                                        <select data-field="transporte" class="transporte-select" aria-label="Tipo de Transporte">
                                            <option value="P" ${frente.transporte === 'P' ? 'selected' : ''}>Próprio</option>
                                            <option value="T" ${frente.transporte === 'T' ? 'selected' : ''}>Terceiro</option>
                                        </select>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-view-frente" data-frente="${frente.frente}" title="Visualizar detalhes">
                                            <i class="fas fa-eye" aria-hidden="true"></i>
                                        </button>
                                        <button class="btn btn-sm btn-edit-frente" data-frente="${frente.frente}" title="Editar frente">
                                            <i class="fas fa-edit" aria-hidden="true"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger btn-delete-frente" data-frente="${frente.frente}" title="Excluir frente">
                                            <i class="fas fa-trash" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                `;
                                
                                tbody.appendChild(row);
                            });
                        }
                        
                        // Adicionar event listeners para atualização automática dos tempos
                        document.querySelectorAll('.tempo-input').forEach(input => {
                            input.addEventListener('change', function() {
                                const row = this.closest('tr');
                                DataHandler.updateTempoTotal(row);
                                DataHandler.updateFrentesDataFromUI();
                                DataHandler.calculatePotencial();
                            });
                        });
                        
                        this.updateFrentesTotais();
                        
                        // Inicializar DataTable para frentes
                        if (typeof jQuery !== 'undefined' && typeof $.fn.DataTable !== 'undefined') {
                            try {
                                if (App.state.dataTables.frentes) {
                                    App.state.dataTables.frentes.destroy();
                                }
                                
                                App.state.dataTables.frentes = $('#frentes-table').DataTable({
                                    paging: App.config.ui.enableFilters,
                                    searching: App.config.ui.enableFilters,
                                    ordering: App.config.ui.enableFilters,
                                    info: App.config.ui.enableFilters,
                                    pageLength: App.config.ui.rowsPerPage,
                                    responsive: true,
                                    language: {
                                        url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/pt-BR.json'
                                    }
                                });
                            } catch (error) {
                                console.warn('Erro ao inicializar DataTable para frentes:', error);
                            }
                        }
                    },
                    
                    // Filtrar tabela de frentes
                    filterFrentesTable: function() {
                        if (!App.state.dataTables.frentes) return;
                        
                        const idFilter = document.getElementById('frentes-filter-id').value.trim();
                        const transporteFilter = document.getElementById('frentes-filter-transporte').value;
                        const sortBy = document.getElementById('frentes-sort').value;
                        
                        // Limpar filtros anteriores
                        App.state.dataTables.frentes.search('').columns().search('').draw();
                        
                        // Aplicar filtro de ID
                        if (idFilter) {
                            App.state.dataTables.frentes.column(0).search(idFilter, true, false).draw();
                        }
                        
                        // Aplicar filtro de transporte
                        if (transporteFilter) {
                            App.state.dataTables.frentes.column(12).search(transporteFilter === 'P' ? 'Próprio' : 'Terceiro', true, false).draw();
                        }
                        
                        // Aplicar ordenação
                        if (sortBy === 'frente') {
                            App.state.dataTables.frentes.order([0, 'asc']).draw();
                        } else if (sortBy === 'cota') {
                            App.state.dataTables.frentes.order([1, 'desc']).draw();
                        } else if (sortBy === 'dist') {
                            App.state.dataTables.frentes.order([2, 'asc']).draw();
                        } else if (sortBy === 'tempo') {
                            App.state.dataTables.frentes.order([7, 'asc']).draw();
                        }
                    },
                    
                    // Inicializar tabelas de equipamentos
                    initEquipamentosTables: function() {
                        const tabsContainer = document.querySelector('.equipamentos-tabs');
                        const contentContainer = document.getElementById('equipamentos-content');
                        tabsContainer.innerHTML = '';
                        contentContainer.innerHTML = '';
                        
                        // Verificar se existem frentes
                        if (Object.keys(App.data.equipamentos).length === 0) {
                            contentContainer.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-tractor" aria-hidden="true"></i>
                                    Nenhuma frente com equipamentos cadastrada. Utilize a aba "Cadastrar Frente" para adicionar.
                                </div>
                            `;
                            return;
                        }
                        
                        // Criar abas e conteúdo para cada frente
                        for (const frente in App.data.equipamentos) {
                            // Criar botão da aba
                            const tabButton = document.createElement('button');
                            tabButton.className = 'equip-tab-button';
                            tabButton.setAttribute('role', 'tab');
                            tabButton.setAttribute('aria-controls', `equip-${frente}`);
                            
                            if (Object.keys(App.data.equipamentos)[0] === frente) {
                                tabButton.classList.add('active');
                                tabButton.setAttribute('aria-selected', 'true');
                            } else {
                                tabButton.setAttribute('aria-selected', 'false');
                            }
                            
                            tabButton.setAttribute('data-frente', frente);
                            tabButton.textContent = `Frente ${frente}`;
                            tabButton.addEventListener('click', function() {
                                // Remove active class from all tabs and buttons
                                document.querySelectorAll('.equip-tab-button').forEach(btn => {
                                    btn.classList.remove('active');
                                    btn.setAttribute('aria-selected', 'false');
                                });
                                document.querySelectorAll('.equip-frente').forEach(tab => {
                                    tab.classList.remove('active');
                                    tab.setAttribute('aria-hidden', 'true');
                                });
                                
                                // Add active class to current tab and button
                                this.classList.add('active');
                                this.setAttribute('aria-selected', 'true');
                                
                                const targetTab = document.getElementById(`equip-${frente}`);
                                targetTab.classList.add('active');
                                targetTab.setAttribute('aria-hidden', 'false');
                            });
                            tabsContainer.appendChild(tabButton);
                            
                            // Criar conteúdo da aba
                            const tabContent = document.createElement('div');
                            tabContent.id = `equip-${frente}`;
                            tabContent.className = 'equip-frente';
                            tabContent.setAttribute('role', 'tabpanel');
                            tabContent.setAttribute('aria-labelledby', `tab-equip-${frente}`);
                            
                            if (Object.keys(App.data.equipamentos)[0] === frente) {
                                tabContent.classList.add('active');
                                tabContent.setAttribute('aria-hidden', 'false');
                            } else {
                                tabContent.setAttribute('aria-hidden', 'true');
                            }
                            
                            tabContent.innerHTML = `
                                <h3>Frente ${frente}</h3>
                                <div class="controls">
                                    <button class="btn btn-sm" id="add-equipamento-${frente}">
                                        <i class="fas fa-plus" aria-hidden="true"></i> Adicionar Equipamento
                                    </button>
                                    <button class="btn btn-secondary btn-sm" id="export-equipamento-${frente}">
                                        <i class="fas fa-file-export" aria-hidden="true"></i> Exportar Dados
                                    </button>
                                </div>
                                <div class="table-container">
                                    <table class="equip-table data-table" id="equip-table-${frente}">
                                        <thead>
                                            <tr>
                                                <th>Equipo</th>
                                                <th>Carreg (min)</th>
                                                <th>Aux (min)</th>
                                                <th>Disponível</th>
                                                <th>Produção (t/h)</th>
                                                <th>Status</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="equip-results">
                                    <div class="equip-result-row">
                                        <label for="${frente}-media-carreg">Média (GATEC) - Carreg:</label>
                                        <input type="text" id="${frente}-media-carreg" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente}-media-aux">Média (GATEC) - Aux:</label>
                                        <input type="text" id="${frente}-media-aux" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente}-disponiveis">Disponíveis:</label>
                                        <input type="text" id="${frente}-disponiveis" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente}-densidade">Densidade dos Tratores:</label>
                                        <input type="number" id="${frente}-densidade" value="12" min="0">
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente}-tratores">Nº de tratores disponíveis:</label>
                                        <input type="number" id="${frente}-tratores" value="5" min="0">
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente}-cap-colhedoras">Capacidade Produção COLHEDORAS (t/h):</label>
                                        <input type="text" id="${frente}-cap-colhedoras" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente}-cap-tratores">Capacidade Produção TRATORES (t/h):</label>
                                        <input type="text" id="${frente}-cap-tratores" readonly>
                                    </div>
                                    <div class="equip-result-row">
                                        <label for="${frente}-cap-frente">CAPACIDADE DA FRENTE (t/h):</label>
                                        <input type="text" id="${frente}-cap-frente" readonly>
                                    </div>
                                </div>
                            `;
                            
                            contentContainer.appendChild(tabContent);
                            
                            // Adicionar eventos aos botões
                            document.getElementById(`add-equipamento-${frente}`).addEventListener('click', () => {
                                this.showAddEquipamentoForm(frente);
                            });
                            
                            document.getElementById(`export-equipamento-${frente}`).addEventListener('click', () => {
                                const equipamentos = App.data.equipamentos[frente].map(e => ({
                                    frente: frente,
                                    ...e
                                }));
                                FileHandler.exportToCSV(`equipamentos_${frente}`, equipamentos);
                            });
                            
                            // Preencher tabela de equipamentos
                            const tbody = tabContent.querySelector('.equip-table tbody');
                            tbody.innerHTML = '';
                            
                            if (App.data.equipamentos[frente].length === 0) {
                                const emptyRow = document.createElement('tr');
                                emptyRow.innerHTML = `
                                    <td colspan="7" class="empty-state">
                                        <i class="fas fa-tractor" aria-hidden="true"></i>
                                        Nenhum equipamento cadastrado para esta frente.
                                    </td>
                                `;
                                tbody.appendChild(emptyRow);
                            } else {
                                App.data.equipamentos[frente].forEach((equip, index) => {
                                    const row = document.createElement('tr');
                                    
                                    // Determinar status de disponibilidade
                                    const dispStatus = equip.disponivel === 1 ? 
                                        '<span class="badge badge-success">Disponível</span>' : 
                                        '<span class="badge badge-danger">Indisponível</span>';
                                    
                                    row.innerHTML = `
                                        <td><input type="text" value="${equip.equipo}" data-field="equipo" aria-label="Nome do Equipamento"></td>
                                        <td><input type="number" value="${equip.carreg}" data-field="carreg" min="0" step="0.1" aria-label="Tempo de Carregamento"></td>
                                        <td><input type="number" value="${equip.aux}" data-field="aux" min="0" step="0.1" aria-label="Tempo Auxiliar"></td>
                                        <td>
                                            <select data-field="disponivel" class="disponivel-select" aria-label="Disponibilidade">
                                                <option value="1" ${equip.disponivel === 1 ? 'selected' : ''}>Sim</option>
                                                <option value="0" ${equip.disponivel === 0 ? 'selected' : ''}>Não</option>
                                            </select>
                                        </td>
                                        <td><input type="text" value="${equip.producao.toFixed(2)}" readonly aria-label="Produção"></td>
                                        <td>${dispStatus}</td>
                                        <td>
                                            <button class="btn btn-sm btn-edit-equip" data-index="${index}" data-frente="${frente}" title="Editar equipamento">
                                                <i class="fas fa-edit" aria-hidden="true"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger btn-delete-equip" data-index="${index}" data-frente="${frente}" title="Excluir equipamento">
                                                <i class="fas fa-trash" aria-hidden="true"></i>
                                            </button>
                                        </td>
                                    `;
                                    
                                    tbody.appendChild(row);
                                });
                                
                                // Registrar eventos para os botões de ação
                                tbody.querySelectorAll('.btn-edit-equip').forEach(btn => {
                                    btn.addEventListener('click', (e) => {
                                        const frente = e.target.closest('.btn-edit-equip').dataset.frente;
                                        const index = e.target.closest('.btn-edit-equip').dataset.index;
                                        this.editEquipamento(frente, index);
                                    });
                                });
                                
                                tbody.querySelectorAll('.btn-delete-equip').forEach(btn => {
                                    btn.addEventListener('click', (e) => {
                                        const frente = e.target.closest('.btn-delete-equip').dataset.frente;
                                        const index = e.target.closest('.btn-delete-equip').dataset.index;
                                        this.deleteEquipamento(frente, index);
                                    });
                                });
                            }
                            
                            DataHandler.updateEquipamentosFrente(frente);
                            
                            // Inicializar DataTable para equipamentos
                            if (typeof $.fn.DataTable !== 'undefined') {
                                try {
                                    $(`#equip-table-${frente}`).DataTable({
                                        paging: App.config.ui.enableFilters,
                                        searching: App.config.ui.enableFilters,
                                        ordering: App.config.ui.enableFilters,
                                        info: App.config.ui.enableFilters,
                                        pageLength: App.config.ui.rowsPerPage,
                                        responsive: true,
                                        language: {
                                            url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/pt-BR.json'
                                        }
                                    });
                                } catch (error) {
                                    console.warn(`Erro ao inicializar DataTable para equipamentos da frente ${frente}:`, error);
                                }
                            }
                        }
                    },
                    
                    // Mostrar formulário para adicionar equipamento
                    showAddEquipamentoForm: function(specificFrente = null) {
                        // Criar modal dinamicamente para adicionar equipamento
                        const modalHTML = `
                            <div id="add-equipamento-modal" class="modal" style="display: flex;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h3>Adicionar Novo Equipamento</h3>
                                        <button class="modal-close">&times;</button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <label for="new-equip-frente">Frente:</label>
                                            <select id="new-equip-frente" ${specificFrente ? 'disabled' : ''}>
                                                ${Object.keys(App.data.equipamentos).map(f => 
                                                    `<option value="${f}" ${specificFrente === f ? 'selected' : ''}>Frente ${f}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                        <div class="form-row">
                                            <label for="new-equip-tipo">Tipo de Equipamento:</label>
                                            <select id="new-equip-tipo">
                                                <option value="COLHEDORA">Colhedora</option>
                                                <option value="TRATOR">Trator</option>
                                                <option value="CARREGADEIRA">Carregadeira</option>
                                                <option value="IMPLEMENTO">Implemento</option>
                                            </select>
                                        </div>
                                        <div class="form-row">
                                            <label for="new-equip-disponivel">Disponível:</label>
                                            <select id="new-equip-disponivel">
                                                <option value="1">Sim</option>
                                                <option value="0">Não</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="cancel-add-equip" class="btn btn-secondary">Cancelar</button>
                                        <button id="confirm-add-equip" class="btn">Adicionar</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Adicionar modal ao DOM
                        const modalContainer = document.createElement('div');
                        modalContainer.innerHTML = modalHTML;
                        document.body.appendChild(modalContainer);
                        
                        // Configurar eventos
                        document.querySelector('#add-equipamento-modal .modal-close').addEventListener('click', () => {
                            document.getElementById('add-equipamento-modal').remove();
                        });
                        
                        document.getElementById('cancel-add-equip').addEventListener('click', () => {
                            document.getElementById('add-equipamento-modal').remove();
                        });
                        
                        document.getElementById('confirm-add-equip').addEventListener('click', () => {
                            const frente = document.getElementById('new-equip-frente').value;
                            const tipo = document.getElementById('new-equip-tipo').value;
                            const disponivel = document.getElementById('new-equip-disponivel').value === '1';
                            
                            // Adicionar equipamento
                            const novoEquipamento = DataHandler.addEquipamento(frente, tipo, disponivel);
                            
                            // Remover modal
                            document.getElementById('add-equipamento-modal').remove();
                            
                            // Mostrar notificação
                            this.showToast(`Equipamento ${novoEquipamento.equipo} adicionado com sucesso!`);
                        });
                    },
                    
                    // Editar equipamento
                    editEquipamento: function(frente, index) {
                        const equipamento = App.data.equipamentos[frente][index];
                        
                        // Criar modal dinamicamente para editar equipamento
                        const modalHTML = `
                            <div id="edit-equipamento-modal" class="modal" style="display: flex;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h3>Editar Equipamento</h3>
                                        <button class="modal-close">&times;</button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <label for="edit-equip-nome">Nome:</label>
                                            <input type="text" id="edit-equip-nome" value="${equipamento.equipo}">
                                        </div>
                                        <div class="form-row">
                                            <label for="edit-equip-carreg">Tempo Carreg (min):</label>
                                            <input type="number" id="edit-equip-carreg" value="${equipamento.carreg}" min="0" step="0.1">
                                        </div>
                                        <div class="form-row">
                                            <label for="edit-equip-aux">Tempo Aux (min):</label>
                                            <input type="number" id="edit-equip-aux" value="${equipamento.aux}" min="0" step="0.1">
                                        </div>
                                        <div class="form-row">
                                            <label for="edit-equip-disponivel">Disponível:</label>
                                            <select id="edit-equip-disponivel">
                                                <option value="1" ${equipamento.disponivel === 1 ? 'selected' : ''}>Sim</option>
                                                <option value="0" ${equipamento.disponivel === 0 ? 'selected' : ''}>Não</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="cancel-edit-equip" class="btn btn-secondary">Cancelar</button>
                                        <button id="confirm-edit-equip" class="btn">Salvar Alterações</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Adicionar modal ao DOM
                        const modalContainer = document.createElement('div');
                        modalContainer.innerHTML = modalHTML;
                        document.body.appendChild(modalContainer);
                        
                        // Configurar eventos
                        document.querySelector('#edit-equipamento-modal .modal-close').addEventListener('click', () => {
                            document.getElementById('edit-equipamento-modal').remove();
                        });
                        
                        document.getElementById('cancel-edit-equip').addEventListener('click', () => {
                            document.getElementById('edit-equipamento-modal').remove();
                        });
                        
                        document.getElementById('confirm-edit-equip').addEventListener('click', () => {
                            const originalDisponivel = equipamento.disponivel;
                            
                            // Atualizar dados do equipamento
                            equipamento.equipo = document.getElementById('edit-equip-nome').value;
                            equipamento.carreg = parseFloat(document.getElementById('edit-equip-carreg').value) || 0;
                            equipamento.aux = parseFloat(document.getElementById('edit-equip-aux').value) || 0;
                            equipamento.disponivel = parseInt(document.getElementById('edit-equip-disponivel').value) || 0;
                            
                            // Verificar se houve mudança de disponibilidade
                            if (originalDisponivel !== equipamento.disponivel) {
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'edit',
                                    entidade: 'equipamento',
                                    titulo: `Equipamento ${equipamento.equipo} alterado`,
                                    descricao: `Disponibilidade alterada para ${equipamento.disponivel === 1 ? 'Disponível' : 'Indisponível'} na frente ${frente}`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                            } else {
                                // Adicionar ao histórico
                                App.addHistoryEntry({
                                    tipo: 'edit',
                                    entidade: 'equipamento',
                                    titulo: `Equipamento ${equipamento.equipo} alterado`,
                                    descricao: `Dados do equipamento foram atualizados na frente ${frente}`,
                                    data: new Date().toISOString(),
                                    usuario: 'Administrador'
                                });
                            }
                            
                            // Atualizar UI
                            this.initEquipamentosTables();
                            DataHandler.updateEquipamentosFrente(frente);
                            DataHandler.calculatePotencial();
                            
                            // Atualizar timestamp
                            App.data.lastUpdated = new Date().toISOString();
                            this.updateTimestamps();
                            
                            // Salvar dados
                            App.saveData();
                            
                            // Remover modal
                            document.getElementById('edit-equipamento-modal').remove();
                            
                            // Mostrar notificação
                            this.showToast(`Equipamento ${equipamento.equipo} editado com sucesso!`);
                        });
                    },
                    
                    // Excluir equipamento
                    deleteEquipamento: function(frente, index) {
                        const equipamento = App.data.equipamentos[frente][index];
                        
                        if (confirm(`Tem certeza que deseja excluir o equipamento ${equipamento.equipo} da frente ${frente}?`)) {
                            // Adicionar ao histórico
                            App.addHistoryEntry({
                                tipo: 'delete',
                                entidade: 'equipamento',
                                titulo: `Equipamento ${equipamento.equipo} removido`,
                                descricao: `Equipamento removido da frente ${frente}`,
                                data: new Date().toISOString(),
                                usuario: 'Administrador'
                            });
                            
                            // Remover equipamento
                            App.data.equipamentos[frente].splice(index, 1);
                            
                            // Atualizar UI
                            this.initEquipamentosTables();
                            DataHandler.updateEquipamentosFrente(frente);
                            DataHandler.calculatePotencial();
                            
                            // Atualizar timestamp
                            App.data.lastUpdated = new Date().toISOString();
                            this.updateTimestamps();
                            
                            // Salvar dados
                            App.saveData();
                            
                            // Mostrar notificação
                            this.showToast(`Equipamento ${equipamento.equipo} excluído com sucesso!`);
                        }
                    },
                    
                    // Inicializar tabela de potencial
                    initPotencialTable: function() {
                        const tbody = document.querySelector('#potencial-table tbody');
                        tbody.innerHTML = '';
                        
                        if (App.data.frentes.length === 0) {
                            const emptyRow = document.createElement('tr');
                            emptyRow.innerHTML = `
                                <td colspan="11" class="empty-state">
                                    <i class="fas fa-calculator" aria-hidden="true"></i>
                                    Nenhuma frente cadastrada. Utilize a aba "Cadastrar Frente" para adicionar.
                                </td>
                            `;
                            tbody.appendChild(emptyRow);
                        } else {
                            App.data.frentes.forEach((frente, index) => {
                                const row = document.createElement('tr');
                                
                                // Pegar valores do potencial, se existir
                                const potencial = App.data.potencial[index] || {};
                                
                                const cotaTH = potencial.cota || 0;
                                const capMaquinas = potencial.maquinas || 0;
                                const capTratores = potencial.tratores || 0;
                                const capLimitante = potencial.limitante || 0;
                                const estrategia = potencial.estrategia || 0;
                                const tempoCiclo = potencial.tempoCiclo || 0;
                                const camH = potencial.camH || 0;
                                const frota = potencial.frota || 0;
                                const intAloc = potencial.intAloc || 0;
                                const status = potencial.status || 'N/A';
                                const statusClass = potencial.statusClass || '';
                                
                                row.innerHTML = `
                                    <td>${frente.frente}</td>
                                    <td><input type="text" value="${cotaTH.toFixed(2)}" readonly class="potencial-cota" aria-label="Cota (t/h)"></td>
                                    <td><input type="text" value="${capMaquinas.toFixed(2)}" readonly class="potencial-maquinas" aria-label="Potencial Máquinas"></td>
                                    <td><input type="text" value="${capTratores.toFixed(2)}" readonly class="potencial-tratores" aria-label="Potencial Tratores"></td>
                                    <td><input type="text" value="${capLimitante.toFixed(2)}" readonly class="potencial-limitante" aria-label="Potencial Limitante"></td>
                                    <td><input type="number" value="${estrategia.toFixed(2)}" class="potencial-estrategia" aria-label="Estratégia Controle"></td>
                                    <td><input type="text" value="${tempoCiclo.toFixed(4)}" readonly class="potencial-tempo" aria-label="Tempo Ciclo"></td>
                                    <td><input type="text" value="${camH.toFixed(2)}" readonly class="potencial-camh" aria-label="CAM/h"></td>
                                    <td><input type="text" value="${frota.toFixed(2)}" readonly class="potencial-frota" aria-label="Frota"></td>
                                    <td><input type="text" value="${intAloc.toFixed(2)}" readonly class="potencial-intaloc" aria-label="INT ALOC (min)"></td>
                                    <td><span class="badge status-badge ${statusClass}">${status}</span></td>
                                `;
                                
                                tbody.appendChild(row);
                            });
                        }
                        
                        this.updatePotencialTotais();
                        
                        // Inicializar DataTable para potencial
                        if (typeof jQuery !== 'undefined' && typeof $.fn.DataTable !== 'undefined') {
                            try {
                                if (App.state.dataTables.potencial) {
                                    App.state.dataTables.potencial.destroy();
                                }
                                
                                App.state.dataTables.potencial = $('#potencial-table').DataTable({
                                    paging: App.config.ui.enableFilters,
                                    searching: App.config.ui.enableFilters,
                                    ordering: App.config.ui.enableFilters,
                                    info: App.config.ui.enableFilters,
                                    pageLength: App.config.ui.rowsPerPage,
                                    responsive: true,
                                    language: {
                                        url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/pt-BR.json'
                                    }
                                });
                            } catch (error) {
                                console.warn('Erro ao inicializar DataTable para potencial:', error);
                            }
                        }
                    },
                    
                    // Filtrar tabela de potencial
                    filterPotencialTable: function() {
                        if (!App.state.dataTables.potencial) return;
                        
                        const frenteFilter = document.getElementById('potencial-filter-frente').value;
                        const transporteFilter = document.getElementById('potencial-filter-transporte').value;
                        const sortBy = document.getElementById('potencial-sort').value;
                        
                        // Limpar filtros anteriores
                        App.state.dataTables.potencial.search('').columns().search('').draw();
                        
                        // Aplicar filtro de frente
                        if (frenteFilter) {
                            App.state.dataTables.potencial.column(0).search(frenteFilter, true, false).draw();
                        }
                        
                        // Aplicar filtro de transporte
                        if (transporteFilter) {
                            // Precisamos filtrar pelo tipo de transporte, mas esse dado não está visível na tabela
                            // Vamos construir um array de índices das linhas que correspondem ao filtro
                            const matchingRows = [];
                            App.data.frentes.forEach((frente, index) => {
                                if (frente.transporte === transporteFilter) {
                                    matchingRows.push(index);
                                }
                            });
                            
                            // Aplicar filtro customizado
                            $.fn.dataTable.ext.search.push(
                                function(settings, data, dataIndex) {
                                    return matchingRows.includes(dataIndex);
                                }
                            );
                            
                            App.state.dataTables.potencial.draw();
                            
                            // Remover filtro customizado após aplicação
                            $.fn.dataTable.ext.search.pop();
                        }
                        
                        // Aplicar ordenação
                        if (sortBy === 'frente') {
                            App.state.dataTables.potencial.order([0, 'asc']).draw();
                        } else if (sortBy === 'cota') {
                            App.state.dataTables.potencial.order([1, 'desc']).draw();
                        } else if (sortBy === 'limitante') {
                            App.state.dataTables.potencial.order([4, 'desc']).draw();
                        } else if (sortBy === 'frota') {
                            App.state.dataTables.potencial.order([8, 'desc']).draw();
                        }
                    },
                    
                    // Atualizar totais da tabela de potencial
                    updatePotencialTotais: function() {
                        let totalCota = 0;
                        let totalMaquinas = 0;
                        let totalTratores = 0;
                        let totalLimitante = 0;
                        let totalEstrategia = 0;
                        let avgTempo = 0;
                        let totalCamH = 0;
                        let totalFrota = 0;
                        
                        // Obter valores das linhas
                        const rows = document.querySelectorAll('#potencial-table tbody tr');
                        
                        rows.forEach(row => {
                            totalCota += parseFloat(row.querySelector('.potencial-cota')?.value || 0);
                            totalMaquinas += parseFloat(row.querySelector('.potencial-maquinas')?.value || 0);
                            totalTratores += parseFloat(row.querySelector('.potencial-tratores')?.value || 0);
                            totalLimitante += parseFloat(row.querySelector('.potencial-limitante')?.value || 0);
                            totalEstrategia += parseFloat(row.querySelector('.potencial-estrategia')?.value || 0);
                            avgTempo += parseFloat(row.querySelector('.potencial-tempo')?.value || 0);
                            totalCamH += parseFloat(row.querySelector('.potencial-camh')?.value || 0);
                            totalFrota += parseFloat(row.querySelector('.potencial-frota')?.value || 0);
                        });
                        
                        // Calcular médias quando aplicável
                        if (rows.length > 0) {
                            avgTempo = avgTempo / rows.length;
                        }
                        
                        // Atualizar campos de totais
                        document.getElementById('potencial-total-cota').value = totalCota.toFixed(2);
                        document.getElementById('potencial-total-maquinas').value = totalMaquinas.toFixed(2);
                        document.getElementById('potencial-total-tratores').value = totalTratores.toFixed(2);
                        document.getElementById('potencial-total-limitante').value = totalLimitante.toFixed(2);
                        document.getElementById('potencial-total-estrategia').value = totalEstrategia.toFixed(2);
                        document.getElementById('potencial-total-tempo').value = avgTempo.toFixed(4);
                        document.getElementById('potencial-total-camh').value = totalCamH.toFixed(2);
                        document.getElementById('potencial-total-frota').value = totalFrota.toFixed(2);
                        
                        // Atualizar campos de resultado
                        document.getElementById('potencial-colheita').value = totalLimitante.toFixed(2);
                    },
                    
                    // Atualizar totais da tabela de frentes
                    updateFrentesTotais: function() {
                        let totalCota = 0;
                        let avgDist = 0;
                        let avgIda = 0;
                        let avgCampo = 0;
                        let avgVolta = 0;
                        let avgUsina = 0;
                        let avgTotal = 0;
                        let avgCiclo = 0;
                        let avgDens = 0;
                        
                        // Obter valores das linhas
                        const rows = document.querySelectorAll('#frentes-table tbody tr');
                        
                        rows.forEach(row => {
                            totalCota += parseFloat(row.querySelector('td:nth-child(2) input')?.value || 0);
                            avgDist += parseFloat(row.querySelector('td:nth-child(3) input')?.value || 0);
                            avgIda += parseFloat(row.querySelector('td:nth-child(4) input')?.value || 0);
                            avgCampo += parseFloat(row.querySelector('td:nth-child(5) input')?.value || 0);
                            avgVolta += parseFloat(row.querySelector('td:nth-child(6) input')?.value || 0);
                            avgUsina += parseFloat(row.querySelector('td:nth-child(7) input')?.value || 0);
                            avgTotal += parseFloat(row.querySelector('.total-tempo')?.value || 0);
                            avgCiclo += parseFloat(row.querySelector('td:nth-child(10) input')?.value || 0);
                            // Densidade média é baseada na coluna 'peso'
                            avgDens += parseFloat(row.querySelector('td:nth-child(12) input')?.value || 0);
                        });
                        
                        // Calcular médias quando aplicável
                        const numRows = rows.length;
                        if (numRows > 0) {
                            avgDist = avgDist / numRows;
                            avgIda = avgIda / numRows;
                            avgCampo = avgCampo / numRows;
                            avgVolta = avgVolta / numRows;
                            avgUsina = avgUsina / numRows;
                            avgTotal = avgTotal / numRows;
                            avgCiclo = avgCiclo / numRows;
                            avgDens = avgDens / numRows;
                        }
                        
                        // Atualizar campos de totais
                        document.getElementById('frentes-total-cota').value = totalCota.toFixed(2);
                        document.getElementById('frentes-media-dist').value = avgDist.toFixed(2);
                        document.getElementById('frentes-media-ida').value = avgIda.toFixed(2);
                        document.getElementById('frentes-media-campo').value = avgCampo.toFixed(2);
                        document.getElementById('frentes-media-volta').value = avgVolta.toFixed(2);
                        document.getElementById('frentes-media-usina').value = avgUsina.toFixed(2);
                        document.getElementById('frentes-media-total').value = avgTotal.toFixed(2);
                        document.getElementById('frentes-media-ciclo').value = avgCiclo.toFixed(2);
                        document.getElementById('frentes-media-dens').value = avgDens.toFixed(2);
                    },
                    
                    // Inicializar transportes
                    initTransportes: function() {
                        document.getElementById('proprios-total').value = App.data.transportes.propriosTotal;
                        document.getElementById('proprios-parados').value = App.data.transportes.propriosParados;
                        document.getElementById('terceiros-total').value = App.data.transportes.terceirosTotal;
                        document.getElementById('terceiros-parados').value = App.data.transportes.terceirosParados;
                        document.getElementById('bv-total').value = App.data.transportes.bvTotal;
                        document.getElementById('bv-parados').value = App.data.transportes.bvParados;
                        
                        document.getElementById('horas-prop-4001').value = App.data.horasTrabalhadas.prop4001;
                        document.getElementById('horas-prop-4002').value = App.data.horasTrabalhadas.prop4002;
                        document.getElementById('horas-terc').value = App.data.horasTrabalhadas.terc;
                        
                        DataHandler.updateTransportes();
                    },
                    
                    // Atualizar frentes recentes
                    updateRecentFrentes: function() {
                        const tbody = document.querySelector('#recentes-frentes-table tbody');
                        tbody.innerHTML = '';
                        
                        // Obter frentes ordenadas por data de criação (mais recentes primeiro)
                        const recentFrentes = [...App.data.frentes]
                            .filter(f => f.createdAt) // filtrar entradas sem data
                            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                            .slice(0, 5); // pegar as 5 mais recentes
                        
                        if (recentFrentes.length === 0) {
                            const emptyRow = document.createElement('tr');
                            emptyRow.innerHTML = `
                                <td colspan="6" class="empty-state">
                                    <i class="fas fa-truck-moving" aria-hidden="true"></i>
                                    Nenhuma frente cadastrada recentemente.
                                </td>
                            `;
                            tbody.appendChild(emptyRow);
                        } else {
                            recentFrentes.forEach(frente => {
                                const row = document.createElement('tr');
                                
                                row.innerHTML = `
                                    <td>${frente.frente}</td>
                                    <td>${frente.cota}</td>
                                    <td>${frente.dist}</td>
                                    <td>${frente.transporte === 'P' ? 'Próprio' : 'Terceiro'}</td>
                                    <td>${this.formatShortDate(frente.createdAt)}</td>
                                    <td>
                                        <button class="btn btn-sm btn-view-frente" data-frente="${frente.frente}" title="Visualizar detalhes">
                                            <i class="fas fa-eye" aria-hidden="true"></i>
                                        </button>
                                        <button class="btn btn-sm btn-edit-frente" data-frente="${frente.frente}" title="Editar frente">
                                            <i class="fas fa-edit" aria-hidden="true"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger btn-delete-frente" data-frente="${frente.frente}" title="Excluir frente">
                                            <i class="fas fa-trash" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                `;
                                
                                tbody.appendChild(row);
                            });
                        }
                        
                        // Inicializar DataTable
                        if (typeof jQuery !== 'undefined' && typeof $.fn.DataTable !== 'undefined') {
                            try {
                                if (App.state.dataTables.recentFrente) {
                                    App.state.dataTables.recentFrente.destroy();
                                }
                                
                                App.state.dataTables.recentFrente = $('#recentes-frentes-table').DataTable({
                                    paging: false,
                                    searching: false,
                                    ordering: true,
                                    info: false,
                                    responsive: true,
                                    language: {
                                        url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/pt-BR.json'
                                    }
                                });
                            } catch (error) {
                                console.warn('Erro ao inicializar DataTable para frentes recentes:', error);
                            }
                        }
                    },
                    
                    // Atualizar resumo de frentes no dashboard
                    updateResumoFrentes: function() {
                        const tbody = document.querySelector('#resumo-frentes-table tbody');
                        tbody.innerHTML = '';
                        
                        if (App.data.frentes.length === 0 || App.data.potencial.length === 0) {
                            const emptyRow = document.createElement('tr');
                            emptyRow.innerHTML = `
                                <td colspan="6" class="empty-state">
                                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                                    Nenhum dado disponível para exibição.
                                </td>
                            `;
                            tbody.appendChild(emptyRow);
                        } else {
                            App.data.frentes.forEach((frente, index) => {
                                const potencial = App.data.potencial[index];
                                if (!potencial) return;
                                
                                const row = document.createElement('tr');
                                
                                // Calcular capacidade percentual
                                const cotaTH = potencial.cota || 0;
                                const capFrente = potencial.limitante || 0;
                                const capacidadePercentual = cotaTH > 0 ? (capFrente / cotaTH) * 100 : 0;
                                
                                const statusClass = capacidadePercentual >= 100 ? 'badge-success' :
                                                   capacidadePercentual >= 90 ? 'badge-info' :
                                                   capacidadePercentual >= 75 ? 'badge-warning' : 'badge-danger';
                                
                                const status = capacidadePercentual >= 100 ? 'ÓTIMO' :
                                             capacidadePercentual >= 90 ? 'BOM' :
                                             capacidadePercentual >= 75 ? 'REGULAR' : 'INSUFICIENTE';
                                
                                row.innerHTML = `
                                    <td>${frente.frente}</td>
                                    <td>${frente.cota}</td>
                                    <td>${capFrente.toFixed(2)}</td>
                                    <td>${capacidadePercentual.toFixed(1)}%</td>
                                    <td><span class="badge ${statusClass}">${status}</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-view-frente" data-frente="${frente.frente}" title="Visualizar detalhes">
                                            <i class="fas fa-eye" aria-hidden="true"></i>
                                        </button>
                                        <button class="btn btn-sm btn-edit-frente" data-frente="${frente.frente}" title="Editar frente">
                                            <i class="fas fa-edit" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                `;
                                
                                tbody.appendChild(row);
                            });
                        }
                        
                        // Inicializar DataTable
                        if (typeof jQuery !== 'undefined' && typeof $.fn.DataTable !== 'undefined') {
                            try {
                                if (App.state.dataTables.resumoFrente) {
                                    App.state.dataTables.resumoFrente.destroy();
                                }
                                
                                App.state.dataTables.resumoFrente = $('#resumo-frentes-table').DataTable({
                                    paging: false,
                                    searching: false,
                                    ordering: true,
                                    info: false,
                                    responsive: true,
                                    language: {
                                        url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/pt-BR.json'
                                    }
                                });
                            } catch (error) {
                                console.warn('Erro ao inicializar DataTable para resumo de frentes:', error);
                            }
                        }
                    },
                    
                    // Mostrar detalhes da frente
                    showFrenteDetails: function(frente) {
                        const frenteData = App.data.frentes.find(f => f.frente === frente);
                        if (!frenteData) {
                            this.showToast('Frente não encontrada', 'error');
                            return;
                        }
                        
                        // Encontrar potencial correspondente
                        const potencialData = App.data.potencial.find(p => p.frente === frente) || {};
                        
                        // Criar modal dinamicamente
                        const modalHTML = `
                            <div id="frente-details-modal" class="modal" style="display: flex;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h3>Detalhes da Frente ${frente}</h3>
                                        <button class="modal-close">&times;</button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <label>Cota:</label>
                                            <input type="text" value="${frenteData.cota}" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Distância:</label>
                                            <input type="text" value="${frenteData.dist} km" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Transporte:</label>
                                            <input type="text" value="${frenteData.transporte === 'P' ? 'Próprio' : 'Terceiro'}" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Peso:</label>
                                            <input type="text" value="${frenteData.peso} toneladas" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Tempo Ciclo:</label>
                                            <input type="text" value="${(parseFloat(frenteData.ida) + parseFloat(frenteData.campo) + parseFloat(frenteData.volta) + parseFloat(frenteData.usina)).toFixed(2)} minutos" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Potencial Limitante:</label>
                                            <input type="text" value="${potencialData.limitante?.toFixed(2) || 'N/A'} t/h" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Estratégia de Controle:</label>
                                            <input type="text" value="${potencialData.estrategia?.toFixed(2) || 'N/A'}" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Frota:</label>
                                            <input type="text" value="${potencialData.frota?.toFixed(2) || 'N/A'}" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Status:</label>
                                            <input type="text" value="${potencialData.status || 'N/A'}" readonly>
                                        </div>
                                        <div class="form-row">
                                            <label>Observações:</label>
                                            <textarea readonly>${frenteData.obs || 'Nenhuma observação'}</textarea>
                                        </div>
                                        <div class="form-row">
                                            <label>Data de Cadastro:</label>
                                            <input type="text" value="${this.formatDate(frenteData.createdAt)}" readonly>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="close-details" class="btn">Fechar</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Adicionar modal ao DOM
                        const modalContainer = document.createElement('div');
                        modalContainer.innerHTML = modalHTML;
                        document.body.appendChild(modalContainer);
                        
                        // Configurar eventos
                        document.querySelector('#frente-details-modal .modal-close').addEventListener('click', () => {
                            document.getElementById('frente-details-modal').remove();
                        });
                        
                        document.getElementById('close-details').addEventListener('click', () => {
                            document.getElementById('frente-details-modal').remove();
                        });
                    },
                    
                    // Mostrar comparação de frentes
                    showFrentesComparison: function() {
                        // Verificar se há frentes suficientes
                        if (App.data.frentes.length < 2) {
                            this.showToast('É necessário ter pelo menos 2 frentes para comparar', 'warning');
                            return;
                        }
                        
                        // Criar modal dinamicamente
                        const frentesOptions = App.data.frentes.map(f => 
                            `<option value="${f.frente}">Frente ${f.frente}</option>`
                        ).join('');
                        
                        const modalHTML = `
                            <div id="frentes-comparison-modal" class="modal" style="display: flex;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h3>Comparar Frentes</h3>
                                        <button class="modal-close">&times;</button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <label for="compare-frente-1">Frente 1:</label>
                                            <select id="compare-frente-1">
                                                ${frentesOptions}
                                            </select>
                                        </div>
                                        <div class="form-row">
                                            <label for="compare-frente-2">Frente 2:</label>
                                            <select id="compare-frente-2">
                                                ${frentesOptions}
                                            </select>
                                        </div>
                                        <div class="form-row">
                                            <label for="compare-metrics">Métricas para comparar:</label>
                                            <select id="compare-metrics" multiple>
                                                <option value="cota" selected>Cota</option>
                                                <option value="dist" selected>Distância</option>
                                                <option value="tempo" selected>Tempo Ciclo</option>
                                                <option value="potencial" selected>Potencial Limitante</option>
                                                <option value="estrategia">Estratégia de Controle</option>
                                                <option value="frota">Frota</option>
                                            </select>
                                        </div>
                                        
                                        <div id="comparison-result" style="margin-top: 1.5rem; display: none;">
                                            <h4>Resultado da Comparação</h4>
                                            <div id="comparison-chart-container" class="chart-container" style="height: 300px;">
                                                <canvas id="comparison-chart"></canvas>
                                            </div>
                                            <div id="comparison-table-container" class="table-container">
                                                <table class="data-table" id="comparison-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Métrica</th>
                                                            <th id="compare-col-1">Frente 1</th>
                                                            <th id="compare-col-2">Frente 2</th>
                                                            <th>Diferença</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Preenchido dinamicamente -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="run-comparison" class="btn">Comparar</button>
                                        <button id="close-comparison" class="btn btn-secondary">Fechar</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Adicionar modal ao DOM
                        const modalContainer = document.createElement('div');
                        modalContainer.innerHTML = modalHTML;
                        document.body.appendChild(modalContainer);
                        
                        // Configurar eventos
                        document.querySelector('#frentes-comparison-modal .modal-close').addEventListener('click', () => {
                            document.getElementById('frentes-comparison-modal').remove();
                        });
                        
                        document.getElementById('close-comparison').addEventListener('click', () => {
                            document.getElementById('frentes-comparison-modal').remove();
                        });
                        
                        document.getElementById('run-comparison').addEventListener('click', () => {
                            const frente1Id = document.getElementById('compare-frente-1').value;
                            const frente2Id = document.getElementById('compare-frente-2').value;
                            
                            if (frente1Id === frente2Id) {
                                this.showToast('Selecione frentes diferentes para comparar', 'warning');
                                return;
                            }
                            
                            // Obter dados das frentes
                            const frente1 = App.data.frentes.find(f => f.frente === frente1Id);
                            const frente2 = App.data.frentes.find(f => f.frente === frente2Id);
                            
                            // Obter dados de potencial
                            const potencial1 = App.data.potencial.find(p => p.frente === frente1Id) || {};
                            const potencial2 = App.data.potencial.find(p => p.frente === frente2Id) || {};
                            
                            // Obter métricas selecionadas
                            const metricsSelect = document.getElementById('compare-metrics');
                            const selectedMetrics = Array.from(metricsSelect.selectedOptions).map(o => o.value);
                            
                            // Preparar dados para o gráfico e tabela
                            const compareData = {
                                cota: {
                                    label: 'Cota',
                                    frente1: frente1.cota,
                                    frente2: frente2.cota,
                                    unit: 't'
                                },
                                dist: {
                                    label: 'Distância',
                                    frente1: frente1.dist,
                                    frente2: frente2.dist,
                                    unit: 'km'
                                },
                                tempo: {
                                    label: 'Tempo Ciclo',
                                    frente1: (parseFloat(frente1.ida) + parseFloat(frente1.campo) + parseFloat(frente1.volta) + parseFloat(frente1.usina)).toFixed(2),
                                    frente2: (parseFloat(frente2.ida) + parseFloat(frente2.campo) + parseFloat(frente2.volta) + parseFloat(frente2.usina)).toFixed(2),
                                    unit: 'min'
                                },
                                potencial: {
                                    label: 'Potencial Limitante',
                                    frente1: potencial1.limitante || 0,
                                    frente2: potencial2.limitante || 0,
                                    unit: 't/h'
                                },
                                estrategia: {
                                    label: 'Estratégia de Controle',
                                    frente1: potencial1.estrategia || 0,
                                    frente2: potencial2.estrategia || 0,
                                    unit: ''
                                },
                                frota: {
                                    label: 'Frota',
                                    frente1: potencial1.frota || 0,
                                    frente2: potencial2.frota || 0,
                                    unit: ''
                                }
                            };
                            
                            // Filtrar apenas métricas selecionadas
                            const filteredData = {};
                            selectedMetrics.forEach(metric => {
                                filteredData[metric] = compareData[metric];
                            });
                            
                            // Mostrar resultado
                            document.getElementById('comparison-result').style.display = 'block';
                            
                            // Atualizar cabeçalhos da tabela
                            document.getElementById('compare-col-1').textContent = `Frente ${frente1Id}`;
                            document.getElementById('compare-col-2').textContent = `Frente ${frente2Id}`;
                            
                            // Preencher tabela
                            const tbody = document.querySelector('#comparison-table tbody');
                            tbody.innerHTML = '';
                            
                            Object.entries(filteredData).forEach(([key, data]) => {
                                const row = document.createElement('tr');
                                const diff = (parseFloat(data.frente1) - parseFloat(data.frente2)).toFixed(2);
                                const percentDiff = parseFloat(data.frente2) !== 0 ? 
                                    (diff / parseFloat(data.frente2) * 100).toFixed(1) : 'N/A';
                                
                                row.innerHTML = `
                                    <td>${data.label}</td>
                                    <td>${data.frente1} ${data.unit}</td>
                                    <td>${data.frente2} ${data.unit}</td>
                                    <td>${diff} ${data.unit} (${percentDiff}%)</td>
                                `;
                                
                                tbody.appendChild(row);
                            });
                            
                            // Criar gráfico
                            this.createComparisonChart(
                                filteredData, 
                                Object.values(filteredData).map(d => d.label),
                                [frente1Id, frente2Id]
                            );
                        });
                    },
                    
                    // Criar gráfico de comparação
                    createComparisonChart: function(data, labels, frenteIds) {
                        const ctx = document.getElementById('comparison-chart').getContext('2d');
                        
                        // Destruir gráfico existente, se houver
                        if (window.comparisonChart) {
                            window.comparisonChart.destroy();
                        }
                        
                        // Preparar dados para o gráfico
                        const datasets = [
                            {
                                label: `Frente ${frenteIds[0]}`,
                                data: Object.values(data).map(d => d.frente1),
                                backgroundColor: 'rgba(92, 107, 192, 0.5)',
                                borderColor: 'rgba(92, 107, 192, 1)',
                                borderWidth: 1
                            },
                            {
                                label: `Frente ${frenteIds[1]}`,
                                data: Object.values(data).map(d => d.frente2),
                                backgroundColor: 'rgba(66, 165, 245, 0.5)',
                                borderColor: 'rgba(66, 165, 245, 1)',
                                borderWidth: 1
                            }
                        ];
                        
                        window.comparisonChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: datasets
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: `Comparação entre Frentes ${frenteIds[0]} e ${frenteIds[1]}`
                                    },
                                    legend: {
                                        position: 'top',
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return value;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    },
                    
                    // Atualizar lista de histórico
                    updateHistoryList: function() {
                        const container = document.getElementById('history-container');
                        if (!container) return;
                        
                        // Filtrar entradas
                        const typeFilter = document.getElementById('history-filter-type').value;
                        const entityFilter = document.getElementById('history-filter-entity').value;
                        const dateFilter = document.getElementById('history-filter-date').value;
                        
                        let filteredHistory = [...App.data.historico];
                        
                        if (typeFilter) {
                            filteredHistory = filteredHistory.filter(h => h.tipo === typeFilter);
                        }
                        
                        if (entityFilter) {
                            filteredHistory = filteredHistory.filter(h => h.entidade === entityFilter);
                        }
                        
                        if (dateFilter) {
                            const now = new Date();
                            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                            const yesterday = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);
                            const lastWeek = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);
                            const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                            
                            filteredHistory = filteredHistory.filter(h => {
                                const entryDate = new Date(h.data);
                                
                                if (dateFilter === 'today') {
                                    return entryDate >= today;
                                } else if (dateFilter === 'yesterday') {
                                    return entryDate >= yesterday && entryDate < today;
                                } else if (dateFilter === 'week') {
                                    return entryDate >= lastWeek;
                                } else if (dateFilter === 'month') {
                                    return entryDate >= lastMonth;
                                }
                                
                                return true;
                            });
                        }
                        
                        // Limpar conteúdo
                        container.innerHTML = '';
                        
                        if (filteredHistory.length === 0) {
                            container.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-history" aria-hidden="true"></i>
                                    Nenhum registro histórico encontrado.
                                </div>
                            `;
                            return;
                        }
                        
                        // Preencher conteúdo
                        filteredHistory.forEach(entry => {
                            const iconClass = entry.tipo === 'add' ? 'add' :
                                          entry.tipo === 'edit' ? 'edit' :
                                          entry.tipo === 'delete' ? 'delete' : 'system';
                            
                            const iconContent = entry.tipo === 'add' ? '<i class="fas fa-plus"></i>' :
                                              entry.tipo === 'edit' ? '<i class="fas fa-edit"></i>' :
                                              entry.tipo === 'delete' ? '<i class="fas fa-trash"></i>' :
                                              '<i class="fas fa-cog"></i>';
                            
                            const historyEntry = document.createElement('div');
                            historyEntry.className = 'history-entry';
                            historyEntry.innerHTML = `
                                <div class="history-icon ${iconClass}">
                                    ${iconContent}
                                </div>
                                <div class="history-content">
                                    <div class="history-title">${entry.titulo}</div>
                                    <div class="history-desc">${entry.descricao}</div>
                                    <div class="history-time">${this.formatDate(entry.data)} - ${entry.usuario}</div>
                                </div>
                            `;
                            
                            container.appendChild(historyEntry);
                        });
                        
                        // Atualizar gráfico
                        this.updateHistoryChart();
                    },
                    
                    // Gerar relatório
                    generateReport: function() {
                        const reportType = document.getElementById('report-type').value;
                        const frenteFilter = document.getElementById('report-frente').value;
                        const format = document.getElementById('report-format').value;
                        const dateRange = document.getElementById('report-date-range').value;
                        const includeCharts = document.getElementById('report-include-charts').checked;
                        const includeSummary = document.getElementById('report-include-summary').checked;
                        const includeComparison = document.getElementById('report-include-comparison').checked;
                        
                        // Verificar se há dados suficientes
                        if (App.data.frentes.length === 0) {
                            this.showToast('Não há dados suficientes para gerar o relatório.', 'warning');
                            return;
                        }
                        
                        // Preparar relatório básico
                        const reportContainer = document.getElementById('report-preview');
                        reportContainer.innerHTML = '';
                        
                        // Criar título e cabeçalho
                        const title = document.createElement('h3');
                        title.textContent = `Relatório de ${this.getReportTypeName(reportType)}`;
                        reportContainer.appendChild(title);
                        
                        const subtitle = document.createElement('p');
                        subtitle.innerHTML = `
                            <strong>Data:</strong> ${new Date().toLocaleDateString('pt-BR')}<br>
                            <strong>Período:</strong> ${this.getDateRangeName(dateRange)}<br>
                            <strong>Usina:</strong> Cambuí Açúcar & Álcool
                        `;
                        reportContainer.appendChild(subtitle);
                        
                        // Adicionar resumo se solicitado
                        if (includeSummary) {
                            const summary = document.createElement('div');
                            summary.className = 'section';
                            summary.innerHTML = `
                                <h4>Resumo Executivo</h4>
                                <p>Este relatório apresenta uma análise detalhada do ${this.getReportTypeName(reportType).toLowerCase()}
                                da Usina Cambuí Açúcar & Álcool. Os dados foram coletados e processados pelo sistema de gestão
                                de colheita e transporte.</p>
                                
                                <p><strong>Principais indicadores:</strong></p>
                                <ul>
                                    <li>Total de frentes: ${App.data.frentes.length}</li>
                                    <li>Potencial total de colheita: ${(document.getElementById('potencial-colheita').value || 0)} t/h</li>
                                    <li>Potencial total de transporte: ${(document.getElementById('potencial-transporte').value || 0)} t/h</li>
                                    <li>Fator limitante do sistema: ${(document.getElementById('limitante-sistema').value || 'N/A')}</li>
                                </ul>
                            `;
                            reportContainer.appendChild(summary);
                        }
                        
                        // Adicionar conteúdo específico pelo tipo de relatório
                        switch (reportType) {
                            case 'potencial':
                                this.addPotencialReport(reportContainer, frenteFilter, includeCharts);
                                break;
                            case 'frentes':
                                this.addFrentesReport(reportContainer, frenteFilter, includeCharts);
                                break;
                            case 'equipamentos':
                                this.addEquipamentosReport(reportContainer, frenteFilter, includeCharts);
                                break;
                            case 'transporte':
                                this.addTransporteReport(reportContainer, includeCharts);
                                break;
                            case 'completo':
                                this.addPotencialReport(reportContainer, frenteFilter, includeCharts);
                                this.addFrentesReport(reportContainer, frenteFilter, includeCharts);
                                this.addEquipamentosReport(reportContainer, frenteFilter, includeCharts);
                                this.addTransporteReport(reportContainer, includeCharts);
                                break;
                        }
                        
                        // Adicionar comparação com período anterior, se solicitado
                        if (includeComparison) {
                            const comparison = document.createElement('div');
                            comparison.className = 'section';
                            comparison.innerHTML = `
                                <h4>Comparação com Período Anterior</h4>
                                <p>Esta seção apresenta uma comparação com o período anterior para avaliar a evolução dos indicadores.</p>
                                
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Indicador</th>
                                                <th>Período Atual</th>
                                                <th>Período Anterior</th>
                                                <th>Variação</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Potencial de Colheita</td>
                                                <td>${(document.getElementById('potencial-colheita').value || 0)} t/h</td>
                                                <td>430.00 t/h</td>
                                                <td>+4.7%</td>
                                            </tr>
                                            <tr>
                                                <td>Potencial de Transporte</td>
                                                <td>${(document.getElementById('potencial-transporte').value || 0)} t/h</td>
                                                <td>385.00 t/h</td>
                                                <td>+2.6%</td>
                                            </tr>
                                            <tr>
                                                <td>Disponibilidade de Caminhões</td>
                                                <td>${(parseInt(document.getElementById('proprios-disponiveis').value) + parseInt(document.getElementById('terceiros-disponiveis').value) || 0)}</td>
                                                <td>33</td>
                                                <td>+6.1%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            `;
                            reportContainer.appendChild(comparison);
                        }
                        
                        // Adicionar conclusão
                        const conclusion = document.createElement('div');
                        conclusion.className = 'section';
                        conclusion.innerHTML = `
                            <h4>Conclusão</h4>
                            <p>Com base na análise dos dados apresentados, é possível concluir que o sistema de colheita e transporte
                            da Usina Cambuí Açúcar & Álcool está operando de forma ${document.getElementById('limitante-sistema').value === 'COLHEITA' ? 'eficiente' : 'limitada pelo transporte'}.</p>
                            
                            <p>Recomendações:</p>
                            <ul>
                                <li>${document.getElementById('limitante-sistema').value === 'COLHEITA' ? 'Manter o atual dimensionamento da frota de transporte.' : 'Avaliar a necessidade de aumentar a disponibilidade de caminhões para equilibrar o sistema.'}</li>
                                <li>Continuar monitorando os indicadores de desempenho para garantir a eficiência operacional.</li>
                                <li>Revisar periodicamente a estratégia de controle para otimizar a utilização dos recursos disponíveis.</li>
                            </ul>
                        `;
                        reportContainer.appendChild(conclusion);
                        
                        // Adicionar ao histórico
                        App.addHistoryEntry({
                            tipo: 'system',
                            entidade: 'dados',
                            titulo: `Geração de relatório`,
                            descricao: `Relatório de ${this.getReportTypeName(reportType)} gerado`,
                            data: new Date().toISOString(),
                            usuario: 'Administrador'
                        });
                        
                        // Exportar relatório se necessário
                        if (format !== 'html') {
                            this.showToast(`A exportação para ${format.toUpperCase()} não está disponível nesta versão.`, 'warning');
                        }
                    },
                    
                    // Obter nome do tipo de relatório
                    getReportTypeName: function(type) {
                        const names = {
                            'potencial': 'Potencial de Colheita',
                            'frentes': 'Dados das Frentes',
                            'equipamentos': 'Dados dos Equipamentos',
                            'transporte': 'Análise de Transporte',
                            'completo': 'Análise Completa'
                        };
                        
                        return names[type] || type;
                    },
                    
                    // Obter nome do período
                    getDateRangeName: function(range) {
                        const names = {
                            'today': 'Hoje',
                            'week': 'Última Semana',
                            'month': 'Último Mês',
                            'custom': 'Personalizado'
                        };
                        
                        return names[range] || range;
                    },
                    
                    // Adicionar relatório de potencial
                    addPotencialReport: function(container, frenteFilter, includeCharts) {
                        const section = document.createElement('div');
                        section.className = 'section';
                        section.innerHTML = `
                            <h4>Potencial de Colheita</h4>
                            <p>Análise do potencial de colheita por frente, considerando as limitações de equipamentos e transporte.</p>
                        `;
                        
                        // Adicionar tabela
                        const tableContainer = document.createElement('div');
                        tableContainer.className = 'table-container';
                        
                        const table = document.createElement('table');
                        table.className = 'data-table';
                        table.innerHTML = `
                            <thead>
                                <tr>
                                    <th>Frente</th>
                                    <th>Cota (t/h)</th>
                                    <th>Potencial Limitante (t/h)</th>
                                    <th>Estratégia</th>
                                    <th>Frota</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${App.data.potencial.filter(p => !frenteFilter || p.frente === frenteFilter).map(p => `
                                    <tr>
                                        <td>${p.frente}</td>
                                        <td>${p.cota.toFixed(2)}</td>
                                        <td>${p.limitante.toFixed(2)}</td>
                                        <td>${p.estrategia.toFixed(2)}</td>
                                        <td>${p.frota.toFixed(2)}</td>
                                        <td>${p.status}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td>TOTAL</td>
                                    <td>${document.getElementById('potencial-total-cota').value}</td>
                                    <td>${document.getElementById('potencial-total-limitante').value}</td>
                                    <td>${document.getElementById('potencial-total-estrategia').value}</td>
                                    <td>${document.getElementById('potencial-total-frota').value}</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        `;
                        
                        tableContainer.appendChild(table);
                        section.appendChild(tableContainer);
                        
                        // Adicionar gráfico se solicitado
                        if (includeCharts) {
                            const chartContainer = document.createElement('div');
                            chartContainer.className = 'chart-container report-chart';
                            chartContainer.style.height = '300px';
                            
                            // Não criamos o canvas real aqui, apenas uma imagem representativa
                            chartContainer.innerHTML = `
                                <div style="text-align:center; padding-top: 100px;">
                                    <i class="fas fa-chart-bar" style="font-size: 48px; color: var(--primary-color);"></i>
                                    <p>Gráfico de Potencial de Colheita</p>
                                </div>
                            `;
                            
                            section.appendChild(chartContainer);
                        }
                        
                        container.appendChild(section);
                    },
                    
                    // Adicionar relatório de frentes
                    addFrentesReport: function(container, frenteFilter, includeCharts) {
                        const section = document.createElement('div');
                        section.className = 'section';
                        section.innerHTML = `
                            <h4>Dados das Frentes</h4>
                            <p>Informações detalhadas sobre cada frente de colheita, incluindo tempos de ciclo e distâncias.</p>
                        `;
                        
                        // Adicionar tabela
                        const tableContainer = document.createElement('div');
                        tableContainer.className = 'table-container';
                        
                        const table = document.createElement('table');
                        table.className = 'data-table';
                        table.innerHTML = `
                            <thead>
                                <tr>
                                    <th>Frente</th>
                                    <th>Cota</th>
                                    <th>Dist (KM)</th>
                                    <th>Tempo Ciclo (min)</th>
                                    <th>Peso (t)</th>
                                    <th>Transporte</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${App.data.frentes.filter(f => !frenteFilter || f.frente === frenteFilter).map(f => `
                                    <tr>
                                        <td>${f.frente}</td>
                                        <td>${f.cota}</td>
                                        <td>${f.dist}</td>
                                        <td>${(parseFloat(f.ida) + parseFloat(f.campo) + parseFloat(f.volta) + parseFloat(f.usina)).toFixed(2)}</td>
                                        <td>${f.peso}</td>
                                        <td>${f.transporte === 'P' ? 'Próprio' : 'Terceiro'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td>TOTAL</td>
                                    <td>${document.getElementById('frentes-total-cota').value}</td>
                                    <td>${document.getElementById('frentes-media-dist').value}</td>
                                    <td>${document.getElementById('frentes-media-total').value}</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        `;
                        
                        tableContainer.appendChild(table);
                        section.appendChild(tableContainer);
                        
                        // Adicionar gráfico se solicitado
                        if (includeCharts) {
                            const chartContainer = document.createElement('div');
                            chartContainer.className = 'chart-container report-chart';
                            chartContainer.style.height = '300px';
                            
                            // Não criamos o canvas real aqui, apenas uma imagem representativa
                            chartContainer.innerHTML = `
                                <div style="text-align:center; padding-top: 100px;">
                                    <i class="fas fa-chart-line" style="font-size: 48px; color: var(--primary-color);"></i>
                                    <p>Gráfico de Tempos de Ciclo</p>
                                </div>
                            `;
                            
                            section.appendChild(chartContainer);
                        }
                        
                        container.appendChild(section);
                    },
                    
                    // Adicionar relatório de equipamentos
                    addEquipamentosReport: function(container, frenteFilter, includeCharts) {
                        const section = document.createElement('div');
                        section.className = 'section';
                        section.innerHTML = `
                            <h4>Dados dos Equipamentos</h4>
                            <p>Informações sobre a disponibilidade e produtividade dos equipamentos por frente.</p>
                        `;
                        
                        // Filtrar frentes
                        const frentesToShow = frenteFilter ? 
                            [frenteFilter] : 
                            Object.keys(App.data.equipamentos);
                        
                        // Para cada frente, criar uma subseção
                        frentesToShow.forEach(frente => {
                            const equipamentos = App.data.equipamentos[frente];
                            if (!equipamentos || equipamentos.length === 0) return;
                            
                            const frenteSection = document.createElement('div');
                            frenteSection.innerHTML = `
                                <h5>Frente ${frente}</h5>
                            `;
                            
                            // Adicionar tabela
                            const tableContainer = document.createElement('div');
                            tableContainer.className = 'table-container';
                            
                            const table = document.createElement('table');
                            table.className = 'data-table';
                            table.innerHTML = `
                                <thead>
                                    <tr>
                                        <th>Equipamento</th>
                                        <th>Carreg (min)</th>
                                        <th>Aux (min)</th>
                                        <th>Disponível</th>
                                        <th>Produção (t/h)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${equipamentos.map(e => `
                                        <tr>
                                            <td>${e.equipo}</td>
                                            <td>${e.carreg}</td>
                                            <td>${e.aux}</td>
                                            <td>${e.disponivel === 1 ? 'Sim' : 'Não'}</td>
                                            <td>${e.producao.toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>TOTAL</td>
                                        <td></td>
                                        <td></td>
                                        <td>${equipamentos.filter(e => e.disponivel === 1).length} / ${equipamentos.length}</td>
                                        <td>${equipamentos.reduce((sum, e) => sum + e.producao, 0).toFixed(2)}</td>
                                    </tr>
                                </tfoot>
                            `;
                            
                            tableContainer.appendChild(table);
                            frenteSection.appendChild(tableContainer);
                            
                            // Adicionar informações de capacidade
                            const capacidadeInfo = document.createElement('div');
                            capacidadeInfo.innerHTML = `
                                <div style="margin-top: 1rem;">
                                    <p><strong>Capacidade Colhedoras:</strong> ${document.getElementById(`${frente}-cap-colhedoras`)?.value || 'N/A'} t/h</p>
                                    <p><strong>Capacidade Tratores:</strong> ${document.getElementById(`${frente}-cap-tratores`)?.value || 'N/A'} t/h</p>
                                    <p><strong>Capacidade da Frente:</strong> ${document.getElementById(`${frente}-cap-frente`)?.value || 'N/A'} t/h</p>
                                </div>
                            `;
                            
                            frenteSection.appendChild(capacidadeInfo);
                            section.appendChild(frenteSection);
                        });
                        
                        // Adicionar gráfico se solicitado
                        if (includeCharts) {
                            const chartContainer = document.createElement('div');
                            chartContainer.className = 'chart-container report-chart';
                            chartContainer.style.height = '300px';
                            
                            // Não criamos o canvas real aqui, apenas uma imagem representativa
                            chartContainer.innerHTML = `
                                <div style="text-align:center; padding-top: 100px;">
                                    <i class="fas fa-chart-pie" style="font-size: 48px; color: var(--primary-color);"></i>
                                    <p>Gráfico de Produtividade dos Equipamentos</p>
                                </div>
                            `;
                            
                            section.appendChild(chartContainer);
                        }
                        
                        container.appendChild(section);
                    },
                    
                    // Adicionar relatório de transporte
                    addTransporteReport: function(container, includeCharts) {
                        const section = document.createElement('div');
                        section.className = 'section';
                        section.innerHTML = `
                            <h4>Análise de Transporte</h4>
                            <p>Informações sobre a disponibilidade e utilização da frota de transporte.</p>
                        `;
                        
                        // Adicionar tabela resumo
                        const tableContainer = document.createElement('div');
                        tableContainer.className = 'table-container';
                        
                        const table = document.createElement('table');
                        table.className = 'data-table';
                        table.innerHTML = `
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Total</th>
                                    <th>Parados</th>
                                    <th>Disponíveis</th>
                                    <th>Necessários</th>
                                    <th>Disponibilidade (%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Caminhões Próprios</td>
                                    <td>${App.data.transportes.propriosTotal}</td>
                                    <td>${App.data.transportes.propriosParados}</td>
                                    <td>${App.data.transportes.propriosTotal - App.data.transportes.propriosParados}</td>
                                    <td>${document.getElementById('proprios-necessarios').value}</td>
                                    <td>${((App.data.transportes.propriosTotal - App.data.transportes.propriosParados) / App.data.transportes.propriosTotal * 100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Caminhões Terceiros</td>
                                    <td>${App.data.transportes.terceirosTotal}</td>
                                    <td>${App.data.transportes.terceirosParados}</td>
                                    <td>${App.data.transportes.terceirosTotal - App.data.transportes.terceirosParados}</td>
                                    <td>${document.getElementById('terceiros-necessarios').value}</td>
                                    <td>${((App.data.transportes.terceirosTotal - App.data.transportes.terceirosParados) / App.data.transportes.terceirosTotal * 100).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td>Conjuntos de BV</td>
                                    <td>${App.data.transportes.bvTotal}</td>
                                    <td>${App.data.transportes.bvParados}</td>
                                    <td>${App.data.transportes.bvTotal - App.data.transportes.bvParados}</td>
                                    <td>${document.getElementById('bv-necessarios').value}</td>
                                    <td>${((App.data.transportes.bvTotal - App.data.transportes.bvParados) / App.data.transportes.bvTotal * 100).toFixed(1)}%</td>
                                </tr>
                            </tbody>
                        `;
                        
                        tableContainer.appendChild(table);
                        section.appendChild(tableContainer);
                        
                        // Adicionar informações adicionais
                        const infoContainer = document.createElement('div');
                        infoContainer.style.marginTop = '1rem';
                        infoContainer.innerHTML = `
                            <p><strong>Potencial de Colheita:</strong> ${document.getElementById('potencial-colheita').value} t/h</p>
                            <p><strong>Potencial de Transporte:</strong> ${document.getElementById('potencial-transporte').value} t/h</p>
                            <p><strong>Fator Limitante do Sistema:</strong> ${document.getElementById('limitante-sistema').value}</p>
                        `;
                        
                        section.appendChild(infoContainer);
                        
                        // Adicionar gráfico se solicitado
                        if (includeCharts) {
                            const chartContainer = document.createElement('div');
                            chartContainer.className = 'chart-container report-chart';
                            chartContainer.style.height = '300px';
                            
                            // Não criamos o canvas real aqui, apenas uma imagem representativa
                            chartContainer.innerHTML = `
                                <div style="text-align:center; padding-top: 100px;">
                                    <i class="fas fa-chart-bar" style="font-size: 48px; color: var(--primary-color);"></i>
                                    <p>Gráfico de Disponibilidade de Transporte</p>
                                </div>
                            `;
                            
                            section.appendChild(chartContainer);
                        }
                        
                        container.appendChild(section);
                    },
                    
                    // Inicializar gráficos
                    initCharts: function() {
                        setTimeout(() => {
                            this.updatePotencialChart();
                            this.updateTransporteChart();
                            this.updateEfficiencyChart();
                            this.updateTempoCicloChart();
                            this.updateProdutividadeChart();
                            this.updateHistoryChart();
                            this.updateColheitaComparativoChart();
                            this.updateColheitaHistoricoChart();
                        }, 300);
                    },
                    
                    // Atualizar gráfico de potencial
                    updatePotencialChart: function() {
                        const canvas = document.getElementById('potencialChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Verificar se há dados de potencial
                        if (!App.data.potencial || App.data.potencial.length === 0) {
                            if (App.charts.potencial) {
                                App.charts.potencial.destroy();
                                App.charts.potencial = null;
                            }
                            
                            // Mostrar mensagem de sem dados
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.font = '16px ' + getComputedStyle(document.body).getPropertyValue('--font-family');
                            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text-color');
                            ctx.fillText('Nenhum dado disponível. Calcule o potencial primeiro.', canvas.width / 2, canvas.height / 2);
                            
                            return;
                        }
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Preparar dados para o gráfico
                        const labels = App.data.potencial.map(p => `Frente ${p.frente}`);
                        const cotaData = App.data.potencial.map(p => p.cota || 0);
                        const maquinasData = App.data.potencial.map(p => p.maquinas || 0);
                        const tratoresData = App.data.potencial.map(p => p.tratores || 0);
                        const limitanteData = App.data.potencial.map(p => p.limitante || 0);
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: 'Cota (t/h)',
                                        data: cotaData,
                                        backgroundColor: '#00BCD4',
                                        borderColor: '#00ACC1',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Potencial Máquinas (t/h)',
                                        data: maquinasData,
                                        backgroundColor: '#4CAF50',
                                        borderColor: '#43A047',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Potencial Tratores (t/h)',
                                        data: tratoresData,
                                        backgroundColor: '#FFC107',
                                        borderColor: '#FFB300',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Potencial Limitante (t/h)',
                                        data: limitanteData,
                                        backgroundColor: '#F44336',
                                        borderColor: '#E53935',
                                        borderWidth: 1
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Potencial de Colheita por Frente',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: textColor
                                        }
                                    },
                                    tooltip: {
                                        mode: 'index',
                                        intersect: false
                                    },
                                    datalabels: App.config.ui.chartLabels ? {
                                        display: true,
                                        align: 'center',
                                        anchor: 'center',
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        },
                                        formatter: function(value) {
                                            return value.toFixed(0);
                                        }
                                    } : false
                                },
                                scales: {
                                    x: {
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    }
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.potencial) {
                            App.charts.potencial.data = config.data;
                            App.charts.potencial.options = config.options;
                            App.charts.potencial.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.potencial = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar gráfico de transporte
                    updateTransporteChart: function() {
                        const canvas = document.getElementById('transporteChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Obter dados de transporte
                        const propriosTotal = App.data.transportes.propriosTotal;
                        const propriosParados = App.data.transportes.propriosParados;
                        const propriosDisponiveis = propriosTotal - propriosParados;
                        
                        const terceirosTotal = App.data.transportes.terceirosTotal;
                        const terceirosParados = App.data.transportes.terceirosParados;
                        const terceirosDisponiveis = terceirosTotal - terceirosParados;
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'bar',
                            data: {
                                labels: ['Próprios', 'Terceiros'],
                                datasets: [
                                    {
                                        label: 'Disponíveis',
                                        data: [propriosDisponiveis, terceirosDisponiveis],
                                        backgroundColor: '#4CAF50',
                                        borderColor: '#43A047',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Parados',
                                        data: [propriosParados, terceirosParados],
                                        backgroundColor: '#F44336',
                                        borderColor: '#E53935',
                                        borderWidth: 1
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Disponibilidade de Transportes',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: textColor
                                        }
                                    },
                                    tooltip: {
                                        mode: 'index',
                                        intersect: false
                                    },
                                    datalabels: App.config.ui.chartLabels ? {
                                        display: true,
                                        align: 'center',
                                        anchor: 'center',
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        }
                                    } : false
                                },
                                scales: {
                                    x: {
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    }
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.transporteChart) {
                            App.charts.transporteChart.data = config.data;
                            App.charts.transporteChart.options = config.options;
                            App.charts.transporteChart.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.transporteChart = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar gráfico de eficiência
                    updateEfficiencyChart: function() {
                        const canvas = document.getElementById('eficienciaChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Obter dados
                        const potencialColheita = parseFloat(document.getElementById('potencial-colheita')?.value || 0);
                        const potencialTransporte = parseFloat(document.getElementById('potencial-transporte')?.value || 0);
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'pie',
                            data: {
                                labels: ['Potencial de Colheita', 'Potencial de Transporte'],
                                datasets: [
                                    {
                                        data: [potencialColheita, potencialTransporte],
                                        backgroundColor: [
                                            '#4CAF50',
                                            '#2196F3'
                                        ],
                                        borderColor: [
                                            '#43A047',
                                            '#1E88E5'
                                        ],
                                        borderWidth: 1
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Comparação Colheita vs Transporte',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: textColor
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.label}: ${context.raw.toFixed(2)} t/h`;
                                            }
                                        }
                                    },
                                    datalabels: App.config.ui.chartLabels ? {
                                        display: true,
                                        formatter: function(value, context) {
                                            return `${value.toFixed(0)} t/h`;
                                        },
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        }
                                    } : false
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.eficienciaChart) {
                            App.charts.eficienciaChart.data = config.data;
                            App.charts.eficienciaChart.options = config.options;
                            App.charts.eficienciaChart.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.eficienciaChart = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar gráfico de tempo de ciclo
                    updateTempoCicloChart: function() {
                        const canvas = document.getElementById('tempoCicloChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Verificar se há dados de frentes
                        if (!App.data.frentes || App.data.frentes.length === 0) {
                            if (App.charts.tempoCicloChart) {
                                App.charts.tempoCicloChart.destroy();
                                App.charts.tempoCicloChart = null;
                            }
                            
                            // Mostrar mensagem de sem dados
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.font = '16px ' + getComputedStyle(document.body).getPropertyValue('--font-family');
                            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text-color');
                            ctx.fillText('Nenhum dado disponível.', canvas.width / 2, canvas.height / 2);
                            
                            return;
                        }
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Preparar dados para o gráfico
                        const labels = App.data.frentes.map(f => `Frente ${f.frente}`);
                        const idaData = App.data.frentes.map(f => parseFloat(f.ida) || 0);
                        const campoData = App.data.frentes.map(f => parseFloat(f.campo) || 0);
                        const voltaData = App.data.frentes.map(f => parseFloat(f.volta) || 0);
                        const usinaData = App.data.frentes.map(f => parseFloat(f.usina) || 0);
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: 'Ida',
                                        data: idaData,
                                        backgroundColor: '#4CAF50',
                                        borderColor: '#43A047',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Campo',
                                        data: campoData,
                                        backgroundColor: '#FFC107',
                                        borderColor: '#FFB300',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Volta',
                                        data: voltaData,
                                        backgroundColor: '#2196F3',
                                        borderColor: '#1E88E5',
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Usina',
                                        data: usinaData,
                                        backgroundColor: '#9C27B0',
                                        borderColor: '#8E24AA',
                                        borderWidth: 1
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Tempo de Ciclo por Frente (min)',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: textColor
                                        }
                                    },
                                    tooltip: {
                                        mode: 'index',
                                        intersect: false
                                    },
                                    datalabels: App.config.ui.chartLabels ? {
                                        display: true,
                                        align: 'center',
                                        anchor: 'center',
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        },
                                        formatter: function(value) {
                                            return value > 0 ? value.toFixed(0) : '';
                                        }
                                    } : false
                                },
                                scales: {
                                    x: {
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    }
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.tempoCicloChart) {
                            App.charts.tempoCicloChart.data = config.data;
                            App.charts.tempoCicloChart.options = config.options;
                            App.charts.tempoCicloChart.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.tempoCicloChart = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar gráfico de produtividade
                    updateProdutividadeChart: function() {
                        const canvas = document.getElementById('produtividadeChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Verificar se há dados de equipamentos
                        const hasEquipamentos = Object.values(App.data.equipamentos).some(e => e && e.length > 0);
                        
                        if (!hasEquipamentos) {
                            if (App.charts.produtividadeChart) {
                                App.charts.produtividadeChart.destroy();
                                App.charts.produtividadeChart = null;
                            }
                            
                            // Mostrar mensagem de sem dados
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.font = '16px ' + getComputedStyle(document.body).getPropertyValue('--font-family');
                            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text-color');
                            ctx.fillText('Nenhum dado disponível.', canvas.width / 2, canvas.height / 2);
                            
                            return;
                        }
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Preparar dados para o gráfico
                        const datasets = [];
                        const labels = Object.keys(App.data.equipamentos).map(f => `Frente ${f}`);
                        
                        // Para cada frente, calcular a média de produção de colhedoras
                        Object.entries(App.data.equipamentos).forEach(([frente, equipamentos], index) => {
                            // Filtrar apenas colhedoras disponíveis
                            const colhedoras = equipamentos.filter(e => 
                                e.disponivel === 1 && e.equipo.toUpperCase().includes('COLHEDORA')
                            );
                            
                            const mediaProducao = colhedoras.length > 0 ?
                                colhedoras.reduce((sum, e) => sum + (e.producao || 0), 0) / colhedoras.length : 0;
                            
                            datasets.push({
                                label: `Frente ${frente}`,
                                data: Array(labels.length).fill(0).map((_, i) => i === index ? mediaProducao : 0),
                                backgroundColor: [
                                    '#4CAF50',
                                    '#2196F3',
                                    '#FF9800',
                                    '#9C27B0',
                                    '#F44336'
                                ][index % 5],
                                borderColor: [
                                    '#43A047',
                                    '#1E88E5',
                                    '#FB8C00',
                                    '#8E24AA',
                                    '#E53935'
                                ][index % 5],
                                borderWidth: 1
                            });
                        });
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: datasets
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Produtividade Média por Frente (t/h)',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.dataset.label}: ${context.raw.toFixed(2)} t/h`;
                                            }
                                        }
                                    },
                                    datalabels: App.config.ui.chartLabels ? {
                                        display: true,
                                        formatter: function(value) {
                                            return value > 0 ? value.toFixed(0) : '';
                                        },
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        }
                                    } : false
                                },
                                scales: {
                                    x: {
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    }
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.produtividadeChart) {
                            App.charts.produtividadeChart.data = config.data;
                            App.charts.produtividadeChart.options = config.options;
                            App.charts.produtividadeChart.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.produtividadeChart = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar gráfico de histórico
                    updateHistoryChart: function() {
                        const canvas = document.getElementById('historyChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Verificar se há dados de histórico
                        if (!App.data.historico || App.data.historico.length === 0) {
                            if (App.charts.historyChart) {
                                App.charts.historyChart.destroy();
                                App.charts.historyChart = null;
                            }
                            
                            // Mostrar mensagem de sem dados
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.font = '16px ' + getComputedStyle(document.body).getPropertyValue('--font-family');
                            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text-color');
                            ctx.fillText('Nenhum dado histórico disponível.', canvas.width / 2, canvas.height / 2);
                            
                            return;
                        }
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Contar ocorrências por tipo para o gráfico de pizza
                        const typeCount = {
                            add: App.data.historico.filter(h => h.tipo === 'add').length,
                            edit: App.data.historico.filter(h => h.tipo === 'edit').length,
                            delete: App.data.historico.filter(h => h.tipo === 'delete').length,
                            system: App.data.historico.filter(h => h.tipo === 'system').length
                        };
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'pie',
                            data: {
                                labels: ['Inclusões', 'Alterações', 'Exclusões', 'Sistema'],
                                datasets: [
                                    {
                                        data: [typeCount.add, typeCount.edit, typeCount.delete, typeCount.system],
                                        backgroundColor: [
                                            '#4CAF50', // Verde para inclusões
                                            '#2196F3', // Azul para alterações
                                            '#F44336', // Vermelho para exclusões
                                            '#FF9800'  // Laranja para sistema
                                        ],
                                        borderColor: [
                                            '#43A047',
                                            '#1E88E5',
                                            '#E53935',
                                            '#FB8C00'
                                        ],
                                        borderWidth: 1
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Distribuição de Alterações por Tipo',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: textColor
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.label}: ${context.raw} (${((context.raw / App.data.historico.length) * 100).toFixed(1)}%)`;
                                            }
                                        }
                                    },
                                    datalabels: App.config.ui.chartLabels ? {
                                        display: true,
                                        formatter: function(value, context) {
                                            return value > 0 ? value : '';
                                        },
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        }
                                    } : false
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.historyChart) {
                            App.charts.historyChart.data = config.data;
                            App.charts.historyChart.options = config.options;
                            App.charts.historyChart.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.historyChart = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar gráfico comparativo de colheita
                    updateColheitaComparativoChart: function() {
                        const canvas = document.getElementById('colheitaComparativoChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Obter dados
                        const potencialColheita = parseFloat(document.getElementById('potencial-colheita')?.value || 0);
                        const potencialTransporte = parseFloat(document.getElementById('potencial-transporte')?.value || 0);
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'radar',
                            data: {
                                labels: ['Colheita', 'Transporte', 'Eficiência', 'Custos', 'Disponibilidade'],
                                datasets: [
                                    {
                                        label: 'Atual',
                                        data: [potencialColheita / 6, potencialTransporte / 6, 85, 75, 80],
                                        fill: true,
                                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                        borderColor: 'rgb(54, 162, 235)',
                                        pointBackgroundColor: 'rgb(54, 162, 235)',
                                        pointBorderColor: '#fff',
                                        pointHoverBackgroundColor: '#fff',
                                        pointHoverBorderColor: 'rgb(54, 162, 235)'
                                    },
                                    {
                                        label: 'Meta',
                                        data: [100, 100, 90, 70, 90],
                                        fill: true,
                                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                        borderColor: 'rgb(255, 99, 132)',
                                        pointBackgroundColor: 'rgb(255, 99, 132)',
                                        pointBorderColor: '#fff',
                                        pointHoverBackgroundColor: '#fff',
                                        pointHoverBorderColor: 'rgb(255, 99, 132)'
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                elements: {
                                    line: {
                                        borderWidth: 3
                                    }
                                },
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Desempenho vs Meta',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: textColor
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.dataset.label}: ${context.raw}%`;
                                            }
                                        }
                                    }
                                },
                                scale: {
                                    angleLines: {
                                        color: gridColor
                                    },
                                    grid: {
                                        color: gridColor
                                    },
                                    pointLabels: {
                                        color: textColor
                                    },
                                    ticks: {
                                        color: textColor,
                                        backdropColor: 'transparent'
                                    }
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.colheitaComparativoChart) {
                            App.charts.colheitaComparativoChart.data = config.data;
                            App.charts.colheitaComparativoChart.options = config.options;
                            App.charts.colheitaComparativoChart.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.colheitaComparativoChart = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar gráfico histórico de colheita
                    updateColheitaHistoricoChart: function() {
                        const canvas = document.getElementById('colheitaHistoricoChart');
                        if (!canvas) return;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Verificar se existem dados históricos
                        if (!App.data.historicalData || !App.data.historicalData.colheita || App.data.historicalData.colheita.length === 0) {
                            if (App.charts.colheitaHistoricoChart) {
                                App.charts.colheitaHistoricoChart.destroy();
                                App.charts.colheitaHistoricoChart = null;
                            }
                            
                            // Mostrar mensagem de sem dados
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.font = '16px ' + getComputedStyle(document.body).getPropertyValue('--font-family');
                            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text-color');
                            ctx.fillText('Nenhum dado histórico disponível.', canvas.width / 2, canvas.height / 2);
                            
                            return;
                        }
                        
                        // Obter o estado do tema
                        const isDark = document.documentElement.classList.contains('dark');
                        
                        // Cores baseadas no tema
                        const textColor = isDark ? '#e5e7eb' : '#333';
                        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                        
                        // Extrair dados históricos
                        const colheitaData = App.data.historicalData.colheita;
                        const transporteData = App.data.historicalData.transporte;
                        
                        // Preparar dados para o gráfico
                        const labels = colheitaData.map(d => {
                            const date = new Date(d.data);
                            return `${date.getMonth() + 1}/${date.getFullYear()}`;
                        });
                        
                        const colheitaValues = colheitaData.map(d => d.valor);
                        const transporteValues = transporteData.map(d => d.valor);
                        
                        // Configuração do gráfico
                        const config = {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: 'Colheita',
                                        data: colheitaValues,
                                        fill: false,
                                        backgroundColor: '#4CAF50',
                                        borderColor: '#43A047',
                                        tension: 0.1,
                                        pointRadius: 4
                                    },
                                    {
                                        label: 'Transporte',
                                        data: transporteValues,
                                        fill: false,
                                        backgroundColor: '#2196F3',
                                        borderColor: '#1E88E5',
                                        tension: 0.1,
                                        pointRadius: 4
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: App.config.ui.chartAnimations ? {
                                    duration: 1000,
                                    easing: 'easeOutQuart'
                                } : false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Histórico de Potencial (t/h)',
                                        color: textColor,
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: textColor
                                        }
                                    },
                                    tooltip: {
                                        mode: 'index',
                                        intersect: false
                                    }
                                },
                                scales: {
                                    x: {
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: gridColor
                                        },
                                        ticks: {
                                            color: textColor
                                        }
                                    }
                                }
                            }
                        };
                        
                        // Verificar se já existe um gráfico e atualizá-lo
                        if (App.charts.colheitaHistoricoChart) {
                            App.charts.colheitaHistoricoChart.data = config.data;
                            App.charts.colheitaHistoricoChart.options = config.options;
                            App.charts.colheitaHistoricoChart.update();
                        } else {
                            // Criar novo gráfico
                            App.charts.colheitaHistoricoChart = new Chart(ctx, config);
                        }
                    },
                    
                    // Atualizar dashboard
                    updateDashboard: function() {
                        // Atualizar cards
                        let totalCota = 0;
                        let totalPotencial = 0;
                        
                        App.data.frentes.forEach(frente => {
                            totalCota += parseFloat(frente.cota) || 0;
                        });
                        
                        const potencialColheita = parseFloat(document.getElementById('potencial-colheita')?.value || 0);
                        const potencialTransporte = parseFloat(document.getElementById('potencial-transporte')?.value || 0);
                        
                        const propriosDisponiveis = parseInt(document.getElementById('proprios-disponiveis')?.value || 0);
                        const terceirosDisponiveis = parseInt(document.getElementById('terceiros-disponiveis')?.value || 0);
                        const totalCaminhoes = propriosDisponiveis + terceirosDisponiveis;
                        
                        // Atualizar valores
                        document.getElementById('dashboard-cota').textContent = totalCota.toFixed(0);
                        document.getElementById('dashboard-colheita').textContent = potencialColheita.toFixed(0);
                        document.getElementById('dashboard-transporte').textContent = potencialTransporte.toFixed(0);
                        document.getElementById('dashboard-caminhoes').textContent = totalCaminhoes;
                        
                        // Atualizar barras de progresso
                        const cotaProgress = Math.min(100, (totalCota / 15000) * 100);
                        const colheitaProgress = Math.min(100, (potencialColheita / 600) * 100);
                        const transporteProgress = Math.min(100, (potencialTransporte / 550) * 100);
                        const caminhoesProgress = Math.min(100, (totalCaminhoes / 60) * 100);
                        
                        document.getElementById('cota-progress').style.width = `${cotaProgress}%`;
                        document.getElementById('colheita-progress').style.width = `${colheitaProgress}%`;
                        document.getElementById('transporte-progress').style.width = `${transporteProgress}%`;
                        document.getElementById('caminhoes-progress').style.width = `${caminhoesProgress}%`;
                        
                        // Atualizar labels de progresso
                        document.querySelector('#dashboard-card-cota .progress-label span:first-child').textContent = `${Math.round(cotaProgress)}% da meta`;
                        document.querySelector('#dashboard-card-colheita .progress-label span:first-child').textContent = `${Math.round(colheitaProgress)}% do projetado`;
                        document.querySelector('#dashboard-card-transporte .progress-label span:first-child').textContent = `${Math.round(transporteProgress)}% do projetado`;
                        document.querySelector('#dashboard-card-caminhoes .progress-label span:first-child').textContent = `${Math.round(caminhoesProgress)}% da frota`;
                        
                        // Atualizar resumo de frentes
                        this.updateResumoFrentes();
                        
                        // Atualizar gráficos do dashboard
                        this.updatePotencialChart();
                        this.updateTransporteChart();
                        this.updateEfficiencyChart();
                        this.updateColheitaComparativoChart();
                        this.updateColheitaHistoricoChart();
                    }
                };
                
                // Inicializar aplicação
                App.init();
            }
        });
    </script>
</body>
</html>